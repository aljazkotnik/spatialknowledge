{"version":3,"file":"spatialknowledge_chess.js","sources":["../../src/helpers.js","../../src/grouping/Item.js","../../src/renderers/chess/chessground_es.js","../../src/renderers/chess/chess.js","../../src/renderers/playbar/PlayButton.js","../../src/renderers/playbar/PlayBarAnnotation.js","../../src/renderers/playbar/PlayBar.js","../../src/renderers/playbar/PlayControls.js","../../src/renderers/ChessGameRenderer.js","../../src/knowledge/tagging/TagForm.js","../../src/knowledge/tagging/TagButton.js","../../src/knowledge/tagging/TagOverview.js","../../src/knowledge/commenting/AddCommentForm.js","../../src/knowledge/commenting/Comment.js","../../src/knowledge/commenting/ReplyComment.js","../../src/knowledge/commenting/GeneralComment.js","../../src/knowledge/commenting/CommentingManager.js","../../src/knowledge/AnnotationSystem.js","../../src/grouping/ChessGame.js","../../src/navigation/tree/DrawLink.js","../../src/navigation/tree/TreeBundle.js","../../src/navigation/tree/TreeLevel.js","../../src/navigation/tree/dimensioning.js","../../src/navigation/tree/TreeNode.js","../../src/navigation/tree/hierarchy.js","../../src/navigation/tree/TreeHierarchy.js","../../src/navigation/tree/TreeKnowledge.js","../../src/navigation/minimap/MiniMapIcon.js","../../src/navigation/minimap/MiniMapViewRect.js","../../src/navigation/arrangement/CorrelationsMenu.js","../../src/navigation/arrangement/SpatialCorrelations.js","../../src/navigation/minimap/MiniMap.js","../../src/navigation/lasso/Lasso.js","../../src/knowledge/tagging/TagValueBatchForm.js","../../src/grouping/Group.js","../../src/navigation/NavigationManager.js","../../src/knowledge/KnowledgeManager.js","../../src/main_chess.js"],"sourcesContent":["export function html2element(html){\r\n  let template = document.createElement('template'); \r\n  template.innerHTML = html.trim(); // Never return a text node of whitespace as the result\r\n  return template.content.firstChild;\r\n} // html2element\r\n\r\nexport function svg2element(svg){\r\n  let g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n  g.innerHTML = svg.trim();\r\n  return g.firstChild;\r\n} // svg2element\r\n\r\n\r\n\r\n\r\n// How to make the addition of dragging more general?? There are some things that have to happen. Pass them in as additional functions?\r\nexport function addDraggingToItem(item, onstart, ondrag, onend){\r\n\t// Add an object to facilitate the dragging.\r\n\t\r\n\tlet active = false;\r\n\tlet itemRelativePosition = [0, 0];\r\n\t\r\n\titem.node.onmouseenter = function(){\r\n\t\tactive = false;\r\n\t} // onmouseenter\r\n\titem.node.onmouseleave = function(){\r\n\t\tactive = false;\r\n\t} // onmouseleave\r\n\titem.node.onmousedown = function(e){\r\n\t\tif(e.target == item.node || e.target == item.wrappednode){\r\n\t\t\tlet rect = item.node.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\tactive = true;\r\n\t\t\titemRelativePosition = [\r\n\t\t\t\te.clientX - rect.x,\r\n\t\t\t\te.clientY - rect.y\r\n\t\t\t];\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Also move the viewFrame div up so that dragging over otehr higher divs is uninterrupted.\r\n\t\t\titem.node.parentNode.insertBefore(item.node, null);\r\n\t\t\t\r\n\t\t\tif(onstart){onstart()} // if\r\n\t\t} // if\r\n\t} // onmousedown\r\n\titem.node.onmousemove = function(e){\r\n\t\tif(active){\r\n\t\t\tlet x = e.pageX - itemRelativePosition[0];\r\n\t\t\tlet y = e.pageY - itemRelativePosition[1];\r\n\t\t\t\r\n\t\t\titem.node.style.left = x + \"px\"\r\n\t\t\titem.node.style.top  = y + \"px\"\r\n\t\t\t\r\n\t\t\tif(ondrag){ondrag()};\r\n\t\t} // if\r\n\t} // mousemove\r\n\titem.node.onmouseup   = function(){\r\n\t\tactive = false;\r\n\t\tif(onend){onend()};\r\n\t} // onmouseup\r\n} // addDraggingToItem\r\n\r\n\r\n\r\n\r\n// Will I need this dragging elsewhere??\r\nexport function addDraggingToSvgItem(svg, item){\r\n\t// SVG movement should be done in SVG coordinates. As the SVG is small, and never moves off screen, the relative position can be calculated on hte go.\r\n\t// The item can never move off the svg, as when it's dragged to the border and the mouse moves over the edge it stops being dragged. The rectangle is well behaved when the mouse re-enters the svg, and only skips when the rectangle is re-entered. Still, it may be good to stop the dragging if th emouse leaves the svg.\r\n\t\r\n\tlet active = false;\r\n\tlet clickedItemOffset = [0,0];\r\n\t\r\n\t\r\n\titem.onmousedown = function(e){\r\n\t\tactive = true;\r\n\t\t\r\n\t\t// Correcting for clicked position within item.\r\n\t\tlet itemClientRect = item.getBoundingClientRect();\r\n\t\tclickedItemOffset = {\r\n\t\t\tx: itemClientRect.x - e.clientX,\r\n\t\t\ty: itemClientRect.y - e.clientY\r\n\t\t} // clickedItemOffset\r\n\t} // onmousedown\r\n\titem.onmousemove = function(e){\r\n\t\tif(active){\r\n\t\t\t// Convert the mouse position into the position within the parent SVG:\r\n\t\t\tlet svgClientRect = svg.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\t// Check if the mouse left the svg.\r\n\t\t\tif(isEventWithinRectangle(e, svgClientRect)){\r\n\t\t\t\tlet x = e.clientX - svgClientRect.x + clickedItemOffset.x;\r\n\t\t\t\tlet y = e.clientY - svgClientRect.y + clickedItemOffset.y;\r\n\t\t\t\t\r\n\t\t\t\titem.setAttribute(\"x\", x)\r\n\t\t\t\titem.setAttribute(\"y\", y)\r\n\t\t\t} else {\r\n\t\t\t\tactive = false;\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t} // if\r\n\t} // mousemove\r\n\titem.onmouseup   = function(){\r\n\t\tactive = false;\r\n\t} // onmouseup\r\n} // addDraggingToItem\r\n\r\n\r\n\r\n\r\nexport function isWithinBoundingClientRect(A, B){\r\n\t// A and B are expected to be the results of \"getBoundingClientRect\"\r\n\treturn ( A.x > B.x && A.x < B.x + B.width ) &&\r\n\t       ( A.y > B.y && A.y < B.y + B.height );\r\n} // isEventWithinRectangle\r\n\r\n\r\n\r\nexport class scaleCategorical {\r\n  domain = []\r\n  range = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf']\r\n\r\n  // Opposite function is not defined - two domain values can map to the same range value.\r\n  dom2range(v){\r\n\tlet obj = this;\r\n\tif(v){\r\n\t\tlet i = (obj.domain.indexOf(v)+1) % obj.range.length - 1;\r\n\t\tif(i<0){\r\n\t\t\tobj.domain.push(v);\r\n\t\t\treturn obj.range[obj.domain.length-1];\r\n\t\t} else {\r\n\t\t\treturn obj.range[i];\r\n\t\t} // if\r\n\t} else {\r\n\t\t// If v isn't a truthy just return black.\r\n\t\treturn '#000000';\r\n\t} // if\r\n  } // dom2range\r\n  \r\n} // scaleCategorical\r\n\r\n\r\n\r\nexport class scaleLinear {\r\n  \r\n  _domain = [0, 1]\r\n  _range = [0, 1]\r\n\r\n  set domain(d){ this._domain = d } // domain\r\n  get domain(){ return this._domain } // domain\r\n\r\n  set range(r){ this._range = r } // range\r\n  get range(){ return this._range } // range\r\n\r\n  dom2range(v){\r\n\treturn mapSpaceAValueToSpaceB(v, this.domain, this.range)\r\n  } // dom2range\r\n  \r\n  range2dom(v){\r\n\treturn mapSpaceAValueToSpaceB(v, this.range, this.domain)  \r\n  } // range2dom\r\n} // scaleLinear\r\n\r\nfunction mapSpaceAValueToSpaceB(v, A, B){\r\n\treturn (v-A[0])/(A[1]-A[0]) * (B[1]-B[0]) + B[0]\r\n} // mapSpaceAValueToSpaceB\r\n\r\n\r\n\r\n// From regular helpers.\r\nexport function unique(d){\t\t\r\n\t// https://stackoverflow.com/questions/1960473/get-all-unique-values-in-a-javascript-array-remove-duplicates\r\n\tfunction onlyUnique(value, index, self) { \r\n\t\treturn self.indexOf(value) === index;\r\n\t} // unique\r\n\t\r\n\treturn d.filter( onlyUnique )\r\n\r\n} // unique\r\n\r\nexport function arrayEqual(A, B){\r\n\t\r\n\treturn arrayIncludesAll(A, B)\r\n\t\t&& arrayIncludesAll(B, A)\r\n\t\r\n} // arrayEqual\r\n\r\nexport function arrayIncludesAll(A,B){\r\n\t// 'arrayIncludesAll' checks if array A includes all elements of array B. The elements of the arrays are expected to be strings.\r\n\t\r\n\t// Return element of B if it is not contained in A. If the response array has length 0 then A includes all elements of B, and 'true' is returned.\r\n\tvar f = B.filter(function(b){\r\n\t\treturn !A.includes(b)\r\n\t})\r\n\t\r\n\treturn f.length == 0? true : false\r\n} // arrayIncludesAll\r\n\r\n\r\nexport function joinDataToElements(data, elements, idAccessor){\r\n  \r\n  // Find data that has no elements, find the elements that have data, and the leftover.\r\n  let elementsArray = [...elements];\r\n  let elementsDataIds = elementsArray.map(el=>idAccessor(el.__data__));\r\n  \r\n  \r\n  let g = elementsArray.reduce((acc,el)=>{\r\n\tlet d = data.filter(d_=>{\r\n\t\treturn idAccessor(el.__data__) == idAccessor(d_)\r\n\t}) // filter\r\n\tif( d.length > 0 ){\r\n\t  el.__data__ = d[0]\r\n\t  acc.update.push(el)\r\n\t} else {\r\n\t  acc.exit.push(el)\r\n\t} // if\r\n\treturn acc\r\n  }, {update: [], exit: []}) // filter\r\n  \r\n  g.enter = data.filter(d=>{\r\n\treturn !elementsDataIds.includes(idAccessor(d))\r\n  }) // filter\r\n  \r\n  return g\r\n} // joinDataToElements","import { html2element } from \"../helpers.js\";\r\n\r\nlet template = `\r\n<div class=\"item\">\r\n  <div class=\"head unselectable\">\r\n    <p class=\"label\"></p>\r\n\t<span class=\"button dissolve\" style=\"display: none;\">✖</span>\r\n\t<span class=\"button enter\" style=\"display: none;\">⮊</span>\r\n  </div>\r\n  <div class=\"viewcontainer\"></div>\r\n  <div class=\"preview\"></div>\r\n  <div class=\"commenting\"></div>\r\n</div>\r\n`;\r\n\r\n/*\r\n`Item' is a basis for individual small multiples as well as groups. It implements the node creation and appends dragging.\r\n\r\nScaling: the container is transformed to include zooming/panning. When the zoom happens the items are prompted to check whether they are still large enough to draw the data.\r\n*/\r\nexport default class Item{\r\n\t\r\n  // Main viewport dimensions;\r\n  width = 300;\r\n  height = 200;\r\n\t\r\n  constructor(){\r\n\tlet obj = this;\r\n\t  \r\n\t\r\n\tobj.node = html2element(template);\r\n\tobj.node.style.position = \"absolute\";\r\n\t  \r\n\tobj.viewnode = obj.node.querySelector(\"div.viewcontainer\");\r\n\t// obj.viewnode.style.height = obj.height + \"px\";\r\n\t// obj.viewnode.style.width = obj.width + \"px\";\r\n\t  \r\n\tobj.previewnode = obj.node.querySelector(\"div.preview\");\r\n\t// obj.previewnode.style.maxWidth = obj.width + \"px\";\r\n\t\r\n\t// Add the dragging in here. The dragging is supposed to be in a scaled, and potentially tranlated div, so the offset to the div needs to be removed.\r\n\tlet active = false;\r\n\tlet itemStartPosition = [0,0];\r\n\tlet itemRelativePosition = [0, 0];\r\n\t\t\r\n\t\t\r\n\t// The `e.target == obj.node' prevents any events on the children elements to bubble up. This require the title width to be 0, and it prevented from a button being positioned to the right. \r\n\t// `obj.node.contains(e.target)' allows any children to launch the dragging, but this will interfere with the panning and zooming in the viewport div.\r\n\t// Maybe any child that is contained by obj.node. but not the viewport node?\r\n\tobj.node.onmousedown = function(e){\r\n\t  if(obj.node.contains(e.target) && !obj.viewnode.contains(e.target) && obj.node.isConnected){\r\n\t\t// e.preventDefault();\r\n\t\tlet rect = obj.node.getBoundingClientRect();\r\n\t\t\r\n\t\tactive = true;\r\n\t\titemStartPosition = obj.position;\r\n\t\titemRelativePosition = [\r\n\t\t  e.clientX - rect.x,\r\n\t\t  e.clientY - rect.y\r\n\t\t];\r\n\t\t\r\n\t\t// Also move the viewFrame div up so that dragging over otehr higher divs is uninterrupted.\r\n\t\tobj.node.parentNode.insertBefore(obj.node, null);\r\n\t  } // if\r\n\t} // onmousedown\r\n\tobj.node.onmousemove = function(e){\r\n\t  if(active){\r\n\t\te.preventDefault();\r\n\t\t\r\n\t\t// The parent may be rescaled, retrieve and collect the k from it.\r\n\t\tlet p = obj.node.parentElement;\r\n\t\tlet k = Number( p.style.transform.split(\" \")[0].replace(/^\\D+|\\D+$/g, \"\") );\r\n\t\tlet parentRect = p.getBoundingClientRect();\r\n\t\t\r\n\t\tlet x = e.pageX - parentRect.x - itemRelativePosition[0];\r\n\t\tlet y = e.pageY - parentRect.y - itemRelativePosition[1];\r\n\t\t\r\n\t\tobj.position = [x/k, y/k];\r\n\t\t\r\n\t\tobj.onmove();\r\n\t  } // if\r\n\t} // mousemove\r\n\tobj.node.onmouseup = function(){ \r\n\t  if(active){\r\n\t\t  obj.onend(itemStartPosition);\r\n\t  } // if\r\n\t  active = false;\r\n\t} // onmouseup\r\n\tobj.node.onmouseenter = function(){ active = false; } // onmouseenter\r\n\tobj.node.onmouseleave = function(){ active = false; } // onmouseleave\r\n  } // constructor\r\n  \r\n  \r\n  // Generic hide, show, and position methods.\r\n  show(){\r\n\tlet obj = this;\r\n\tobj.node.style.display = \"\";\r\n  } // show\r\n  \r\n  hide(){\r\n\tlet obj = this;\r\n\tobj.node.style.display = \"none\";\r\n  } // hide\r\n  \r\n  set position(point){\r\n\tlet obj = this;\r\n\tobj.node.style.left = point[0] + \"px\";\r\n\tobj.node.style.top  = point[1] + \"px\";\r\n  } // set position\r\n  \r\n  get position(){\r\n\t  let obj = this;\r\n\t  return [\r\n\t    parseFloat(obj.node.style.left),\r\n\t\tparseFloat(obj.node.style.top)\r\n\t  ]\r\n  } // get position\r\n  \r\n  // superclass method defined in the subclasses.\r\n  checksize(){} // checksize\r\n  \r\n  \r\n  // Dummy method. Superset in NavigationManager to trigger the minimap update.\r\n  onmove(){} // onmove\r\n  \r\n  // Dummy method. Superset in Navigationmanager.track to allow adding to groups.\r\n  onend(){} // onend\r\n  \r\n  \r\n  isonscreen(){\r\n\tlet obj = this;\r\n\t// Check if any part of the item is on-screen. Or should there be a tolerance of a few pixels?\r\n\tlet rect = obj.node.getBoundingClientRect();\r\n\t\r\n\t// East, West, North, South\r\n\tlet outside = (rect.x > window.innerWidth) || \r\n\t              (rect.x + rect.width < 0) || \r\n\t\t\t\t  (rect.y + rect.height < 0) || \r\n\t\t\t\t  (rect.y > window.innerHeight);\r\n\t\r\n\treturn !outside && obj.node.style.display != \"none\";\r\n  } // isonscreen\r\n  \r\n} // Item","var colors = ['white', 'black'];\nvar files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\nvar ranks = ['1', '2', '3', '4', '5', '6', '7', '8'];\n\nlet invRanks = [...ranks].reverse();\nvar allKeys = Array.prototype.concat(...files.map(c => ranks.map(r => c + r)));\nvar pos2key = (pos) => allKeys[8 * pos[0] + pos[1]];\nvar key2pos = (k) => [k.charCodeAt(0) - 97, k.charCodeAt(1) - 49];\nvar allPos = allKeys.map(key2pos);\n\nfunction memo(f) {\n    let v;\n    const ret = () => {\n        if (v === undefined)\n            v = f();\n        return v;\n    };\n    ret.clear = () => {\n        v = undefined;\n    };\n    return ret;\n}\n\nvar timer = () => {\n    let startAt;\n    return {\n        start() {\n            startAt = performance.now();\n        },\n        cancel() {\n            startAt = undefined;\n        },\n        stop() {\n            if (!startAt)\n                return 0;\n            const time = performance.now() - startAt;\n            startAt = undefined;\n            return time;\n        },\n    };\n};\n\nvar opposite = (c) => (c === 'white' ? 'black' : 'white');\n\nvar distanceSq = (pos1, pos2) => {\n    const dx = pos1[0] - pos2[0], dy = pos1[1] - pos2[1];\n    return dx * dx + dy * dy;\n};\n\nvar samePiece = (p1, p2) => p1.role === p2.role && p1.color === p2.color;\nvar posToTranslateBase = (pos, asWhite, xFactor, yFactor) => [\n    (asWhite ? pos[0] : 7 - pos[0]) * xFactor,\n    (asWhite ? 7 - pos[1] : pos[1]) * yFactor,\n];\nvar posToTranslateAbs = (bounds) => {\n    const xFactor = bounds.width / 8, yFactor = bounds.height / 8;\n    return (pos, asWhite) => posToTranslateBase(pos, asWhite, xFactor, yFactor);\n};\nvar posToTranslateRel = (pos, asWhite) => posToTranslateBase(pos, asWhite, 100, 100);\nvar translateAbs = (el, pos) => {\n    el.style.transform = `translate(${pos[0]}px,${pos[1]}px)`;\n};\nvar translateRel = (el, percents) => {\n    el.style.transform = `translate(${percents[0]}%,${percents[1]}%)`;\n};\nvar setVisible = (el, v) => {\n    el.style.visibility = v ? 'visible' : 'hidden';\n};\nvar eventPosition = (e) => {\n    var _a;\n    if (e.clientX || e.clientX === 0)\n        return [e.clientX, e.clientY];\n    if ((_a = e.targetTouches) === null || _a === void 0 ? void 0 : _a[0])\n        return [e.targetTouches[0].clientX, e.targetTouches[0].clientY];\n    return;\n};\nvar isRightButton = (e) => e.buttons === 2 || e.button === 2;\nvar createEl = (tagName, className) => {\n    const el = document.createElement(tagName);\n    if (className)\n        el.className = className;\n    return el;\n};\nfunction computeSquareCenter(key, asWhite, bounds) {\n    const pos = key2pos(key);\n    if (!asWhite) {\n        pos[0] = 7 - pos[0];\n        pos[1] = 7 - pos[1];\n    }\n    return [\n        bounds.left + (bounds.width * pos[0]) / 8 + bounds.width / 16,\n        bounds.top + (bounds.height * (7 - pos[1])) / 8 + bounds.height / 16,\n    ];\n}\n\nfunction diff(a, b) {\n    return Math.abs(a - b);\n}\nfunction pawn(color) {\n    return (x1, y1, x2, y2) => diff(x1, x2) < 2 &&\n        (color === 'white'\n            ?\n                y2 === y1 + 1 || (y1 <= 1 && y2 === y1 + 2 && x1 === x2)\n            : y2 === y1 - 1 || (y1 >= 6 && y2 === y1 - 2 && x1 === x2));\n}\nvar knight = (x1, y1, x2, y2) => {\n    const xd = diff(x1, x2);\n    const yd = diff(y1, y2);\n    return (xd === 1 && yd === 2) || (xd === 2 && yd === 1);\n};\n\nconst bishop = (x1, y1, x2, y2) => {\n    return diff(x1, x2) === diff(y1, y2);\n};\nconst rook = (x1, y1, x2, y2) => {\n    return x1 === x2 || y1 === y2;\n};\nvar queen = (x1, y1, x2, y2) => {\n    return bishop(x1, y1, x2, y2) || rook(x1, y1, x2, y2);\n};\n\nfunction king(color, rookFiles, canCastle) {\n    return (x1, y1, x2, y2) => (diff(x1, x2) < 2 && diff(y1, y2) < 2) ||\n        (canCastle &&\n            y1 === y2 &&\n            y1 === (color === 'white' ? 0 : 7) &&\n            ((x1 === 4 && ((x2 === 2 && rookFiles.includes(0)) || (x2 === 6 && rookFiles.includes(7)))) ||\n                rookFiles.includes(x2)));\n}\nfunction rookFilesOf(pieces, color) {\n    const backrank = color === 'white' ? '1' : '8';\n    const files = [];\n    for (const [key, piece] of pieces) {\n        if (key[1] === backrank && piece.color === color && piece.role === 'rook') {\n            files.push(key2pos(key)[0]);\n        }\n    }\n    return files;\n}\nfunction premove(pieces, key, canCastle) {\n    const piece = pieces.get(key);\n    if (!piece)\n        return [];\n    const pos = key2pos(key), r = piece.role, mobility = r === 'pawn'\n        ? pawn(piece.color)\n        : r === 'knight'\n            ? knight\n            : r === 'bishop'\n                ? bishop\n                : r === 'rook'\n                    ? rook\n                    : r === 'queen'\n                        ? queen\n                        : king(piece.color, rookFilesOf(pieces, piece.color), canCastle);\n    return allPos\n        .filter(pos2 => (pos[0] !== pos2[0] || pos[1] !== pos2[1]) && mobility(pos[0], pos[1], pos2[0], pos2[1]))\n        .map(pos2key);\n}\n\nfunction callUserFunction(f, ...args) {\n    if (f)\n        setTimeout(() => f(...args), 1);\n}\nfunction toggleOrientation(state) {\n    state.orientation = opposite(state.orientation);\n    state.animation.current = state.draggable.current = state.selected = undefined;\n}\nfunction setPieces(state, pieces) {\n    for (const [key, piece] of pieces) {\n        if (piece)\n            state.pieces.set(key, piece);\n        else\n            state.pieces.delete(key);\n    }\n}\nfunction setCheck(state, color) {\n    state.check = undefined;\n    if (color === true)\n        color = state.turnColor;\n    if (color)\n        for (const [k, p] of state.pieces) {\n            if (p.role === 'king' && p.color === color) {\n                state.check = k;\n            }\n        }\n}\nfunction setPremove(state, orig, dest, meta) {\n    unsetPredrop(state);\n    state.premovable.current = [orig, dest];\n    callUserFunction(state.premovable.events.set, orig, dest, meta);\n}\nfunction unsetPremove(state) {\n    if (state.premovable.current) {\n        state.premovable.current = undefined;\n        callUserFunction(state.premovable.events.unset);\n    }\n}\nfunction setPredrop(state, role, key) {\n    unsetPremove(state);\n    state.predroppable.current = { role, key };\n    callUserFunction(state.predroppable.events.set, role, key);\n}\nfunction unsetPredrop(state) {\n    const pd = state.predroppable;\n    if (pd.current) {\n        pd.current = undefined;\n        callUserFunction(pd.events.unset);\n    }\n}\nfunction tryAutoCastle(state, orig, dest) {\n    if (!state.autoCastle)\n        return false;\n    const king = state.pieces.get(orig);\n    if (!king || king.role !== 'king')\n        return false;\n    const origPos = key2pos(orig);\n    const destPos = key2pos(dest);\n    if ((origPos[1] !== 0 && origPos[1] !== 7) || origPos[1] !== destPos[1])\n        return false;\n    if (origPos[0] === 4 && !state.pieces.has(dest)) {\n        if (destPos[0] === 6)\n            dest = pos2key([7, destPos[1]]);\n        else if (destPos[0] === 2)\n            dest = pos2key([0, destPos[1]]);\n    }\n    const rook = state.pieces.get(dest);\n    if (!rook || rook.color !== king.color || rook.role !== 'rook')\n        return false;\n    state.pieces.delete(orig);\n    state.pieces.delete(dest);\n    if (origPos[0] < destPos[0]) {\n        state.pieces.set(pos2key([6, destPos[1]]), king);\n        state.pieces.set(pos2key([5, destPos[1]]), rook);\n    }\n    else {\n        state.pieces.set(pos2key([2, destPos[1]]), king);\n        state.pieces.set(pos2key([3, destPos[1]]), rook);\n    }\n    return true;\n}\nfunction baseMove(state, orig, dest) {\n    const origPiece = state.pieces.get(orig), destPiece = state.pieces.get(dest);\n    if (orig === dest || !origPiece)\n        return false;\n    const captured = destPiece && destPiece.color !== origPiece.color ? destPiece : undefined;\n    if (dest === state.selected)\n        unselect(state);\n    callUserFunction(state.events.move, orig, dest, captured);\n    if (!tryAutoCastle(state, orig, dest)) {\n        state.pieces.set(dest, origPiece);\n        state.pieces.delete(orig);\n    }\n    state.lastMove = [orig, dest];\n    state.check = undefined;\n    callUserFunction(state.events.change);\n    return captured || true;\n}\n\nfunction baseNewPiece(state, piece, key, force) {\n    if (state.pieces.has(key)) {\n        if (force)\n            state.pieces.delete(key);\n        else\n            return false;\n    }\n    callUserFunction(state.events.dropNewPiece, piece, key);\n    state.pieces.set(key, piece);\n    state.lastMove = [key];\n    state.check = undefined;\n    callUserFunction(state.events.change);\n    state.movable.dests = undefined;\n    state.turnColor = opposite(state.turnColor);\n    return true;\n}\n\nfunction baseUserMove(state, orig, dest) {\n    const result = baseMove(state, orig, dest);\n    if (result) {\n        state.movable.dests = undefined;\n        state.turnColor = opposite(state.turnColor);\n        state.animation.current = undefined;\n    }\n    return result;\n}\nfunction userMove(state, orig, dest) {\n    if (canMove(state, orig, dest)) {\n        const result = baseUserMove(state, orig, dest);\n        if (result) {\n            const holdTime = state.hold.stop();\n            unselect(state);\n            const metadata = {\n                premove: false,\n                ctrlKey: state.stats.ctrlKey,\n                holdTime,\n            };\n            if (result !== true)\n                metadata.captured = result;\n            callUserFunction(state.movable.events.after, orig, dest, metadata);\n            return true;\n        }\n    }\n    else if (canPremove(state, orig, dest)) {\n        setPremove(state, orig, dest, {\n            ctrlKey: state.stats.ctrlKey,\n        });\n        unselect(state);\n        return true;\n    }\n    unselect(state);\n    return false;\n}\n\nfunction dropNewPiece(state, orig, dest, force) {\n    const piece = state.pieces.get(orig);\n    if (piece && (canDrop(state, orig, dest) || force)) {\n        state.pieces.delete(orig);\n        baseNewPiece(state, piece, dest, force);\n        callUserFunction(state.movable.events.afterNewPiece, piece.role, dest, {\n            premove: false,\n            predrop: false,\n        });\n    }\n    else if (piece && canPredrop(state, orig, dest)) {\n        setPredrop(state, piece.role, dest);\n    }\n    else {\n        unsetPremove(state);\n        unsetPredrop(state);\n    }\n    state.pieces.delete(orig);\n    unselect(state);\n}\n\nfunction selectSquare(state, key, force) {\n    callUserFunction(state.events.select, key);\n    if (state.selected) {\n        if (state.selected === key && !state.draggable.enabled) {\n            unselect(state);\n            state.hold.cancel();\n            return;\n        }\n        else if ((state.selectable.enabled || force) && state.selected !== key) {\n            if (userMove(state, state.selected, key)) {\n                state.stats.dragged = false;\n                return;\n            }\n        }\n    }\n    if (isMovable(state, key) || isPremovable(state, key)) {\n        setSelected(state, key);\n        state.hold.start();\n    }\n}\n\nfunction setSelected(state, key) {\n    state.selected = key;\n    if (isPremovable(state, key)) {\n        state.premovable.dests = premove(state.pieces, key, state.premovable.castle);\n    }\n    else\n        state.premovable.dests = undefined;\n}\n\nfunction unselect(state) {\n    state.selected = undefined;\n    state.premovable.dests = undefined;\n    state.hold.cancel();\n}\nfunction isMovable(state, orig) {\n    const piece = state.pieces.get(orig);\n    return (!!piece &&\n        (state.movable.color === 'both' || (state.movable.color === piece.color && state.turnColor === piece.color)));\n}\nfunction canMove(state, orig, dest) {\n    var _a, _b;\n    return (orig !== dest && isMovable(state, orig) && (state.movable.free || !!((_b = (_a = state.movable.dests) === null || _a === void 0 ? void 0 : _a.get(orig)) === null || _b === void 0 ? void 0 : _b.includes(dest))));\n}\nfunction canDrop(state, orig, dest) {\n    const piece = state.pieces.get(orig);\n    return (!!piece &&\n        (orig === dest || !state.pieces.has(dest)) &&\n        (state.movable.color === 'both' || (state.movable.color === piece.color && state.turnColor === piece.color)));\n}\nfunction isPremovable(state, orig) {\n    const piece = state.pieces.get(orig);\n    return !!piece && state.premovable.enabled && state.movable.color === piece.color && state.turnColor !== piece.color;\n}\nfunction canPremove(state, orig, dest) {\n    return (orig !== dest && isPremovable(state, orig) && premove(state.pieces, orig, state.premovable.castle).includes(dest));\n}\nfunction canPredrop(state, orig, dest) {\n    const piece = state.pieces.get(orig);\n    const destPiece = state.pieces.get(dest);\n    return (!!piece &&\n        (!destPiece || destPiece.color !== state.movable.color) &&\n        state.predroppable.enabled &&\n        (piece.role !== 'pawn' || (dest[1] !== '1' && dest[1] !== '8')) &&\n        state.movable.color === piece.color &&\n        state.turnColor !== piece.color);\n}\nfunction isDraggable(state, orig) {\n    const piece = state.pieces.get(orig);\n    return (!!piece &&\n        state.draggable.enabled &&\n        (state.movable.color === 'both' ||\n            (state.movable.color === piece.color && (state.turnColor === piece.color || state.premovable.enabled))));\n}\nfunction playPremove(state) {\n    const move = state.premovable.current;\n    if (!move)\n        return false;\n    const orig = move[0], dest = move[1];\n    let success = false;\n    if (canMove(state, orig, dest)) {\n        const result = baseUserMove(state, orig, dest);\n        if (result) {\n            const metadata = { premove: true };\n            if (result !== true)\n                metadata.captured = result;\n            callUserFunction(state.movable.events.after, orig, dest, metadata);\n            success = true;\n        }\n    }\n    unsetPremove(state);\n    return success;\n}\nfunction playPredrop(state, validate) {\n    const drop = state.predroppable.current;\n    let success = false;\n    if (!drop)\n        return false;\n    if (validate(drop)) {\n        const piece = {\n            role: drop.role,\n            color: state.movable.color,\n        };\n        if (baseNewPiece(state, piece, drop.key)) {\n            callUserFunction(state.movable.events.afterNewPiece, drop.role, drop.key, {\n                premove: false,\n                predrop: true,\n            });\n            success = true;\n        }\n    }\n    unsetPredrop(state);\n    return success;\n}\nfunction cancelMove(state) {\n    unsetPremove(state);\n    unsetPredrop(state);\n    unselect(state);\n}\nfunction stop(state) {\n    state.movable.color = state.movable.dests = state.animation.current = undefined;\n    cancelMove(state);\n}\nfunction getKeyAtDomPos(pos, asWhite, bounds) {\n    let file = Math.floor((8 * (pos[0] - bounds.left)) / bounds.width);\n    if (!asWhite)\n        file = 7 - file;\n    let rank = 7 - Math.floor((8 * (pos[1] - bounds.top)) / bounds.height);\n    if (!asWhite)\n        rank = 7 - rank;\n    return file >= 0 && file < 8 && rank >= 0 && rank < 8 ? pos2key([file, rank]) : undefined;\n}\nfunction getSnappedKeyAtDomPos(orig, pos, asWhite, bounds) {\n    const origPos = key2pos(orig);\n    const validSnapPos = allPos.filter(pos2 => {\n        return queen(origPos[0], origPos[1], pos2[0], pos2[1]) || knight(origPos[0], origPos[1], pos2[0], pos2[1]);\n    });\n    const validSnapCenters = validSnapPos.map(pos2 => computeSquareCenter(pos2key(pos2), asWhite, bounds));\n    const validSnapDistances = validSnapCenters.map(pos2 => distanceSq(pos, pos2));\n    const [, closestSnapIndex] = validSnapDistances.reduce((a, b, index) => (a[0] < b ? a : [b, index]), [\n        validSnapDistances[0],\n        0,\n    ]);\n    return pos2key(validSnapPos[closestSnapIndex]);\n}\nfunction whitePov(s) {\n    return s.orientation === 'white';\n}\n\nvar initial = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\nconst roles = {\n    p: 'pawn',\n    r: 'rook',\n    n: 'knight',\n    b: 'bishop',\n    q: 'queen',\n    k: 'king',\n};\nconst letters = {\n    pawn: 'p',\n    rook: 'r',\n    knight: 'n',\n    bishop: 'b',\n    queen: 'q',\n    king: 'k',\n};\nfunction read(fen) {\n    if (fen === 'start')\n        fen = initial;\n    const pieces = new Map();\n    let row = 7, col = 0;\n    for (const c of fen) {\n        switch (c) {\n            case ' ':\n                return pieces;\n            case '/':\n                --row;\n                if (row < 0)\n                    return pieces;\n                col = 0;\n                break;\n            case '~':\n                const piece = pieces.get(pos2key([col, row]));\n                if (piece)\n                    piece.promoted = true;\n                break;\n            default:\n                const nb = c.charCodeAt(0);\n                if (nb < 57)\n                    col += nb - 48;\n                else {\n                    const role = c.toLowerCase();\n                    pieces.set(pos2key([col, row]), {\n                        role: roles[role],\n                        color: c === role ? 'black' : 'white',\n                    });\n                    ++col;\n                }\n        }\n    }\n    return pieces;\n}\n\nfunction write(pieces) {\n    return invRanks\n        .map(y => files\n        .map(x => {\n        const piece = pieces.get((x + y));\n        if (piece) {\n            const letter = letters[piece.role];\n            return piece.color === 'white' ? letter.toUpperCase() : letter;\n        }\n        else\n            return '1';\n    })\n        .join(''))\n        .join('/')\n        .replace(/1{2,}/g, s => s.length.toString());\n}\n\nfunction configure(state, config) {\n    var _a;\n    if ((_a = config.movable) === null || _a === void 0 ? void 0 : _a.dests)\n        state.movable.dests = undefined;\n    merge(state, config);\n    if (config.fen) {\n        state.pieces = read(config.fen);\n        state.drawable.shapes = [];\n    }\n    if (config.hasOwnProperty('check'))\n        setCheck(state, config.check || false);\n    if (config.hasOwnProperty('lastMove') && !config.lastMove)\n        state.lastMove = undefined;\n    else if (config.lastMove)\n        state.lastMove = config.lastMove;\n    if (state.selected)\n        setSelected(state, state.selected);\n    if (!state.animation.duration || state.animation.duration < 100)\n        state.animation.enabled = false;\n    if (!state.movable.rookCastle && state.movable.dests) {\n        const rank = state.movable.color === 'white' ? '1' : '8', kingStartPos = ('e' + rank), dests = state.movable.dests.get(kingStartPos), king = state.pieces.get(kingStartPos);\n        if (!dests || !king || king.role !== 'king')\n            return;\n        state.movable.dests.set(kingStartPos, dests.filter(d => !(d === 'a' + rank && dests.includes(('c' + rank))) &&\n            !(d === 'h' + rank && dests.includes(('g' + rank)))));\n    }\n}\n\nfunction merge(base, extend) {\n    for (const key in extend) {\n        if (isObject(base[key]) && isObject(extend[key]))\n            merge(base[key], extend[key]);\n        else\n            base[key] = extend[key];\n    }\n}\nfunction isObject(o) {\n    return typeof o === 'object';\n}\n\nfunction anim(mutation, state) {\n    return state.animation.enabled ? animate(mutation, state) : render$1(mutation, state);\n}\nfunction render$1(mutation, state) {\n    const result = mutation(state);\n    state.dom.redraw();\n    return result;\n}\nfunction makePiece(key, piece) {\n    return {\n        key: key,\n        pos: key2pos(key),\n        piece: piece,\n    };\n}\nfunction closer(piece, pieces) {\n    return pieces.sort((p1, p2) => {\n        return distanceSq(piece.pos, p1.pos) - distanceSq(piece.pos, p2.pos);\n    })[0];\n}\nfunction computePlan(prevPieces, current) {\n    const anims = new Map(), animedOrigs = [], fadings = new Map(), missings = [], news = [], prePieces = new Map();\n    let curP, preP, vector;\n    for (const [k, p] of prevPieces) {\n        prePieces.set(k, makePiece(k, p));\n    }\n    for (const key of allKeys) {\n        curP = current.pieces.get(key);\n        preP = prePieces.get(key);\n        if (curP) {\n            if (preP) {\n                if (!samePiece(curP, preP.piece)) {\n                    missings.push(preP);\n                    news.push(makePiece(key, curP));\n                }\n            }\n            else\n                news.push(makePiece(key, curP));\n        }\n        else if (preP)\n            missings.push(preP);\n    }\n    for (const newP of news) {\n        preP = closer(newP, missings.filter(p => samePiece(newP.piece, p.piece)));\n        if (preP) {\n            vector = [preP.pos[0] - newP.pos[0], preP.pos[1] - newP.pos[1]];\n            anims.set(newP.key, vector.concat(vector));\n            animedOrigs.push(preP.key);\n        }\n    }\n    for (const p of missings) {\n        if (!animedOrigs.includes(p.key))\n            fadings.set(p.key, p.piece);\n    }\n    return {\n        anims: anims,\n        fadings: fadings,\n    };\n}\nfunction step(state, now) {\n    const cur = state.animation.current;\n    if (cur === undefined) {\n        if (!state.dom.destroyed)\n            state.dom.redrawNow();\n        return;\n    }\n    const rest = 1 - (now - cur.start) * cur.frequency;\n    if (rest <= 0) {\n        state.animation.current = undefined;\n        state.dom.redrawNow();\n    }\n    else {\n        const ease = easing(rest);\n        for (const cfg of cur.plan.anims.values()) {\n            cfg[2] = cfg[0] * ease;\n            cfg[3] = cfg[1] * ease;\n        }\n        state.dom.redrawNow(true);\n        requestAnimationFrame((now = performance.now()) => step(state, now));\n    }\n}\nfunction animate(mutation, state) {\n    const prevPieces = new Map(state.pieces);\n    const result = mutation(state);\n    const plan = computePlan(prevPieces, state);\n    if (plan.anims.size || plan.fadings.size) {\n        const alreadyRunning = state.animation.current && state.animation.current.start;\n        state.animation.current = {\n            start: performance.now(),\n            frequency: 1 / state.animation.duration,\n            plan: plan,\n        };\n        if (!alreadyRunning)\n            step(state, performance.now());\n    }\n    else {\n        state.dom.redraw();\n    }\n    return result;\n}\nfunction easing(t) {\n    return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n}\n\nconst brushes = ['green', 'red', 'blue', 'yellow'];\nfunction start$2(state, e) {\n    if (e.touches && e.touches.length > 1)\n        return;\n    e.stopPropagation();\n    e.preventDefault();\n    e.ctrlKey ? unselect(state) : cancelMove(state);\n    const pos = eventPosition(e), orig = getKeyAtDomPos(pos, whitePov(state), state.dom.bounds());\n    if (!orig)\n        return;\n    state.drawable.current = {\n        orig,\n        pos,\n        brush: eventBrush(e),\n        snapToValidMove: state.drawable.defaultSnapToValidMove,\n    };\n    processDraw(state);\n}\n\nfunction processDraw(state) {\n    requestAnimationFrame(() => {\n        const cur = state.drawable.current;\n        if (cur) {\n            const keyAtDomPos = getKeyAtDomPos(cur.pos, whitePov(state), state.dom.bounds());\n            if (!keyAtDomPos) {\n                cur.snapToValidMove = false;\n            }\n            const mouseSq = cur.snapToValidMove\n                ? getSnappedKeyAtDomPos(cur.orig, cur.pos, whitePov(state), state.dom.bounds())\n                : keyAtDomPos;\n            if (mouseSq !== cur.mouseSq) {\n                cur.mouseSq = mouseSq;\n                cur.dest = mouseSq !== cur.orig ? mouseSq : undefined;\n                state.dom.redrawNow();\n            }\n            processDraw(state);\n        }\n    });\n}\nfunction move$1(state, e) {\n    if (state.drawable.current)\n        state.drawable.current.pos = eventPosition(e);\n}\n\nfunction end$1(state) {\n    const cur = state.drawable.current;\n    if (cur) {\n        if (cur.mouseSq)\n            addShape(state.drawable, cur);\n        cancel$1(state);\n    }\n}\n\nfunction cancel$1(state) {\n    if (state.drawable.current) {\n        state.drawable.current = undefined;\n        state.dom.redraw();\n    }\n}\n\nfunction clear(state) {\n    if (state.drawable.shapes.length) {\n        state.drawable.shapes = [];\n        state.dom.redraw();\n        onChange(state.drawable);\n    }\n}\n\nfunction eventBrush(e) {\n    var _a;\n    const modA = (e.shiftKey || e.ctrlKey) && isRightButton(e);\n    const modB = e.altKey || e.metaKey || ((_a = e.getModifierState) === null || _a === void 0 ? void 0 : _a.call(e, 'AltGraph'));\n    return brushes[(modA ? 1 : 0) + (modB ? 2 : 0)];\n}\nfunction addShape(drawable, cur) {\n    const sameShape = (s) => s.orig === cur.orig && s.dest === cur.dest;\n    const similar = drawable.shapes.find(sameShape);\n    if (similar)\n        drawable.shapes = drawable.shapes.filter(s => !sameShape(s));\n    if (!similar || similar.brush !== cur.brush)\n        drawable.shapes.push(cur);\n    onChange(drawable);\n}\nfunction onChange(drawable) {\n    if (drawable.onChange)\n        drawable.onChange(drawable.shapes);\n}\n\nfunction start$1(s, e) {\n    if (!e.isTrusted || (e.button !== undefined && e.button !== 0))\n        return;\n    if (e.touches && e.touches.length > 1)\n        return;\n    const bounds = s.dom.bounds(), position = eventPosition(e), orig = getKeyAtDomPos(position, whitePov(s), bounds);\n    if (!orig)\n        return;\n    const piece = s.pieces.get(orig);\n    const previouslySelected = s.selected;\n    if (!previouslySelected && s.drawable.enabled && (s.drawable.eraseOnClick || !piece || piece.color !== s.turnColor))\n        clear(s);\n    if (e.cancelable !== false &&\n        (!e.touches || !s.movable.color || piece || previouslySelected || pieceCloseTo(s, position)))\n        e.preventDefault();\n    const hadPremove = !!s.premovable.current;\n    const hadPredrop = !!s.predroppable.current;\n    s.stats.ctrlKey = e.ctrlKey;\n    if (s.selected && canMove(s, s.selected, orig)) {\n        anim(state => selectSquare(state, orig), s);\n    }\n    else {\n        selectSquare(s, orig);\n    }\n    const stillSelected = s.selected === orig;\n    const element = pieceElementByKey(s, orig);\n    if (piece && element && stillSelected && isDraggable(s, orig)) {\n        s.draggable.current = {\n            orig,\n            piece,\n            origPos: position,\n            pos: position,\n            started: s.draggable.autoDistance && s.stats.dragged,\n            element,\n            previouslySelected,\n            originTarget: e.target,\n        };\n        element.cgDragging = true;\n        element.classList.add('dragging');\n        const ghost = s.dom.elements.ghost;\n        if (ghost) {\n            ghost.className = `ghost ${piece.color} ${piece.role}`;\n            translateAbs(ghost, posToTranslateAbs(bounds)(key2pos(orig), whitePov(s)));\n            setVisible(ghost, true);\n        }\n        processDrag(s);\n    }\n    else {\n        if (hadPremove)\n            unsetPremove(s);\n        if (hadPredrop)\n            unsetPredrop(s);\n    }\n    s.dom.redraw();\n}\n\nfunction pieceCloseTo(s, pos) {\n    const asWhite = whitePov(s), bounds = s.dom.bounds(), radiusSq = Math.pow(bounds.width / 8, 2);\n    for (const key in s.pieces) {\n        const center = computeSquareCenter(key, asWhite, bounds);\n        if (distanceSq(center, pos) <= radiusSq)\n            return true;\n    }\n    return false;\n}\nfunction dragNewPiece(s, piece, e, force) {\n    const key = 'a0';\n    s.pieces.set(key, piece);\n    s.dom.redraw();\n    const position = eventPosition(e);\n    s.draggable.current = {\n        orig: key,\n        piece,\n        origPos: position,\n        pos: position,\n        started: true,\n        element: () => pieceElementByKey(s, key),\n        originTarget: e.target,\n        newPiece: true,\n        force: !!force,\n    };\n    processDrag(s);\n}\n\nfunction processDrag(s) {\n    requestAnimationFrame(() => {\n        var _a;\n        const cur = s.draggable.current;\n        if (!cur)\n            return;\n        if ((_a = s.animation.current) === null || _a === void 0 ? void 0 : _a.plan.anims.has(cur.orig))\n            s.animation.current = undefined;\n        const origPiece = s.pieces.get(cur.orig);\n        if (!origPiece || !samePiece(origPiece, cur.piece))\n            cancel(s);\n        else {\n            if (!cur.started && distanceSq(cur.pos, cur.origPos) >= Math.pow(s.draggable.distance, 2))\n                cur.started = true;\n            if (cur.started) {\n                if (typeof cur.element === 'function') {\n                    const found = cur.element();\n                    if (!found)\n                        return;\n                    found.cgDragging = true;\n                    found.classList.add('dragging');\n                    cur.element = found;\n                }\n                const bounds = s.dom.bounds();\n                translateAbs(cur.element, [\n                    cur.pos[0] - bounds.left - bounds.width / 16,\n                    cur.pos[1] - bounds.top - bounds.height / 16,\n                ]);\n            }\n        }\n        processDrag(s);\n    });\n}\nfunction move(s, e) {\n    if (s.draggable.current && (!e.touches || e.touches.length < 2)) {\n        s.draggable.current.pos = eventPosition(e);\n    }\n}\n\nfunction end(s, e) {\n    const cur = s.draggable.current;\n    if (!cur)\n        return;\n    if (e.type === 'touchend' && e.cancelable !== false)\n        e.preventDefault();\n    if (e.type === 'touchend' && cur.originTarget !== e.target && !cur.newPiece) {\n        s.draggable.current = undefined;\n        return;\n    }\n    unsetPremove(s);\n    unsetPredrop(s);\n    const eventPos = eventPosition(e) || cur.pos;\n    const dest = getKeyAtDomPos(eventPos, whitePov(s), s.dom.bounds());\n    if (dest && cur.started && cur.orig !== dest) {\n        if (cur.newPiece)\n            dropNewPiece(s, cur.orig, dest, cur.force);\n        else {\n            s.stats.ctrlKey = e.ctrlKey;\n            if (userMove(s, cur.orig, dest))\n                s.stats.dragged = true;\n        }\n    }\n    else if (cur.newPiece) {\n        s.pieces.delete(cur.orig);\n    }\n    else if (s.draggable.deleteOnDropOff && !dest) {\n        s.pieces.delete(cur.orig);\n        callUserFunction(s.events.change);\n    }\n    if (cur.orig === cur.previouslySelected && (cur.orig === dest || !dest))\n        unselect(s);\n    else if (!s.selectable.enabled)\n        unselect(s);\n    removeDragElements(s);\n    s.draggable.current = undefined;\n    s.dom.redraw();\n}\n\nfunction cancel(s) {\n    const cur = s.draggable.current;\n    if (cur) {\n        if (cur.newPiece)\n            s.pieces.delete(cur.orig);\n        s.draggable.current = undefined;\n        unselect(s);\n        removeDragElements(s);\n        s.dom.redraw();\n    }\n}\n\nfunction removeDragElements(s) {\n    const e = s.dom.elements;\n    if (e.ghost)\n        setVisible(e.ghost, false);\n}\nfunction pieceElementByKey(s, key) {\n    let el = s.dom.elements.board.firstChild;\n    while (el) {\n        if (el.cgKey === key && el.tagName === 'PIECE')\n            return el;\n        el = el.nextSibling;\n    }\n    return;\n}\n\nfunction explosion(state, keys) {\n    state.exploding = { stage: 1, keys };\n    state.dom.redraw();\n    setTimeout(() => {\n        setStage(state, 2);\n        setTimeout(() => setStage(state, undefined), 120);\n    }, 120);\n}\nfunction setStage(state, stage) {\n    if (state.exploding) {\n        if (stage)\n            state.exploding.stage = stage;\n        else\n            state.exploding = undefined;\n        state.dom.redraw();\n    }\n}\n\nfunction start(state, redrawAll) {\n    function toggleOrientation$1() {\n        toggleOrientation(state);\n        redrawAll();\n    }\n    return {\n        set(config) {\n            if (config.orientation && config.orientation !== state.orientation)\n                toggleOrientation$1();\n            (config.fen ? anim : render$1)(state => configure(state, config), state);\n        },\n        state,\n        getFen: () => write(state.pieces),\n        toggleOrientation: toggleOrientation$1,\n        setPieces(pieces) {\n            anim(state => setPieces(state, pieces), state);\n        },\n        selectSquare(key, force) {\n            if (key)\n                anim(state => selectSquare(state, key, force), state);\n            else if (state.selected) {\n                unselect(state);\n                state.dom.redraw();\n            }\n        },\n        move(orig, dest) {\n            anim(state => baseMove(state, orig, dest), state);\n        },\n        newPiece(piece, key) {\n            anim(state => baseNewPiece(state, piece, key), state);\n        },\n        playPremove() {\n            if (state.premovable.current) {\n                if (anim(playPremove, state))\n                    return true;\n                state.dom.redraw();\n            }\n            return false;\n        },\n        playPredrop(validate) {\n            if (state.predroppable.current) {\n                const result = playPredrop(state, validate);\n                state.dom.redraw();\n                return result;\n            }\n            return false;\n        },\n        cancelPremove() {\n            render$1(unsetPremove, state);\n        },\n        cancelPredrop() {\n            render$1(unsetPredrop, state);\n        },\n        cancelMove() {\n            render$1(state => {\n                cancelMove(state);\n                cancel(state);\n            }, state);\n        },\n        stop() {\n            render$1(state => {\n                stop(state);\n                cancel(state);\n            }, state);\n        },\n        explode(keys) {\n            explosion(state, keys);\n        },\n        setAutoShapes(shapes) {\n            render$1(state => (state.drawable.autoShapes = shapes), state);\n        },\n        setShapes(shapes) {\n            render$1(state => (state.drawable.shapes = shapes), state);\n        },\n        getKeyAtDomPos(pos) {\n            return getKeyAtDomPos(pos, whitePov(state), state.dom.bounds());\n        },\n        redrawAll,\n        dragNewPiece(piece, event, force) {\n            dragNewPiece(state, piece, event, force);\n        },\n        destroy() {\n            stop(state);\n            state.dom.unbind && state.dom.unbind();\n            state.dom.destroyed = true;\n        },\n    };\n}\n\nfunction defaults() {\n    return {\n        pieces: read(initial),\n        orientation: 'white',\n        turnColor: 'white',\n        coordinates: true,\n        autoCastle: true,\n        viewOnly: false,\n        disableContextMenu: false,\n        resizable: true,\n        addPieceZIndex: false,\n        pieceKey: false,\n        highlight: {\n            lastMove: true,\n            check: true,\n        },\n        animation: {\n            enabled: true,\n            duration: 200,\n        },\n        movable: {\n            free: true,\n            color: 'both',\n            showDests: true,\n            events: {},\n            rookCastle: true,\n        },\n        premovable: {\n            enabled: true,\n            showDests: true,\n            castle: true,\n            events: {},\n        },\n        predroppable: {\n            enabled: false,\n            events: {},\n        },\n        draggable: {\n            enabled: true,\n            distance: 3,\n            autoDistance: true,\n            showGhost: true,\n            deleteOnDropOff: false,\n        },\n        dropmode: {\n            active: false,\n        },\n        selectable: {\n            enabled: true,\n        },\n        stats: {\n            dragged: !('ontouchstart' in window),\n        },\n        events: {},\n        drawable: {\n            enabled: true,\n            visible: true,\n            defaultSnapToValidMove: true,\n            eraseOnClick: true,\n            shapes: [],\n            autoShapes: [],\n            brushes: {\n                green: { key: 'g', color: '#15781B', opacity: 1, lineWidth: 10 },\n                red: { key: 'r', color: '#882020', opacity: 1, lineWidth: 10 },\n                blue: { key: 'b', color: '#003088', opacity: 1, lineWidth: 10 },\n                yellow: { key: 'y', color: '#e68f00', opacity: 1, lineWidth: 10 },\n                paleBlue: { key: 'pb', color: '#003088', opacity: 0.4, lineWidth: 15 },\n                paleGreen: { key: 'pg', color: '#15781B', opacity: 0.4, lineWidth: 15 },\n                paleRed: { key: 'pr', color: '#882020', opacity: 0.4, lineWidth: 15 },\n                paleGrey: {\n                    key: 'pgr',\n                    color: '#4a4a4a',\n                    opacity: 0.35,\n                    lineWidth: 15,\n                },\n            },\n            pieces: {\n                baseUrl: 'https://lichess1.org/assets/piece/cburnett/',\n            },\n            prevSvgHash: '',\n        },\n        hold: timer(),\n    };\n}\n\nfunction createElement(tagName) {\n    return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\n\nfunction renderSvg(state, svg, customSvg) {\n    const d = state.drawable, curD = d.current, cur = curD && curD.mouseSq ? curD : undefined, arrowDests = new Map(), bounds = state.dom.bounds();\n    for (const s of d.shapes.concat(d.autoShapes).concat(cur ? [cur] : [])) {\n        if (s.dest)\n            arrowDests.set(s.dest, (arrowDests.get(s.dest) || 0) + 1);\n    }\n    const shapes = d.shapes.concat(d.autoShapes).map((s) => {\n        return {\n            shape: s,\n            current: false,\n            hash: shapeHash(s, arrowDests, false, bounds),\n        };\n    });\n    if (cur)\n        shapes.push({\n            shape: cur,\n            current: true,\n            hash: shapeHash(cur, arrowDests, true, bounds),\n        });\n    const fullHash = shapes.map(sc => sc.hash).join(';');\n    if (fullHash === state.drawable.prevSvgHash)\n        return;\n    state.drawable.prevSvgHash = fullHash;\n    const defsEl = svg.querySelector('defs');\n    const shapesEl = svg.querySelector('g');\n    const customSvgsEl = customSvg.querySelector('g');\n    syncDefs(d, shapes, defsEl);\n    syncShapes(state, shapes.filter(s => !s.shape.customSvg), d.brushes, arrowDests, shapesEl);\n    syncShapes(state, shapes.filter(s => s.shape.customSvg), d.brushes, arrowDests, customSvgsEl);\n}\n\nfunction syncDefs(d, shapes, defsEl) {\n    const brushes = new Map();\n    let brush;\n    for (const s of shapes) {\n        if (s.shape.dest) {\n            brush = d.brushes[s.shape.brush];\n            if (s.shape.modifiers)\n                brush = makeCustomBrush(brush, s.shape.modifiers);\n            brushes.set(brush.key, brush);\n        }\n    }\n    const keysInDom = new Set();\n    let el = defsEl.firstChild;\n    while (el) {\n        keysInDom.add(el.getAttribute('cgKey'));\n        el = el.nextSibling;\n    }\n    for (const [key, brush] of brushes.entries()) {\n        if (!keysInDom.has(key))\n            defsEl.appendChild(renderMarker(brush));\n    }\n}\nfunction syncShapes(state, shapes, brushes, arrowDests, root) {\n    const bounds = state.dom.bounds(), hashesInDom = new Map(), toRemove = [];\n    for (const sc of shapes)\n        hashesInDom.set(sc.hash, false);\n    let el = root.firstChild, elHash;\n    while (el) {\n        elHash = el.getAttribute('cgHash');\n        if (hashesInDom.has(elHash))\n            hashesInDom.set(elHash, true);\n        else\n            toRemove.push(el);\n        el = el.nextSibling;\n    }\n    for (const el of toRemove)\n        root.removeChild(el);\n    for (const sc of shapes) {\n        if (!hashesInDom.get(sc.hash))\n            root.appendChild(renderShape(state, sc, brushes, arrowDests, bounds));\n    }\n}\nfunction shapeHash({ orig, dest, brush, piece, modifiers, customSvg }, arrowDests, current, bounds) {\n    return [\n        bounds.width,\n        bounds.height,\n        current,\n        orig,\n        dest,\n        brush,\n        dest && (arrowDests.get(dest) || 0) > 1,\n        piece && pieceHash(piece),\n        modifiers && modifiersHash(modifiers),\n        customSvg && customSvgHash(customSvg),\n    ]\n        .filter(x => x)\n        .join(',');\n}\nfunction pieceHash(piece) {\n    return [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n}\nfunction modifiersHash(m) {\n    return '' + (m.lineWidth || '');\n}\nfunction customSvgHash(s) {\n    let h = 0;\n    for (let i = 0; i < s.length; i++) {\n        h = (((h << 5) - h) + s.charCodeAt(i)) >>> 0;\n    }\n    return 'custom-' + h.toString();\n}\nfunction renderShape(state, { shape, current, hash }, brushes, arrowDests, bounds) {\n    let el;\n    if (shape.customSvg) {\n        const orig = orient(key2pos(shape.orig), state.orientation);\n        el = renderCustomSvg(shape.customSvg, orig, bounds);\n    }\n    else if (shape.piece)\n        el = renderPiece(state.drawable.pieces.baseUrl, orient(key2pos(shape.orig), state.orientation), shape.piece, bounds);\n    else {\n        const orig = orient(key2pos(shape.orig), state.orientation);\n        if (shape.dest) {\n            let brush = brushes[shape.brush];\n            if (shape.modifiers)\n                brush = makeCustomBrush(brush, shape.modifiers);\n            el = renderArrow(brush, orig, orient(key2pos(shape.dest), state.orientation), current, (arrowDests.get(shape.dest) || 0) > 1, bounds);\n        }\n        else\n            el = renderCircle(brushes[shape.brush], orig, current, bounds);\n    }\n    el.setAttribute('cgHash', hash);\n    return el;\n}\nfunction renderCustomSvg(customSvg, pos, bounds) {\n    const { width, height } = bounds;\n    const w = width / 8;\n    const h = height / 8;\n    const x = pos[0] * w;\n    const y = (7 - pos[1]) * h;\n    const g = setAttributes(createElement('g'), { transform: `translate(${x},${y})` });\n    const svg = setAttributes(createElement('svg'), { width: w, height: h, viewBox: '0 0 100 100' });\n    g.appendChild(svg);\n    svg.innerHTML = customSvg;\n    return g;\n}\nfunction renderCircle(brush, pos, current, bounds) {\n    const o = pos2px(pos, bounds), widths = circleWidth(bounds), radius = (bounds.width + bounds.height) / 32;\n    return setAttributes(createElement('circle'), {\n        stroke: brush.color,\n        'stroke-width': widths[current ? 0 : 1],\n        fill: 'none',\n        opacity: opacity(brush, current),\n        cx: o[0],\n        cy: o[1],\n        r: radius - widths[1] / 2,\n    });\n}\nfunction renderArrow(brush, orig, dest, current, shorten, bounds) {\n    const m = arrowMargin(bounds, shorten && !current), a = pos2px(orig, bounds), b = pos2px(dest, bounds), dx = b[0] - a[0], dy = b[1] - a[1], angle = Math.atan2(dy, dx), xo = Math.cos(angle) * m, yo = Math.sin(angle) * m;\n    return setAttributes(createElement('line'), {\n        stroke: brush.color,\n        'stroke-width': lineWidth(brush, current, bounds),\n        'stroke-linecap': 'round',\n        'marker-end': 'url(#arrowhead-' + brush.key + ')',\n        opacity: opacity(brush, current),\n        x1: a[0],\n        y1: a[1],\n        x2: b[0] - xo,\n        y2: b[1] - yo,\n    });\n}\nfunction renderPiece(baseUrl, pos, piece, bounds) {\n    const o = pos2px(pos, bounds), size = (bounds.width / 8) * (piece.scale || 1), name = piece.color[0] + (piece.role === 'knight' ? 'n' : piece.role[0]).toUpperCase();\n    return setAttributes(createElement('image'), {\n        className: `${piece.role} ${piece.color}`,\n        x: o[0] - size / 2,\n        y: o[1] - size / 2,\n        width: size,\n        height: size,\n        href: baseUrl + name + '.svg',\n    });\n}\nfunction renderMarker(brush) {\n    const marker = setAttributes(createElement('marker'), {\n        id: 'arrowhead-' + brush.key,\n        orient: 'auto',\n        markerWidth: 4,\n        markerHeight: 8,\n        refX: 2.05,\n        refY: 2.01,\n    });\n    marker.appendChild(setAttributes(createElement('path'), {\n        d: 'M0,0 V4 L3,2 Z',\n        fill: brush.color,\n    }));\n    marker.setAttribute('cgKey', brush.key);\n    return marker;\n}\nfunction setAttributes(el, attrs) {\n    for (const key in attrs)\n        el.setAttribute(key, attrs[key]);\n    return el;\n}\n\nfunction orient(pos, color) {\n    return color === 'white' ? pos : [7 - pos[0], 7 - pos[1]];\n}\nfunction makeCustomBrush(base, modifiers) {\n    return {\n        color: base.color,\n        opacity: Math.round(base.opacity * 10) / 10,\n        lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n        key: [base.key, modifiers.lineWidth].filter(x => x).join(''),\n    };\n}\nfunction circleWidth(bounds) {\n    const base = bounds.width / 512;\n    return [3 * base, 4 * base];\n}\nfunction lineWidth(brush, current, bounds) {\n    return (((brush.lineWidth || 10) * (current ? 0.85 : 1)) / 512) * bounds.width;\n}\nfunction opacity(brush, current) {\n    return (brush.opacity || 1) * (current ? 0.9 : 1);\n}\nfunction arrowMargin(bounds, shorten) {\n    return ((shorten ? 20 : 10) / 512) * bounds.width;\n}\nfunction pos2px(pos, bounds) {\n    return [((pos[0] + 0.5) * bounds.width) / 8, ((7.5 - pos[1]) * bounds.height) / 8];\n}\n\nfunction renderWrap(element, s, relative) {\n    element.innerHTML = '';\n    element.classList.add('cg-wrap');\n    for (const c of colors)\n        element.classList.toggle('orientation-' + c, s.orientation === c);\n    element.classList.toggle('manipulable', !s.viewOnly);\n    const helper = createEl('cg-helper');\n    element.appendChild(helper);\n    const container = createEl('cg-container');\n    helper.appendChild(container);\n    const board = createEl('cg-board');\n    container.appendChild(board);\n    let svg;\n    let customSvg;\n    if (s.drawable.visible && !relative) {\n        svg = setAttributes(createElement('svg'), { 'class': 'cg-shapes' });\n        svg.appendChild(createElement('defs'));\n        svg.appendChild(createElement('g'));\n        customSvg = setAttributes(createElement('svg'), { 'class': 'cg-custom-svgs' });\n        customSvg.appendChild(createElement('g'));\n        container.appendChild(svg);\n        container.appendChild(customSvg);\n    }\n    if (s.coordinates) {\n        const orientClass = s.orientation === 'black' ? ' black' : '';\n        container.appendChild(renderCoords(ranks, 'ranks' + orientClass));\n        container.appendChild(renderCoords(files, 'files' + orientClass));\n    }\n    let ghost;\n    if (s.draggable.showGhost && !relative) {\n        ghost = createEl('piece', 'ghost');\n        setVisible(ghost, false);\n        container.appendChild(ghost);\n    }\n    return {\n        board,\n        container,\n        ghost,\n        svg,\n        customSvg,\n    };\n}\n\nfunction renderCoords(elems, className) {\n    const el = createEl('coords', className);\n    let f;\n    for (const elem of elems) {\n        f = createEl('coord');\n        f.textContent = elem;\n        el.appendChild(f);\n    }\n    return el;\n}\n\nfunction drop(s, e) {\n    if (!s.dropmode.active)\n        return;\n    unsetPremove(s);\n    unsetPredrop(s);\n    const piece = s.dropmode.piece;\n    if (piece) {\n        s.pieces.set('a0', piece);\n        const position = eventPosition(e);\n        const dest = position && getKeyAtDomPos(position, whitePov(s), s.dom.bounds());\n        if (dest)\n            dropNewPiece(s, 'a0', dest);\n    }\n    s.dom.redraw();\n}\n\nfunction bindBoard(s, boundsUpdated) {\n    const boardEl = s.dom.elements.board;\n    if (!s.dom.relative && s.resizable && 'ResizeObserver' in window) {\n        const observer = new window['ResizeObserver'](boundsUpdated);\n        observer.observe(boardEl);\n    }\n    if (s.viewOnly)\n        return;\n    const onStart = startDragOrDraw(s);\n    boardEl.addEventListener('touchstart', onStart, {\n        passive: false,\n    });\n    boardEl.addEventListener('mousedown', onStart, {\n        passive: false,\n    });\n    if (s.disableContextMenu || s.drawable.enabled) {\n        boardEl.addEventListener('contextmenu', e => e.preventDefault());\n    }\n}\n\nfunction bindDocument(s, boundsUpdated) {\n    const unbinds = [];\n    if (!s.dom.relative && s.resizable && !('ResizeObserver' in window)) {\n        unbinds.push(unbindable(document.body, 'chessground.resize', boundsUpdated));\n    }\n    if (!s.viewOnly) {\n        const onmove = dragOrDraw(s, move, move$1);\n        const onend = dragOrDraw(s, end, end$1);\n        for (const ev of ['touchmove', 'mousemove'])\n            unbinds.push(unbindable(document, ev, onmove));\n        for (const ev of ['touchend', 'mouseup'])\n            unbinds.push(unbindable(document, ev, onend));\n        const onScroll = () => s.dom.bounds.clear();\n        unbinds.push(unbindable(document, 'scroll', onScroll, { capture: true, passive: true }));\n        unbinds.push(unbindable(window, 'resize', onScroll, { passive: true }));\n    }\n    return () => unbinds.forEach(f => f());\n}\n\n\nfunction unbindable(el, eventName, callback, options) {\n    el.addEventListener(eventName, callback, options);\n    return () => el.removeEventListener(eventName, callback, options);\n}\nfunction startDragOrDraw(s) {\n    return e => {\n        if (s.draggable.current)\n            cancel(s);\n        else if (s.drawable.current)\n            cancel$1(s);\n        else if (e.shiftKey || isRightButton(e)) {\n            if (s.drawable.enabled)\n                start$2(s, e);\n        }\n        else if (!s.viewOnly) {\n            if (s.dropmode.active)\n                drop(s, e);\n            else\n                start$1(s, e);\n        }\n    };\n}\nfunction dragOrDraw(s, withDrag, withDraw) {\n    return e => {\n        if (s.drawable.current) {\n            if (s.drawable.enabled)\n                withDraw(s, e);\n        }\n        else if (!s.viewOnly)\n            withDrag(s, e);\n    };\n}\n\nfunction render(s) {\n    const asWhite = whitePov(s), posToTranslate = s.dom.relative ? posToTranslateRel : posToTranslateAbs(s.dom.bounds()), translate = s.dom.relative ? translateRel : translateAbs, boardEl = s.dom.elements.board, pieces = s.pieces, curAnim = s.animation.current, anims = curAnim ? curAnim.plan.anims : new Map(), fadings = curAnim ? curAnim.plan.fadings : new Map(), curDrag = s.draggable.current, squares = computeSquareClasses(s), samePieces = new Set(), sameSquares = new Set(), movedPieces = new Map(), movedSquares = new Map();\n    let k, el, pieceAtKey, elPieceName, anim, fading, pMvdset, pMvd, sMvdset, sMvd;\n    el = boardEl.firstChild;\n    while (el) {\n        k = el.cgKey;\n        if (isPieceNode(el)) {\n            pieceAtKey = pieces.get(k);\n            anim = anims.get(k);\n            fading = fadings.get(k);\n            elPieceName = el.cgPiece;\n            if (el.cgDragging && (!curDrag || curDrag.orig !== k)) {\n                el.classList.remove('dragging');\n                translate(el, posToTranslate(key2pos(k), asWhite));\n                el.cgDragging = false;\n            }\n            if (!fading && el.cgFading) {\n                el.cgFading = false;\n                el.classList.remove('fading');\n            }\n            if (pieceAtKey) {\n                if (anim && el.cgAnimating && elPieceName === pieceNameOf(pieceAtKey)) {\n                    const pos = key2pos(k);\n                    pos[0] += anim[2];\n                    pos[1] += anim[3];\n                    el.classList.add('anim');\n                    translate(el, posToTranslate(pos, asWhite));\n                }\n                else if (el.cgAnimating) {\n                    el.cgAnimating = false;\n                    el.classList.remove('anim');\n                    translate(el, posToTranslate(key2pos(k), asWhite));\n                    if (s.addPieceZIndex)\n                        el.style.zIndex = posZIndex(key2pos(k), asWhite);\n                }\n                if (elPieceName === pieceNameOf(pieceAtKey) && (!fading || !el.cgFading)) {\n                    samePieces.add(k);\n                }\n                else {\n                    if (fading && elPieceName === pieceNameOf(fading)) {\n                        el.classList.add('fading');\n                        el.cgFading = true;\n                    }\n                    else {\n                        appendValue(movedPieces, elPieceName, el);\n                    }\n                }\n            }\n            else {\n                appendValue(movedPieces, elPieceName, el);\n            }\n        }\n        else if (isSquareNode(el)) {\n            const cn = el.className;\n            if (squares.get(k) === cn)\n                sameSquares.add(k);\n            else\n                appendValue(movedSquares, cn, el);\n        }\n        el = el.nextSibling;\n    }\n    for (const [sk, className] of squares) {\n        if (!sameSquares.has(sk)) {\n            sMvdset = movedSquares.get(className);\n            sMvd = sMvdset && sMvdset.pop();\n            const translation = posToTranslate(key2pos(sk), asWhite);\n            if (sMvd) {\n                sMvd.cgKey = sk;\n                translate(sMvd, translation);\n            }\n            else {\n                const squareNode = createEl('square', className);\n                squareNode.cgKey = sk;\n                translate(squareNode, translation);\n                boardEl.insertBefore(squareNode, boardEl.firstChild);\n            }\n        }\n    }\n    for (const [k, p] of pieces) {\n        anim = anims.get(k);\n        if (!samePieces.has(k)) {\n            pMvdset = movedPieces.get(pieceNameOf(p));\n            pMvd = pMvdset && pMvdset.pop();\n            if (pMvd) {\n                pMvd.cgKey = k;\n                if (pMvd.cgFading) {\n                    pMvd.classList.remove('fading');\n                    pMvd.cgFading = false;\n                }\n                const pos = key2pos(k);\n                if (s.addPieceZIndex)\n                    pMvd.style.zIndex = posZIndex(pos, asWhite);\n                if (anim) {\n                    pMvd.cgAnimating = true;\n                    pMvd.classList.add('anim');\n                    pos[0] += anim[2];\n                    pos[1] += anim[3];\n                }\n                translate(pMvd, posToTranslate(pos, asWhite));\n            }\n            else {\n                const pieceName = pieceNameOf(p), pieceNode = createEl('piece', pieceName), pos = key2pos(k);\n                pieceNode.cgPiece = pieceName;\n                pieceNode.cgKey = k;\n                if (anim) {\n                    pieceNode.cgAnimating = true;\n                    pos[0] += anim[2];\n                    pos[1] += anim[3];\n                }\n                translate(pieceNode, posToTranslate(pos, asWhite));\n                if (s.addPieceZIndex)\n                    pieceNode.style.zIndex = posZIndex(pos, asWhite);\n                boardEl.appendChild(pieceNode);\n            }\n        }\n    }\n    for (const nodes of movedPieces.values())\n        removeNodes(s, nodes);\n    for (const nodes of movedSquares.values())\n        removeNodes(s, nodes);\n}\n\nfunction updateBounds(s) {\n    if (s.dom.relative)\n        return;\n    const asWhite = whitePov(s), posToTranslate = posToTranslateAbs(s.dom.bounds());\n    let el = s.dom.elements.board.firstChild;\n    while (el) {\n        if ((isPieceNode(el) && !el.cgAnimating) || isSquareNode(el)) {\n            translateAbs(el, posToTranslate(key2pos(el.cgKey), asWhite));\n        }\n        el = el.nextSibling;\n    }\n}\n\nfunction isPieceNode(el) {\n    return el.tagName === 'PIECE';\n}\nfunction isSquareNode(el) {\n    return el.tagName === 'SQUARE';\n}\nfunction removeNodes(s, nodes) {\n    for (const node of nodes)\n        s.dom.elements.board.removeChild(node);\n}\nfunction posZIndex(pos, asWhite) {\n    let z = 2 + pos[1] * 8 + (7 - pos[0]);\n    if (asWhite)\n        z = 67 - z;\n    return z + '';\n}\nfunction pieceNameOf(piece) {\n    return `${piece.color} ${piece.role}`;\n}\nfunction computeSquareClasses(s) {\n    var _a;\n    const squares = new Map();\n    if (s.lastMove && s.highlight.lastMove)\n        for (const k of s.lastMove) {\n            addSquare(squares, k, 'last-move');\n        }\n    if (s.check && s.highlight.check)\n        addSquare(squares, s.check, 'check');\n    if (s.selected) {\n        addSquare(squares, s.selected, 'selected');\n        if (s.movable.showDests) {\n            const dests = (_a = s.movable.dests) === null || _a === void 0 ? void 0 : _a.get(s.selected);\n            if (dests)\n                for (const k of dests) {\n                    addSquare(squares, k, 'move-dest' + (s.pieces.has(k) ? ' oc' : ''));\n                }\n            const pDests = s.premovable.dests;\n            if (pDests)\n                for (const k of pDests) {\n                    addSquare(squares, k, 'premove-dest' + (s.pieces.has(k) ? ' oc' : ''));\n                }\n        }\n    }\n    const premove = s.premovable.current;\n    if (premove)\n        for (const k of premove)\n            addSquare(squares, k, 'current-premove');\n    else if (s.predroppable.current)\n        addSquare(squares, s.predroppable.current.key, 'current-premove');\n    const o = s.exploding;\n    if (o)\n        for (const k of o.keys)\n            addSquare(squares, k, 'exploding' + o.stage);\n    return squares;\n}\nfunction addSquare(squares, key, klass) {\n    const classes = squares.get(key);\n    if (classes)\n        squares.set(key, `${classes} ${klass}`);\n    else\n        squares.set(key, klass);\n}\nfunction appendValue(map, key, value) {\n    const arr = map.get(key);\n    if (arr)\n        arr.push(value);\n    else\n        map.set(key, [value]);\n}\n\nfunction Chessground(element, config) {\n    const maybeState = defaults();\n    configure(maybeState, config || {});\n    function redrawAll() {\n        const prevUnbind = 'dom' in maybeState ? maybeState.dom.unbind : undefined;\n        const relative = maybeState.viewOnly && !maybeState.drawable.visible, elements = renderWrap(element, maybeState, relative), bounds = memo(() => elements.board.getBoundingClientRect()), redrawNow = (skipSvg) => {\n            render(state);\n            if (!skipSvg && elements.svg)\n                renderSvg(state, elements.svg, elements.customSvg);\n        }, boundsUpdated = () => {\n            bounds.clear();\n            updateBounds(state);\n            if (elements.svg)\n                renderSvg(state, elements.svg, elements.customSvg);\n        };\n        const state = maybeState;\n        state.dom = {\n            elements,\n            bounds,\n            redraw: debounceRedraw(redrawNow),\n            redrawNow,\n            unbind: prevUnbind,\n            relative,\n        };\n        state.drawable.prevSvgHash = '';\n        redrawNow(false);\n        bindBoard(state, boundsUpdated);\n        if (!prevUnbind)\n            state.dom.unbind = bindDocument(state, boundsUpdated);\n        state.events.insert && state.events.insert(elements);\n        return state;\n    }\n    return start(redrawAll(), redrawAll);\n}\n\nfunction debounceRedraw(redrawNow) {\n    let redrawing = false;\n    return () => {\n        if (redrawing)\n            return;\n        redrawing = true;\n        requestAnimationFrame(() => {\n            redrawNow();\n            redrawing = false;\n        });\n    };\n}\n\nexport default Chessground;\n","/*\r\n * Copyright (c) 2021, Jeff Hlywa (jhlywa@gmail.com)\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * 1. Redistributions of source code must retain the above copyright notice,\r\n *    this list of conditions and the following disclaimer.\r\n * 2. Redistributions in binary form must reproduce the above copyright notice,\r\n *    this list of conditions and the following disclaimer in the documentation\r\n *    and/or other materials provided with the distribution.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n *----------------------------------------------------------------------------*/\r\n\r\nexport default function Chess(fen) {\r\n  var BLACK = 'b'\r\n  var WHITE = 'w'\r\n\r\n  var EMPTY = -1\r\n\r\n  var PAWN = 'p'\r\n  var KNIGHT = 'n'\r\n  var BISHOP = 'b'\r\n  var ROOK = 'r'\r\n  var QUEEN = 'q'\r\n  var KING = 'k'\r\n\r\n  var SYMBOLS = 'pnbrqkPNBRQK'\r\n\r\n  var DEFAULT_POSITION =\r\n    'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1'\r\n\r\n  var POSSIBLE_RESULTS = ['1-0', '0-1', '1/2-1/2', '*']\r\n\r\n  var PAWN_OFFSETS = {\r\n    b: [16, 32, 17, 15],\r\n    w: [-16, -32, -17, -15],\r\n  }\r\n\r\n  var PIECE_OFFSETS = {\r\n    n: [-18, -33, -31, -14, 18, 33, 31, 14],\r\n    b: [-17, -15, 17, 15],\r\n    r: [-16, 1, 16, -1],\r\n    q: [-17, -16, -15, 1, 17, 16, 15, -1],\r\n    k: [-17, -16, -15, 1, 17, 16, 15, -1],\r\n  }\r\n\r\n  // prettier-ignore\r\n  var ATTACKS = [\r\n    20, 0, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0, 0,20, 0,\r\n     0,20, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0,20, 0, 0,\r\n     0, 0,20, 0, 0, 0, 0, 24,  0, 0, 0, 0,20, 0, 0, 0,\r\n     0, 0, 0,20, 0, 0, 0, 24,  0, 0, 0,20, 0, 0, 0, 0,\r\n     0, 0, 0, 0,20, 0, 0, 24,  0, 0,20, 0, 0, 0, 0, 0,\r\n     0, 0, 0, 0, 0,20, 2, 24,  2,20, 0, 0, 0, 0, 0, 0,\r\n     0, 0, 0, 0, 0, 2,53, 56, 53, 2, 0, 0, 0, 0, 0, 0,\r\n    24,24,24,24,24,24,56,  0, 56,24,24,24,24,24,24, 0,\r\n     0, 0, 0, 0, 0, 2,53, 56, 53, 2, 0, 0, 0, 0, 0, 0,\r\n     0, 0, 0, 0, 0,20, 2, 24,  2,20, 0, 0, 0, 0, 0, 0,\r\n     0, 0, 0, 0,20, 0, 0, 24,  0, 0,20, 0, 0, 0, 0, 0,\r\n     0, 0, 0,20, 0, 0, 0, 24,  0, 0, 0,20, 0, 0, 0, 0,\r\n     0, 0,20, 0, 0, 0, 0, 24,  0, 0, 0, 0,20, 0, 0, 0,\r\n     0,20, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0,20, 0, 0,\r\n    20, 0, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0, 0,20\r\n  ];\r\n\r\n  // prettier-ignore\r\n  var RAYS = [\r\n     17,  0,  0,  0,  0,  0,  0, 16,  0,  0,  0,  0,  0,  0, 15, 0,\r\n      0, 17,  0,  0,  0,  0,  0, 16,  0,  0,  0,  0,  0, 15,  0, 0,\r\n      0,  0, 17,  0,  0,  0,  0, 16,  0,  0,  0,  0, 15,  0,  0, 0,\r\n      0,  0,  0, 17,  0,  0,  0, 16,  0,  0,  0, 15,  0,  0,  0, 0,\r\n      0,  0,  0,  0, 17,  0,  0, 16,  0,  0, 15,  0,  0,  0,  0, 0,\r\n      0,  0,  0,  0,  0, 17,  0, 16,  0, 15,  0,  0,  0,  0,  0, 0,\r\n      0,  0,  0,  0,  0,  0, 17, 16, 15,  0,  0,  0,  0,  0,  0, 0,\r\n      1,  1,  1,  1,  1,  1,  1,  0, -1, -1,  -1,-1, -1, -1, -1, 0,\r\n      0,  0,  0,  0,  0,  0,-15,-16,-17,  0,  0,  0,  0,  0,  0, 0,\r\n      0,  0,  0,  0,  0,-15,  0,-16,  0,-17,  0,  0,  0,  0,  0, 0,\r\n      0,  0,  0,  0,-15,  0,  0,-16,  0,  0,-17,  0,  0,  0,  0, 0,\r\n      0,  0,  0,-15,  0,  0,  0,-16,  0,  0,  0,-17,  0,  0,  0, 0,\r\n      0,  0,-15,  0,  0,  0,  0,-16,  0,  0,  0,  0,-17,  0,  0, 0,\r\n      0,-15,  0,  0,  0,  0,  0,-16,  0,  0,  0,  0,  0,-17,  0, 0,\r\n    -15,  0,  0,  0,  0,  0,  0,-16,  0,  0,  0,  0,  0,  0,-17\r\n  ];\r\n\r\n  var SHIFTS = { p: 0, n: 1, b: 2, r: 3, q: 4, k: 5 }\r\n\r\n  var FLAGS = {\r\n    NORMAL: 'n',\r\n    CAPTURE: 'c',\r\n    BIG_PAWN: 'b',\r\n    EP_CAPTURE: 'e',\r\n    PROMOTION: 'p',\r\n    KSIDE_CASTLE: 'k',\r\n    QSIDE_CASTLE: 'q',\r\n  }\r\n\r\n  var BITS = {\r\n    NORMAL: 1,\r\n    CAPTURE: 2,\r\n    BIG_PAWN: 4,\r\n    EP_CAPTURE: 8,\r\n    PROMOTION: 16,\r\n    KSIDE_CASTLE: 32,\r\n    QSIDE_CASTLE: 64,\r\n  }\r\n\r\n  var RANK_1 = 7\r\n  var RANK_2 = 6\r\n  var RANK_3 = 5\r\n  var RANK_4 = 4\r\n  var RANK_5 = 3\r\n  var RANK_6 = 2\r\n  var RANK_7 = 1\r\n  var RANK_8 = 0\r\n\r\n  // prettier-ignore\r\n  var SQUARES = {\r\n    a8:   0, b8:   1, c8:   2, d8:   3, e8:   4, f8:   5, g8:   6, h8:   7,\r\n    a7:  16, b7:  17, c7:  18, d7:  19, e7:  20, f7:  21, g7:  22, h7:  23,\r\n    a6:  32, b6:  33, c6:  34, d6:  35, e6:  36, f6:  37, g6:  38, h6:  39,\r\n    a5:  48, b5:  49, c5:  50, d5:  51, e5:  52, f5:  53, g5:  54, h5:  55,\r\n    a4:  64, b4:  65, c4:  66, d4:  67, e4:  68, f4:  69, g4:  70, h4:  71,\r\n    a3:  80, b3:  81, c3:  82, d3:  83, e3:  84, f3:  85, g3:  86, h3:  87,\r\n    a2:  96, b2:  97, c2:  98, d2:  99, e2: 100, f2: 101, g2: 102, h2: 103,\r\n    a1: 112, b1: 113, c1: 114, d1: 115, e1: 116, f1: 117, g1: 118, h1: 119\r\n  };\r\n\r\n  var ROOKS = {\r\n    w: [\r\n      { square: SQUARES.a1, flag: BITS.QSIDE_CASTLE },\r\n      { square: SQUARES.h1, flag: BITS.KSIDE_CASTLE },\r\n    ],\r\n    b: [\r\n      { square: SQUARES.a8, flag: BITS.QSIDE_CASTLE },\r\n      { square: SQUARES.h8, flag: BITS.KSIDE_CASTLE },\r\n    ],\r\n  }\r\n\r\n  var board = new Array(128)\r\n  var kings = { w: EMPTY, b: EMPTY }\r\n  var turn = WHITE\r\n  var castling = { w: 0, b: 0 }\r\n  var ep_square = EMPTY\r\n  var half_moves = 0\r\n  var move_number = 1\r\n  var history = []\r\n  var header = {}\r\n  var comments = {}\r\n\r\n  /* if the user passes in a fen string, load it, else default to\r\n   * starting position\r\n   */\r\n  if (typeof fen === 'undefined') {\r\n    load(DEFAULT_POSITION)\r\n  } else {\r\n    load(fen)\r\n  }\r\n\r\n  function clear(keep_headers) {\r\n    if (typeof keep_headers === 'undefined') {\r\n      keep_headers = false\r\n    }\r\n\r\n    board = new Array(128)\r\n    kings = { w: EMPTY, b: EMPTY }\r\n    turn = WHITE\r\n    castling = { w: 0, b: 0 }\r\n    ep_square = EMPTY\r\n    half_moves = 0\r\n    move_number = 1\r\n    history = []\r\n    if (!keep_headers) header = {}\r\n    comments = {}\r\n    update_setup(generate_fen())\r\n  }\r\n\r\n  function prune_comments() {\r\n    var reversed_history = []\r\n    var current_comments = {}\r\n    var copy_comment = function (fen) {\r\n      if (fen in comments) {\r\n        current_comments[fen] = comments[fen]\r\n      }\r\n    }\r\n    while (history.length > 0) {\r\n      reversed_history.push(undo_move())\r\n    }\r\n    copy_comment(generate_fen())\r\n    while (reversed_history.length > 0) {\r\n      make_move(reversed_history.pop())\r\n      copy_comment(generate_fen())\r\n    }\r\n    comments = current_comments\r\n  }\r\n\r\n  function reset() {\r\n    load(DEFAULT_POSITION)\r\n  }\r\n\r\n  function load(fen, keep_headers) {\r\n    if (typeof keep_headers === 'undefined') {\r\n      keep_headers = false\r\n    }\r\n\r\n    var tokens = fen.split(/\\s+/)\r\n    var position = tokens[0]\r\n    var square = 0\r\n\r\n    if (!validate_fen(fen).valid) {\r\n      return false\r\n    }\r\n\r\n    clear(keep_headers)\r\n\r\n    for (var i = 0; i < position.length; i++) {\r\n      var piece = position.charAt(i)\r\n\r\n      if (piece === '/') {\r\n        square += 8\r\n      } else if (is_digit(piece)) {\r\n        square += parseInt(piece, 10)\r\n      } else {\r\n        var color = piece < 'a' ? WHITE : BLACK\r\n        put({ type: piece.toLowerCase(), color: color }, algebraic(square))\r\n        square++\r\n      }\r\n    }\r\n\r\n    turn = tokens[1]\r\n\r\n    if (tokens[2].indexOf('K') > -1) {\r\n      castling.w |= BITS.KSIDE_CASTLE\r\n    }\r\n    if (tokens[2].indexOf('Q') > -1) {\r\n      castling.w |= BITS.QSIDE_CASTLE\r\n    }\r\n    if (tokens[2].indexOf('k') > -1) {\r\n      castling.b |= BITS.KSIDE_CASTLE\r\n    }\r\n    if (tokens[2].indexOf('q') > -1) {\r\n      castling.b |= BITS.QSIDE_CASTLE\r\n    }\r\n\r\n    ep_square = tokens[3] === '-' ? EMPTY : SQUARES[tokens[3]]\r\n    half_moves = parseInt(tokens[4], 10)\r\n    move_number = parseInt(tokens[5], 10)\r\n\r\n    update_setup(generate_fen())\r\n\r\n    return true\r\n  }\r\n\r\n  /* TODO: this function is pretty much crap - it validates structure but\r\n   * completely ignores content (e.g. doesn't verify that each side has a king)\r\n   * ... we should rewrite this, and ditch the silly error_number field while\r\n   * we're at it\r\n   */\r\n  function validate_fen(fen) {\r\n    var errors = {\r\n      0: 'No errors.',\r\n      1: 'FEN string must contain six space-delimited fields.',\r\n      2: '6th field (move number) must be a positive integer.',\r\n      3: '5th field (half move counter) must be a non-negative integer.',\r\n      4: '4th field (en-passant square) is invalid.',\r\n      5: '3rd field (castling availability) is invalid.',\r\n      6: '2nd field (side to move) is invalid.',\r\n      7: \"1st field (piece positions) does not contain 8 '/'-delimited rows.\",\r\n      8: '1st field (piece positions) is invalid [consecutive numbers].',\r\n      9: '1st field (piece positions) is invalid [invalid piece].',\r\n      10: '1st field (piece positions) is invalid [row too large].',\r\n      11: 'Illegal en-passant square',\r\n    }\r\n\r\n    /* 1st criterion: 6 space-seperated fields? */\r\n    var tokens = fen.split(/\\s+/)\r\n    if (tokens.length !== 6) {\r\n      return { valid: false, error_number: 1, error: errors[1] }\r\n    }\r\n\r\n    /* 2nd criterion: move number field is a integer value > 0? */\r\n    if (isNaN(tokens[5]) || parseInt(tokens[5], 10) <= 0) {\r\n      return { valid: false, error_number: 2, error: errors[2] }\r\n    }\r\n\r\n    /* 3rd criterion: half move counter is an integer >= 0? */\r\n    if (isNaN(tokens[4]) || parseInt(tokens[4], 10) < 0) {\r\n      return { valid: false, error_number: 3, error: errors[3] }\r\n    }\r\n\r\n    /* 4th criterion: 4th field is a valid e.p.-string? */\r\n    if (!/^(-|[abcdefgh][36])$/.test(tokens[3])) {\r\n      return { valid: false, error_number: 4, error: errors[4] }\r\n    }\r\n\r\n    /* 5th criterion: 3th field is a valid castle-string? */\r\n    if (!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(tokens[2])) {\r\n      return { valid: false, error_number: 5, error: errors[5] }\r\n    }\r\n\r\n    /* 6th criterion: 2nd field is \"w\" (white) or \"b\" (black)? */\r\n    if (!/^(w|b)$/.test(tokens[1])) {\r\n      return { valid: false, error_number: 6, error: errors[6] }\r\n    }\r\n\r\n    /* 7th criterion: 1st field contains 8 rows? */\r\n    var rows = tokens[0].split('/')\r\n    if (rows.length !== 8) {\r\n      return { valid: false, error_number: 7, error: errors[7] }\r\n    }\r\n\r\n    /* 8th criterion: every row is valid? */\r\n    for (var i = 0; i < rows.length; i++) {\r\n      /* check for right sum of fields AND not two numbers in succession */\r\n      var sum_fields = 0\r\n      var previous_was_number = false\r\n\r\n      for (var k = 0; k < rows[i].length; k++) {\r\n        if (!isNaN(rows[i][k])) {\r\n          if (previous_was_number) {\r\n            return { valid: false, error_number: 8, error: errors[8] }\r\n          }\r\n          sum_fields += parseInt(rows[i][k], 10)\r\n          previous_was_number = true\r\n        } else {\r\n          if (!/^[prnbqkPRNBQK]$/.test(rows[i][k])) {\r\n            return { valid: false, error_number: 9, error: errors[9] }\r\n          }\r\n          sum_fields += 1\r\n          previous_was_number = false\r\n        }\r\n      }\r\n      if (sum_fields !== 8) {\r\n        return { valid: false, error_number: 10, error: errors[10] }\r\n      }\r\n    }\r\n\r\n    if (\r\n      (tokens[3][1] == '3' && tokens[1] == 'w') ||\r\n      (tokens[3][1] == '6' && tokens[1] == 'b')\r\n    ) {\r\n      return { valid: false, error_number: 11, error: errors[11] }\r\n    }\r\n\r\n    /* everything's okay! */\r\n    return { valid: true, error_number: 0, error: errors[0] }\r\n  }\r\n\r\n  function generate_fen() {\r\n    var empty = 0\r\n    var fen = ''\r\n\r\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\r\n      if (board[i] == null) {\r\n        empty++\r\n      } else {\r\n        if (empty > 0) {\r\n          fen += empty\r\n          empty = 0\r\n        }\r\n        var color = board[i].color\r\n        var piece = board[i].type\r\n\r\n        fen += color === WHITE ? piece.toUpperCase() : piece.toLowerCase()\r\n      }\r\n\r\n      if ((i + 1) & 0x88) {\r\n        if (empty > 0) {\r\n          fen += empty\r\n        }\r\n\r\n        if (i !== SQUARES.h1) {\r\n          fen += '/'\r\n        }\r\n\r\n        empty = 0\r\n        i += 8\r\n      }\r\n    }\r\n\r\n    var cflags = ''\r\n    if (castling[WHITE] & BITS.KSIDE_CASTLE) {\r\n      cflags += 'K'\r\n    }\r\n    if (castling[WHITE] & BITS.QSIDE_CASTLE) {\r\n      cflags += 'Q'\r\n    }\r\n    if (castling[BLACK] & BITS.KSIDE_CASTLE) {\r\n      cflags += 'k'\r\n    }\r\n    if (castling[BLACK] & BITS.QSIDE_CASTLE) {\r\n      cflags += 'q'\r\n    }\r\n\r\n    /* do we have an empty castling flag? */\r\n    cflags = cflags || '-'\r\n    var epflags = ep_square === EMPTY ? '-' : algebraic(ep_square)\r\n\r\n    return [fen, turn, cflags, epflags, half_moves, move_number].join(' ')\r\n  }\r\n\r\n  function set_header(args) {\r\n    for (var i = 0; i < args.length; i += 2) {\r\n      if (typeof args[i] === 'string' && typeof args[i + 1] === 'string') {\r\n        header[args[i]] = args[i + 1]\r\n      }\r\n    }\r\n    return header\r\n  }\r\n\r\n  /* called when the initial board setup is changed with put() or remove().\r\n   * modifies the SetUp and FEN properties of the header object.  if the FEN is\r\n   * equal to the default position, the SetUp and FEN are deleted\r\n   * the setup is only updated if history.length is zero, ie moves haven't been\r\n   * made.\r\n   */\r\n  function update_setup(fen) {\r\n    if (history.length > 0) return\r\n\r\n    if (fen !== DEFAULT_POSITION) {\r\n      header['SetUp'] = '1'\r\n      header['FEN'] = fen\r\n    } else {\r\n      delete header['SetUp']\r\n      delete header['FEN']\r\n    }\r\n  }\r\n\r\n  function get(square) {\r\n    var piece = board[SQUARES[square]]\r\n    return piece ? { type: piece.type, color: piece.color } : null\r\n  }\r\n\r\n  function put(piece, square) {\r\n    /* check for valid piece object */\r\n    if (!('type' in piece && 'color' in piece)) {\r\n      return false\r\n    }\r\n\r\n    /* check for piece */\r\n    if (SYMBOLS.indexOf(piece.type.toLowerCase()) === -1) {\r\n      return false\r\n    }\r\n\r\n    /* check for valid square */\r\n    if (!(square in SQUARES)) {\r\n      return false\r\n    }\r\n\r\n    var sq = SQUARES[square]\r\n\r\n    /* don't let the user place more than one king */\r\n    if (\r\n      piece.type == KING &&\r\n      !(kings[piece.color] == EMPTY || kings[piece.color] == sq)\r\n    ) {\r\n      return false\r\n    }\r\n\r\n    board[sq] = { type: piece.type, color: piece.color }\r\n    if (piece.type === KING) {\r\n      kings[piece.color] = sq\r\n    }\r\n\r\n    update_setup(generate_fen())\r\n\r\n    return true\r\n  }\r\n\r\n  function remove(square) {\r\n    var piece = get(square)\r\n    board[SQUARES[square]] = null\r\n    if (piece && piece.type === KING) {\r\n      kings[piece.color] = EMPTY\r\n    }\r\n\r\n    update_setup(generate_fen())\r\n\r\n    return piece\r\n  }\r\n\r\n  function build_move(board, from, to, flags, promotion) {\r\n    var move = {\r\n      color: turn,\r\n      from: from,\r\n      to: to,\r\n      flags: flags,\r\n      piece: board[from].type,\r\n    }\r\n\r\n    if (promotion) {\r\n      move.flags |= BITS.PROMOTION\r\n      move.promotion = promotion\r\n    }\r\n\r\n    if (board[to]) {\r\n      move.captured = board[to].type\r\n    } else if (flags & BITS.EP_CAPTURE) {\r\n      move.captured = PAWN\r\n    }\r\n    return move\r\n  }\r\n\r\n  function generate_moves(options) {\r\n    function add_move(board, moves, from, to, flags) {\r\n      /* if pawn promotion */\r\n      if (\r\n        board[from].type === PAWN &&\r\n        (rank(to) === RANK_8 || rank(to) === RANK_1)\r\n      ) {\r\n        var pieces = [QUEEN, ROOK, BISHOP, KNIGHT]\r\n        for (var i = 0, len = pieces.length; i < len; i++) {\r\n          moves.push(build_move(board, from, to, flags, pieces[i]))\r\n        }\r\n      } else {\r\n        moves.push(build_move(board, from, to, flags))\r\n      }\r\n    }\r\n\r\n    var moves = []\r\n    var us = turn\r\n    var them = swap_color(us)\r\n    var second_rank = { b: RANK_7, w: RANK_2 }\r\n\r\n    var first_sq = SQUARES.a8\r\n    var last_sq = SQUARES.h1\r\n    var single_square = false\r\n\r\n    /* do we want legal moves? */\r\n    var legal =\r\n      typeof options !== 'undefined' && 'legal' in options\r\n        ? options.legal\r\n        : true\r\n\r\n    var piece_type =\r\n      typeof options !== 'undefined' &&\r\n      'piece' in options &&\r\n      typeof options.piece === 'string'\r\n        ? options.piece.toLowerCase()\r\n        : true\r\n\r\n    /* are we generating moves for a single square? */\r\n    if (typeof options !== 'undefined' && 'square' in options) {\r\n      if (options.square in SQUARES) {\r\n        first_sq = last_sq = SQUARES[options.square]\r\n        single_square = true\r\n      } else {\r\n        /* invalid square */\r\n        return []\r\n      }\r\n    }\r\n\r\n    for (var i = first_sq; i <= last_sq; i++) {\r\n      /* did we run off the end of the board */\r\n      if (i & 0x88) {\r\n        i += 7\r\n        continue\r\n      }\r\n\r\n      var piece = board[i]\r\n      if (piece == null || piece.color !== us) {\r\n        continue\r\n      }\r\n\r\n      if (piece.type === PAWN && (piece_type === true || piece_type === PAWN)) {\r\n        /* single square, non-capturing */\r\n        var square = i + PAWN_OFFSETS[us][0]\r\n        if (board[square] == null) {\r\n          add_move(board, moves, i, square, BITS.NORMAL)\r\n\r\n          /* double square */\r\n          var square = i + PAWN_OFFSETS[us][1]\r\n          if (second_rank[us] === rank(i) && board[square] == null) {\r\n            add_move(board, moves, i, square, BITS.BIG_PAWN)\r\n          }\r\n        }\r\n\r\n        /* pawn captures */\r\n        for (j = 2; j < 4; j++) {\r\n          var square = i + PAWN_OFFSETS[us][j]\r\n          if (square & 0x88) continue\r\n\r\n          if (board[square] != null && board[square].color === them) {\r\n            add_move(board, moves, i, square, BITS.CAPTURE)\r\n          } else if (square === ep_square) {\r\n            add_move(board, moves, i, ep_square, BITS.EP_CAPTURE)\r\n          }\r\n        }\r\n      } else if (piece_type === true || piece_type === piece.type) {\r\n        for (var j = 0, len = PIECE_OFFSETS[piece.type].length; j < len; j++) {\r\n          var offset = PIECE_OFFSETS[piece.type][j]\r\n          var square = i\r\n\r\n          while (true) {\r\n            square += offset\r\n            if (square & 0x88) break\r\n\r\n            if (board[square] == null) {\r\n              add_move(board, moves, i, square, BITS.NORMAL)\r\n            } else {\r\n              if (board[square].color === us) break\r\n              add_move(board, moves, i, square, BITS.CAPTURE)\r\n              break\r\n            }\r\n\r\n            /* break, if knight or king */\r\n            if (piece.type === 'n' || piece.type === 'k') break\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /* check for castling if: a) we're generating all moves, or b) we're doing\r\n     * single square move generation on the king's square\r\n     */\r\n    if (piece_type === true || piece_type === KING) {\r\n      if (!single_square || last_sq === kings[us]) {\r\n        /* king-side castling */\r\n        if (castling[us] & BITS.KSIDE_CASTLE) {\r\n          var castling_from = kings[us]\r\n          var castling_to = castling_from + 2\r\n\r\n          if (\r\n            board[castling_from + 1] == null &&\r\n            board[castling_to] == null &&\r\n            !attacked(them, kings[us]) &&\r\n            !attacked(them, castling_from + 1) &&\r\n            !attacked(them, castling_to)\r\n          ) {\r\n            add_move(board, moves, kings[us], castling_to, BITS.KSIDE_CASTLE)\r\n          }\r\n        }\r\n\r\n        /* queen-side castling */\r\n        if (castling[us] & BITS.QSIDE_CASTLE) {\r\n          var castling_from = kings[us]\r\n          var castling_to = castling_from - 2\r\n\r\n          if (\r\n            board[castling_from - 1] == null &&\r\n            board[castling_from - 2] == null &&\r\n            board[castling_from - 3] == null &&\r\n            !attacked(them, kings[us]) &&\r\n            !attacked(them, castling_from - 1) &&\r\n            !attacked(them, castling_to)\r\n          ) {\r\n            add_move(board, moves, kings[us], castling_to, BITS.QSIDE_CASTLE)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /* return all pseudo-legal moves (this includes moves that allow the king\r\n     * to be captured)\r\n     */\r\n    if (!legal) {\r\n      return moves\r\n    }\r\n\r\n    /* filter out illegal moves */\r\n    var legal_moves = []\r\n    for (var i = 0, len = moves.length; i < len; i++) {\r\n      make_move(moves[i])\r\n      if (!king_attacked(us)) {\r\n        legal_moves.push(moves[i])\r\n      }\r\n      undo_move()\r\n    }\r\n\r\n    return legal_moves\r\n  }\r\n\r\n  /* convert a move from 0x88 coordinates to Standard Algebraic Notation\r\n   * (SAN)\r\n   *\r\n   * @param {boolean} sloppy Use the sloppy SAN generator to work around over\r\n   * disambiguation bugs in Fritz and Chessbase.  See below:\r\n   *\r\n   * r1bqkbnr/ppp2ppp/2n5/1B1pP3/4P3/8/PPPP2PP/RNBQK1NR b KQkq - 2 4\r\n   * 4. ... Nge7 is overly disambiguated because the knight on c6 is pinned\r\n   * 4. ... Ne7 is technically the valid SAN\r\n   */\r\n  function move_to_san(move, moves) {\r\n    var output = ''\r\n\r\n    if (move.flags & BITS.KSIDE_CASTLE) {\r\n      output = 'O-O'\r\n    } else if (move.flags & BITS.QSIDE_CASTLE) {\r\n      output = 'O-O-O'\r\n    } else {\r\n      if (move.piece !== PAWN) {\r\n        var disambiguator = get_disambiguator(move, moves)\r\n        output += move.piece.toUpperCase() + disambiguator\r\n      }\r\n\r\n      if (move.flags & (BITS.CAPTURE | BITS.EP_CAPTURE)) {\r\n        if (move.piece === PAWN) {\r\n          output += algebraic(move.from)[0]\r\n        }\r\n        output += 'x'\r\n      }\r\n\r\n      output += algebraic(move.to)\r\n\r\n      if (move.flags & BITS.PROMOTION) {\r\n        output += '=' + move.promotion.toUpperCase()\r\n      }\r\n    }\r\n\r\n    make_move(move)\r\n    if (in_check()) {\r\n      if (in_checkmate()) {\r\n        output += '#'\r\n      } else {\r\n        output += '+'\r\n      }\r\n    }\r\n    undo_move()\r\n\r\n    return output\r\n  }\r\n  // parses all of the decorators out of a SAN string\r\n  function stripped_san(move) {\r\n    return move.replace(/=/, '').replace(/[+#]?[?!]*$/, '')\r\n  }\r\n\r\n  function attacked(color, square) {\r\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\r\n      /* did we run off the end of the board */\r\n      if (i & 0x88) {\r\n        i += 7\r\n        continue\r\n      }\r\n\r\n      /* if empty square or wrong color */\r\n      if (board[i] == null || board[i].color !== color) continue\r\n\r\n      var piece = board[i]\r\n      var difference = i - square\r\n      var index = difference + 119\r\n\r\n      if (ATTACKS[index] & (1 << SHIFTS[piece.type])) {\r\n        if (piece.type === PAWN) {\r\n          if (difference > 0) {\r\n            if (piece.color === WHITE) return true\r\n          } else {\r\n            if (piece.color === BLACK) return true\r\n          }\r\n          continue\r\n        }\r\n\r\n        /* if the piece is a knight or a king */\r\n        if (piece.type === 'n' || piece.type === 'k') return true\r\n\r\n        var offset = RAYS[index]\r\n        var j = i + offset\r\n\r\n        var blocked = false\r\n        while (j !== square) {\r\n          if (board[j] != null) {\r\n            blocked = true\r\n            break\r\n          }\r\n          j += offset\r\n        }\r\n\r\n        if (!blocked) return true\r\n      }\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  function king_attacked(color) {\r\n    return attacked(swap_color(color), kings[color])\r\n  }\r\n\r\n  function in_check() {\r\n    return king_attacked(turn)\r\n  }\r\n\r\n  function in_checkmate() {\r\n    return in_check() && generate_moves().length === 0\r\n  }\r\n\r\n  function in_stalemate() {\r\n    return !in_check() && generate_moves().length === 0\r\n  }\r\n\r\n  function insufficient_material() {\r\n    var pieces = {}\r\n    var bishops = []\r\n    var num_pieces = 0\r\n    var sq_color = 0\r\n\r\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\r\n      sq_color = (sq_color + 1) % 2\r\n      if (i & 0x88) {\r\n        i += 7\r\n        continue\r\n      }\r\n\r\n      var piece = board[i]\r\n      if (piece) {\r\n        pieces[piece.type] = piece.type in pieces ? pieces[piece.type] + 1 : 1\r\n        if (piece.type === BISHOP) {\r\n          bishops.push(sq_color)\r\n        }\r\n        num_pieces++\r\n      }\r\n    }\r\n\r\n    /* k vs. k */\r\n    if (num_pieces === 2) {\r\n      return true\r\n    } else if (\r\n      /* k vs. kn .... or .... k vs. kb */\r\n      num_pieces === 3 &&\r\n      (pieces[BISHOP] === 1 || pieces[KNIGHT] === 1)\r\n    ) {\r\n      return true\r\n    } else if (num_pieces === pieces[BISHOP] + 2) {\r\n      /* kb vs. kb where any number of bishops are all on the same color */\r\n      var sum = 0\r\n      var len = bishops.length\r\n      for (var i = 0; i < len; i++) {\r\n        sum += bishops[i]\r\n      }\r\n      if (sum === 0 || sum === len) {\r\n        return true\r\n      }\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  function in_threefold_repetition() {\r\n    /* TODO: while this function is fine for casual use, a better\r\n     * implementation would use a Zobrist key (instead of FEN). the\r\n     * Zobrist key would be maintained in the make_move/undo_move functions,\r\n     * avoiding the costly that we do below.\r\n     */\r\n    var moves = []\r\n    var positions = {}\r\n    var repetition = false\r\n\r\n    while (true) {\r\n      var move = undo_move()\r\n      if (!move) break\r\n      moves.push(move)\r\n    }\r\n\r\n    while (true) {\r\n      /* remove the last two fields in the FEN string, they're not needed\r\n       * when checking for draw by rep */\r\n      var fen = generate_fen().split(' ').slice(0, 4).join(' ')\r\n\r\n      /* has the position occurred three or move times */\r\n      positions[fen] = fen in positions ? positions[fen] + 1 : 1\r\n      if (positions[fen] >= 3) {\r\n        repetition = true\r\n      }\r\n\r\n      if (!moves.length) {\r\n        break\r\n      }\r\n      make_move(moves.pop())\r\n    }\r\n\r\n    return repetition\r\n  }\r\n\r\n  function push(move) {\r\n    history.push({\r\n      move: move,\r\n      kings: { b: kings.b, w: kings.w },\r\n      turn: turn,\r\n      castling: { b: castling.b, w: castling.w },\r\n      ep_square: ep_square,\r\n      half_moves: half_moves,\r\n      move_number: move_number,\r\n    })\r\n  }\r\n\r\n  function make_move(move) {\r\n    var us = turn\r\n    var them = swap_color(us)\r\n    push(move)\r\n\r\n    board[move.to] = board[move.from]\r\n    board[move.from] = null\r\n\r\n    /* if ep capture, remove the captured pawn */\r\n    if (move.flags & BITS.EP_CAPTURE) {\r\n      if (turn === BLACK) {\r\n        board[move.to - 16] = null\r\n      } else {\r\n        board[move.to + 16] = null\r\n      }\r\n    }\r\n\r\n    /* if pawn promotion, replace with new piece */\r\n    if (move.flags & BITS.PROMOTION) {\r\n      board[move.to] = { type: move.promotion, color: us }\r\n    }\r\n\r\n    /* if we moved the king */\r\n    if (board[move.to].type === KING) {\r\n      kings[board[move.to].color] = move.to\r\n\r\n      /* if we castled, move the rook next to the king */\r\n      if (move.flags & BITS.KSIDE_CASTLE) {\r\n        var castling_to = move.to - 1\r\n        var castling_from = move.to + 1\r\n        board[castling_to] = board[castling_from]\r\n        board[castling_from] = null\r\n      } else if (move.flags & BITS.QSIDE_CASTLE) {\r\n        var castling_to = move.to + 1\r\n        var castling_from = move.to - 2\r\n        board[castling_to] = board[castling_from]\r\n        board[castling_from] = null\r\n      }\r\n\r\n      /* turn off castling */\r\n      castling[us] = ''\r\n    }\r\n\r\n    /* turn off castling if we move a rook */\r\n    if (castling[us]) {\r\n      for (var i = 0, len = ROOKS[us].length; i < len; i++) {\r\n        if (\r\n          move.from === ROOKS[us][i].square &&\r\n          castling[us] & ROOKS[us][i].flag\r\n        ) {\r\n          castling[us] ^= ROOKS[us][i].flag\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    /* turn off castling if we capture a rook */\r\n    if (castling[them]) {\r\n      for (var i = 0, len = ROOKS[them].length; i < len; i++) {\r\n        if (\r\n          move.to === ROOKS[them][i].square &&\r\n          castling[them] & ROOKS[them][i].flag\r\n        ) {\r\n          castling[them] ^= ROOKS[them][i].flag\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    /* if big pawn move, update the en passant square */\r\n    if (move.flags & BITS.BIG_PAWN) {\r\n      if (turn === 'b') {\r\n        ep_square = move.to - 16\r\n      } else {\r\n        ep_square = move.to + 16\r\n      }\r\n    } else {\r\n      ep_square = EMPTY\r\n    }\r\n\r\n    /* reset the 50 move counter if a pawn is moved or a piece is captured */\r\n    if (move.piece === PAWN) {\r\n      half_moves = 0\r\n    } else if (move.flags & (BITS.CAPTURE | BITS.EP_CAPTURE)) {\r\n      half_moves = 0\r\n    } else {\r\n      half_moves++\r\n    }\r\n\r\n    if (turn === BLACK) {\r\n      move_number++\r\n    }\r\n    turn = swap_color(turn)\r\n  }\r\n\r\n  function undo_move() {\r\n    var old = history.pop()\r\n    if (old == null) {\r\n      return null\r\n    }\r\n\r\n    var move = old.move\r\n    kings = old.kings\r\n    turn = old.turn\r\n    castling = old.castling\r\n    ep_square = old.ep_square\r\n    half_moves = old.half_moves\r\n    move_number = old.move_number\r\n\r\n    var us = turn\r\n    var them = swap_color(turn)\r\n\r\n    board[move.from] = board[move.to]\r\n    board[move.from].type = move.piece // to undo any promotions\r\n    board[move.to] = null\r\n\r\n    if (move.flags & BITS.CAPTURE) {\r\n      board[move.to] = { type: move.captured, color: them }\r\n    } else if (move.flags & BITS.EP_CAPTURE) {\r\n      var index\r\n      if (us === BLACK) {\r\n        index = move.to - 16\r\n      } else {\r\n        index = move.to + 16\r\n      }\r\n      board[index] = { type: PAWN, color: them }\r\n    }\r\n\r\n    if (move.flags & (BITS.KSIDE_CASTLE | BITS.QSIDE_CASTLE)) {\r\n      var castling_to, castling_from\r\n      if (move.flags & BITS.KSIDE_CASTLE) {\r\n        castling_to = move.to + 1\r\n        castling_from = move.to - 1\r\n      } else if (move.flags & BITS.QSIDE_CASTLE) {\r\n        castling_to = move.to - 2\r\n        castling_from = move.to + 1\r\n      }\r\n\r\n      board[castling_to] = board[castling_from]\r\n      board[castling_from] = null\r\n    }\r\n\r\n    return move\r\n  }\r\n\r\n  /* this function is used to uniquely identify ambiguous moves */\r\n  function get_disambiguator(move, moves) {\r\n    var from = move.from\r\n    var to = move.to\r\n    var piece = move.piece\r\n\r\n    var ambiguities = 0\r\n    var same_rank = 0\r\n    var same_file = 0\r\n\r\n    for (var i = 0, len = moves.length; i < len; i++) {\r\n      var ambig_from = moves[i].from\r\n      var ambig_to = moves[i].to\r\n      var ambig_piece = moves[i].piece\r\n\r\n      /* if a move of the same piece type ends on the same to square, we'll\r\n       * need to add a disambiguator to the algebraic notation\r\n       */\r\n      if (piece === ambig_piece && from !== ambig_from && to === ambig_to) {\r\n        ambiguities++\r\n\r\n        if (rank(from) === rank(ambig_from)) {\r\n          same_rank++\r\n        }\r\n\r\n        if (file(from) === file(ambig_from)) {\r\n          same_file++\r\n        }\r\n      }\r\n    }\r\n\r\n    if (ambiguities > 0) {\r\n      /* if there exists a similar moving piece on the same rank and file as\r\n       * the move in question, use the square as the disambiguator\r\n       */\r\n      if (same_rank > 0 && same_file > 0) {\r\n        return algebraic(from)\r\n      } else if (same_file > 0) {\r\n        /* if the moving piece rests on the same file, use the rank symbol as the\r\n         * disambiguator\r\n         */\r\n        return algebraic(from).charAt(1)\r\n      } else {\r\n        /* else use the file symbol */\r\n        return algebraic(from).charAt(0)\r\n      }\r\n    }\r\n\r\n    return ''\r\n  }\r\n\r\n  function infer_piece_type(san) {\r\n    var piece_type = san.charAt(0)\r\n    if (piece_type >= 'a' && piece_type <= 'h') {\r\n      var matches = san.match(/[a-h]\\d.*[a-h]\\d/)\r\n      if (matches) {\r\n        return undefined\r\n      }\r\n      return PAWN\r\n    }\r\n    piece_type = piece_type.toLowerCase()\r\n    if (piece_type === 'o') {\r\n      return KING\r\n    }\r\n    return piece_type\r\n  }\r\n  function ascii() {\r\n    var s = '   +------------------------+\\n'\r\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\r\n      /* display the rank */\r\n      if (file(i) === 0) {\r\n        s += ' ' + '87654321'[rank(i)] + ' |'\r\n      }\r\n\r\n      /* empty piece */\r\n      if (board[i] == null) {\r\n        s += ' . '\r\n      } else {\r\n        var piece = board[i].type\r\n        var color = board[i].color\r\n        var symbol = color === WHITE ? piece.toUpperCase() : piece.toLowerCase()\r\n        s += ' ' + symbol + ' '\r\n      }\r\n\r\n      if ((i + 1) & 0x88) {\r\n        s += '|\\n'\r\n        i += 8\r\n      }\r\n    }\r\n    s += '   +------------------------+\\n'\r\n    s += '     a  b  c  d  e  f  g  h\\n'\r\n\r\n    return s\r\n  }\r\n\r\n  // convert a move from Standard Algebraic Notation (SAN) to 0x88 coordinates\r\n  function move_from_san(move, sloppy) {\r\n    // strip off any move decorations: e.g Nf3+?!\r\n    var clean_move = stripped_san(move)\r\n\r\n    // if we're using the sloppy parser run a regex to grab piece, to, and from\r\n    // this should parse invalid SAN like: Pe2-e4, Rc1c4, Qf3xf7\r\n    if (sloppy) {\r\n      var matches = clean_move.match(\r\n        /([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/\r\n      )\r\n      if (matches) {\r\n        var piece = matches[1]\r\n        var from = matches[2]\r\n        var to = matches[3]\r\n        var promotion = matches[4]\r\n      }\r\n    }\r\n    var piece_type = infer_piece_type(clean_move)\r\n    var moves = null\r\n    var legalMoves = generate_moves({\r\n      legal: true,\r\n      piece: piece ? piece : piece_type,\r\n    })\r\n    moves = legalMoves\r\n    if (sloppy) {\r\n      var illegalMoves = generate_moves({\r\n        legal: false,\r\n        piece: piece ? piece : piece_type,\r\n      })\r\n      moves = illegalMoves\r\n    }\r\n\r\n    for (var i = 0, len = moves.length; i < len; i++) {\r\n      // try the strict parser first, then the sloppy parser if requested\r\n      // by the user\r\n      if (\r\n        clean_move === stripped_san(move_to_san(moves[i], legalMoves)) ||\r\n        (sloppy &&\r\n          clean_move === stripped_san(move_to_san(moves[i], illegalMoves)))\r\n      ) {\r\n        return moves[i]\r\n      } else {\r\n        if (\r\n          matches &&\r\n          (!piece || piece.toLowerCase() == moves[i].piece) &&\r\n          SQUARES[from] == moves[i].from &&\r\n          SQUARES[to] == moves[i].to &&\r\n          (!promotion || promotion.toLowerCase() == moves[i].promotion)\r\n        ) {\r\n          return moves[i]\r\n        }\r\n      }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  /*****************************************************************************\r\n   * UTILITY FUNCTIONS\r\n   ****************************************************************************/\r\n  function rank(i) {\r\n    return i >> 4\r\n  }\r\n\r\n  function file(i) {\r\n    return i & 15\r\n  }\r\n\r\n  function algebraic(i) {\r\n    var f = file(i),\r\n      r = rank(i)\r\n    return 'abcdefgh'.substring(f, f + 1) + '87654321'.substring(r, r + 1)\r\n  }\r\n\r\n  function swap_color(c) {\r\n    return c === WHITE ? BLACK : WHITE\r\n  }\r\n\r\n  function is_digit(c) {\r\n    return '0123456789'.indexOf(c) !== -1\r\n  }\r\n\r\n  /* pretty = external move object */\r\n  function make_pretty(ugly_move) {\r\n    var move = clone(ugly_move)\r\n    move.san = move_to_san(move, generate_moves({ legal: true }))\r\n    move.to = algebraic(move.to)\r\n    move.from = algebraic(move.from)\r\n\r\n    var flags = ''\r\n\r\n    for (var flag in BITS) {\r\n      if (BITS[flag] & move.flags) {\r\n        flags += FLAGS[flag]\r\n      }\r\n    }\r\n    move.flags = flags\r\n\r\n    return move\r\n  }\r\n\r\n  function clone(obj) {\r\n    var dupe = obj instanceof Array ? [] : {}\r\n\r\n    for (var property in obj) {\r\n      if (typeof property === 'object') {\r\n        dupe[property] = clone(obj[property])\r\n      } else {\r\n        dupe[property] = obj[property]\r\n      }\r\n    }\r\n\r\n    return dupe\r\n  }\r\n\r\n  function trim(str) {\r\n    return str.replace(/^\\s+|\\s+$/g, '')\r\n  }\r\n\r\n  /*****************************************************************************\r\n   * DEBUGGING UTILITIES\r\n   ****************************************************************************/\r\n  function perft(depth) {\r\n    var moves = generate_moves({ legal: false })\r\n    var nodes = 0\r\n    var color = turn\r\n\r\n    for (var i = 0, len = moves.length; i < len; i++) {\r\n      make_move(moves[i])\r\n      if (!king_attacked(color)) {\r\n        if (depth - 1 > 0) {\r\n          var child_nodes = perft(depth - 1)\r\n          nodes += child_nodes\r\n        } else {\r\n          nodes++\r\n        }\r\n      }\r\n      undo_move()\r\n    }\r\n\r\n    return nodes\r\n  }\r\n\r\n  return {\r\n    /***************************************************************************\r\n     * PUBLIC CONSTANTS (is there a better way to do this?)\r\n     **************************************************************************/\r\n    WHITE: WHITE,\r\n    BLACK: BLACK,\r\n    PAWN: PAWN,\r\n    KNIGHT: KNIGHT,\r\n    BISHOP: BISHOP,\r\n    ROOK: ROOK,\r\n    QUEEN: QUEEN,\r\n    KING: KING,\r\n    SQUARES: (function () {\r\n      /* from the ECMA-262 spec (section 12.6.4):\r\n       * \"The mechanics of enumerating the properties ... is\r\n       * implementation dependent\"\r\n       * so: for (var sq in SQUARES) { keys.push(sq); } might not be\r\n       * ordered correctly\r\n       */\r\n      var keys = []\r\n      for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\r\n        if (i & 0x88) {\r\n          i += 7\r\n          continue\r\n        }\r\n        keys.push(algebraic(i))\r\n      }\r\n      return keys\r\n    })(),\r\n    FLAGS: FLAGS,\r\n\r\n    /***************************************************************************\r\n     * PUBLIC API\r\n     **************************************************************************/\r\n    load: function (fen) {\r\n      return load(fen)\r\n    },\r\n\r\n    reset: function () {\r\n      return reset()\r\n    },\r\n\r\n    moves: function (options) {\r\n      /* The internal representation of a chess move is in 0x88 format, and\r\n       * not meant to be human-readable.  The code below converts the 0x88\r\n       * square coordinates to algebraic coordinates.  It also prunes an\r\n       * unnecessary move keys resulting from a verbose call.\r\n       */\r\n\r\n      var ugly_moves = generate_moves(options)\r\n      var moves = []\r\n\r\n      for (var i = 0, len = ugly_moves.length; i < len; i++) {\r\n        /* does the user want a full move object (most likely not), or just\r\n         * SAN\r\n         */\r\n        if (\r\n          typeof options !== 'undefined' &&\r\n          'verbose' in options &&\r\n          options.verbose\r\n        ) {\r\n          moves.push(make_pretty(ugly_moves[i]))\r\n        } else {\r\n          moves.push(\r\n            move_to_san(ugly_moves[i], generate_moves({ legal: true }))\r\n          )\r\n        }\r\n      }\r\n\r\n      return moves\r\n    },\r\n\r\n    in_check: function () {\r\n      return in_check()\r\n    },\r\n\r\n    in_checkmate: function () {\r\n      return in_checkmate()\r\n    },\r\n\r\n    in_stalemate: function () {\r\n      return in_stalemate()\r\n    },\r\n\r\n    in_draw: function () {\r\n      return (\r\n        half_moves >= 100 ||\r\n        in_stalemate() ||\r\n        insufficient_material() ||\r\n        in_threefold_repetition()\r\n      )\r\n    },\r\n\r\n    insufficient_material: function () {\r\n      return insufficient_material()\r\n    },\r\n\r\n    in_threefold_repetition: function () {\r\n      return in_threefold_repetition()\r\n    },\r\n\r\n    game_over: function () {\r\n      return (\r\n        half_moves >= 100 ||\r\n        in_checkmate() ||\r\n        in_stalemate() ||\r\n        insufficient_material() ||\r\n        in_threefold_repetition()\r\n      )\r\n    },\r\n\r\n    validate_fen: function (fen) {\r\n      return validate_fen(fen)\r\n    },\r\n\r\n    fen: function () {\r\n      return generate_fen()\r\n    },\r\n\r\n    board: function () {\r\n      var output = [],\r\n        row = []\r\n\r\n      for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\r\n        if (board[i] == null) {\r\n          row.push(null)\r\n        } else {\r\n          row.push({ type: board[i].type, color: board[i].color })\r\n        }\r\n        if ((i + 1) & 0x88) {\r\n          output.push(row)\r\n          row = []\r\n          i += 8\r\n        }\r\n      }\r\n\r\n      return output\r\n    },\r\n\r\n    pgn: function (options) {\r\n      /* using the specification from http://www.chessclub.com/help/PGN-spec\r\n       * example for html usage: .pgn({ max_width: 72, newline_char: \"<br />\" })\r\n       */\r\n      var newline =\r\n        typeof options === 'object' && typeof options.newline_char === 'string'\r\n          ? options.newline_char\r\n          : '\\n'\r\n      var max_width =\r\n        typeof options === 'object' && typeof options.max_width === 'number'\r\n          ? options.max_width\r\n          : 0\r\n      var result = []\r\n      var header_exists = false\r\n\r\n      /* add the PGN header headerrmation */\r\n      for (var i in header) {\r\n        /* TODO: order of enumerated properties in header object is not\r\n         * guaranteed, see ECMA-262 spec (section 12.6.4)\r\n         */\r\n        result.push('[' + i + ' \"' + header[i] + '\"]' + newline)\r\n        header_exists = true\r\n      }\r\n\r\n      if (header_exists && history.length) {\r\n        result.push(newline)\r\n      }\r\n\r\n      var append_comment = function (move_string) {\r\n        var comment = comments[generate_fen()]\r\n        if (typeof comment !== 'undefined') {\r\n          var delimiter = move_string.length > 0 ? ' ' : ''\r\n          move_string = `${move_string}${delimiter}{${comment}}`\r\n        }\r\n        return move_string\r\n      }\r\n\r\n      /* pop all of history onto reversed_history */\r\n      var reversed_history = []\r\n      while (history.length > 0) {\r\n        reversed_history.push(undo_move())\r\n      }\r\n\r\n      var moves = []\r\n      var move_string = ''\r\n\r\n      /* special case of a commented starting position with no moves */\r\n      if (reversed_history.length === 0) {\r\n        moves.push(append_comment(''))\r\n      }\r\n\r\n      /* build the list of moves.  a move_string looks like: \"3. e3 e6\" */\r\n      while (reversed_history.length > 0) {\r\n        move_string = append_comment(move_string)\r\n        var move = reversed_history.pop()\r\n\r\n        /* if the position started with black to move, start PGN with 1. ... */\r\n        if (!history.length && move.color === 'b') {\r\n          move_string = move_number + '. ...'\r\n        } else if (move.color === 'w') {\r\n          /* store the previous generated move_string if we have one */\r\n          if (move_string.length) {\r\n            moves.push(move_string)\r\n          }\r\n          move_string = move_number + '.'\r\n        }\r\n\r\n        move_string =\r\n          move_string +\r\n          ' ' +\r\n          move_to_san(move, generate_moves({ legal: false }))\r\n        make_move(move)\r\n      }\r\n\r\n      /* are there any other leftover moves? */\r\n      if (move_string.length) {\r\n        moves.push(append_comment(move_string))\r\n      }\r\n\r\n      /* is there a result? */\r\n      if (typeof header.Result !== 'undefined') {\r\n        moves.push(header.Result)\r\n      }\r\n\r\n      /* history should be back to what it was before we started generating PGN,\r\n       * so join together moves\r\n       */\r\n      if (max_width === 0) {\r\n        return result.join('') + moves.join(' ')\r\n      }\r\n\r\n      var strip = function () {\r\n        if (result.length > 0 && result[result.length - 1] === ' ') {\r\n          result.pop()\r\n          return true\r\n        }\r\n        return false\r\n      }\r\n\r\n      /* NB: this does not preserve comment whitespace. */\r\n      var wrap_comment = function (width, move) {\r\n        for (var token of move.split(' ')) {\r\n          if (!token) {\r\n            continue\r\n          }\r\n          if (width + token.length > max_width) {\r\n            while (strip()) {\r\n              width--\r\n            }\r\n            result.push(newline)\r\n            width = 0\r\n          }\r\n          result.push(token)\r\n          width += token.length\r\n          result.push(' ')\r\n          width++\r\n        }\r\n        if (strip()) {\r\n          width--\r\n        }\r\n        return width\r\n      }\r\n\r\n      /* wrap the PGN output at max_width */\r\n      var current_width = 0\r\n      for (var i = 0; i < moves.length; i++) {\r\n        if (current_width + moves[i].length > max_width) {\r\n          if (moves[i].includes('{')) {\r\n            current_width = wrap_comment(current_width, moves[i])\r\n            continue\r\n          }\r\n        }\r\n        /* if the current move will push past max_width */\r\n        if (current_width + moves[i].length > max_width && i !== 0) {\r\n          /* don't end the line with whitespace */\r\n          if (result[result.length - 1] === ' ') {\r\n            result.pop()\r\n          }\r\n\r\n          result.push(newline)\r\n          current_width = 0\r\n        } else if (i !== 0) {\r\n          result.push(' ')\r\n          current_width++\r\n        }\r\n        result.push(moves[i])\r\n        current_width += moves[i].length\r\n      }\r\n\r\n      return result.join('')\r\n    },\r\n\r\n    load_pgn: function (pgn, options) {\r\n      // allow the user to specify the sloppy move parser to work around over\r\n      // disambiguation bugs in Fritz and Chessbase\r\n      var sloppy =\r\n        typeof options !== 'undefined' && 'sloppy' in options\r\n          ? options.sloppy\r\n          : false\r\n\r\n      function mask(str) {\r\n        return str.replace(/\\\\/g, '\\\\')\r\n      }\r\n\r\n      function has_keys(object) {\r\n        for (var key in object) {\r\n          return true\r\n        }\r\n        return false\r\n      }\r\n\r\n      function parse_pgn_header(header, options) {\r\n        var newline_char =\r\n          typeof options === 'object' &&\r\n          typeof options.newline_char === 'string'\r\n            ? options.newline_char\r\n            : '\\r?\\n'\r\n        var header_obj = {}\r\n        var headers = header.split(new RegExp(mask(newline_char)))\r\n        var key = ''\r\n        var value = ''\r\n\r\n        for (var i = 0; i < headers.length; i++) {\r\n          key = headers[i].replace(/^\\[([A-Z][A-Za-z]*)\\s.*\\]$/, '$1')\r\n          value = headers[i].replace(/^\\[[A-Za-z]+\\s\"(.*)\"\\ *\\]$/, '$1')\r\n          if (trim(key).length > 0) {\r\n            header_obj[key] = value\r\n          }\r\n        }\r\n\r\n        return header_obj\r\n      }\r\n\r\n      var newline_char =\r\n        typeof options === 'object' && typeof options.newline_char === 'string'\r\n          ? options.newline_char\r\n          : '\\r?\\n'\r\n\r\n      // RegExp to split header. Takes advantage of the fact that header and movetext\r\n      // will always have a blank line between them (ie, two newline_char's).\r\n      // With default newline_char, will equal: /^(\\[((?:\\r?\\n)|.)*\\])(?:\\r?\\n){2}/\r\n      var header_regex = new RegExp(\r\n        '^(\\\\[((?:' +\r\n          mask(newline_char) +\r\n          ')|.)*\\\\])' +\r\n          '(?:' +\r\n          mask(newline_char) +\r\n          '){2}'\r\n      )\r\n\r\n      // If no header given, begin with moves.\r\n      var header_string = header_regex.test(pgn)\r\n        ? header_regex.exec(pgn)[1]\r\n        : ''\r\n\r\n      // Put the board in the starting position\r\n      reset()\r\n\r\n      /* parse PGN header */\r\n      var headers = parse_pgn_header(header_string, options)\r\n      for (var key in headers) {\r\n        set_header([key, headers[key]])\r\n      }\r\n\r\n      /* load the starting position indicated by [Setup '1'] and\r\n       * [FEN position] */\r\n      if (headers['SetUp'] === '1') {\r\n        if (!('FEN' in headers && load(headers['FEN'], true))) {\r\n          // second argument to load: don't clear the headers\r\n          return false\r\n        }\r\n      }\r\n\r\n      /* NB: the regexes below that delete move numbers, recursive\r\n       * annotations, and numeric annotation glyphs may also match\r\n       * text in comments. To prevent this, we transform comments\r\n       * by hex-encoding them in place and decoding them again after\r\n       * the other tokens have been deleted.\r\n       *\r\n       * While the spec states that PGN files should be ASCII encoded,\r\n       * we use {en,de}codeURIComponent here to support arbitrary UTF8\r\n       * as a convenience for modern users */\r\n\r\n      var to_hex = function (string) {\r\n        return Array.from(string)\r\n          .map(function (c) {\r\n            /* encodeURI doesn't transform most ASCII characters,\r\n             * so we handle these ourselves */\r\n            return c.charCodeAt(0) < 128\r\n              ? c.charCodeAt(0).toString(16)\r\n              : encodeURIComponent(c).replace(/\\%/g, '').toLowerCase()\r\n          })\r\n          .join('')\r\n      }\r\n\r\n      var from_hex = function (string) {\r\n        return string.length == 0\r\n          ? ''\r\n          : decodeURIComponent('%' + string.match(/.{1,2}/g).join('%'))\r\n      }\r\n\r\n      var encode_comment = function (string) {\r\n        string = string.replace(new RegExp(mask(newline_char), 'g'), ' ')\r\n        return `{${to_hex(string.slice(1, string.length - 1))}}`\r\n      }\r\n\r\n      var decode_comment = function (string) {\r\n        if (string.startsWith('{') && string.endsWith('}')) {\r\n          return from_hex(string.slice(1, string.length - 1))\r\n        }\r\n      }\r\n\r\n      /* delete header to get the moves */\r\n      var ms = pgn\r\n        .replace(header_string, '')\r\n        .replace(\r\n          /* encode comments so they don't get deleted below */\r\n          new RegExp(`(\\{[^}]*\\})+?|;([^${mask(newline_char)}]*)`, 'g'),\r\n          function (match, bracket, semicolon) {\r\n            return bracket !== undefined\r\n              ? encode_comment(bracket)\r\n              : ' ' + encode_comment(`{${semicolon.slice(1)}}`)\r\n          }\r\n        )\r\n        .replace(new RegExp(mask(newline_char), 'g'), ' ')\r\n\r\n      /* delete recursive annotation variations */\r\n      var rav_regex = /(\\([^\\(\\)]+\\))+?/g\r\n      while (rav_regex.test(ms)) {\r\n        ms = ms.replace(rav_regex, '')\r\n      }\r\n\r\n      /* delete move numbers */\r\n      ms = ms.replace(/\\d+\\.(\\.\\.)?/g, '')\r\n\r\n      /* delete ... indicating black to move */\r\n      ms = ms.replace(/\\.\\.\\./g, '')\r\n\r\n      /* delete numeric annotation glyphs */\r\n      ms = ms.replace(/\\$\\d+/g, '')\r\n\r\n      /* trim and get array of moves */\r\n      var moves = trim(ms).split(new RegExp(/\\s+/))\r\n\r\n      /* delete empty entries */\r\n      moves = moves.join(',').replace(/,,+/g, ',').split(',')\r\n      var move = ''\r\n\r\n      for (var half_move = 0; half_move < moves.length - 1; half_move++) {\r\n        var comment = decode_comment(moves[half_move])\r\n        if (comment !== undefined) {\r\n          comments[generate_fen()] = comment\r\n          continue\r\n        }\r\n        move = move_from_san(moves[half_move], sloppy)\r\n\r\n        /* move not possible! (don't clear the board to examine to show the\r\n         * latest valid position)\r\n         */\r\n        if (move == null) {\r\n          return false\r\n        } else {\r\n          make_move(move)\r\n        }\r\n      }\r\n\r\n      comment = decode_comment(moves[moves.length - 1])\r\n      if (comment !== undefined) {\r\n        comments[generate_fen()] = comment\r\n        moves.pop()\r\n      }\r\n\r\n      /* examine last move */\r\n      move = moves[moves.length - 1]\r\n      if (POSSIBLE_RESULTS.indexOf(move) > -1) {\r\n        if (has_keys(header) && typeof header.Result === 'undefined') {\r\n          set_header(['Result', move])\r\n        }\r\n      } else {\r\n        move = move_from_san(move, sloppy)\r\n        if (move == null) {\r\n          return false\r\n        } else {\r\n          make_move(move)\r\n        }\r\n      }\r\n      return true\r\n    },\r\n\r\n    header: function () {\r\n      return set_header(arguments)\r\n    },\r\n\r\n    ascii: function () {\r\n      return ascii()\r\n    },\r\n\r\n    turn: function () {\r\n      return turn\r\n    },\r\n\r\n    move: function (move, options) {\r\n      /* The move function can be called with in the following parameters:\r\n       *\r\n       * .move('Nxb7')      <- where 'move' is a case-sensitive SAN string\r\n       *\r\n       * .move({ from: 'h7', <- where the 'move' is a move object (additional\r\n       *         to :'h8',      fields are ignored)\r\n       *         promotion: 'q',\r\n       *      })\r\n       */\r\n\r\n      // allow the user to specify the sloppy move parser to work around over\r\n      // disambiguation bugs in Fritz and Chessbase\r\n      var sloppy =\r\n        typeof options !== 'undefined' && 'sloppy' in options\r\n          ? options.sloppy\r\n          : false\r\n\r\n      var move_obj = null\r\n\r\n      if (typeof move === 'string') {\r\n        move_obj = move_from_san(move, sloppy)\r\n      } else if (typeof move === 'object') {\r\n        var moves = generate_moves()\r\n\r\n        /* convert the pretty move object to an ugly move object */\r\n        for (var i = 0, len = moves.length; i < len; i++) {\r\n          if (\r\n            move.from === algebraic(moves[i].from) &&\r\n            move.to === algebraic(moves[i].to) &&\r\n            (!('promotion' in moves[i]) ||\r\n              move.promotion === moves[i].promotion)\r\n          ) {\r\n            move_obj = moves[i]\r\n            break\r\n          }\r\n        }\r\n      }\r\n\r\n      /* failed to find move */\r\n      if (!move_obj) {\r\n        return null\r\n      }\r\n\r\n      /* need to make a copy of move because we can't generate SAN after the\r\n       * move is made\r\n       */\r\n      var pretty_move = make_pretty(move_obj)\r\n\r\n      make_move(move_obj)\r\n\r\n      return pretty_move\r\n    },\r\n\r\n    undo: function () {\r\n      var move = undo_move()\r\n      return move ? make_pretty(move) : null\r\n    },\r\n\r\n    clear: function () {\r\n      return clear()\r\n    },\r\n\r\n    put: function (piece, square) {\r\n      return put(piece, square)\r\n    },\r\n\r\n    get: function (square) {\r\n      return get(square)\r\n    },\r\n\r\n    remove: function (square) {\r\n      return remove(square)\r\n    },\r\n\r\n    perft: function (depth) {\r\n      return perft(depth)\r\n    },\r\n\r\n    square_color: function (square) {\r\n      if (square in SQUARES) {\r\n        var sq_0x88 = SQUARES[square]\r\n        return (rank(sq_0x88) + file(sq_0x88)) % 2 === 0 ? 'light' : 'dark'\r\n      }\r\n\r\n      return null\r\n    },\r\n\r\n    history: function (options) {\r\n      var reversed_history = []\r\n      var move_history = []\r\n      var verbose =\r\n        typeof options !== 'undefined' &&\r\n        'verbose' in options &&\r\n        options.verbose\r\n\r\n      while (history.length > 0) {\r\n        reversed_history.push(undo_move())\r\n      }\r\n\r\n      while (reversed_history.length > 0) {\r\n        var move = reversed_history.pop()\r\n        if (verbose) {\r\n          move_history.push(make_pretty(move))\r\n        } else {\r\n          move_history.push(move_to_san(move, generate_moves({ legal: true })))\r\n        }\r\n        make_move(move)\r\n      }\r\n\r\n      return move_history\r\n    },\r\n\r\n    get_comment: function () {\r\n      return comments[generate_fen()]\r\n    },\r\n\r\n    set_comment: function (comment) {\r\n      comments[generate_fen()] = comment.replace('{', '[').replace('}', ']')\r\n    },\r\n\r\n    delete_comment: function () {\r\n      var comment = comments[generate_fen()]\r\n      delete comments[generate_fen()]\r\n      return comment\r\n    },\r\n\r\n    get_comments: function () {\r\n      prune_comments()\r\n      return Object.keys(comments).map(function (fen) {\r\n        return { fen: fen, comment: comments[fen] }\r\n      })\r\n    },\r\n\r\n    delete_comments: function () {\r\n      prune_comments()\r\n      return Object.keys(comments).map(function (fen) {\r\n        var comment = comments[fen]\r\n        delete comments[fen]\r\n        return { fen: fen, comment: comment }\r\n      })\r\n    },\r\n  }\r\n}\r\n\r\n","import { svg2element } from \"../../helpers.js\";\r\n\r\n\r\n\r\n\r\n\r\nfunction play(width, y){\r\n\t\r\n\t\r\n\t// Calculate the size of the triangle, and where the drawing should begin.\r\n\tlet height = width*2*Math.sqrt(3)/3;\r\n\t\r\n\t\r\n\tlet r_max = height*Math.sqrt(3)/6;\r\n    let r = 3 > r_max ? r_max : 3;\r\n    let dH = r*Math.sqrt(3); // Length of side cut by 1 rounding.\r\n\t\r\n\r\n    let Mx = 0;\r\n\tlet My = y + 5 - height/2;\r\n    \r\n    let p0 = [Mx, My]\r\n    let p1 = [Mx + height*Math.sqrt(3)/2, My + height/2]\r\n    let p2 = [Mx, My + height]\r\n    \r\n\t\r\n    \r\n    return `M${p0[0]} ${p0[1]+dH}\r\n      a ${r},${r}, 0,0,1  ${r*3/2}, ${-dH/2}\r\n      L ${p1[0]-r*3/2} ${p1[1]-dH/2}\r\n      a ${r},${r}, 0,0,1  0, ${dH}\r\n      L ${p2[0]+r*3/2} ${p2[1]-dH/2}\r\n      a ${r},${r}, 0,0,1  ${-r*3/2}, ${-dH/2}\r\n      Z\r\n      `\r\n\t\r\n} // playPath\r\n\r\nfunction pause(width, y){\r\n\t\r\n    let height = width*2*Math.sqrt(3)/3 - 2*(3*Math.sqrt(3)-3);\r\n    let dx = width/5;\r\n    let r = 3;\r\n    \r\n\tlet Mx = 0;\r\n\tlet My = y + 5 - height/2;\r\n\t\r\n    return `\r\n      M ${Mx+r} ${My} \r\n      L ${Mx+2*dx-r} ${My}\r\n      a ${r},${r} 0,0,1 ${r},${r}\r\n      L ${Mx+2*dx} ${My+height-r}\r\n      a ${r},${r} 0,0,1 ${-r},${r}\r\n      L ${Mx+r} ${My+height}\r\n      a ${r},${r} 0,0,1 ${-r},${-r}\r\n      L ${Mx} ${My+r}\r\n      a ${r},${r} 0,0,1 ${r},${-r}\r\n\t  M ${Mx+3*dx + r} ${My}\r\n      L ${Mx+5*dx-r} ${My}\r\n      a ${r},${r} 0,0,1 ${r},${r}\r\n      L ${Mx+5*dx} ${My+height-r}\r\n      a ${r},${r} 0,0,1 ${-r},${r}\r\n      L ${Mx+3*dx+r} ${My+height}\r\n      a ${r},${r} 0,0,1 ${-r},${-r}\r\n      L ${Mx+3*dx} ${My+r}\r\n      a ${r},${r} 0,0,1 ${r},${-r}\r\n    `\r\n} // pausePath\r\n\r\n\r\nlet template = `\r\n<g style=\"cursor: pointer;\">\r\n  <path fill=\"tomato\" d=\"\"></path>\r\n</g>\r\n`\r\n\r\n\r\n\r\n\r\n\r\n// Maybe the y should just be set outside? And the same for the chapter?? Maybe give it the y it should center itself about?\r\n\r\n// textHeight + textBottomMargin + rectHighlightHeightDelta + rectHeight/2 - H/2\r\nexport default class PlayButton{\r\n\t\r\n  // The y is given as the centerline about which to position the button. Half above, and half below. The initial y is therefore half the height, and should draw the button completely on hte svg.\r\n  y = 20*2*Math.sqrt(3)/3 / 2;\r\n  width = 20;\r\n\t\r\n  constructor(){\r\n    let obj = this;\r\n\tobj.node = svg2element( template );\r\n  } // constructor\r\n  \r\n  update(playing){\r\n\tlet obj = this;\r\n\tlet d = playing ? pause(obj.width, obj.y) : play(obj.width, obj.y);\r\n\tobj.node.querySelector(\"path\").setAttribute(\"d\", d)\t\r\n  } // update\r\n} // PlayButton","import { svg2element } from \"../../helpers.js\";\r\n\r\n\r\nlet defaultRectAttributes = `stroke=\"white\" stroke-width=\"2px\"`;\r\nlet template = `<g class=\"chapter\">\r\n  <rect class=\"background\" fill=\"gainsboro\" ${ defaultRectAttributes }\"></rect>\r\n  <rect class=\"buffering\" fill=\"gray\" ${ defaultRectAttributes }\"></rect>\r\n  <rect class=\"foreground\" fill=\"tomato\" ${ defaultRectAttributes }\"></rect>\r\n  <text style=\"display: none;\"></text>\r\n</g>`\r\n\r\n\r\nexport default class PlayBarAnnotation{\r\n\t\r\n  // y = textHeight + textBottomMargin + highlightHeightDelta\r\n  y = 12 + 2 + 3;\r\n  height = 10\r\n  dh = 4\r\n  \r\n  constructor(config, tscale){\r\n    let obj = this;\r\n\tobj.node = svg2element(template);\r\n\t\r\n\tobj.background = obj.node.querySelector(\"rect.background\");\r\n\tobj.buffering = obj.node.querySelector(\"rect.buffering\");\r\n\tobj.foreground = obj.node.querySelector(\"rect.foreground\");\r\n\tobj.label = obj.node.querySelector(\"text\");\r\n\t\r\n\tobj.config = config;\r\n\tobj.tscale = tscale;\r\n\t\r\n\t\r\n\tobj.node.addEventListener(\"mouseenter\", ()=>{\r\n\t\tobj.highlight();\r\n\t}) // addEventListener\r\n\t\r\n\tobj.node.addEventListener(\"mouseover\", ()=>{\r\n\t\tobj.highlight();\r\n\t}) // addEventListener\r\n\t\r\n\tobj.node.addEventListener(\"mouseout\", ()=>{\r\n\t\tobj.unhighlight();\t\t\t\r\n\t}) // addEventListener\r\n  } // constructor\r\n  \r\n  update(t_play, t_buffered){\r\n\tlet obj = this;\r\n\t\r\n\tlet y = obj.y;\r\n\tlet x = obj.tscale.dom2range(obj.config.starttime);\r\n\r\n    obj.background.setAttribute(\"y\", y)\r\n\tobj.background.setAttribute(\"x\", x);\r\n\tobj.background.setAttribute(\"width\", obj.width)\r\n\tobj.background.setAttribute(\"height\", obj.height)\r\n\t \r\n\tobj.buffering.setAttribute(\"y\", y)\r\n\tobj.buffering.setAttribute(\"x\", x);\r\n\tobj.buffering.setAttribute(\"width\", obj.width*obj.timeFraction(t_buffered))\r\n\tobj.buffering.setAttribute(\"height\", obj.height)\r\n\t  \r\n\tobj.foreground.setAttribute(\"y\", y)\r\n\tobj.foreground.setAttribute(\"x\", x);\r\n\tobj.foreground.setAttribute(\"width\", obj.width*obj.timeFraction(t_play))\r\n\tobj.foreground.setAttribute(\"height\", obj.height)\r\n\t  \r\n\tobj.label.setAttribute(\"y\", 12)\r\n\tobj.label.setAttribute(\"x\", x)\r\n\tobj.label.innerHTML = obj.config.label\r\n\r\n  } // update\r\n  \r\n  \r\n  get width(){\r\n\tlet obj = this;\r\n\tlet x0 = obj.tscale.dom2range(obj.config.starttime);\r\n\tlet x1 = obj.tscale.dom2range(obj.config.endtime);\r\n\t// At the beginning hte widths may be negative because the starttime of the comment exceeds the time domain of the playbar that hasn't yet been updated to the right interval. Returen 0 while this is so.\r\n\treturn x1 - x0 < 0 ? 0 : x1 - x0;\r\n  } // width\r\n  \r\n  timeFraction(t){\r\n\tlet obj = this;\r\n\tlet tf = ( t - obj.config.starttime ) / (obj.config.endtime - obj.config.starttime);\r\n\treturn Math.abs(tf - 0.5) <= 0.5 ? tf : tf>0;\r\n  } // timeFraction\r\n  \r\n  highlight(){\r\n\tlet obj = this;\r\n\thighlightRectangle( obj.background, obj.y, obj.height, obj.dh );\r\n\thighlightRectangle( obj.buffering, obj.y, obj.height, obj.dh );\r\n\thighlightRectangle( obj.foreground, obj.y, obj.height, obj.dh );\r\n\tobj.label.style.display = \"\";\r\n  } // highlight\r\n  \r\n  unhighlight(){\r\n\tlet obj = this;\r\n\tunhighlightRectangle( obj.background, obj.y, obj.height );\r\n\tunhighlightRectangle( obj.buffering, obj.y, obj.height );\r\n\tunhighlightRectangle( obj.foreground, obj.y, obj.height );\r\n\tobj.label.style.display = \"none\";\r\n  } // highlight\r\n} // PlayBarAnnotation\r\n\r\n\r\nfunction highlightRectangle(r, y, h, dh){\r\n\tr.height.baseVal.value = h + 2*dh; \r\n\tr.y.baseVal.value = y - dh;\r\n} // highlightRectangle\r\n\r\nfunction unhighlightRectangle(r, y, h){\r\n\tr.height.baseVal.value = h;\r\n\tr.y.baseVal.value = y;\r\n} // unhighlightRectangle","import { svg2element, scaleLinear, joinDataToElements } from \"../../helpers.js\";\r\nimport PlayBarAnnotation from \"./PlayBarAnnotation.js\";\r\n\r\n// This class is in charge of drawing the play bar. It takes in user prescribed annotations and the min and maximum times. It fills the gaps between the user prescribed annotations and the min/max times with empty chapters. The process is repeated anytime a new annotation is added.\r\n\r\nlet template = `<g style=\"cursor: pointer;\"></g>`; // template\r\n\r\nexport default class PlayBar{\r\n\t\r\n  // Coordinates in whole svg frame.\r\n  y = 12 + 2 + 3;\r\n  x0 = 20 + 6;\r\n  x1 = 300;\r\n\t\r\n  annotations = []\r\n\t\r\n  t_min = 0\r\n  t_max = 1\r\n\t\r\n  t_buffered = 0\r\n  t_play = 0\r\n\t\r\n  constructor(){\r\n\tlet obj = this;\r\n\tobj.node = svg2element( template );\r\n\t\r\n\tobj._tscale = new scaleLinear();\r\n  } // constructor\r\n  \r\n    \r\n  get tscale(){\r\n\t// The tscale is relative to the whole svg element, and takes in whole svg coordinates.\r\n\tlet obj = this;\r\n\t\t\r\n\tobj._tscale.domain = [obj.t_min, obj.t_max]\r\n\tobj._tscale.range = [obj.x0, obj.x1]\r\n\t\r\n\treturn obj._tscale;\r\n\t  \r\n  } // get tscale\r\n  \r\n  \r\n  rebuild(){\r\n\t// I need to do the join, but on objects instead of elements... Or just throw them all out and create new ones? Simpler I guess\r\n\tlet obj = this;\r\n\t\r\n\tlet exiting = obj.node.querySelectorAll(\"g.chapter\");\r\n\tfor(let i=0; i<exiting.length; i++){\r\n\t\texiting[i].remove()\r\n\t} // for\r\n\t\r\n\t// The creation of the chapters to show after somme annotations have been pushed still needs to be implemented.\r\n\tfunction makeChapterObj(label, timestamps){\r\n\t\t// Don't assign \r\n\t\treturn {\r\n\t\t\tlabel: label, \r\n\t\t\tstarttime: timestamps[0]===null ? obj.t_min : timestamps[0], \r\n\t\t\tendtime:   timestamps[1]===null ? obj.t_max : timestamps[1]}\r\n\t} // makeChapterObj\r\n\t\r\n\t\r\n\t// The ultimate way of doing it would be for the annotations to persist below other smaller annotations.\r\n\tlet chapters = obj.annotations.reduce((acc, a, i)=>{\r\n\t\t\r\n\t\t// Don't curtail hte previous one but instead allow it to draw completely. This allows the chapters to be 'stacked'. Ordering them by start time ensures they all have a handle available.\r\n\t\tlet previous = acc[acc.length - 1];\r\n\t\tlet current = makeChapterObj( a.name, a.timestamps );\r\n\t\t\r\n\t\tif(previous.endtime < current.starttime){\r\n\t\t\t// Push in the needed padding, and then the annotation.\r\n\t\t\tacc.push( makeChapterObj( \"\", [previous.endtime, current.starttime] ) );\r\n\t\t} // if\r\n\t\t\r\n\t\tacc.push( current )\r\n\t\t\r\n\t\tif(i==(obj.annotations.length-1) && current.endtime < obj.t_max){\r\n\t\t    acc.push( makeChapterObj( \"\", [current.endtime, obj.t_max] ) )\r\n\t\t} // if\r\n\t\t\r\n\t\treturn acc\r\n\t}, [ makeChapterObj(\"\", [obj.t_min, obj.t_max]) ])\r\n\t\r\n\t// Cpters need to be sorted by starttime in order for all start points to be visible.\r\n\tobj.chapters = chapters.sort((a,b)=>a.starttime-b.starttime || b.endtime-a.endtime).map(c=>{\r\n\t\tlet a = new PlayBarAnnotation(c, obj.tscale);\r\n\t\ta.y = obj.y;\r\n\t\treturn a;\r\n\t}) // map\r\n\t\r\n\tobj.chapters.forEach(chapter=>{\r\n\t\tobj.node.appendChild(chapter.node)\r\n\t}) // forEach\r\n\t\r\n  } // rebuild\r\n  \r\n  update(){\r\n\tlet obj = this;\r\n\tobj.chapters.forEach(chapter=>{\r\n\t\tchapter.update( obj.t_play, obj.t_buffered );\r\n\t})\r\n  } // update\r\n  \r\n  addchapters(tags){\r\n\t// The player may need to be updated when the serverr pushes updates. Also if other users update the annotations it should appear straightaway.\r\n\tlet obj = this;\r\n\t\r\n\t// Tags may not have both the startand end time specified. \r\n\tobj.annotations = obj.annotations.concat(tags);\r\n\t\r\n\t// Update the bar.\r\n\tobj.rebuild();\r\n\tobj.update();\r\n\t\r\n\t/*\r\n\tif(tag.starttime){\r\n\t\tlet i = obj.annotations.findIndex(a=>a.id==tag.id);\r\n\t\tobj.annotations.splice(i>-1 ? i : 0, i>-1, tag);\r\n\t\r\n\t\t// Update the bar.\r\n\t\tobj.rebuild();\r\n\t\tobj.update();\r\n\t} // if\r\n\t*/\r\n  } // addchapter\r\n} // PlayBar","/*\r\nPLAYBAR only controls the appearance of the playbar, but does not control the playing. It just allows the user interaction with the playbar.\r\n*/\r\n\r\n\r\n\r\n// Helepr to make an html element.\r\nimport {html2element, svg2element, scaleLinear, joinDataToElements} from \"../../helpers.js\";\r\n\r\nimport PlayButton from \"./PlayButton.js\";\r\nimport PlayBar from \"./PlayBar.js\";\r\n\r\n// The canvas will be positioned, and this should be relative to that positioning. Maybe there should be an overall div that contains the canvas and a sibling div that contains all the markup.\r\nlet template = `\r\n<div class=\"player-controls\">\r\n  <svg id=\"playbar\" width=\"100%\" height=\"32px\">\r\n    <g class=\"playbutton\"></g>\r\n    <g class=\"playbar\"></g>\r\n  </svg>\r\n</div>\r\n`; // template\r\n\r\n\r\n\r\n\r\n\r\nexport default class PlayControls{\r\n\t\r\n  textHeight = 12 \r\n  textBottomMargin = 2 \r\n  highlightHeightDelta = 3\r\n\t\r\n  constructor(){\r\n\tlet obj = this;\r\n\t\r\n\tobj.node = html2element(template);\r\n\t\r\n\tlet y = obj.textHeight + obj.textBottomMargin + obj.highlightHeightDelta;\r\n\t\r\n\t// Make a play button.\r\n\tobj.button = new PlayButton();\r\n\tobj.button.y = y;\r\n\tobj.node.querySelector(\"g.playbutton\").appendChild(obj.button.node);\r\n\t\r\n\tobj.button.node.addEventListener(\"click\",event=>{\r\n\t\t// Get the action required based on the button icon.\r\n\t\tif( obj.t_play == obj.t_max ){\r\n\t\t\tobj.t_play = obj.t_min;\r\n\t\t} // if\r\n\t\t\r\n\t\tobj.playing = !obj.playing;\r\n\t}) // addEventListener\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// The bar is just a node at this point\r\n\tobj.bar = new PlayBar();\r\n\tobj.bar.y = y;\r\n\tobj.node.querySelector(\"g.playbar\").appendChild( obj.bar.node );\r\n\t\r\n\tobj.bar.node.addEventListener(\"mouseup\", event=>{\r\n\t\t// On click the playbar should register the correct time.\r\n\t\t\r\n\t\t// The tscale takes inputs in the svg coordinates, and the event returns them in the client coordinates. Therefore the client coordinates must be adjusted for the position of the SVG.\r\n\t\t// Because there is a transformation applied the scale needs to be corrected for that also. Maybe calculate where \r\n\t\tlet barrect = obj.bar.node.getBoundingClientRect();\r\n\t\t\r\n\t\tlet t = obj.bar.t_min + (event.clientX - barrect.x)/(barrect.width)*(obj.bar.t_max - obj.bar.t_min);\r\n\t\t\r\n\t\t// Now just set the t to the right value, and update the view.\r\n\t\tobj.bar.t_play = t;\r\n\t\tobj.bar.update();\r\n\t\t\r\n\t\t// The playtime changed, therefore pause the video.\r\n\t\tobj.playing = false;\r\n\t\tobj.skipped = true;\r\n\t}) // addEventListener\r\n\t\r\n\t\r\n\tobj.bar.rebuild();\r\n\tobj.bar.update();\r\n\t\r\n\t\r\n\t\r\n\tobj.playing = false;\r\n\tobj.skipped = false;\r\n\t\r\n\t// Annotations. Comments should be based on the chapter tags I think. The discussion is intended to be based on observed events. The logical progress is that events need to first be identified, and then discussed in a separate step. There should be a single dialogue box, and in that one tags can be added. This allows a single comment to be seen in multiple threads. Replies will have to be handled separately. Eventually the user should also be able to pin comments.\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n\r\n  \r\n  get t_play(){\r\n\treturn this.bar.t_play;\r\n  } // get t_play\r\n  \r\n  set t_play(t){\r\n\tthis.bar.t_play = t;\r\n\tthis.bar.update();\r\n  } // set t_play\r\n  \r\n  get t_buffered(){\r\n\treturn this.bar.t_buffered;\r\n  } // get t_buffer\r\n  \r\n  set t_buffered(t){\r\n\tthis.bar.t_buffered = t;\r\n\tthis.bar.update();\r\n  } // set t_buffered\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  set t_domain(t){\r\n\t// Since t is coming from a specific location, it should be the same reference always. Therefore == comparison is valid.\r\n\tlet obj = this;\r\n\tif((t[0] != obj.bar.t_min) || (t[1] != obj.bar.t_max)){\r\n\t  obj.bar.t_min = t[0];\r\n\t  obj.bar.t_max = t[1];\r\n\t  obj.bar.rebuild();\r\n\t  obj.bar.update();\r\n\t} // if\r\n  } // set t_domain\r\n  \r\n  get t_domain(){\r\n\treturn [this.bar.t_min, this.bar.t_max]\r\n  } // get t_domain\r\n  \r\n  \r\n  set playing(v){\r\n\tlet obj = this;\r\n\tobj._playing = v;\r\n\tobj.update(v);\r\n  } // set playing\r\n  \r\n  get playing(){\r\n\treturn this._playing;\r\n  } // get playing\r\n  \r\n  \r\n  // FUNCTIONALITY\r\n  update(){\r\n\tlet obj = this;\r\n\tobj.button.update( obj.playing );\r\n\tobj.bar.update();\r\n  } // update\r\n  \r\n} // PlayControls","/* \r\nUnsteadyPlayer2D is a player option for the class `Individual' small multiple\r\nViewFrame2D controls the viewport and user interactions\r\nCamera2D keeps track of the user itneractions\r\nPlayBar handles the playbar interactivity\r\nMeshRenderer2D actually does the GPU drawing\r\n*/\r\n\r\n\r\nimport { html2element } from \"../helpers.js\"; \r\n\r\n\r\n// Load in hte external modules. Should all this be wrapped up in one item?\r\nimport Chessground from \"./chess/chessground_es.js\";\r\nimport Chess from \"./chess/chess.js\";\r\nimport PlayControls from \"./playbar/PlayControls.js\";\r\n\r\n\r\n\r\n\r\nlet template = `\r\n<div style=\"position: relative;\">\r\n  <div class=\"view\" style=\"width:300px; height:300px;\"></div>\r\n  <div class=\"controls\"></div>\r\n</div>\r\n`; // template\r\n\r\n\r\n\r\nexport default class ChessGameRenderer {\r\n  constructor(gamepgn){\r\n    // The superclass requires the viewnode to attach the required events..\r\n\tlet obj = this;\r\n\tobj.node = html2element( template );\r\n\t\r\n\t// The FPS at which to swap out data.\r\n\tobj.fps = 24;\r\n\tobj.dt = 1000 / obj.fps;\r\n\tobj.timelastdraw = 0;\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// `Chess' finds the available legal moves.\r\n\tobj.chess = new Chess();\r\n\t\r\n\t\r\n\t// `pgn' is teh sequence of moves played, `fen' is the current state of the game.\r\n\tobj.pgn = gamepgn;\r\n\t\r\n\t\r\n\t// Position within the series.\r\n\tlet plies = gamepgn.split(\" \"); // split by gaps.\r\n\tplies.splice(plies.length-1,1); // last one is points allocation\r\n\tobj.plies = plies.filter(function(v,i){return i%3 != 0}); // Filter out move number.\r\n\t\r\n\t\r\n\t// Convert the individual moves to FEN positions for easier navigation.\r\n\tobj.plies_fen = obj.plies.reduce((acc,ply)=>{\r\n\t\tobj.chess.move(ply)\r\n\t    acc.push(obj.chess.fen());\r\n\t\treturn acc\r\n\t},[\"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\"]); // reduce\r\n\tobj.chess.reset();\r\n\t\r\n\tobj.plyind = -1;\r\n\tobj.plyind_prev = undefined;\r\n\t\r\n\t\r\n\t// Configure the chess board renderer. Here we need to pass in the div to draw to.\r\n\tobj.board = Chessground(obj.node.querySelector(\"div.view\"), {\r\n\t\tviewOnly: false, \r\n\t\tmovable: {\r\n\t\t\tfree: false,\r\n\t\t\tevents: {\r\n\t\t\t\tafter: function(orig, dest){\r\n\t\t\t\t\t// After a move the new available moves need to be established. For that the chessboard needs to produce a fen for the chess module, which can then calculate the possible moves.\r\n\t\t\t\t\tobj.chess.move({\"from\": orig, \"to\": dest});\r\n\t\t\t\t\tobj.enforceAvailableMoves()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tobj.enforceAvailableMoves();\r\n\t\r\n\t\r\n\t\r\n\t// On board move the available moves should be updated. How do I achieve that?\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// WHAT OTHER METODS ARE REQUIRED??\r\n\t// GEOMTRYANNOTATION OBJ\r\n\tobj.geometryannotation = {\r\n\t\tsubmit: function(){\r\n\t\t\t// Retain only the basic items. Should also set an empty shapes array...\r\n\t\t\tlet a = {\r\n\t\t\t\tfen: obj.chess.fen(),\r\n\t\t\t\tshapes: obj.board.state.drawable.shapes.map(s=>{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\torig: s.orig,\r\n\t\t\t\t\t\tdest: s.dest\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// Clear the board.\r\n\t\t\tobj.board.set({\r\n\t\t\t\tdrawable: {\r\n\t\t\t\t\tshapes: []\r\n\t\t\t\t}\r\n\t\t\t}); // set\r\n\t\t\t\r\n\t\t\treturn a\r\n\t\t},\r\n\t\tshow: function(previewconfig){\r\n\t\t\t// This is supposed to show the current annotation - the chessground module supports that already.\r\n\t\t\t\r\n\t\t\t// The tag has a specific fen to display. When previewing the annotation it should be shown.\r\n\t\t\t// How will selecting the annotations happen? Should they be on-screen only if the fen are the same? Or should they be FEN independent? And toggling them on just shows them without showing the preview? Nah, toggling will show the latest one.\r\n\t\t\t// The playbar should move simultaneously?\r\n\t\t\t\r\n\t\t\tif(previewconfig){\r\n\t\t\t\tobj.plyind_prev = obj.plyind;\r\n\t\t\t\t\r\n\t\t\t\t// Clear the annotation state.\r\n\t\t\t\tobj.board.state.drawable.shapes = [];\r\n\t\t\t\t\r\n\t\t\t\tlet plyind = obj.plies_fen.indexOf(previewconfig.fen);\r\n\t\t\t\tobj.ply(plyind);\r\n\t\t\t\t\r\n\t\t\t\t// Redrawing of annotations should also remove hte previous set.\r\n\t\t\t\tobj.drawGeometryAnnotations(previewconfig.shapes);\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tobj.ply(obj.plyind_prev)\r\n\t\t\t\tobj.plying_prev = undefined;\r\n\t\t\t\t\r\n\t\t\t\tobj.board.state.drawable.shapes = [];\r\n\t\t\t\tobj.board.redrawAll();\r\n\t\t\t}; // previewconfig\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\t\r\n\t\r\n\t// Add in precofigured UI. The metadata filename identifies this small multiple.\r\n\tobj.ui = new PlayControls();\r\n\tobj.node.querySelector(\"div.controls\").appendChild(obj.ui.node);\r\n\t\r\n\t\r\n\tobj.ui.bar.t_min = 0;\r\n\tobj.ui.bar.t_max = obj.plies.length-1;\r\n\tobj.ui.bar.rebuild();\r\n\tobj.ui.bar.update();\r\n\t\r\n\t// The SVG elements can handle their own updating, and there is no global renderer anyway.\r\n\t// Maybe just keep an requestAnimationFrame running? Or do it with setTimeout? setTimeout is likely less wasteful.\r\n\tobj.ui.button.node.addEventListener(\"click\", event=>{\r\n\t\t// Will the rendering loop have to be redone in order to allow promises to be returned to ensure that the player is ready for the next step?\r\n\t\tif(obj.ui.playing){\r\n\t\t\tobj.ply(obj.plyind+1);\r\n\t\t\tobj.interval = setInterval(function(){\r\n\t\t\t    obj.ply(obj.plyind+1);\r\n\t\t\t}, 1000);\r\n\t\t} else if ( obj.ui.skipped ){\r\n\t\t\tclearInterval(obj.interval);\r\n\t\t\tobj.ply(  Math.floor( obj.ui.bar.t_play ) )\r\n\t\t\tobj.ui.skipped = false;\r\n\t\t} else {\r\n\t\t\tclearInterval(obj.interval);\r\n\t\t} // if\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}) // addEventListener\r\n\t\r\n\t\r\n\tobj.ui.bar.node.addEventListener(\"click\", event=>{\r\n\t\tif(!obj.ui.playing && obj.ui.skipped){\r\n\t\t\t// Ok, when skipped the situation needs to be rebuilt. The chess module needs to be restarted in case variations have been played.\r\n\t\t\tobj.ply(  Math.floor( obj.ui.bar.t_play ) );\r\n\t\t} // if\r\n\t}) // addEventListener\r\n\t\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  ply(plyind){\r\n\t// This increments the plyind. I could then even make a computed value of `fen`, and only then ask the rerender.\r\n\tvar obj = this;\r\n\t\r\n\tif(plyind > obj.ui.bar.t_max){\r\n\t\tobj.plyind = obj.ui.bar.t_max;\r\n\t\tobj.ui.playing = false;\r\n\t\tclearInterval(obj.interval);\r\n\t} else {\r\n\t\tobj.plyind = plyind < 0 ? 0 : plyind;\r\n\t} // if\r\n\t\r\n\t\r\n\t// Also keep the chess module up to date - it's needed for variations.\r\n\tobj.chess.reset();\r\n\tobj.chess.load(obj.plies_fen[obj.plyind]);\r\n\t\r\n\t\r\n\t// Find and play the next ply.\r\n\tobj.board.set({\r\n\t\tfen: obj.plies_fen[obj.plyind],\r\n\t\tmovable: {\r\n\t\t\tshowDests: true,\r\n\t\t\tdests: obj.calculateAvailableMoves()\r\n\t\t}\r\n\t});\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tobj.ui.t_play = obj.plyind;\r\n\t\r\n\t\r\n\t// Keep enforcing the available moves.\r\n\tobj.enforceAvailableMoves();\r\n  } // ply\r\n  \r\n  \r\n  \r\n  \r\n  get isOnScreen(){\r\n\t// Check whether the viewframe is still on hte canvas screen. If it's display has been set to \"none\" then just return a false. \"display: none\" will be required when introducing the grouping interfaces.\r\n\tlet obj = this;\r\n\t\r\n\tlet isOnScreen = false;\r\n\tif(obj.node.style.display != \"none\"){\r\n\t\tlet rect = obj.node.getBoundingClientRect();\r\n    \r\n\t\tlet isOffScreen = \r\n\t\t  (rect.bottom < 0 || rect.top > window.innerHeight) || \r\n\t\t  (rect.right < 0 || rect.left > window.innerWidth)\r\n\t\t  \r\n\t\tisOnScreen = !isOffScreen;\r\n\t} // if\r\n\t\r\n\treturn isOnScreen;\r\n  } // isOnScreen\r\n  \r\n  \r\n  \r\n  \r\n  drawGeometryAnnotations(shapesconfigs){\r\n\t// shapesconfigs is an array of annotation squares\r\n\tlet obj = this;\r\n\t\r\n\tlet shapes = shapesconfigs.map(an=>{\r\n\t\treturn {\r\n\t\t\tbrush: \"green\",\r\n\t\t\torig: an.orig,\r\n\t\t\tdest: an.dest\r\n\t\t}\r\n\t}) // map\r\n\r\n\t\t\r\n\tobj.board.set({\r\n\t\tdrawable: {\r\n\t\t\tshapes: shapes\r\n\t\t}\r\n\t})\r\n  } // drawGeometryAnnotations\r\n  \r\n  \r\n  \r\n  calculateAvailableMoves(){\r\n\tlet obj = this;\r\n\t\r\n\t// obj.chess.turn -> get the current player w/b\r\n\tlet currentplayer = obj.chess.turn();\r\n\t\r\n\t\r\n\t// obj.board.state.pieces is a Map, and does not have a reduce, or filter.\r\n\t\r\n\tlet playermoves = [];\r\n\t\r\n\t\r\n\tobj.board.state.pieces.forEach((piece,square)=>{\r\n\t\tif(piece.color[0] == currentplayer){\r\n\t\t\tlet moves = obj.chess.moves({square: square, verbose: true});\r\n\t\t\tplayermoves.push([square, moves.map(m=>m.to)])\r\n\t\t} // if\r\n\t})\r\n\t\r\n\t\r\n\treturn new Map(playermoves)\r\n  } // calculateAvailableMoves\r\n  \r\n  \r\n  enforceAvailableMoves(){\r\n\tlet obj = this;\r\n\t\r\n\tlet availableMoves = obj.calculateAvailableMoves();\r\n\tobj.board.set({\r\n\t\tmovable: {\r\n\t\t\tfree: false,\r\n\t\t\tshowDests: true,\r\n\t\t\tdests: availableMoves\r\n\t\t}\r\n\t})\r\n  } // enforceAvailableMoves\r\n  \r\n  \r\n} // ChessGameRenderer","import {html2element} from \"../../helpers.js\";\r\n\r\nlet css = {\r\n  button: `\r\n    border: none;\r\n\tcursor: pointer;\r\n\tborder-radius: 4px;\r\n  `,\r\n  \r\n  timebutton: `\r\n    background-color: gainsboro;\r\n  `,\r\n  \r\n  submitbutton: `\r\n    background-color: black;\r\n\tcolor: white;\r\n  `\r\n}; // css\r\n\r\n\r\nlet template = `\r\n<div style=\"width: 300px\">\r\n  <input class=\"tagname\" type=\"text\" placeholder=\"#tag-name\" style=\"width: 65px;\"></input>\r\n  \r\n  <input class=\"tagvalue\" type=\"text\" placeholder=\"value\" style=\"width: 35px;\"></input>\r\n  \r\n  <div class=\"buttons\" style=\"display: inline-block; float: right;\">\r\n      <button class=\"starttime\" style=\"${ css.button } ${css.timebutton}\">start</button>\r\n      <i>-</i>\r\n      <button class=\"endtime\" style=\"${ css.button } ${css.timebutton}\">end</button>\r\n    \r\n      <button class=\"submit\" style=\"${ css.button } ${css.submitbutton}\">Submit</button>\r\n  </div>\r\n  \r\n  \r\n</div>\r\n`; // template\r\n\r\n\r\n// This is more than the chapterform, it is the entirety of the forms.\r\nexport default class TagForm{\r\n  \r\n  constructor(){\r\n    let obj = this;\r\n\tobj.node = html2element(template);\r\n\t\r\n\tobj.nameinput = obj.node.querySelector(\"input.tagname\");\r\n\tobj.valueinput = obj.node.querySelector(\"input.tagvalue\");\r\n\tobj.buttons = obj.node.querySelector(\"div.buttons\");\r\n\t\r\n\t// This value will be overwritten during interactions, and is where the tag manager collects the time for the timestamps.\r\n\tobj.clear();\r\n\t// The button should cycle through black, green, and red. It will need some way of tracking its current state, and a way to load in existing tags! This will allow users to subsequently change the tag if needed? Maybe this is a bit much for now. It will need a submit button.\r\n\t// If the tag is loaded and the button switches to timestamping then any user can add the ned timesteps. Then the users name needs to be checked in addition. Maybe some way of filtering out the tags that are added? How would that work?\r\n\t// For now add 3 buttons. A starttime endtime and submit button. For the submit button only the start and name need to be filled in. The buttons must also show the selected times!\r\n\t\r\n\t\r\n\tobj.nameinput.onmousedown = function(e){\r\n\t\te.stopPropagation()\r\n\t} // onmousedown\r\n\t\r\n\t\r\n\t// Update the form when the text is typed in to activate the submit button.\r\n\tobj.nameinput.oninput = function(){\r\n\t\tobj.update()\r\n\t} // oninput\r\n\t\r\n\t// Maybe it's simpler if the time is assigned from the outside?\r\n\tobj.node.querySelector(\"button.starttime\").onmousedown = function(e){\r\n\t\te.stopPropagation();\r\n\t\tobj.starttime = obj.t();\r\n\t\tobj.update();\r\n\t} // onmousedown\r\n\t\r\n\tobj.node.querySelector(\"button.endtime\").onmousedown = function(e){\r\n\t\te.stopPropagation();\r\n\t\tobj.endtime = obj.t();\r\n\t\tobj.update();\r\n\t} // onmousedown\r\n\t\r\n\tobj.submitButton = obj.node.querySelector(\"button.submit\");\r\n\tobj.submitButton.onmousedown = function(e){\r\n\t\te.stopPropagation();\r\n\t\tlet tag = obj.tag;\r\n\t\tif(tag){\r\n\t\t\tobj.submit(tag);\r\n\t\t\tobj.clear()\r\n\t\t} // if\r\n\t} // onmousedown\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  // Dummy method to facilitate outside supply of the timesteps.\r\n  t(){ return undefined }\r\n  \r\n  update(){\r\n\tlet obj = this;\r\n\t\r\n\t// Ensure that the times are always consistent (end > start);\r\n\tif(obj.endtime && obj.starttime){\r\n\t\tlet t0 = Math.min(obj.starttime, obj.endtime);\r\n\t\tlet t1 = Math.max(obj.starttime, obj.endtime);\r\n\t\tobj.starttime = t0;\r\n\t\tobj.endtime = t1;\r\n\t} // if\r\n\t\r\n\t// Update the time tags also.\r\n\tlet it0 = obj.node.querySelector(\"button.starttime\");\r\n\tlet it1 = obj.node.querySelector(\"button.endtime\");\r\n\t\r\n\tit0.innerText = (obj.starttime != undefined) ? obj.starttime.toFixed(3) : \"start\";\r\n\tit1.innerText = (obj.endtime != undefined) ? obj.endtime.toFixed(3) : \"end\";\r\n\t\r\n\t\r\n\t// The button is black by default, and making it look disabled is a bit more involved.\r\n\tlet button = obj.node.querySelector(\"button.submit\");\r\n\tif(obj.tag){\r\n\t\t// Enable.\r\n\t\tbutton.style.opacity = 1;\r\n\t\tbutton.style.backgroundColor = \"black\";\r\n\t\tbutton.style.color = \"white\";\r\n\t} else {\r\n\t\tbutton.style.opacity = 0.6;\r\n\t\tbutton.style.backgroundColor = \"gainsboro\";\r\n\t\tbutton.style.color = \"black\";\r\n\t} // if\r\n  } // update\r\n  \r\n  clear(){\r\n\tlet obj = this;\r\n\tobj.starttime = undefined;\r\n\tobj.endtime = undefined;\r\n\tobj.nameinput.value = \"\";\r\n\tobj.valueinput.value = \"\";\r\n\tobj.update();\r\n  } // clear\r\n  \r\n  get tag(){\r\n\t// Chapter tag should belong to the task id so that the observations across multiple slices are available together to the user.\r\n\tlet obj = this;\r\n\t\t\r\n\t\r\n\t\r\n\tlet tag = { \r\n\t\tname: obj.nameinput.value,\r\n\t\tvalue: obj.valueinput.value\r\n\t} // tag\r\n\t\r\n\t\r\n\t// How should the timestamps be handled? CANNOT always store two values, as the chapterform is ot aware of the extent of the timestep. So do I place undefined in one of the slots? And How would that be interpreted by JSON?\r\n\t\r\n\tlet timestamps = [obj.starttime, obj.endtime];\r\n\t\r\n\t/* Expected behavior:\r\n\t\t[undefined, undefined] -> tag\r\n\t    [  value  , undefined] -> chapter\r\n\t\t[undefined,   value  ] -> chapter\r\n\t\t[  value  ,   value  ] -> chapter\r\n\t*/\r\n\tif(timestamps.some(t=>!isNaN(t))){\r\n\t\t// In this case at least one of the values is defined, and should be included.\r\n\t\ttag.timestamps = JSON.stringify( timestamps );\r\n\t}; // if\r\n\t\r\n\t// This only collects the name and the optional timestamps. The author is supplied outside, in the knowledge manager, to avoid sending the author into this object.\r\n\t// The time should be defined, but it can also be 0, or less than 0!\r\n\t// obj.user && obj.input.value && ( obj.starttime != undefined ) ? tag : false; \r\n\treturn obj.nameinput.value ? tag : false; \r\n  } // tag\r\n\r\n  // Is this necessary?? Or should we just use an outside method?\r\n  // Placeholder for communication between classes.\r\n  submit(tag){} // submit\r\n} // TagForm","import { html2element } from \"../../helpers.js\";\r\n\r\nexport default class TagButton{\r\n  constructor(tag){\r\n    let obj = this;\r\n\tobj.tag = tag;\r\n\tobj.node = html2element(`<button class=\"btn-small\">#${tag.name}</button>`);\r\n    obj.on = true;\t\r\n\t\r\n\t// On mouseover the tags should be highlighted. To highlight geometrical tags the corresponding SVG must be made visible.\r\n\t  \r\n\t\r\n\t// Onclick the buttons should filter the comments, and toggle the annotations.\r\n\tobj.node.onmousedown = function(e){\r\n\t  e.stopPropagation();\r\n\t  obj.toggle(!obj.on);\r\n\t} // onclick\r\n\t\r\n\t\r\n\t// Turn button off as default.\r\n\tobj.toggle(false);\r\n  } // constructor\r\n  \r\n  toggle(on){\r\n\t// if on == true then turn the button on, otherwise turn it off.\r\n\tlet obj = this;\r\n    obj.node.style.background = on ? \"black\" : \"gainsboro\";\r\n\tobj.node.style.color = on ? \"white\" : \"black\";\r\n\tobj.on = on;\r\n  } // toggle\r\n  \r\n} // TagButton","import { html2element } from \"../../helpers.js\";\r\nimport TagButton from \"./TagButton.js\";\r\n\r\nlet template = `<div style=\"width: 300px; margin-top: 5px;\"></div>`;\r\n\r\nexport default class TagOverview{\r\n  \r\n  tags = [];\r\n  buttons = [];\r\n  \r\n  constructor(){\r\n    let obj = this;\r\n\tobj.node = html2element(template);\r\n\t// The tag visualisation should happen here also.\r\n  } // constructor\r\n  \r\n  add(newtags){\r\n\tlet obj = this;\r\n\tnewtags.forEach(t=>obj.tags.push(t));\r\n\t\r\n\t\r\n\tlet newbuttons = newtags.map(tag=>{return new TagButton(tag)}) // map\r\n\tnewbuttons.forEach(b=>{\r\n\t  obj.buttons.push(b);\r\n\t  obj.node.appendChild(b.node);\r\n\t  \r\n\t  b.node.onmouseover = function(){\r\n\t\tobj.preview(b.tag);\r\n\t  } // onmouseover\r\n\t  b.node.onmouseout = function(){\r\n\t\tobj.previewend();\r\n\t  } // onmouseover\r\n\t  \r\n\t}) // forEach\r\n\t\r\n\t\r\n\tobj.communicatetags(obj.tags);\r\n  } // add\r\n  \r\n  namevalid(name){\r\n\t// If any existing tag has this name the name is not valid.\r\n\tlet obj = this;\r\n\treturn !obj.tags.some(tag=>tag.name == name)\r\n  } // namevalid\r\n  \r\n  \r\n  purge(){\r\n\tlet obj = this;\r\n\tobj.tags = [];\r\n\tobj.buttons.forEach(b=>b.node.remove());\r\n\tobj.buttons = [];\r\n  } // purge\r\n  \r\n  \r\n  \r\n  // Dummy code. \r\n  preview(tag){\r\n\t// If the tag has geometry then the SVG should be turned on. This can only be done with access to the geometry annotation class.\r\n  } // preview\r\n  \r\n  previewend(){\r\n\t// Stop the previewing by switching the SVG off - if it's not toggled on.\r\n  } // previewend\r\n  \r\n  // The available tags need to be communicated to comments to highlight them in hte text.\r\n  communicatetags(tagnames){} //communicatetags\r\n  \r\n} // TagOverview","import { html2element } from \"../../helpers.js\";\r\n\r\n/*\r\nMaybe this one should be remade into a manager so it can keep add comments to itself. Otherwise they have to be routed outside.\r\n*/\r\nlet css = {\r\n  textarea: `\r\n    width: 100%;\r\n    border: none;\r\n    resize: none;\r\n    overflow: hidden;\r\n    max-height: 100px;\r\n  `,\r\n\r\n  submitbutton: `\r\n    color: white;\r\n\tbackground-color: black;\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\r\n  `\r\n}; // css\r\n\r\n\r\n\r\nlet template = `\r\n<div>\r\n  <textarea class=\"comment\" type=\"text\" rows=\"1\" placeholder=\"What do you think?\" style=\"${css.textarea}\"></textarea>\r\n  <button class=\"submit\" style=\"${css.submitbutton}\"><b>Submit</b></button>\r\n</div>\r\n`; // template\r\n\r\n\r\nexport default class AddCommentForm{\r\n  _user = \"\"\r\n\r\n  constructor(){\r\n    let obj = this;\r\n\t\r\n\tobj.node = html2element(template);\r\n\t\r\n\t// Author input got omitted because the author also needs to be known when voting on a comment, and I didn't want to implement an input there. That's why now there will be an overall login box that will control everything.\r\n\tobj.commentinput = obj.node.querySelector(\"textarea.comment\");\r\n\tobj.submitbutton = obj.node.querySelector(\"button.submit\");\r\n\t\r\n\t\r\n\tobj.commentinput.style.display = \"block\";\r\n\tobj.submitbutton.style.display = \"none\";\r\n\t\r\n\t\r\n\tobj.commentinput.oninput = function(){\r\n\t  obj.update();\r\n\t} // oninput\r\n\t\r\n\t// Make both replies and general comments to use a single form.\r\n    obj.submitbutton.onmousedown = function(e){\r\n\t\te.stopPropagation();\r\n\t\tobj.submit(obj.config);\r\n\t    obj.clear();\r\n    } // onmousedown\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  update(){\r\n\tlet obj = this;\r\n\t\r\n\t// Change the height\r\n\tobj.commentinput.style.height = \"1px\";\r\n    obj.commentinput.style.height = (obj.commentinput.scrollHeight)+\"px\";\r\n\t\r\n\t// Show or hide button.\r\n\tobj.submitbutton.style.display = obj.config ? \"block\" : \"none\";\r\n  } // update\r\n  \r\n  \r\n  clear(){\r\n\tlet obj = this;  \r\n\tobj.commentinput.value = \"\";\r\n    obj.update()\r\n  } // clear\r\n  \r\n\r\n  \r\n  get config(){\r\n\tlet obj = this;\r\n\treturn obj.commentinput.value ? {comment: obj.commentinput.value} : false;\r\n  } // config\r\n  \r\n  \r\n  // Dummy method that takes in hte config.\r\n  submit(comment){}\r\n  \r\n  \r\n} // AddCommentForm","import { html2element } from \"../../helpers.js\";\r\n\r\nlet css = {\r\n\t\r\n  button: `\r\n    border: none;\r\n\tbackground-color: white;\r\n\tcursor: pointer;\r\n  `,\r\n\t\r\n  replybutton: `\r\n    color: gray;\r\n\tpadding: 0 0 0 0;\r\n  `,\r\n  \r\n  votenumberi: `\r\n    margin-left: 4px;\r\n  `,\r\n  \r\n  timestampspan: `\r\n    color: gray;\r\n\tfont-size: 14px;\r\n\tmargin-left: 12px;\r\n  `\r\n}; // css\r\n\r\nlet template = `\r\n<div class=\"comment\">\r\n  <div class=\"header\">\r\n    <b class=\"author\"></b>\r\n\t<span class=\"timestamp\" style=\"${ css.timestampspan }\"></span>\r\n  </div>\r\n  <div class=\"body\"></div>\r\n  <div class=\"footer\">\r\n    <button class=\"upvote\" style=\"${ css.button }\">\r\n\t  <i class=\"fa fa-thumbs-up\"></i>\r\n\t  <i class=\"vote-number\"></i>\r\n\t</button>\r\n\t<button class=\"downvote\" style=\"${ css.button }\">\r\n\t  <i class=\"fa fa-thumbs-down\"></i>\r\n\t  <i class=\"vote-number\" style=\"${ css.votenumberi }\"></i>\r\n\t</button>\r\n\t<button class=\"reply\" style=\"${css.button} ${ css.replybutton }\"><b>REPLY</b></button>\r\n  </div>\r\n</div>\r\n`; // template\r\n\r\n\r\n\r\nexport default class Comment{\r\n  \r\n  user = \"Default\"\r\n  \r\n  // available tags.\r\n  availabletags = []\r\n\t\r\n  constructor(config){\r\n\tlet obj = this;\r\n\t\r\n\t// Make a new node.\r\n\tobj.node = html2element(template);\r\n\t\r\n\t// Fill the template with the options from the config. There must be a comment, and there must be an author.\r\n\tobj.config = config;\r\n\t\r\n\t\r\n\t\r\n\t// Fill some options that may not be defined in config.\r\n\tobj.config.datetime  = config.datetime ? config.datetime : new Date().toISOString();\r\n\tobj.config.upvotes   = config.upvotes ? config.upvotes : [];\r\n\tobj.config.downvotes = config.downvotes ? config.downvotes : [];\r\n\t\r\n\t\r\n\t// Modify the node to reflect the config.\r\n\tlet header = obj.node.querySelector(\"div.header\");\r\n\theader.querySelector(\"b.author\").innerText = config.author;\r\n\t\r\n\t\r\n\t\r\n\tobj.update();\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Add the upvoting and downvoting. Where will the author name come from?? The upvote/downvote buttons should also be colored depending on whether the current user has upvoted or downvoted the comment already. Maybe the top app should just push the current user to the elements, and then they can figure out how to handle everything. That means that the functionality can be implemented here.\r\n\t\r\n\tlet footer = obj.node.querySelector(\"div.footer\")\r\n\tfooter.querySelector(\"button.upvote\").onmousedown = function(){\r\n\t\tobj.submitvote({id: obj.config.id, type: \"upvote\"})\r\n\t} // onclick\r\n\t\r\n\tfooter.querySelector(\"button.downvote\").onmousedown = function(){\r\n\t\tobj.submitvote({id: obj.config.id, type: \"downvote\"})\r\n\t} // onclick\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  update(){\r\n\t// Only the time is allowed to be updated (if it will be calculated back), and the up and down votes.\r\n\tlet obj = this;\r\n\t\r\n\tobj.updateTimestamp();\r\n\t\r\n\tobj.updateVoteCounter(\"upvote\");\r\n\tobj.updateVoteCounter(\"downvote\");\r\n\t\r\n\tobj.updateContent();\r\n  } // update\r\n  \r\n  \r\n  updateContent(){\r\n\tlet obj = this;\r\n\tobj.node.querySelector(\"div.body\").innerHTML = obj.config.comment.replace(/#\\w+/g, function(s){return obj.availabletags.includes(s) ? `<mark>${s}</mark>` : s});\r\n\t\r\n\t// Any mark tags need to interact with the view.\r\n\tobj.node.querySelector(\"div.body\").querySelectorAll(\"mark\").forEach(m=>{\r\n\t\tm.onmouseover = function(){\r\n\t\t\tobj.preview(m.innerText)\r\n\t\t} // onmouseover\r\n\t\tm.onmouseout = function(){\r\n\t\t\tobj.previewend(m.innerText)\r\n\t\t} // onmouseover\r\n\t}) // forEach\r\n  } // updateContent\r\n  \r\n\t\r\n  updateTimestamp(){\r\n\tlet obj = this;\r\n\t\r\n\tlet timestamp = obj.node\r\n\t  .querySelector(\"div.header\")\r\n\t  .querySelector(\"span.timestamp\");\r\n\t  \r\n\ttimestamp.innerText = formatTimeStamp( obj.config.datetime );\r\n  } // updateTimestamp\r\n\r\n\r\n  updateVoteCounter(buttonClassName){\r\n\tlet obj = this;\r\n\t\r\n\tlet button = obj.node\r\n\t  .querySelector(\"div.footer\")\r\n\t  .querySelector(`button.${ buttonClassName }`)\r\n\t\r\n\t\r\n\tlet icon = button.querySelector(\"i.fa\");\r\n\tlet counter = button\r\n\t  .querySelector(\"i.vote-number\");\r\n\t\r\n\tlet n = 0;\r\n\tswitch( buttonClassName ){\r\n\t  case \"upvote\":\r\n\t\tn = obj.config.upvotes.length;\r\n\t\tcounter.innerText = n > 0 ? n : \"\";\r\n\t\ticon.style.color = obj.config.upvotes.includes(obj.user) ? \"green\" : \"black\";\r\n\t\tbreak;\r\n\t  case \"downvote\":\r\n\t\tn = obj.config.downvotes.length;\r\n\t\tcounter.innerText = n > 0 ? -n : \"\";\r\n\t\ticon.style.color = obj.config.downvotes.includes(obj.user) ? \"tomato\" : \"black\";\r\n\t\tbreak;\r\n\t} // switch\r\n\r\n  } // updateVoteCounter\r\n\t\r\n  \r\n  // Dummy functionality.\r\n  submitvote(vote){} // submitvote\r\n  preview(){} // preview\r\n  previewend(){} // previewend\r\n} // Comment\r\n\r\n\r\n  \r\n  \r\n  \r\nfunction formatTimeStamp(t){\r\n\t\r\n\t\r\n\t// Dates are saved as strings for ease of comprehension. For formatting they are first translated into miliseconds passed since 1970.\r\n\tlet now = new Date(Date.now());\r\n\tlet stamp = new Date(t);\r\n\t\r\n\tlet dayInMiliseconds = 1000*60*60*24;\r\n\t\r\n\r\n\tlet todayInMiliseconds = ( ( now.getHours()*60 + now.getMinutes() )*60 + now.getSeconds() )*1000 + now.getMilliseconds();\r\n\t\t\r\n\t// Format the time so that it shows everything from today as n minutes/hours ago, everything from yesterday as yesterday at :... and everything else as the date. \r\n\tif( stamp > now - todayInMiliseconds ){\r\n\t    // This was submitted today. Now figure out how long ago.\r\n\t\tlet seconds = Math.floor( (now - stamp)/1000 );\r\n\t\tlet minutes = Math.floor( seconds/60 );\r\n\t\tlet hours   = Math.floor( minutes/60 );\r\n\t\tlet days    = Math.floor( hours/24 );\r\n\t\t\r\n\t\tif(days > 0){\r\n\t\t\treturn `${days} days ago`;\r\n\t\t} // if\r\n\t\t\r\n\t\tif(hours > 0){\r\n\t\t\treturn `${hours} hours ago`;\r\n\t\t} // if\r\n\t\t\r\n\t\tif(minutes > 0){\r\n\t\t\treturn `${minutes} minutes ago`;\r\n\t\t} // if\r\n\t\t\r\n\t\treturn `${seconds} seconds ago`\r\n\t\t\t\t\r\n\t} else if (stamp > now - todayInMiliseconds - dayInMiliseconds){\r\n\t\t// Yesterday at HH:MM\r\n\t\treturn `Yesterday at ${stamp.toLocaleTimeString()}`;\r\n\t} else {\r\n\t\t// Just keep the first 4 parts which should be day name, month name, day number, year number\r\n\t\treturn stamp.toDateString()\r\n\t} // if\r\n\t\r\n  } // updateTimestamp\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { html2element } from \"../../helpers.js\";\r\nimport Comment from \"./Comment.js\";\r\n\r\nexport default class ReplyComment extends Comment{\r\n  constructor(config){\r\n    super(config)\r\n\tlet obj = this;\r\n\t\r\n\t// The secondary comments need to be indented.\r\n\tobj.node.style.marginLeft = \"20px\";\r\n\t\r\n\t// Replies can't be replied to. Maybe allow them too, but just put a hashtagged name in front?\r\n\tobj.node.querySelector(\"button.reply\").remove();\r\n\t\r\n  } // constructor\r\n} // ReplyComment","import { html2element } from \"../../helpers.js\";\r\nimport Comment from \"./Comment.js\";\r\nimport ReplyComment from \"./ReplyComment.js\";\r\n\r\n// If a general comment owns its replies, then keeping the replies in control is easy. What happens when someone else make a reply on a separate client though, and the data is just pushed to this client? How should the reply be added to the right parent? Maybe the reply should have an identifier that can be constructed from the comment (e.g. view id + author name + time), and that can be used to merge the comments. Then everytime a comment is pushed to the storage an update can be fired? Also, how will the changes be communicated back to the server? Let the backend handle the updates - just find the comment with the proper id, and resolve the differences, and then push any comments that had differences. Maybe it's simpler to just adjust everything when the connection closes?\r\n\r\n// Sort the comments before passing them to the comments below. How will replies be updated? Ultimately everything should be coming from the server??\r\n\r\n\r\n// This is just a template for the controls which allow the replies to be expanded or collapsed. These are invisible at first.\r\nlet template = `\r\n<div style=\"display: none;\">\r\n  <div class=\"expand-controls\" style=\"color: blue; cursor: pointer;\">\r\n    <i class=\"fa fa-caret-down\"></i>\r\n\t<i class=\"control-text\">View replies</i>\r\n  </div>\r\n  <div class=\"replies\"></div>\r\n</div>\r\n`\r\n\r\n// Maybe the general comments can be added on top, but the replies should follow in chronological order.\r\nexport default class GeneralComment extends Comment{\r\n  \r\n  replies = [];\r\n  \r\n  constructor(config){\r\n    super(config)\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\tobj.replybutton = obj.node.querySelector(\"button.reply\");\r\n\t\r\n\t// The general comment can have replies associated with it. Handle these here. Furthermore an additional control for expanding, reducing hte comments is required.\r\n\tobj.replynode = html2element(template);\r\n\tobj.node.appendChild( obj.replynode );\r\n\t\r\n\t// Add the functionality to the caret.\r\n\tobj.repliesExpanded = false;\r\n\tobj.replynode.querySelector(\"div.expand-controls\").onmousedown = function(){\r\n\t    obj.repliesExpanded = !obj.repliesExpanded;\r\n\t\tobj.update();\r\n\t} // onclick\r\n\t\r\n\t// Replies on the config need to be initialised. But actually, they should be stored as separate entries for ease of updating...\r\n\t\r\n\tobj.update();\r\n  } // constructor\r\n  \r\n  addreply(replyconfig){\r\n\t// No pushing of updated versions.\r\n\tlet obj = this;\r\n\t\r\n\t// Make a comment node, and append it to this comment.\r\n\tlet r = new ReplyComment(replyconfig);\r\n\tr.preview = obj.preview;\r\n\tr.previewend = obj.previewend;\r\n\tr.availabletags = obj.availabletags;\r\n\tr.update();\r\n\t\r\n\t// Add this one at the end.\r\n\tobj.replynode.querySelector(\"div.replies\").appendChild(r.node);\r\n\tobj.replies.push(r);\r\n\t\r\n\t// Copy the submitvote function.\r\n\tr.submitvote = obj.submitvote;\r\n\t\r\n\r\n\t// Update the view.\r\n\tobj.update();\r\n  } // addreply\r\n  \r\n  replaceReply(existing, replacement){\r\n\t// For simplicity handle the replacing of hte comment here.\r\n\tlet obj = this;\r\n\t\r\n\t// Update the internal comments store.\r\n\tobj.replies.splice(obj.replies.indexOf(existing), 1, replacement);\r\n\t\r\n\t// Update teh DOM.\r\n\tlet container = obj.node.querySelector(\"div.replies\");\r\n\tcontainer.insertBefore(replacement.node, existing.node);\r\n  } // replaceReply\r\n  \r\n  \r\n  update(){\r\n\t// Only the time is allowed to be updated (if it will be calculated back), and the up and down votes.\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\t// From superclass\r\n\tobj.updateTimestamp();\r\n\tobj.updateVoteCounter(\"upvote\");\r\n\tobj.updateVoteCounter(\"downvote\");\r\n\tobj.updateContent();\r\n\t\r\n\t// GeneralComment specific.\r\n\tobj.updateReplies();\r\n  } // update\r\n  \r\n  // Update function in addition to the superclass ones.\r\n  updateReplies(){\r\n\tlet obj = this;\r\n\t\r\n\t// First update is called when the superclass constructor is called.\r\n\tif(obj.replies){\r\n\t  let n = obj.replies.length;\r\n\t  obj.replynode.style.display = n > 0 ? \"\" : \"none\";\r\n\t\r\n\t  // View replies or hide replies\r\n\t  let s = n == 1 ? \"y\" : `ies (${n})`\r\n\t  obj.replynode\r\n\t    .querySelector(\"div.expand-controls\")\r\n\t    .querySelector(\"i.control-text\")\r\n\t    .innerText = obj.repliesExpanded ? `Hide repl${s}` : `View repl${s}`;\r\n\t\t\r\n\t  obj.replynode\r\n\t    .querySelector(\"div.expand-controls\")\r\n\t    .querySelector(\"i.fa\")\r\n\t    .classList.value = obj.repliesExpanded ? \"fa fa-caret-up\" : \"fa fa-caret-down\";\r\n\t\r\n\t  obj.replynode.querySelector(\"div.replies\").style.display = obj.repliesExpanded ? \"\" : \"none\";\r\n\t} // if\r\n  } // updateReplies\r\n  \r\n} // GeneralComment\r\n\r\nfunction findArrayItemById(A, id){\r\n  let candidates = A.filter(a=>{\r\n\treturn a.id == id;\r\n  }) // filter\r\n  \r\n  return candidates.length > 0 ? candidates[0] : false;\r\n} // findArrayItemById","import { html2element } from \"../../helpers.js\";\r\nimport AddCommentForm from \"./AddCommentForm.js\";\r\nimport GeneralComment from \"./GeneralComment.js\"; \r\n\r\n\r\n// Needs a way to minimise the commenting completely.\r\nlet template = `\r\n<div class=\"commenting\" style=\"width:300px; margin-top: 10px;\">\r\n  <div class=\"hideShowText\" style=\"cursor: pointer; margin-bottom: 5px; color: gray;\">\r\n    <b class=\"text\">Show comments</b>\r\n\t<b class=\"counter\"></b>\r\n\t<i class=\"fa fa-caret-down\"></i>\r\n  </div>\r\n  <div class=\"commentingWrapper\" style=\"display: none;\">\r\n    <div class=\"comment-form\"></div>\r\n    <hr>\r\n    <div class=\"comment-tags\"></div>\r\n    <div class=\"comments\" style=\"overflow-y: auto; max-height: 200px;\"></div>\r\n  </div>\r\n</div>\r\n`; // template\r\n\r\n\r\nexport default class CommentingManager{\r\n\t\r\n  comments = [];\r\n  generalcommentobjs = [];\r\n  availabletags = [];\r\n\t\r\n  constructor(){\r\n    let obj = this;\r\n\tobj.node = html2element( template );\r\n\t\r\n\t\r\n\t// Make the form;\r\n    obj.form = new AddCommentForm();\r\n    obj.node.querySelector(\"div.comment-form\").appendChild(obj.form.node);\r\n  \r\n  \r\n\t\r\n\t// Finally add teh controls that completely hide comments.\r\n\tlet hsdiv = obj.node.querySelector(\"div.hideShowText\");\r\n\tlet cdiv = obj.node.querySelector(\"div.commentingWrapper\");\r\n\thsdiv.onmousedown = function(e){\r\n\t  e.stopPropagation();\r\n\t  let hidden = cdiv.style.display == \"none\";\r\n\t  cdiv.style.display = hidden ? \"\" : \"none\";\r\n\t  \r\n\t  // It changed from hidden to show, but hidden is past state.\r\n\t  hsdiv.querySelector(\"b.text\").innerText = hidden ? \"Hide comments\" : \"Show comments\";\r\n\t  hsdiv.querySelector(\"i\").classList.value = hidden ? \"fa fa-caret-up\" : \"fa fa-caret-down\";\r\n\t} // onmousedown\r\n\t\r\n  } // constructor\r\n  \r\n\r\n  \r\n  updateCommentCounter(){\r\n\tlet obj = this;\r\n\t\r\n\t/*\r\n\tlet n = obj.comments.reduce((acc,c)=>{\r\n\t\tacc += 1\r\n\t\tacc += c.replies.length;\r\n\t\treturn acc\r\n\t},0)\r\n\t*/\r\n\tlet n = obj.comments.length;\r\n\tlet counterNode = obj.node\r\n\t  .querySelector(\"div.hideShowText\")\r\n\t  .querySelector(\"b.counter\");\r\n\tcounterNode.innerText = n ? `(${n})` : \"\";\r\n\t\r\n  } // updateCommentCounter\r\n  \r\n  \r\n  purge(){\r\n\tlet obj = this;\r\n\tobj.comments = [];\r\n\tobj.generalcommentobjs = [];\r\n\tlet commentsToRemove = obj.node.querySelector(\"div.comments\").children;\r\n\tfor(let i=0; i<commentsToRemove.length; i++){\r\n\t\tcommentsToRemove[i].remove();\r\n\t} // for\r\n  } // purge\r\n  \r\n  \r\n\r\n  \r\n  add(comments){\r\n\t// The comments come solely from the server. They are not updated, and can just be created once.\r\n\tlet obj = this;\r\n\t  \r\n\t// Store all of them as a record.\r\n\tobj.comments = obj.comments.concat(comments);\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Replies are owned by the general comment. So maybe split them first into general comments, and replies, and add the general comments first, and then add the replies to the general comments.\r\n\tlet replies = comments.filter(c=>c.ownerid);\r\n\tlet general = comments.filter(c=>!c.ownerid);\r\n\t\r\n\t// Just add the new ones in.\r\n\tgeneral.forEach(comment=>{\r\n\t\tlet c = new GeneralComment(comment);\r\n\t\tc.preview = obj.preview;\r\n\t\tc.previewend = obj.previewend;\r\n\t\tc.availabletags = obj.availabletags;\r\n\t\tc.update();\r\n\t\t\r\n\t\t// Insert the new comment at teh very top.\r\n\t\tlet container = obj.node.querySelector(\"div.comments\");\r\n\t\tcontainer.insertBefore(c.node, container.firstChild);\r\n\t\tobj.generalcommentobjs.push(c);\r\n\t\t\r\n\t\t\r\n\t\t// The general comment has a REPLY button - it needs to use the AddCommentForm submit function. That method is assigned from outside. The function here is different in that it assigns a parent id.\r\n\t\tc.replybutton.onmousedown = function(e){\r\n\t\t\te.stopPropagation();\r\n\t\t\tlet c = obj.form.config;\r\n\t\t\tc.ownerid = comment.id;\r\n\t\t\tobj.form.submit(c);\r\n\t\t\tobj.form.clear();\r\n\t\t} // onmousedown\r\n\t\t\r\n\t\tc.submitvote = obj.submitvote;\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t// Replies need to be SORTED BY DATETIME!!\r\n\treplies.forEach(reply=>{\r\n\t\t// Find the owner.\r\n\t\tlet ownercomment = obj.generalcommentobjs.find(gc=>gc.config.id==reply.ownerid);\r\n\t\t\r\n\t\t// This if is not strictly necessary, but just to play it safe.\r\n\t\tif(ownercomment){\r\n\t\t\townercomment.addreply(reply);\r\n\t\t} // if\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t// Update the comment section header:\r\n\tobj.updateCommentCounter();\r\n\t\r\n  } // add\r\n  \r\n  \r\n  \r\n  set user(name){\r\n\tlet obj = this;\r\n\t\r\n\t// The comment appearance and functionality changes depends on who is checking them.\r\n\tobj.generalcommentobjs.forEach(gc=>{\r\n\t  gc.user = name;\r\n\t  gc.update();\r\n\t  \r\n\t  gc.replies.forEach(rc=>{\r\n\t\t  rc.user = name;\r\n\t\t  rc.update();\r\n\t  })\r\n\t}) // forEach\r\n  } // set user\r\n  \r\n  \r\n  \r\n  updateAvailableTags(tagnames){\r\n\t  let obj = this;\r\n\t  obj.availabletags = tagnames;\r\n\t  obj.generalcommentobjs.forEach(gc=>{\r\n\t\t  gc.availabletags = tagnames;\r\n\t\t  gc.update();\r\n\t\t  \r\n\t\t  gc.replies.forEach(rc=>{\r\n\t\t\trc.availabletags = tagnames;\r\n\t\t    rc.update();\r\n\t\t  })\r\n\t  })\r\n  }\r\n  \r\n  \r\n  \r\n  // Dummy function\r\n  submitvote(){} // submitvote\r\n  preview(){} // preview\r\n  previewend(){} // previewend\r\n  \r\n} // CommentingManager\r\n\r\n\r\nfunction findArrayItemById(A, id){\r\n  let candidates = A.filter(a=>{\r\n\treturn a.id == id;\r\n  }) // filter\r\n  \r\n  return candidates.length > 0 ? candidates[0] : false;\r\n} // findArrayItemById\r\n\r\nfunction arrayIncludesAll(A,B){\r\n  // 'arrayIncludesAll' checks if array A includes all elements of array B. The elements of the arrays are expected to be strings.\r\n\t\r\n  // Return element of B if it is not contained in A. If the response array has length 0 then A includes all elements of B, and 'true' is returned.\r\n  var f = B.filter(function(b){\r\n\treturn !A.includes(b)\r\n  })\r\n\t\r\n  return f.length == 0? true : false\r\n} // arrayIncludesAll\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { html2element } from \"../helpers.js\";\r\n\r\nimport TagForm from \"./tagging/TagForm.js\";\r\nimport TagOverview from \"./tagging/TagOverview.js\";\r\nimport CommentingManager from \"./commenting/CommentingManager.js\";\r\n\r\n/* COMMENTING SYSTEM\r\n\r\nA class that handles all of the commenting system. Should be minimisable!!\r\n\r\n*/\r\n\r\nlet template = `\r\n<div></div>\r\n`; // template\r\n\r\n\r\n// Add top caret that hides the whole thing!! And the chapterform should maybe include a draw button.\r\n\r\nexport default class AnnotationSystem{\r\n  constructor(taskid){\r\n\tlet obj = this;\r\n\t\r\n\tobj.node = html2element(template);\r\n\t\r\n\t\r\n\t\r\n\t// How will the chapter form know which time is currently selected? Should there be a dummy version that is assigned from the outside? So that the accessing can be done only when needed?\r\n\tobj.tagform = new TagForm();\r\n\tobj.node.appendChild( obj.tagform.node )\r\n\t\r\n\t\r\n\tobj.tagoverview = new TagOverview();\r\n\tobj.node.appendChild( obj.tagoverview.node );\r\n\t\r\n\t\r\n\t// Add in the commenting system. The metadata filename is used as the id of this 'video', and thus this player. The node needs to be added also.\r\n\tobj.commenting = new CommentingManager( taskid );\r\n\tobj.node.appendChild( obj.commenting.node );\r\n\t\r\n\t\r\n\t// Tags will always be submitted straight to the server, which will then send them back. It's going to be tricky to deal with the upvotes/downvotes.\r\n\t// This is just a local assignment. The actual submit function is attached in the knowledge manager.\r\n\tobj.tagform.submit = function(tag){\r\n\t\t// The KnowledgeManager must push the chapter annotations to:\r\n\t\t// the navigation tree as a group seed, the playbar as a chapter, and the commenting system as a conversation topic.\r\n\t\tconsole.log(\"Send to server\", tag)\r\n\t} // submit\r\n\t\r\n  } // constuctor\r\n  \r\n  \r\n  purge(){\r\n\tlet obj = this;\r\n\tobj.tagoverview.purge();\r\n\tobj.commenting.purge();\r\n  } // purge\r\n} // AnnotationSystem","/* Superclass framework \r\n\r\nATTRIBUTES:\r\nnode\r\nviewnode\r\npreviewnode\r\n\r\nMETHODS: \r\nset/get position\r\nshow\r\nhide\r\nchecksize\r\n\r\nDUMMY METHODS:\r\nonmove\r\nonend\r\n*/ \r\nimport Item from \"./Item.js\";\r\n\r\n\r\n\r\n// Rendering modules\r\nimport ChessGameRenderer from \"../renderers/ChessGameRenderer.js\";\r\nimport AnnotationSystem from \"../knowledge/AnnotationSystem.js\";\r\n\r\n\r\n\r\n// How will the individual draw? The group will have to follow the same idea. Or? maybe the drawing would just access a specific module, like geometry or smth, and that isn't implemented yet. And then the same thing can be added to the group?\r\nexport default class ChessGame extends Item {\r\n  constructor(task){\r\n    super();\r\n    let obj = this;\r\n\t\r\n\t// The task is important!\r\n\tobj.task = task;\r\n\tobj.node.querySelector(\"p.label\").innerHTML = task.taskId;\r\n\t\r\n\t\r\n\t\r\n\t// Configure the chess board renderer.\r\n\tobj.renderer = new ChessGameRenderer(task.Game);\r\n\tobj.viewnode.appendChild(obj.renderer.node);\r\n\t\r\n\t// Add in a Commenting system also.\r\n\tobj.annotations = new AnnotationSystem(task.taskId);\r\n\tobj.node.querySelector(\"div.commenting\").appendChild(obj.annotations.node);\r\n\t\r\n\t\r\n\t\r\n\t// CROSS MODULE FUNCTIONALITY\r\n\t\r\n\t\r\n\t// Maybe the tagform should be split off from the commenting? And just be its own independent module? But it'll need to be wrapped up somehown if I want to be able to hide it all at once.\r\n\t// The tagform needs to have access to the playbar current time.\r\n\tlet c = obj.annotations.tagform;\r\n\tc.t = function(){\r\n\t\treturn obj.renderer.ui.t_play;\r\n\t} // tagform t.\r\n\t\r\n\t\r\n\t\r\n\tlet ga = obj.renderer.geometryannotation;\r\n\tlet to = obj.annotations.tagoverview;\r\n\tlet cm = obj.annotations.commenting;\r\n\t\r\n\t\r\n\t// Attach a toggle on the geometry button to either show, or hide the geometry annotation SVG.\r\n\t// Onclick is captured and stopped somewhere else, so mousedown is looked for.\r\n\t// c.buttons.insertBefore(ga.togglebutton, c.buttons.firstChild);\r\n\t\r\n\t\r\n\t// Should previewing persist when the user is adding points? In that case the geometry annotation should know about all the active tags. So maybe it should just have a slot to show them? And it should be updated on the go?\r\n\t// Here implement the annotation tag previewing.\r\n\t// Should this just collectall currently active tags and push them to the polygon annotation for viewing?\r\n\tto.preview = function(tag){\r\n\t  // If the tag has geometry then the SVG should be turned on. This can only be done with access to the geometry annotation class.\r\n\t  let activeannotations = to.buttons.filter(b=>b.on);\r\n\t  \r\n\t  // Tags are stored at least as empty arrays.\r\n\t  if(tag.geometry != \"[]\"){\r\n\t\t  \r\n\t\t// Get all active geometries. A geometry has a FEN associated with it.\r\n\t\tlet taggeometry = JSON.parse(tag.geometry);\r\n\t\tlet activegeometries = activeannotations.map(b=>JSON.parse(b.tag.geometry));\r\n\t\t  \r\n\t\tlet previewconfig = {\r\n\t\t\tfen: taggeometry.fen,\r\n\t\t\tshapes: activegeometries.reduce((acc,g)=>acc.concat(g.shapes),[]).concat(taggeometry.shapes)\r\n\t\t}; // previewconfig\r\n\t\tga.show(previewconfig);\r\n\t  } // if\r\n\t  \r\n\t\t\r\n\t  if(tag.timestamps){\r\n\t\t// Just search by name.\r\n\t\tobj.renderer.ui.bar.chapters.find(c=>c.config.label==tag.name).highlight();\r\n\t  } // if\r\n\t  \r\n\t  \r\n\t} // preview\r\n\t\r\n\t\r\n\tto.previewend = function(){\r\n\t  // Check if the geometry annotation is toggled on. If it's not then turn the SVG off.\r\n\t  let activeannotations = to.buttons.filter(b=>b.on).map(b=>JSON.parse(b.tag.geometry));\r\n\t  // ga.external = activeannotations;\r\n\t\t\r\n\t  // geometryannotation.show expects to see the data in the data domain.\r\n\t  ga.show();\r\n\t  \r\n\t  \r\n\t  // Unhighlight all chapters.\r\n\t  obj.renderer.ui.bar.chapters.forEach(c=>c.unhighlight());\r\n\t  \r\n\t} // previewend\r\n\t\r\n\t\r\n\tto.communicatetags = function(tags){\r\n\t\t// Pass these to the comment manager, which should pass it to all the comments.\r\n\t\tcm.updateAvailableTags(tags.map(t=>`#${t.name}`));\r\n\t} // communicatetags\r\n\t\r\n\t\r\n\t\r\n\t// Commenting should also support previewing.\r\n\tcm.preview = function(tagname){\r\n\t\t// Where should a selection be made which tags to preview, and which not?\r\n\t\t\r\n\t\t// First find the correct tag. All the tags are in TagOverview. After finding the correct tag the TagOverview preview can be used?\r\n\t\tlet tag = to.buttons.find(b=>b.node.innerText == tagname).tag;\r\n\t\tto.preview(tag);\r\n\t}; // preview\r\n\t\r\n\t\r\n\tcm.previewend = function(tagname){\r\n\t\tto.previewend();\r\n\t}; // previewend\r\n\t\r\n  } // constructor\r\n  \r\n  checksize(){\r\n\tlet obj = this;\r\n\t// Check size to decide what to do. In cases where many items are drawn the cumulative memory required to draw the image may be too high, and it's sensible to draw a static image instead.\r\n\t\r\n\tlet rect = obj.node.getBoundingClientRect();\r\n\tif(rect.width < 200){\r\n\t\t// Signal that the drawing should no longer occur.\r\n\t\t// obj.viewnode.style.border = `5px solid ${obj.task.color}`;\r\n\t} else {\r\n\t\t// Turn it back to default values.\r\n\t\t// obj.viewnode.style.border = \"\";\r\n\t} // if\r\n  } // checksize\r\n  \r\n} // ChessGame\r\n\r\n\r\n\r\n\r\n","// Link has access to the nodes, but it will have it's own offsets. This allows the drawnode to change its values correctly.\r\nexport default class DrawLink{\r\n\t// Indices when exiting parent node, entering child node, and the index of position of the bend.\r\n\tpi = 0\r\n\tci = 0\r\n\tbendi = 0\r\n\t\r\n\t// Actual dimensions. The label width is the minimum horizontal line length. Bundle width is the space reserved for the vertical line width. Line width is the actual width of the white outline. The default radius is the basis for the actual bend radii.\r\n\tnode_label_width = 70\r\n\tbundle_width = 4\r\n\tline_width = 4\r\n\tr = 16\r\n\t\r\n\tconstructor(parentnode, childnode, author){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// So that hte locations can be changed on hte go.\r\n\t\tobj.parentnode = parentnode;\r\n\t\tobj.childnode = childnode;\r\n\t\tobj.author = author;\r\n\t\t\r\n\t\t// Exit radius is determined node level difference.\r\n\t\tobj.r1 = (childnode.level - parentnode.level)*obj.r;\r\n\t\tobj.r2 = obj.r;\r\n\t} // constructor\r\n\t\r\n\t\r\n\t\r\n\tget originCoord(){\r\n\t\tlet obj = this;\r\n\t\treturn {\r\n\t\t\tx: obj.parentnode.x,\r\n\t\t\ty: obj.parentnode.calculateOutgoingLineY(obj.pi)\r\n\t\t} // origin\r\n\t} // origincoord\r\n\t\r\n\t\r\n\tget targetCoord(){\r\n\t\tlet obj = this;\r\n\t\treturn {\r\n\t\t\tx: obj.childnode.x,\r\n\t\t\ty: obj.childnode.calculateIncomingLineY(obj.ci)\r\n\t\t} // origin\r\n\t} // origincoord\r\n\t\r\n\tget path(){\r\n\t\t// Doesn't take into account the offsets yet!!\r\n\t\t\r\n\t\t\r\n\t\t// Allow this to return a straight path, or a curved one. The straight path is exclusively for bundles that have only one parent. Furthermore, that one should only be allowed when connecting nodes on the same height. So maybe just base the decision off of that?\r\n\t\t\r\n\t\t// Straight path is just M0 0 L40 0 or so.\r\n\t\t\r\n\t\tlet obj = this;\r\n\t\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// The target x should be > `xHorizontal + r1 + r2'\r\n\t\tlet xHorizontal = obj.parentnode.x + obj.node_label_width + obj.bendi*obj.bundle_width;\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tlet origin = obj.originCoord;\r\n\t\tlet target = obj.targetCoord;\r\n\t\t\r\n\t\r\n\t\t\r\n\t\tlet p = `M${ origin.x } ${ origin.y } L${ target.x } ${ target.y }`;\r\n\t\tif( origin.y != target.y ){\t\t\r\n\t\t\t\r\n\t\t\tlet arc1start = {\r\n\t\t\t\tx: xHorizontal - obj.r1,\r\n\t\t\t\ty: origin.y\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet arc1end = {\r\n\t\t\t\tx: xHorizontal,\r\n\t\t\t\ty: origin.y + obj.r1\r\n\t\t\t}\r\n\r\n\t\t\tlet arc2start = {\r\n\t\t\t\tx: xHorizontal,\r\n\t\t\t\ty: target.y - obj.r2\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet arc2end = {\r\n\t\t\t\tx: xHorizontal + obj.r2,\r\n\t\t\t\ty: target.y\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t/*\r\n\t\t\tHow the path is made up.\r\n\t\t\tstart point                   : M0 0\r\n\t\t\thorizontal line               : L40 0\r\n\t\t\tfirst bend to vertical        : A16 16 90 0 1 46 16\r\n\t\t\tvertical line                 : L46 34\r\n\t\t\tsecond bend to horizontal     : A16 16 90 0 0 62 50\r\n\t\t\thorizontal connection to node : L62 50\r\n\t\t\t*/\r\n\t\t\tp = `M${ origin.x } ${ origin.y } L${ arc1start.x } ${ arc1start.y } A${ obj.r1 } ${ obj.r1 } 90 0 1 ${ arc1end.x } ${ arc1end.y } L${ arc2start.x } ${ arc2start.y } A${ obj.r2 } ${ obj.r2 } 90 0 0 ${ arc2end.x } ${ arc2end.y } L${ target.x } ${ target.y }`; \r\n\t\t\t\r\n\t\t} // if\r\n\t\t\r\n\t\treturn p\r\n\t} // path\r\n\t\r\n} // DrawLink","import { svg2element } from \"../../helpers.js\";\r\nimport DrawLink from \"./DrawLink.js\";\r\n\r\n// Lines are drawn in bundles. The links are drawn as two pats, one in color, and the other white. The white paths are in the background and help make the transitions over lines neater. If links were drawn individually then the bundle itself would have an overlap somewhere.\t\r\nlet template = `\r\n<g class=\"bundle\">\r\n  <path stroke=\"white\" stroke-width=\"5\" fill=\"none\"></path>\r\n  <path stroke=\"black\" stroke-width=\"2\" fill=\"none\"></path>\r\n</g>\r\n`; // tempalte\r\n\r\n\r\n// These should just be exposed at the link level... The tree level also has them, and it's non hygienic.\r\nlet node_label_width = 70\r\nlet bundle_width = 4\r\nlet line_width = 4\r\nlet r = 16\r\n\r\n// Bundles are the connections between two levels of nodes.\r\nexport default class TreeBundle{\r\n\t// Index is the ranked position of this bundle within hte level. It determines the position of hte vertical line segment, and the corner radius.\r\n\tlinks = []\r\n\t_bendi = 0;\r\n\t\r\n\tconstructor(seednode, author){\r\n\t\t// A seed node is passed in to define the bundle parents and thus instantiate a bundle. After instantialisation only the children of the bundle can change.\r\n\t\t// NOTE: seednode is a `treenode' instance, but parents and children are `taskgroup' instances. The level is only defined for the node because it can change when the user interacts with the tree.\r\n\t\tlet obj = this;\r\n\t\tobj.node = svg2element( template );\r\n\t\t\r\n\t\tobj.author = author,\r\n\t\tobj.level = seednode.level;\r\n\t\tobj.parents = seednode.connections.parents;\r\n\t    obj.children = [seednode.connections.group];\r\n\t\t\r\n\t\tobj.nodeChildren = [seednode];\r\n\t\tobj.nodeParents = [];\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\tset bendi(i){\r\n\t\t// When a bunldes bend index is set it should propagate it to all the children.\r\n\t\tlet obj = this;\r\n\t\tobj.links.forEach(link=>{\r\n\t\t\tlink.bendi = i;\r\n\t\t}) // forEach\r\n\t\tobj._bendi = i;\r\n\t} // bendi\r\n\t\r\n\tget bendi(){return this._bendi} // get bendi\r\n\t\r\n\tupdate(color){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// There's two paths, an upper color and bottom white.\r\n\t\tlet paths = obj.node.querySelectorAll(\"path\");\r\n\t\tfor(let i=0; i<paths.length; i++){\r\n\t\t\tpaths[i].setAttribute(\"d\", obj.path)\r\n\t\t} // for\r\n\t\t\r\n\t\tif(color){\r\n\t\t\tpaths[paths.length-1].setAttribute(\"stroke\", color);\r\n\t\t} // if\r\n\t\t\r\n\t\tif(!obj.author){\r\n\t\t\tpaths[paths.length-1].setAttribute(\"stroke-dasharray\", \"5,2\");\r\n\t\t} // if\r\n\t} // update\r\n\t\r\n\t\r\n\taddparent(node){\r\n\t\t// Only nodes can be pushed. And only the ones declared upon initialisation!\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tlet isNodeAllowed = obj.parents.includes(node.connections.group);\r\n\t\tlet isNodeUnknown = !obj.nodeParents.includes(node);\r\n\t\t\r\n\t\tif( isNodeAllowed && isNodeUnknown ){\r\n\t\t\tobj.nodeParents.push(node);\r\n\t\t\tobj.updateNodeMinBlockPositions();\r\n\t\t} // if\r\n\t} // addparent\r\n\t\r\n\taddchild(node){\r\n\t\tlet obj = this;\r\n\t\tif(!obj.children.includes(node.connections.group)){\r\n\t\t\tobj.children.push(node.connections.group);\r\n\t\t} // if\r\n\t\t\r\n\t\tif(!obj.nodeChildren.includes(node)){\r\n\t\t\tobj.nodeChildren.push(node);\r\n\t\t\tobj.updateNodeMinBlockPositions();\r\n\t\t} // if\r\n\t} // addchild\r\n\t\r\n\tmakelinks(){\r\n\t\tlet obj = this;\r\n\t\t\t\t\t\r\n\t\t// Links must be made for every child-parent combination. Strictly speaking at least one link must be made for all the children, and at least one link must connect to every parent.\r\n\t\tlet links = []\r\n\t\t\r\n\t\tobj.nodeParents.forEach(p=>{\r\n\t\t\tobj.nodeChildren.forEach(c=>{\r\n\t\t\t\tlinks.push( new DrawLink(p,c) )\r\n\t\t\t}) // forEach\r\n\t\t}) // forEach\r\n\t\t\r\n\t\tobj.links = links;\r\n\t\t\r\n\t} // links\r\n\t\r\n\t\r\n\t// Make the full path here??\r\n\tget path(){\r\n\t\tlet obj = this;\r\n\t\treturn obj.links.map(link=>link.path).join(\"\")\r\n\t} // path\r\n\t\r\n\t\r\n\tget width(){\r\n\t\t// The width of the bundle is the fixed horizontal distance plus the number of bundles multiplied by the width reserved for the vertical line segment. The nodes, and therefore the lines are not yet positioned properly, therefore their width cannot be used to calculate the bunlde width. But they can be just summed together though!\r\n\t\t// Note that this is the minimum width of spanning one level, and not the entire width of the bundle, which may include lines spanning multiple levels!\r\n\t\t\r\n\t\treturn node_label_width + obj.bundles.length*bundle_width + r;\r\n\t} // get width\r\n\t\r\n\tupdateNodeMinBlockPositions(){\r\n\t\t// This should just be run whenever the parents or the children are changed.\r\n\t\t// Because the links make two 90 degree turns when connecting the parent to the child the radii of these turns constitute the minimum y offset of this bundle relative to the previous one. Furthermore, this is offset relative to the lowest parent! This is important when positioning the child nodes.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tlet lowestParentBlock = obj.nodeParents.reduce((acc, p)=>{\r\n\t\t\treturn acc > p.block ? acc : p.block\r\n\t\t}, 0)\r\n\t\t\r\n\t\tobj.nodeChildren.forEach(child=>{\r\n\t\t\tchild.block = lowestParentBlock; // + 2*r if all links curves.\r\n\t\t}) // forEach\r\n\t\t\r\n\t} // y_min\r\n\t\r\n\tchildMinimumY(){\r\n\t\tlet obj = this;\r\n\t\treturn obj.nodeParents.reduce((acc,b)=>{\r\n\t\t\treturn Math.max(acc,b.y)\r\n\t\t}, 0)\r\n\t} // childMinimumY\r\n\t\r\n} // TreeBundle2","let node_label_width = 70; // length of text\r\nlet bundle_width = 4; // reserved space for the vertical bunlde line\r\nlet r = 16; // arc radius\r\n\r\n// A level is an organisational group. All dimensioning is done through a treelevel. The primary elements that define the level are its bundles. The TreeLevel is necessary because the bundles need to be sequenced within a level, and the level width is required to position hte levels. Because the bundles are based on a set of parents, the level of the bundle is the level of the children.\r\nexport default class TreeLevel{\r\n  constructor(nodes, bundles, nlevel){\r\n\t\tlet obj = this;\r\n\t\tobj.n = nlevel;\r\n\t\tobj.bundles = bundles.filter(b=>b.level==nlevel);\r\n\t\tobj.nodes = nodes.filter(n=>n.level==nlevel);\r\n\t} // constructor\r\n\t\r\n\tget width(){\r\n\t\t// The width of the entire level. It's the width of the label plus the width of all the vertical line segments (including padding), plus the length of the finishing horizontal segment (this is zero for the right-most bundle).\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The width of the level is determined by the bundles that end in it. If there aren't any bundles, there is no width. Maybe do a reduce and move the width calculation to the bundle? That would eliminate the dimensions here.\r\n\t\tif(obj.bundles.length > 0){\r\n\t\t\treturn node_label_width + obj.bundles.length*bundle_width + r;\r\n\t\t} else {\r\n\t\t\treturn 0\r\n\t\t} // if\r\n\t} // width\r\n} // TreeLevel","import { arrayEqual } from \"../../helpers.js\";\r\n\r\nimport TreeBundle from \"./TreeBundle.js\";\r\nimport TreeLevel from \"./TreeLevel.js\";\r\n/* \r\nA defined group hierarchy (groups, group members, and group parents have been established) is passed in. The input data is an array of groups to be drawn.\r\n\r\nThis is the background data based on which a tree chart can be established. Interactions with the tree don't change the underlying group hierarchy, only the drawn representation.\r\n*/\r\n\r\n/*\r\nNode height -> number of bundles connecting to it\r\nNode x -> depends on the levels and their widths\r\nNode y -> position of parent nodes\r\nLevel width -> number of bundles\r\nBundle links -> parent/child nodes\r\n*/\r\n\r\nfunction getBundleLinesGoingThroughNode(bundle, node){\r\n\t// Given some bundles find which of its lines go through a specific node. Whether the lines are incoming or outgoing is not needed, because it's determined by the relationship between the bundles and the node. Instead the node must just be referenced by the line.\r\n\treturn bundle.links.filter(link=>{\r\n\t\treturn link.childnode == node || link.parentnode == node;\r\n\t}) // filter\r\n} // getBundleLines\r\n\t\r\nfunction arrangeIncomingOutgoingTracks(node, bundles){\r\n\t// This is for bundles coming in and out of a particular node. To draw the node I need to know where to start, how big it should be, and I should also know what the label is, and what the corresponding tags are. Each bundle should be staggered when entering a particular node. But bundles can also hold lines of several authors. These should be staggered as well.\r\n\t\t\r\n\tlet outgoingbundles = bundles.filter(b=>{\r\n\t\treturn b.parents.includes( node.connections.group );\r\n\t}) // filter\r\n\t\r\n\tlet incomingbundles = bundles.filter(b=>{\r\n\t\treturn b.children.includes( node.connections.group );\r\n\t}) // filter\r\n\t\r\n\t\r\n\t// Bundles spanning multiple levels should be all the way at the top. Then they should be ordered by bundle ind. Larger bendi means bend happens more to the right.\r\n\tincomingbundles.sort((a,b)=>{\r\n\t\treturn b.level - a.level || b.bendi - a.bendi;\r\n\t}) // sort\r\n\t\r\n\toutgoingbundles.sort((a,b)=>{\r\n\t\treturn b.level - a.level || b.bendi - a.bendi;\r\n\t}) // sort\r\n\t\r\n\t// This should be improved. First of all, the track indices and the bundle indices should be coordinated by sorting the lines by bundle ind before assigning the track ind. Secondly, it would be good if bundles of the same color could maintain same track positions...\r\n\t\r\n\t\r\n\t// Assign the index of track to enter the node by. Lines entering this node treat it as a child.\r\n\tincomingbundles.forEach((bundle,i)=>{\r\n\t\tlet lines = getBundleLinesGoingThroughNode(bundle, node);\r\n\t\tlines.forEach(line=>{\r\n\t\t\tline.ci = i;\r\n\t\t})\r\n\t}) // forEach\r\n\t\r\n\t// Lines exiting hte node treat it as a parent.\r\n\toutgoingbundles.forEach((bundle,i)=>{\r\n\t\tlet lines = getBundleLinesGoingThroughNode(bundle, node);\r\n\t\tlines.forEach(line=>{\r\n\t\t\tline.pi = i;\r\n\t\t})\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t// Set number of incoming bundles.\r\n\tnode.nBundlesIn  = incomingbundles.length;\r\n\tnode.nBundlesOut = outgoingbundles.length;\r\n\t\r\n\t\t\r\n} // arrangeIncomingOutgoingTracks\r\n\r\nfunction arrangeBundlesOfLevel(bundles){\r\n\t\r\n\tbundles.sort((a,b)=>{\r\n\t\t// How to sort by similarity? Similarity is based on a pairs, not on individual. Maybe order by size, and then progressively do smaller sorts? Or just sort the nodes, and adjust the bundles to that?\r\n\t\t\r\n\t\t// Sort by size.\r\n\t\treturn b.children.length - a.children.length;\r\n\t}) // sort\r\n\t\r\n\t\r\n\t\r\n\t// But it also depends on hte nodes in hte previous level? So just arrange them sensibly? Go through them and assign minimum y positions based on the parents. This can later be used to create further bundles?\r\n\t\r\n\t\r\n\t// Maybe the nodes should just track the indices of the paths that lead to them? Sort of a history? That would also allow the longest chain to be identified. And then the level indices of the paths/bundles can be used to determine the order.\r\n\t\r\n\t\r\n\t// Maybe if the up-path is also allowed it can be used to reclaim some space after a particular branch ends?\r\n\t\r\n\t// The bundle needs an ind for within the level. This can be used to sort the bundle links horizontally. The location of the vertical line segment is determined based on this index.\r\n\tlet maxBundleInd = bundles.length - 1;\r\n\tbundles.forEach((b,i)=>{\r\n\t\tb.bendi = maxBundleInd - i;\r\n\t}) // forEach\r\n\t\r\n\t\r\n} // arrangeBundlesOfLevel\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction getbundles(nodes){\r\n\t\t\r\n\t// The bundles should be differentiated based on tag authors.\r\n\tlet bundleseeds = nodes.filter(node=>{\r\n\t\treturn node.connections.parents.length > 0;\r\n\t}) // filter\r\n\t\r\n\t\r\n\t// The `taskgroup' objects have several tags connected to them. Each tag represents a group that was created by some user. For every author of a group there should be a different bundle connecting to it. Even if the tag has only been created for that specific group.\r\n\t\r\n\t\r\n\t// Two bundles are not necessarily the same if htey have the same parents. They should be differentiated by the user tag also.\r\n\t\r\n\tlet bundles = bundleseeds.reduce(function(bundles, node){\r\n\t\t\r\n\t\t// This node may belong to several bundles made by different authors. Find thos bundles, and if they can't be found create them.\r\n\t\tnode.connections.group.tags.forEach(tag=>{\r\n\t\t\tlet existing = bundles\r\n\t\t\t  .filter(b=>b.author==tag.author)\r\n\t\t\t  .filter(b=>arrayEqual(b.parents, node.connections.parents))\r\n\t\t\t  \r\n\t\t\tif(existing.length>0){\r\n\t\t\t\texisting.forEach(b=>{\r\n\t\t\t\t\tb.addchild(node)\r\n\t\t\t\t}) // forEach\r\n\t\t\t} else {\r\n\t\t\t\tbundles.push( new TreeBundle(node, tag.author) )\r\n\t\t\t} // if\r\n\t\t})\r\n\t\t\r\n\t\treturn bundles\r\n\t}, []) // map\r\n\t\r\n\t\r\n\t\r\n\t// Go through hte nodes one more time to assign the parent nodes also. Originally only the groups are assigned as parents as the incoming nodes don't reference other nodes, but the groups do reference each other.\r\n\t// `treebundle' instances will check whether parents are valid.\r\n\tnodes.forEach(node=>{\r\n\t\tbundles.forEach(bundle=>{\r\n\t\t\tbundle.addparent(node);\r\n\t\t})\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t// Make sure the bundles create all the required links.\r\n\tbundles.forEach(bundle=>{\r\n\t\tbundle.makelinks();\r\n\t})\r\n\t\r\n\t\t\r\n\treturn bundles;\r\n} // get bundles\r\n\r\nfunction getlevels(nodes, bundles){\r\n\t\t\r\n\t// Always create all new levels!!\r\n\tlet levels = []\r\n\t\r\n\t// Find all the levels from the bundles.\r\n\tlet maxlevel = Math.max( ...nodes.map(n=>n.level) )\r\n\tfor(let level=0; level<maxlevel+1; level++){\r\n\t\tlevels.push( new TreeLevel(nodes, bundles, level) )\r\n\t} // for\r\n  \r\n\treturn levels\r\n} // get levels\r\n\r\n\r\n\r\n// Maybe devolve this one into TreeRender and hierarchy?\r\n\r\n// The user can only click on the nodes to directly interact with the tree. Currently the 'collapsenode' is used for that.\r\nexport function dimensioning(nodes){\r\n\t// `dimension' calculates the positions of the nodes on the screen, and dimensions the connecting links.\r\n\tnodes.forEach(node=>node.clear())\r\n  \r\n\t// Need to get teh levels so that I have a constant copy... mobx would probably improve this, but it'll do for now. Maybe it'd just be better to collect this with some sort of functions? And not getters?\r\n\tlet bundles = getbundles(nodes);\r\n\tlet levels = getlevels(nodes, bundles);\r\n\t\r\n\t\r\n\t// First order the bundles within hte levels.\r\n\tlevels.forEach(level=>arrangeBundlesOfLevel(level.bundles)); // forEach\r\n\t\r\n\t\r\n\t// ASSIGN INCOMING/OUTGOING INDICES TO LINES.\r\n\tnodes.forEach(node=>arrangeIncomingOutgoingTracks(node, bundles)); // forEach\r\n  \r\n\t\r\n\t// Last thing is to position the nodes. x positioning is controlled by the level they are on.\r\n\tlet x = 0;\r\n\tlevels.forEach(level=>{\r\n\t\t\r\n\t\t// Assigning x positions just depends on the level.\r\n\t\tx += level.width;\r\n\t\tlevel.nodes.forEach(n=>{\r\n\t\t\tn.x = x;\r\n\t\t}); // level.nodes\r\n\t\t\r\n\t\t\r\n\t\t// Recalculate the minimum node positions.\r\n\t\tlevel.bundles.forEach(b=>b.updateNodeMinBlockPositions());\r\n\t\t\t\t\r\n\t\t// Now sort the nodes by their miny to conserve as much space as possible.\r\n\t\tlevel.nodes.sort((a,b)=>{\r\n\t\t\treturn a.block - b.block\r\n\t\t}) // sort\r\n\t\t\r\n\t\t\r\n\t\t// Run through htem again to assign unique block ids to them. This should already produce a block ordered array of nodes.\r\n\t\tlet block = 0;\r\n\t\tlevel.nodes.forEach(n=>{\r\n\t\t\tn.block = Math.max(n.block, block);\r\n\t\t\tblock += 1;\r\n\t\t}); // forEach\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// After blocks are assigned do the positioning. This also depends on the links. If a link is expected to connect the same blocks it will be horizntal, and hte node positions should be adjusted accordingly.\r\n\t\t\r\n\t\t// The block are supposed to already separate the nodes vertically, now we're just figuring out the small adjustments.\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// The assignment has to be done via links!\r\n\t\tvar y = 0;\r\n\t\tlevel.bundles.forEach(bundle=>{\r\n\t\t\tbundle.links.sort((a,b)=>{\r\n\t\t\t\treturn a.childnode.block - b.childnode.block\r\n\t\t\t}); // sort\r\n\t\t\t\r\n\t\t\t// Bundle links can always only be at the same level as parents, or below.\r\n\t\t\ty = Math.max(y, bundle.childMinimumY());\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Bundle links nodes may have already been positioned - by a parallel path connecting hte same nodes.\r\n\t\t\t// If there are multiple prents, then they will have positioned the childnode twice also!\r\n\t\t\t\r\n\t\t\t// It's intra-bundle that causes the bundle positioning!\r\n\t\t\t\r\n\t\t\tbundle.links.filter(lnk=>!lnk.childnode.positioned).forEach(lnk=>{\r\n\t\t\t\t\r\n\t\t\t\t\tif(lnk.parentnode.block == lnk.childnode.block){\r\n\t\t\t\t\t\tlnk.childnode.yBasedOnIncomingHorizontalLine(lnk.parentnode.calculateOutgoingLineY(lnk.pi), lnk.ci ) ;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlnk.childnode.y = y;\r\n\t\t\t\t\t} // if\r\n\t\t\t\t\t\r\n\t\t\t\t\t// The y position for hte next node. This should be global!\r\n\t\t\t\t\tlnk.childnode.positioned = true;\r\n\t\t\t\t\ty = lnk.childnode.y + lnk.childnode.markerSize + lnk.childnode.pitch;\r\n\t\t\t\t\r\n\t\t\t})\r\n\t\t\t\r\n\t\t}) // forEach\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}) // forEach\r\n\r\n\treturn {\r\n\t\tnodes: nodes,\r\n\t\tbundles: bundles\r\n\t}\r\n} // dimensioning\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { svg2element } from \"../../helpers.js\";\r\n\r\n\r\n\t\r\n// d, node=>node.path\r\n// text -> \t\"x\", node => node.labelx, \"y\", node => node.labely, label node=>node.label\r\nlet template = `\r\n<g class=\"node\" cursor=\"pointer\">\r\n  <g class=\"marker\">\r\n    <path class=\"outline\" stroke=\"black\" stroke-width=\"8\" stroke-linecap=\"round\"></path>\r\n    <path class=\"fill\" stroke=\"white\" stroke-width=\"4\" stroke-linecap=\"round\"></path>\r\n  </g>\r\n  <g class=\"label\">\r\n    <rect rx=\"5\" ry=\"5\" fill=\"none\"></rect>\r\n    <text class=\"unselectable\" stroke=\"white\" stroke-width=\"2\" font-size=\"10px\"></text>\r\n    <text class=\"unselectable\" stroke=\"black\" stroke-width=\"0.5\" font-size=\"10px\"></text>\r\n  </g>\r\n  <g class=\"tooltip\"></g>\r\n</g>\r\n`; // template\r\n\r\n// A treenode object is a higher level wrapper that contains all the dimensioning information. The `connections' attribute is supposed to hold the `treegroup' object, which contains a reference the an individual group, all it's ancestors, it's direct parents, and all its descendants.\r\nexport default class TreeNode{\r\n\t\r\n\t// These are assigned from outside.\r\n\tx = 0\r\n\ty = 0\r\n\t\r\n\t// Blocks are used to roughly position nodes.\r\n\tblock = 0\r\n\t\r\n\t// Line width is the width of the incoming line. The pitch is the vertical spacing to the next node.\r\n\tlineWidth = 4\r\n\tpitch = 32\r\n\t\r\n\tnBundlesIn = 0\r\n\tnBundlesOut = 0\r\n\t\r\n\thidden = false;\r\n\t\r\n\tconstructor(treegroup){\r\n\t\tlet obj = this;\r\n\t\tobj.node = svg2element( template );\r\n\t\t// The treegroup holds all the connections of a particular group.\r\n\t\tobj.connections = treegroup;\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tlet label = obj.node.querySelector(\"g.label\");\r\n\t\tlabel.addEventListener(\"mouseenter\", function(){ obj.highlightText(true) });\r\n\t\tlabel.addEventListener(\"mouseout\" , function(){ obj.highlightText(false) });\r\n\t\t\r\n\t\tlet marker = obj.node.querySelector(\"g.marker\");\r\n\t\tmarker.onmouseenter = function(){ obj.highlightMarker(true) }\r\n\t\tmarker.onmouseleave = function(){ obj.highlightMarker(false) }\r\n\t} // constructor\t\r\n\t\r\n\t\r\n\tclear(){\r\n\t\tlet obj = this;\r\n\t\tobj.x = 0;\r\n\t\tobj.y = 0;\r\n\t\tobj.block = 0;\r\n\t\tobj.nBundlesIn = 0;\r\n\t\tobj.nBundlesOut = 0;\r\n\t} // clear\r\n\t\r\n\t\r\n\t// Updating\r\n\tupdate(){\r\n\t    let obj = this;\r\n\t\t\r\n\t\tlet marker = obj.node.querySelector(\"g.marker\");\r\n\t\tlet paths = marker.querySelectorAll(\"path\");\r\n\t\t\r\n\t\tlet label = obj.node.querySelector(\"g.label\");\r\n\t\tlet texts = label.querySelectorAll(\"text\");\r\n\t\t\r\n\t\t\r\n\t\t// Draw the node marker\r\n\t\tfor(let i=0; i<paths.length; i++){\r\n\t\t\tpaths[i].setAttribute(\"d\", `M${ obj.x } ${ obj.y } L${ obj.x } ${ obj.y + obj.markerSize }`)\r\n\t\t} // for\r\n\t\t\r\n\t\t// Position hte texts\r\n\t\tlabel.setAttribute(\"transform\", `translate(${obj.x+4}, ${obj.y-4})`);\r\n\t\tfor(let i=0; i<texts.length; i++){\r\n\t\t\ttexts[i].innerHTML = obj.label;\r\n\t\t} // for\r\n\t\t\r\n\t\t// Instead of having background text just a rectangle is added behind it. Text scales weirdly...\r\n\t\tobj.updateBackgroundRectSize();\r\n\t} // update\r\n\t\r\n\tupdateBackgroundRectSize(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tlet t = obj.node.querySelector(\"g.label\").querySelectorAll(\"text\")[1];\r\n\t\tlet rect = obj.node.querySelector(\"g.label\").querySelector(\"rect\");\r\n\t\tlet textbox = t.getBBox();\r\n\t\t\r\n\t\trect.setAttribute(\"x\", textbox.x - textbox.width*0.05);\r\n\t\trect.setAttribute(\"y\", textbox.y);\r\n\t\trect.setAttribute(\"width\", textbox.width*1.1);\r\n\t\trect.setAttribute(\"height\", textbox.height*1.1);\r\n\t} // updatebackgroundRectSize\r\n\t\r\n\t\r\n\t\r\n\t// Highlighting\r\n\thighlightSelect(){\r\n\t\t// Just toggle the background rect, and the text color. Let it still respond to mouseover font increases.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tlet t = obj.node.querySelector(\"g.label\").querySelectorAll(\"text\");\r\n\t\tlet rect = obj.node.querySelector(\"g.label\").querySelector(\"rect\");\r\n\t\t\r\n\t\t// Text fill is now white.\r\n\t\tt[0].setAttribute(\"fill\", \"black\");\r\n\t\tt[0].setAttribute(\"stroke\", \"black\");\r\n\r\n\t\tt[1].setAttribute(\"fill\", \"white\");\r\n\t\tt[1].setAttribute(\"stroke\", \"white\");\r\n\r\n\t\t// Set the rect\r\n\t\trect.setAttribute(\"fill\", \"black\");\r\n\t} // highlightSelect\r\n\t\r\n\tunhighlightSelect(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tlet t = obj.node.querySelector(\"g.label\").querySelectorAll(\"text\");\r\n\t\tlet rect = obj.node.querySelector(\"g.label\").querySelector(\"rect\");\r\n\t\t\r\n\t\t// Text fill is now white.\r\n\t\tt[0].setAttribute(\"fill\", \"white\");\r\n\t\tt[0].setAttribute(\"stroke\", \"white\");\r\n\r\n\t\tt[1].setAttribute(\"fill\", \"black\");\r\n\t\tt[1].setAttribute(\"stroke\", \"black\");\r\n\r\n\r\n\t\trect.setAttribute(\"fill\", \"none\");\r\n\t} // unhighlightSelect\r\n\t\r\n\thighlightText(v){\r\n\t\tlet obj = this;\r\n\t\tlet size = v ? \"12px\" : \"10px\";\r\n\t\tlet texts = obj.node.querySelector(\"g.label\").querySelectorAll(\"text\");\r\n\t\tfor(let i=0; i<texts.length; i++){\r\n\t\t\ttexts[i].setAttribute(\"font-size\", size);\r\n\t\t} // for\r\n\t\tobj.updateBackgroundRectSize();\r\n\t} // highlightText\r\n\t\r\n\thighlightMarker(v){\r\n\t\tlet obj = this;\r\n\t\tlet size = v ? 10 : 8;\r\n\t\tlet outline = obj.node.querySelector(\"g.marker\").querySelector(\"path.outline\");\r\n\t\toutline.setAttribute(\"stroke-width\", size);\r\n\t} // highlightMarker\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\t// Drawing.\r\n\tget markerSize(){\r\n\t\treturn Math.max(this.nBundlesIn-1, this.nBundlesOut-1, 0)*this.lineWidth;\r\n\t} // markersize\r\n\t\r\n\t\r\n\tyBasedOnIncomingHorizontalLine(y,i){\r\n\t\t// A horizontal line should be drawn at a `y'. Given that this line should come in at index i position the node to achieve both simultaneously.\r\n\t\tlet obj = this;\r\n\t\tobj.y = y - i*obj.lineWidth - obj.markerPaddingIn;\r\n\t} // yBasedOnIncomingHorizontalLine\r\n\t\r\n\t\r\n\tcalculateIncomingLineY(i){\r\n\t\t// given index 'i', and the position of the node calulate the y the line should terminate at.\r\n\t\tlet obj = this;\r\n\t\treturn obj.y + obj.markerPaddingIn + i*obj.lineWidth;\r\n\t} // calculateIncomingLineY\r\n\t\r\n\tcalculateOutgoingLineY(i){\r\n\t\t// given index 'i', and the position of the node calulate the y the line should terminate at.\r\n\t\tlet obj = this;\r\n\t\treturn obj.y + obj.markerPaddingOut + i*obj.lineWidth;\r\n\t} // calculateIncomingLineY\r\n\t\r\n\t\r\n\t\r\n\tget markerPaddingIn(){\r\n\t\t// If the marker is larger than the width of the lines coming in, then the lines should be centered in hte middle of the marker. Calculate the empty space from hte marker start to where the lines should begin.\r\n\t\tlet obj = this;\r\n\t\treturn (obj.markerSize - (obj.nBundlesIn-1)*obj.lineWidth) / 2;\r\n\t} // markerPaddingIn\r\n\t\r\n\tget markerPaddingOut(){\r\n\t\tlet obj = this;\r\n\t\treturn (obj.markerSize - (obj.nBundlesOut-1)*obj.lineWidth) / 2;\r\n\t} // markerPaddingOut\r\n\t\r\n\t\r\n\t\r\n\t// Label to be displayed next to it. Shouldn't be larger than the node_label_width.\r\n\tget label(){\r\n\t\tlet obj = this;\r\n\t\tlet name = obj.connections.group.tags.length > 0 ? obj.connections.group.tags[0].name : \"Root\";\r\n\t\t\r\n\t\t// Temporarily changed to show n tasks for troubleshooting.\r\n\t\t// let n = obj.connections.descendants.length;\r\n\t\tlet n = obj.connections.group.members.length;\r\n\t\treturn `${name} ${n > 0 ? `(${ n })`: \"\"}`\r\n\t} // label\r\n\t\r\n\t\r\n\t\r\n\t\r\n} // TreeNode\r\n\r\n","import {arrayEqual, arrayIncludesAll} from \"../../helpers.js\";\r\n/*\r\nIf all the tasks are in the same array, and the author information is on the tags, then the partial trees won;t be a problem.\r\n\r\nEvery tag represents a group possibility essentially. But the same tag can relate to different groups. The group members differentiate the groups. The different tag descriptions of the groups should all be presented on mouseover, maybe along with the author data.\r\n\r\nWon't be able to remove the initial dialogue in the small multiples visualisation, but I will be able to get rid of the expand button on the small multiples.\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n// FROM AN ARRAY OF TASKS WITH TAGS TO A TREE\r\n\r\n\r\nexport function array2tree(array, alltasks){\r\n\t/*\r\n\t1.) Find groups.\r\n\t2.) Merge them.\r\n\t3.) Create parent-child relationships\r\n\t*/\r\n\t\r\n\t// Find all created groups, and merge the ones with identical members.\r\n\tlet groups = findAllTagBasedGroups(array);\r\n\tlet root = makeRootGroup(alltasks);\r\n\tlet mergedgroups = mergeIdenticalGroups(groups.concat(root));\r\n\t\r\n\t// Convert the groups into a higher level object to avoid circular references when figuring out ancestry.\r\n\tlet hierarchicalnodes = findParentalRelationships(mergedgroups);\r\n\t\r\n\treturn hierarchicalnodes\r\n\t\r\n} // array2tree\r\n\r\n\r\n// The tree node represents a single group, but also holds references to the parent and child nodes. The treenode is a higher level object to avoid circular referencing of objects.\r\nclass treegroup{\r\n\tconstructor(taskgroup){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.group = taskgroup;\r\n\t\t\r\n\t\t// Groups CAN have more than 1 parent. While it's true that during a single dive through the tasks each group can only have one parent, it's possible that additional dives (by the same, or other users) will produce the same groups, but tracing different steps. The merging already combines all identical groups, so the merged groups can have multiple parents.\r\n\t\t// Select the parents as all those candidate  groups that have not been referenced by other candidate groups already.\r\n\t\tobj.ancestors = []; // All upstream groups\r\n\t\tobj.parents = []; // Only groups directly above this one.\r\n\t\t\r\n\t\tobj.descendants = []; // All downstream groups\r\n\t\tobj.children = []; // Only groups immediately below this one.\r\n\t} // constructor\r\n} // treegroup\r\n\r\nclass taskgroup{\r\n\tconstructor(){\r\n\t\tthis.tags = [];\r\n\t\tthis.members = [];\r\n\t} // constructor\r\n\t\r\n\taddtask(task){\r\n\t\tlet obj = this;\r\n\t\tif(!obj.members.includes(task)){\r\n\t\t\tobj.members.push(task);\r\n\t\t} // if\r\n\t} // addtask\r\n\t\r\n\taddtag(tag){\r\n\t\tlet obj = this;\r\n\t\t\t\t\r\n\t\tif( !obj.tags.some(existing=>(existing.author == tag.author) && (existing.name == tag.name)) ){\r\n\t\t\tobj.tags.push(tag);\r\n\t\t} // if\r\n\t} // addtags\r\n} // group\r\n\r\n\r\n\r\n// Making groups.\r\nfunction findAllTagBasedGroups(array){\r\n\t\r\n\t// Create a group for each tag present in the array. We also need to differentiate teh groups by the author at this point. Otherwise parallel trees won't be possible.\r\n\tlet dict = {};\r\n\tlet groups = [];\r\n\t\r\n\tarray.forEach(tag=>{\r\n\t\t// If you tag something in the session, then that tag is reserved for a particular group. If you tag other elements with it, it'll become a part of that group. Actual tags need to be retained in order to be able to edit them, and therefore edit the groups.\r\n\t\tlet groupid = `${tag.name}-${tag.author}`;\r\n\t\tif(!dict[groupid]){\r\n\t\t\t// Here just pass the tag in. The group will need to hold on to it.\r\n\t\t\tdict[groupid] = new taskgroup();\r\n\t\t\tdict[groupid].temporary = tag.author == undefined;\r\n\t\t\tgroups.push(dict[groupid]);\r\n\t\t} // if\r\n\t\t\r\n\t\t// Add teh task to the specific group, but also to the root group.\r\n\t\tdict[groupid].addtask(tag.taskId);\r\n\t\tdict[groupid].addtag(tag);\r\n\t}) // forEach\r\n\r\n\treturn groups;\r\n\t\r\n} // findAllTagBasedGroups\r\n\r\n\r\n\r\nfunction makeRootGroup(array){\r\n\t\r\n\t// The root MUST always contain all of the data!! It will also allow navigation all the way to the start.\r\n\tlet root = new taskgroup();\r\n\troot.root = true;\r\n\t\r\n\t// Root should contain all tasks.\r\n\tarray.forEach(tag=>{\r\n\t\troot.addtask(tag.taskId);\r\n\t}) // forEach\r\n\t\r\n\treturn root\r\n\t\r\n} // makeRootGroup\r\n\r\nfunction mergeIdenticalGroups(groups){\r\n\t\r\n\tlet mergedgroups = groups.reduce((acc,g)=>{\r\n\t\t// Find group with identical members.\r\n\t\tlet identicalg = acc.find(g_=>{\r\n\t\t\treturn arrayEqual(g_.members, g.members)\r\n\t\t}) // filter\r\n\t\t\r\n\t\tif(identicalg){\r\n\t\t\t// Add another author to existing group.\r\n\t\t\tg.tags.forEach(tag=>{\r\n\t\t\t\tidenticalg.addtag(tag);\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t// Add this group to the unique ones.\r\n\t\t\tacc = acc.concat(g);\r\n\t\t} // if\r\n\t\t\r\n\t\treturn acc\r\n\t},[]) // reduce\r\n\t\r\n\treturn mergedgroups\r\n\t\r\n} // mergeIdenticalGroups\r\n\r\nfunction isSubset(a,b){\r\n\t// Check whether array a is a subset of array b.\r\n\t\r\n\t// A must be strictly smaller than b.\r\n\tif(a.length < b.length){\r\n\t\t// Check if b contains all of a.\r\n\t\treturn arrayIncludesAll(b, a);\r\n\t} else {\r\n\t\treturn false;\r\n\t} // if\r\n\t\r\n} // isSubset\r\n\r\nfunction findParentalRelationships(groups){\r\n\t\r\n\t\r\n\t// First create an object one level above to avoid cross referenceing of objects.\r\n\tlet nodes = groups.map(g=>{return new treegroup(g)});\r\n\t\r\n\t// maybe calculate all ancestors, all descendants, and then parents and children? Could be useful to have all hte information available.\r\n\t\r\n\t\r\n\t// FIND PARENT CANDIDATES FOR ALL GROUPS.\r\n\tnodes.forEach(node=>{\r\n\t\t// Ancestor groups are all groups that include all of the members of the node group, but are larger than it.\r\n\t\tnode.ancestors = groups.filter(g=>{\r\n\t\t\treturn isSubset(node.group.members, g.members)\r\n\t\t}) // filter\r\n\t\t\r\n\t\t\r\n\t\t// Descendant groups are all groups that contain a subset of the members of this group.\r\n\t\tnode.descendants = groups.filter(g=>{\r\n\t\t\treturn isSubset(g.members, node.group.members)\r\n\t\t});\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Groups CAN have more than 1 parent. While it's true that during a single dive through the tasks each group can only have one parent, it's possible that additional dives (by the same, or other users) will produce the same groups, but tracing different steps. The merging already combines all identical groups, so the merged groups can have multiple parents.\r\n\t// Select the parents as all those candidate  groups that have not been referenced by other candidate groups already.\r\n\t\r\n\t\r\n\t\r\n\t// Loop over all the candidates of a particular group, and remove all candidates that appear in that.\r\n\tnodes.forEach(node=>{\r\n\t\tnode.parents = node.ancestors;\r\n\t\t// All parents of a candidate parent are considered `grandparents'. All grandparents cannot be the parent. Loop over the candidates and remove all grandparents. Candidates also include teh candidates parents, so the whole lineage is checked.\r\n\t\tnode.parents.forEach(candidate=>{\r\n\t\t\t\r\n\t\t\t// The candidate now no longer has parents. Just check directly? If another group contains all the members of a group then it is its parent.\r\n\t\t\tnode.parents = node.parents.filter(parent=>{\r\n\t\t\t\tif(candidate == parent){\r\n\t\t\t\t\t// A candidate can't eliminate himself.\r\n\t\t\t\t\treturn true\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn !isSubset(candidate.members, parent.members);\r\n\t\t\t\t} // if\r\n\t\t\t}) // filter\r\n\t\t}) // forEach\r\n\t\t\t\r\n\t\t\r\n\t\t// The children are useful when navigating, as it allows the creation of groups that are immediately below the current node.\r\n\t\tnode.children = node.descendants;\r\n\t\tnode.children.forEach(candidate=>{\r\n\t\t\tnode.children = node.children.filter(child=>{\r\n\t\t\t\tif(candidate == child){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// a is subset of b.\r\n\t\t\t\t\t// I'm filtering out the children, and any children that are a subset of the candidate can no longer be candidates themselves.\r\n\t\t\t\t\treturn !isSubset(child.members, candidate.members)\r\n\t\t\t\t} // if\r\n\t\t\t}); // filter\r\n\t\t}); // forEach\r\n\t}) // forEach\r\n\t\r\n\treturn nodes\r\n\t\r\n\t\r\n} // findParentalRelationships\r\n\r\n\r\n\r\n\r\nexport function calculateLevelNumbers(nodes){\r\n\t\r\n\t// First clear all the levels and set any root ones.\r\n\tnodes.forEach(node=>{\r\n\t\tnode.level = undefined;\r\n\t\tif(node.connections.parents.length == 0){\r\n\t\t\tnode.level = 0;\r\n\t\t} // if\r\n\t})\r\n\t\r\n\t// Now move through the nodes and check if all parents already had a level assigned. If so the level of the node is max(parents.level) + 1. This must be done until all the nodes have an assigned level.\r\n\t\r\n\t\r\n\tfor(let i=0; i<nodes.length; i++){\r\n\t\t\r\n\t\tlet unassignednodes = nodes.filter(node=>node.level==undefined);\r\n\t\t\r\n\t\tunassignednodes.forEach(node=>{\r\n\t\t\t// All parents must have an assigned level, otherwise skip. Check if any don't have level.\r\n\t\t\tlet parents = node.connections.parents.reduce((acc,parent)=>{\r\n\t\t\t\treturn acc.concat(nodes.filter(node=>node.connections.group == parent))\r\n\t\t\t}, []) // reduce\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif( parents.some(parent=>parent.level==undefined) ){\r\n\t\t\t\t// Some don't have level assigned. Skip.\r\n\t\t\t} else {\r\n\t\t\t\tnode.level = Math.max(...parents.map(parent=>parent.level)) + 1;\r\n\t\t\t} // if\r\n\t\t}) // forEach\r\n\t\t\r\n\t\t\r\n\t\tif(unassignednodes.length == 0){ break; } // if\r\n\t} // for\r\n\t\r\n} // calculateLevelNumbers\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import TreeNode from \"./TreeNode.js\";\r\nimport {array2tree, calculateLevelNumbers} from \"./hierarchy.js\";\r\n\r\nexport default class TreeHierarchy{\r\n  constructor(){\r\n\t  let obj = this;\r\n\t  \r\n\t  // How should the temporary groups be differentiated from the actual ones? Inside the groups are differentiated by \"<tag.name>-<tag.author>\". So maybe check if the author is undefined, and if so mark it as a temporary group?\r\n\t  obj.alltasks = [];\r\n\t  obj.temporary = [];\r\n\t  obj.annotations = [];\r\n\t  \r\n\t  obj.collapsednodes = [];\r\n\t  \r\n\t  obj.update();\r\n  } // constructor\r\n  \r\n  update(){\r\n\t// Recalculate makes new treenodes. Maybe instead of having hidden nodes just have hidden tasks? And any group that consists only of the hidden tasks is hidden also? That's how the hierarchy creation works anyway.\r\n\t// Nah, just push the togglig to the node itself! However, anytime that the data will be recalculated the hidden aspect will disappear....\r\n\tlet obj = this;\r\n\t\r\n\t// obj.temporary are actual 'Group' objects which are converted into temporary annotations on-the-go.\r\n\tlet i = -1;\r\n\tlet temporaryAnnotations = obj.temporary.reduce((acc, g, j)=>{\r\n\t\t// Why does the id need to be unique?\r\n\t\t// The dummy annotation needs to have a unique id, name, author, and task ids.\r\n\t\treturn acc.concat(g.members.map(item=>{\r\n\t\t\ti += 1;\r\n\t\t\treturn {id: `temp${i}`, name: `Unsaved ${j}`, author: undefined, taskId: item.task.taskId}\r\n\t\t})) // concat\r\n\t}, []); // reduce\r\n\t\r\n\t\r\n\tobj.nodes = array2tree(obj.annotations.concat(temporaryAnnotations), obj.alltasks).map(group=>{\r\n\t\treturn new TreeNode(group);\r\n\t}); // map\r\n  } // update\r\n  \r\n  get visiblenodes(){\r\n\tlet obj = this;\r\n\t\r\n\tlet collapsednodes = obj.nodes.filter(node=>node.hidden);\r\n\t\r\n\t// Based on the collapsed nodes determine which ones are still visible. I can ignore any incorrect nodes here. But I would rather just get rid of them.\r\n\tlet hiddennodes = obj.nodes.filter(node=>{\r\n\t\treturn collapsednodes.some(collapsed=>{\r\n\t\t\treturn collapsed.connections.descendants.includes(node.connections.group)\r\n\t\t}) // some\r\n\t}) // filter\r\n\t\t\r\n\t// Filter out any disabled nodes. Maybe this can be made more sophisticated so that the folds further down the line are preserved?\r\n\tlet nodes = obj.nodes.filter(node=>{\r\n\t\treturn !hiddennodes.includes(node)\r\n\t});\r\n\t\t\r\n\r\n\t// The level numbers should be assigned to all active nodes.\r\n\tcalculateLevelNumbers(nodes);\r\n\t\t\r\n\t\t\r\n\treturn nodes\r\n  } // get nodes\r\n} // TreeHierarchy\r\n\r\n\r\n\r\n// HELPERS\r\n","/* `TreeRender' is the class that defines and executes the tree interactions.\r\n\r\n- dimensioning spatially places the nodes and links.\r\n \r\n*/\r\n\r\n\r\n\r\n// Move the hierarchy to CORE!!\r\nimport { dimensioning } from \"./dimensioning.js\";\r\nimport TreeHierarchy from \"./TreeHierarchy.js\";\r\n\r\nimport {svg2element, scaleCategorical} from \"../../helpers.js\";\r\n\r\n\r\n\r\n/* TODO\r\n- Connect to a scatter plot for interactive tag addition.\r\n- Handle unassigned tasks.\r\n*/\r\n\r\n/* ADVANCED\r\n- Single parent bundles should allow for straight links too.\r\n\r\n- How to display very large trees?\r\n\tMake the tree zoomable?\r\n\r\n- How should the group descriptions be presented? \r\n\tNumber of tasks, number of children, text description, AUTHOR!! All the data is available. Maybe on text hover all the information should be displayed?? Maybe in a tooltip?\r\n- Which label to select when making nodes?\r\n\tThe current author should be allowed to control their branch. This would require some differentiation between users. Certainly can't be done now. For now just select the first one?\r\n- How to merge the groups interactively? I.e. a git pull.\r\n*/\r\n\r\n/* DONE\r\n- Collapsible nodes - collapse, with the folding history saved.\r\n- Enforce partial branches to be inserted - tree created on bundle level.\r\n- Make text unselectable - add into app css\r\n- Fix node mouseover css - css affects specific child of mover g.\r\n*/\r\n\r\n\r\n\r\n\r\nlet template = `\r\n<g transform=\"translate(20, 20)\">\r\n  <g class=\"legend\"></g>\r\n  <g class=\"treeelements\" transform=\"translate(0, 20)\">\r\n\t<g class=\"bundles\"></g>\r\n\t<g class=\"nodes\"></g>\r\n  </g>\r\n</g>\r\n`;\r\n\r\n\r\n\r\nexport default class TreeKnowledge {\r\n\t\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Hierarchy\r\n\t\tobj.hierarchy = new TreeHierarchy();\r\n\t\t\r\n\t\t// Drawing\r\n\t\tobj.node = svg2element( template );\r\n\t\tobj.gnodes = obj.node.querySelector(\"g.nodes\");\r\n\t\tobj.gbundles = obj.node.querySelector(\"g.bundles\");\r\n\t\t\r\n\t\tobj.color = new scaleCategorical();\r\n\t\t\r\n\t\t\r\n\t\t// The tree is redrawn on every interaction. To allow the user to ee where on the tree they currently are just highlight the group that contains all the relevant items.\r\n\t\tobj.currenttasks = [];\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\tpurge(){\r\n\t\t// Remove all the server-based annotations.\r\n\t\tthis.hierarchy.annotations = [];\r\n\t} // purge\r\n\t\r\n\taddtagannotation(tag){\r\n\t\tthis.hierarchy.annotations.push(tag)\r\n\t} // addtagannotation\r\n\t\r\n\tset temporary(d){\r\n\t\tthis.hierarchy.temporary = d;\r\n\t} // set temporary\r\n\t\r\n\tget temporary(){\r\n\t\treturn this.hierarchy.temporary;\r\n\t} // get temporary\r\n\t\r\n\tclear(){\r\n\t\t// When clearing by looping through .children and .remove() it only removed the nodes in the last step. When redrawing it added all of them back somehow...\r\n\t\tlet obj = this;\r\n\t\tobj.gnodes.innerHTML = \"\";\r\n\t\tobj.gbundles.innerHTML = \"\";\r\n\t} // clear\r\n\t\r\n\tinteract(){\r\n\t\tlet obj = this;\r\n\t\tobj.clear();\r\n\t\tobj.map = dimensioning( obj.hierarchy.visiblenodes );\r\n\t\tobj.updatenodes();\r\n\t\tobj.updatelines();\r\n\t\tobj.updatelegend();\r\n\t} // interact\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tupdate(){\r\n\t\tlet obj = this;\r\n\t\tobj.hierarchy.update();\r\n\t\tobj.interact();\r\n\t} // update\r\n\t\r\n\t// The functionality is added in here. Maybe refactor to remove the nestedness??\r\n\tupdatenodes(){\r\n\t\tlet obj = this\r\n\t\t\r\n\t\tobj.map.nodes.sort((a,b)=>a.x-b.x).forEach(nodeobj=>{\r\n\t\t\t\r\n\t\t\t// Check if the group should be highlighted.\r\n\t\t\tlet iscurrent = !nodeobj.connections.group.members.some(taskId=>!obj.currenttasks.includes(taskId))\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tobj.gnodes.appendChild( nodeobj.node );\r\n\t\t\tnodeobj.update();\r\n\t\t\tif(iscurrent){\r\n\t\t\t\tnodeobj.highlightselect();\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tvar tooltipTimer;\r\n\t\t\t\r\n\t\t\t// Add teh styling changes on mouseover. Clicking the label moves view to the group.\r\n\t\t\tlet label = nodeobj.node.querySelector(\"g.label\");\r\n\t\t\tlabel.onclick = function(){ \r\n\t\t\t\tobj.moveto(nodeobj.connections);\r\n\t\t\t\tclearTimeout(tooltipTimer)\r\n\t\t\t\tobj.hidetooltip(nodeobj);\r\n\t\t\t} // onclick\r\n\t\t\tlabel.addEventListener(\"mouseenter\", function(){\r\n\t\t\t\tobj.crossreferencein(nodeobj.connections.group.members)\r\n\t\t\t\ttooltipTimer = setTimeout(function(){\r\n\t\t\t\t\tobj.showtooltip(nodeobj)\r\n\t\t\t\t}, 10)\r\n\t\t\t}) // addEventListener\r\n\t\t\tlabel.addEventListener(\"mouseout\", function(){\r\n\t\t\t\tobj.crossreferenceout();\r\n\t\t\t\tclearTimeout(tooltipTimer)\r\n\t\t\t\tobj.hidetooltip(nodeobj);\r\n\t\t\t}) // addEventListener\r\n\t\t\t\r\n\t\t\t// Clicking on hte node just collapses branches.\r\n\t\t\tnodeobj.node.querySelector(\"g.marker\").onclick = function(){\r\n\t\t\t\tnodeobj.hidden = !nodeobj.hidden;\r\n\t\t\t\tobj.interact();\r\n\t\t\t} // onclick\r\n\r\n\t\t}) // forEach\r\n\t\t\r\n\t} // updatenodes\r\n\t\r\n\t\r\n\tupdatelines(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The renderer controls the color of the lines!!\r\n\t\tobj.map.bundles.forEach(bundleobj=>{\r\n\t\t\tobj.gbundles.appendChild( bundleobj.node )\r\n\t\t\tbundleobj.update( obj.color.dom2range(bundleobj.author) )\r\n\t\t}) // forEach\r\n\t} // updatelines\r\n\t\r\n\t\r\n\tupdatelegend(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Get the tentative width of hte legend.\r\n\t\tlet entrywidth = 90;\r\n\t\tlet entryheight = 15;\r\n\t\t\r\n\t\t// A minus is used to allow i=0 to be used later on - easier to calculate start x.\r\n\t\tlet legendwidth = obj.gnodes.getBoundingClientRect().width - entrywidth/2;\r\n\r\n\t\t\r\n\r\n\t\t// This should only appear if there are any unsaved items.\r\n\t\tlet unsaved = obj.hierarchy.temporary.length > 0 ? `<g transform=translate(0,0)>\r\n\t\t\t<path d=\"M0,-4 L20,-4\" stroke=\"black\" stroke-dasharray=\"5,2\" stroke-width=\"5px\"></path>\r\n\t\t\t<text x=\"25\" y=\"0\" font-weight=\"bold\" font-size=\"12px\">Unsaved</text>\r\n\t\t</g>` : ``;\r\n\r\n\t\t\r\n\t\tlet i = obj.hierarchy.temporary.length > 0 ? 0 : -1;\r\n\t\tlet j = 0;\r\n\t\tlet entries = obj.color.domain.map(author=>{\r\n\t\t\tj = (i+1)*entrywidth > legendwidth ? j+1 : j;\r\n\t\t\ti = (i+1)*entrywidth > legendwidth ? 0 : i+1;\r\n\t\t\treturn `<g transform=translate(${i*entrywidth},${j*entryheight})>\r\n\t\t\t<path d=\"M0,-4 L20,-4\" stroke=\"${obj.color.dom2range(author)}\" stroke-width=\"5px\"></path>\r\n\t\t\t<text x=\"25\" y=\"0\" font-weight=\"bold\" font-size=\"12px\">${author}</text>\r\n\t\t\t</g>`\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// Try to fit the legend entries in one row. Limit username to 8 characters?\t\t\r\n\t\tobj.node.querySelector(\"g.legend\").appendChild(svg2element(`<g>${[unsaved].concat(entries)}</g>`));\r\n\t\tobj.node.querySelector(\"g.treeelements\").setAttribute(\"transform\", `translate(0,${(j+2)*entryheight})`);\r\n\t} // updatelegend\r\n\t\r\n\t\r\n\tshowtooltip(nodeobj){\r\n\t\t// Get the aliases. Don't show the tooltip if there is no other aliases.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\r\n\t\tlet g = nodeobj.node.querySelector(\"g.tooltip\")\r\n\t\tg.innerHTML = \"\";\r\n\t\t\r\n\t\t\r\n\t\tlet aliases = nodeobj.connections.group.tags;\r\n\t\tif(aliases.length > 1){\r\n\t\t\t// Ok - there has to be a square, and it should be positioned near the text.\r\n\t\t\t\r\n\t\t\tlet textnodes = aliases.map((alias,i)=>svg2element(`<text x=\"10\" y=\"${(i+1)*15}\" font-weight=\"bold\" font-size=\"12px\">${alias.author}: ${alias.name}</text>`))\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tlet tooltip = svg2element(`<g>\r\n\t\t\t<rect x=\"0\" y=\"0\" width=\"100\" height=\"${textnodes.length*15+10}\" fill=\"white\" stroke-width=\"2\" stroke=\"black\" rx=\"5px\"></rect></g>`)\r\n\t\t\t\r\n\t\t\tg.appendChild(tooltip)\r\n\t\t\ttextnodes.forEach(n=>tooltip.appendChild(n))\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tlet w = textnodes.reduce((acc,n)=>{\r\n\t\t\t\treturn Math.max(acc, n.getBBox().width)\r\n\t\t\t},0) + 20; // reduce\r\n\t\t\t\r\n\t\t\ttooltip.querySelector(\"rect\").setAttribute(\"width\", w);\r\n\t\t\ttooltip.setAttribute(\"transform\", `translate(${nodeobj.x - w < 0 ? 0 : nodeobj.x - w},${nodeobj.y - 10})`);\r\n\t\t\t\r\n\t\t} // if\r\n\t\t\r\n\t} // showtooltip\r\n\t\r\n\thidetooltip(nodeobj){\r\n\t\tlet g = nodeobj.node.querySelector(\"g.tooltip\")\r\n\t\tg.innerHTML = \"\";\r\n\t} // hidetooltip\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tmoveto(connections){\r\n\t\t// I want to move to the group which contains only tasks given by \"nodeobj.connections.group.members\", but I also want to show all the groups within that grop.\r\n\t\tconsole.log(\"Move to\", connections.group.members)\r\n\t} // moveto\r\n\t\r\n\tcrossreferencein(taskids){\r\n\t\t// Dummy method that takes in taskids and allows for them to be highlighted on a different plot.\r\n\t} // crossreferencein\r\n\t\r\n\tcrossreferenceout(taskids){\r\n\t\t// Dummy method to signal end of cross reference\r\n\t} // crossreferenceout\r\n\t\r\n} // TreeKnowledge","import { svg2element } from \"../../helpers.js\";\r\n\r\nlet template = `<circle r=\"5\" fill=\"cornflowerblue\"></circle>`; // template\r\n\r\nexport default class MiniMapIcon{\r\n    constructor(item){\r\n\t\tlet obj = this;\r\n\t\tobj.item = item;\r\n\t\tobj.node = svg2element(template);\r\n\t} // constructor\r\n\t\r\n\r\n\tupdate(xscale, yscale, highlight){\r\n\t\t// The scales must be given from the parent, and the icon uses them to position itself.\r\n\t\t// The scales should incorporate both the panning and zooming adjustements needed.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Update the position of the circle with the center point of the DOM card.\r\n\t\tlet itemClientRect = obj.item.node.getBoundingClientRect();\r\n\t\t\t\r\n\t\tlet x = itemClientRect.left + itemClientRect.width/2;\r\n\t\tlet y = itemClientRect.top + itemClientRect.height/2;\r\n\t\t\r\n\t\tobj.node.setAttribute(\"cx\", xscale.dom2range( x ));\r\n\t\tobj.node.setAttribute(\"cy\", yscale.dom2range( y ));\r\n\t\t\r\n\t\t\r\n\t\tobj.node.setAttribute(\"fill\", highlight ? \"orange\" : \"cornflowerblue\");\r\n\t\tobj.node.setAttribute(\"display\", obj.item.node.style.display );\r\n\t\t\r\n\t\t\r\n\t\t// Support for groups.\r\n\t\tif(obj.item.members){\r\n\t\t\t// The area of the group of n items should be n times larger?\r\n\t\t\tobj.node.setAttribute(\"r\", Math.sqrt( obj.item.members.length )*5)\r\n\t\t}; // if\r\n\t} // update\r\n\t\r\n\t\r\n\thighlight(){\r\n\t\tlet obj = this;\r\n\t\tobj.node.setAttribute(\"fill\", \"orange\");\r\n\t} // highlight\r\n\t\r\n\tunhighlight(){\r\n\t\tlet obj = this;\r\n\t\tobj.node.setAttribute(\"fill\", \"cornflowerblue\");\r\n\t} // unhighlight\r\n\t\r\n} // MiniMapIcon","import { svg2element, isWithinBoundingClientRect } from \"../../helpers.js\";\r\n\r\nlet template = `<rect class=\"current\" x=\"50\" y=\"10\" width=\"150\" height=\"50\" fill=\"black\" opacity=\"0.2\"></rect>`\r\n\r\nexport default class MiniMapViewRect{\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.node = svg2element(template);\r\n\t\t\r\n\t\t\r\n\t\t// Make it draggable.\r\n\t\tlet active, clickedItemOffset;\r\n\t\r\n\t\r\n\t\tobj.node.onmousedown = function(e){\r\n\t\t\tactive = true;\r\n\t\t\t\r\n\t\t\t// Correcting for clicked position within item.\r\n\t\t\tlet itemClientRect = obj.node.getBoundingClientRect();\r\n\t\t\tclickedItemOffset = {\r\n\t\t\t\tx: itemClientRect.x - e.clientX,\r\n\t\t\t\ty: itemClientRect.y - e.clientY\r\n\t\t\t} // clickedItemOffset\r\n\t\t} // onmousedown\r\n\t\tobj.node.onmousemove = function(e){\r\n\t\t\tif(active){\r\n\t\t\t\t// Convert the mouse position into the position within the parent SVG. ASSUME that the parent element is the SVG.\r\n\t\t\t\tlet svgClientRect = obj.node.parentElement.getBoundingClientRect();\r\n\t\t\t\t\r\n\t\t\t\t// Check if the mouse left the svg.\r\n\t\t\t\t\r\n\t\t\t\tif(isWithinBoundingClientRect({x: e.clientX, y: e.clientY}, svgClientRect)){\r\n\t\t\t\t\tlet x = e.clientX - svgClientRect.x + clickedItemOffset.x;\r\n\t\t\t\t\tlet y = e.clientY - svgClientRect.y + clickedItemOffset.y;\r\n\t\t\t\t\t\r\n\t\t\t\t\tobj.node.setAttribute(\"x\", x);\r\n\t\t\t\t\tobj.node.setAttribute(\"y\", y);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Now all the DOM items should be moved.\r\n\t\t\t\t\tobj.reposition();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactive = false;\r\n\t\t\t\t} // if\r\n\t\t\t\t\r\n\t\t\t} // if\r\n\t\t} // mousemove\r\n\t\tobj.node.onmouseup   = function(){\r\n\t\t\tactive = false;\r\n\t\t} // onmouseup\r\n\t\t\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\tinit(xscale, yscale){\r\n\t\tlet obj = this;\r\n\t\t// Reposition the viewrect back to the origin.\r\n\t\tobj.node.setAttribute(\"x\",  xscale.dom2range(0) );\r\n\t\tobj.node.setAttribute(\"y\",  yscale.dom2range(0) );\r\n\t} // init\r\n\t\r\n\t\r\n\t// The data to position the icons comes from boundingClientRect, which is the positions on hte screen. In that case\r\n\tupdate(xscale, yscale){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The viewrect represents the window.\r\n\t\tlet width = xscale.dom2range(window.innerWidth) - xscale.dom2range(0);\r\n\t\tlet height = yscale.dom2range(window.innerHeight) - yscale.dom2range(0);\r\n\t\t\r\n\t\tobj.node.setAttribute(\"width\",  width )\r\n\t\tobj.node.setAttribute(\"height\", height )\r\n\t} // update\r\n\t\r\n\t// Dummy function that gets changed by the minimap;\r\n\treposition(){} // reposition\r\n\t\r\n} // MiniMapViewRect","import {html2element} from \"../../helpers.js\";\r\n\r\n// A custom select menu to facilitate correlation selection in menus.\r\n\r\nlet css = {\r\n\tmenu: `\r\n\t  background-color: white;\r\n\t  border: 2px solid black;\r\n\t  border-radius: 5px;\r\n\t  display: none; \r\n\t  position: absolute;\r\n\t  max-height: 120px;\r\n\t  overflow-y: auto;\r\n\t`,\r\n\t\r\n\tul: `\r\n\t  list-style-type: none;\r\n\t  font-size: 10px;\r\n\t  font-weight: bold;\r\n\t  padding-left: 4px;\r\n\t  padding-right: 4px;\r\n\t`\r\n}; // css\r\n\r\n\r\n\r\nlet template = `\r\n<div class=\"variable-select-menu\" style=\"${ css.menu }\">\r\n  <ul style=\"${ css.ul }\">\r\n  </ul>\r\n</div>\r\n`;\r\n\r\n\r\n// Differentite between an x and a y one.\r\n\r\nexport default class CorrelationsMenu{\r\n\t\r\n\tconstructor(axis){\r\n\t\tlet obj = this;\r\n\t\tobj.node = html2element(template);\r\n\t\t\r\n\t\t// axis = 0/1 for x/y\r\n\t\tobj.axis = axis;\r\n\t} // constructor\r\n\t\r\n\t\r\n\t// Just update with variables here? No, but update with CORRELATIONS!!!!\r\n\tupdate(correlations){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// First remove all li.\r\n\t\tlet ul = obj.node.querySelector(\"ul\");\r\n\t\twhile (ul.lastChild) {\r\n\t\t\tul.removeChild(ul.lastChild);\r\n\t\t} // while\r\n\t\t\r\n\t\t\r\n\t\t// Now add in the needed li objects.\r\n\t\tcorrelations.forEach(c=>{\r\n\t\t\tlet sign = c[obj.axis] > 0 ? \"+\" : \"-\"\r\n\t\t\tlet li = html2element( `<li class=\"hover-highlight\">${sign} ${c.name}</li>` );\r\n\t\t\tul.appendChild(li);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Color it.\r\n\t\t\tli.style.backgroundColor = green( Math.abs(c[obj.axis]) );\r\n\t\t\t\r\n\t\t\t// On click the menu should updat ethe current selection, close itself, and launch the appropriate effect.\r\n\t\t\tli.addEventListener(\"click\", event=>{\r\n\t\t\t\t// If event propagation is stopped here then additional functionality can't be attached to the menu.\r\n\t\t\t\tobj.current = c.name;\r\n\t\t\t\tobj.hide();\r\n\t\t\t\t\r\n\t\t\t\tobj.onvariableselect(c);\r\n\t\t\t}) // addEventListener\r\n\t\t})\r\n\t} // update\r\n\t\r\n\t\r\n\ttoggle(correlations, p){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tif(obj.node.style.display==\"none\"){\r\n\t\t\tobj.update(correlations);\r\n\t\t\t\r\n\t\t\tif(obj.axis==0){\r\n\t\t\t\tobj.node.style.left = p[0] + \"px\";\r\n\t\t\t\tobj.node.style.bottom = p[1] + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tobj.position(p);\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t\tobj.show();\r\n\t\t} else {\r\n\t\t\tobj.hide();\r\n\t\t} // if\r\n\t\t\r\n\t} // toggle\r\n\t\r\n\t\r\n\tposition(p){\r\n\t\tlet obj = this;\r\n\t\tobj.node.style.left = p[0] + \"px\";\r\n\t\tobj.node.style.top = p[1] + \"px\";\r\n\t} // position\r\n\t\r\n\tshow(){\r\n\t\tlet obj = this;\r\n\t\tobj.node.style.display = \"inline-block\";\r\n\t} // show\r\n\t\r\n\thide(){\r\n\t\tlet obj = this;\r\n\t\tobj.node.style.display = \"none\";\r\n\t} // hide\r\n\t\r\n\t// dummy method.\r\n\tonvariableselect(variable){}\r\n\t\r\n} // CorrelationsMenu\r\n\r\n\r\n\r\n\r\nfunction green(t){\r\n\t// t should be between 0 and 1.\r\n\tt = t > 1 ? 1 : t;\r\n\tt = t < 0 ? 0 : t;\r\n\t\r\n\tlet r = Math.round( 247/2*(Math.cos(t*Math.PI)+1) );\r\n\tlet g = Math.round( 252*(Math.cos(t*2/5*Math.PI)) );\r\n\tlet b = Math.round( 245-(245-28)*t );\r\n\t\r\n\treturn `rgb(${r},${g},${b})`\r\n} // green\r\n\r\n","import {svg2element, unique} from \"../../helpers.js\";\r\nimport CorrelationsMenu from \"./CorrelationsMenu.js\";\r\n\r\n/*\r\nHandle the variable->arrangement and arrangement->variable alleyways.\r\n\r\n\r\n\r\n\r\nApproaches: menu vs figure based visualisation and interaction.\r\n\r\nMENU:\r\n+ : qualitative, intuitive interaction, no additional mode, no clutter\r\n- : no cross correlations against both axes\r\n\r\n\r\nFIGURE:\r\n+ : correlations visualised\r\n- : non-intuitive interaction, additional mode, clutter, quantitative correlations\r\n\r\n\r\nA combination of both? Where the figure is brought up, but the menu is used fo rthe interaction? Maybe the Correlations menu should just have a figure attached? So that it's a small widget? But that is a figure mode then....\r\n\r\nJust stick to the menu for now, and figure something out later...\r\n\r\nMaybe click on the axes to show the menu, and that shows the figure? And then when a selection is made the figure disappears??\r\n\r\n\r\n\r\nIf the Spatial correlations are on the sketchpad svg in the background then they are not clickable. So maybe it mag=kes sene to place them on separate svg elements, and put them into the HUD html. Then they can be positioned via css properties as opposed to explicitly.\r\n\r\n*/\r\n\r\n\r\nlet template = `\r\n<g transform=\"translate(10,390)\">\r\n  <path class=\"horizontal\" stroke=\"grey\" stroke-width=\"3\" stroke-linecap=\"round\" fill=\"none\"></path>\r\n  <text class=\"correlation-label horizontal\"></text>\r\n  \r\n  <path class=\"vertical\" stroke=\"grey\" stroke-width=\"3\" stroke-linecap=\"round\" fill=\"none\"></path>\r\n  <text class=\"correlation-label vertical\" transform=\"rotate(-90)\"></text>\r\n</g>\r\n`;\r\n\r\n\r\n// The paths only depend on how close together the arrows should be.\r\nlet arrowheadwidth = 15; // arrowheadwidth\r\nlet arrowheadlength = 20; // arrowheadlength\r\nlet length = 30; // whole arrow length\r\n\r\nlet relativeHorizontalArrow = `\r\n  l${length},0 \r\n  m-${arrowheadlength},-${arrowheadwidth/2} \r\n  c 0,0 ${arrowheadlength/6},${arrowheadwidth/2} ${arrowheadlength},${arrowheadwidth/2} \r\n  m-${arrowheadlength},${arrowheadwidth/2}\r\n  c 0,0 ${arrowheadlength/6},-${arrowheadwidth/2} ${arrowheadlength},-${arrowheadwidth/2}`;\r\nlet relativeVerticalArrow = `\r\n  l0,-${length} \r\n  m-${arrowheadwidth/2},${arrowheadlength}\r\n  c 0,0 ${arrowheadwidth/2},-${arrowheadlength/6} ${arrowheadwidth/2},-${arrowheadlength}\r\n  m${arrowheadwidth/2},${arrowheadlength}\r\n  c 0,0 -${arrowheadwidth/2},-${arrowheadlength/6} -${arrowheadwidth/2},-${arrowheadlength}`;\r\n\r\nexport default class SpatialCorrelations{\r\n\t\r\n  // offset from axes origin point\r\n  xoffset = 300\r\n  yoffset = 300\r\n\t\r\n  constructor(){\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\tobj.node = svg2element(template);\r\n\t\r\n\tobj.th = obj.node.querySelector(\"text.horizontal\");\r\n\tobj.tv = obj.node.querySelector(\"text.vertical\");\r\n\t\r\n\t\r\n\tobj.th.onclick = function(){console.log(\"Hello Horizontal!\")};\r\n\tobj.tv.onclick = function(){console.log(\"Hello Vertical!\")};\r\n\t\r\n\t// The variables need to include undefined/unknown, and that is the default selection everytime when the user doesn't specifically click on the menu. Every interaction should revert the menu selection back to unknown.\r\n\tobj.yvariable = \"Unknown\";\r\n\tobj.xvariable = \"Unknown\";\r\n\t\r\n\t\r\n\tobj.xmenu = new CorrelationsMenu(0);\r\n\tobj.ymenu = new CorrelationsMenu(1);\r\n  \r\n  } // constructor\r\n  \r\n  update(){\r\n\tlet obj = this;\r\n\t  \r\n\tlet textmargin = 5; // offset between arrow and text\r\n\t  \r\n\tobj.node.querySelector(\"path.horizontal\").setAttribute(\"d\", `M${obj.xoffset - length},-${arrowheadwidth/2} ${relativeHorizontalArrow}`)\r\n  \r\n    obj.th.innerHTML = clipstring( obj.xvariable );\r\n    obj.th.setAttribute(\"x\", obj.xoffset - length - obj.th.getBoundingClientRect().width - textmargin )\r\n    obj.th.setAttribute(\"y\", -arrowheadwidth/2 + textmargin)\r\n  \r\n  \r\n    \r\n    obj.node.querySelector(\"path.vertical\").setAttribute(\"d\", `M${arrowheadwidth/2},-${obj.yoffset - length} ${relativeVerticalArrow}`)\r\n  \r\n    obj.tv.innerHTML = clipstring( obj.yvariable );\r\n    obj.tv.setAttribute(\"x\", obj.yoffset - length - obj.tv.getBoundingClientRect().height - textmargin )\r\n    obj.tv.setAttribute(\"y\", arrowheadwidth/2 + 3)\r\n\t  \r\n  } // update\r\n  \r\n  \r\n  position(p){\r\n\tlet obj = this;\r\n\tobj.node.setAttribute(\"transform\", `translate(${p[0]},${p[1]})`)\r\n  } // position\r\n  \r\n  \r\n  calculate(d){\r\n\tlet obj = this;\r\n\t\r\n\t// When collecting the scores we're banking on the fact that the originally created items are never destroyed. Only the groups get destroyed when no longer needed. Items are always accessed in the same order.\r\n\t\r\n\tlet os = obj.ordinalscores(d);\r\n\tlet cs = obj.categoricalscores(d);\r\n\t\r\n\treturn os.concat(cs);\r\n  } // calculate\r\n  \r\n  \r\n  ordinalscores(d){\r\n\tlet obj = this;\r\n\t\r\n\t// Calculate correlation between spatial and ordinal.\r\n\tlet scores = d.ordinals.map(ordinal=>{\r\n\t\t\r\n\t\tlet sp = [\r\n\t\t  spearman( d.spatial[0], ordinal ),\r\n\t\t  spearman( d.spatial[1], ordinal )\r\n\t\t]\r\n\t\t\r\n\t\tsp.name = ordinal.name\r\n\t\treturn sp\r\n\t}) // forEach\r\n\t\r\n\treturn scores\r\n  } // ordinalscores\r\n  \r\n\r\n  \r\n  categoricalscores(d){\r\n\tlet obj = this;\r\n\t\r\n\tlet scores = d.categoricals.map(categorical=>{\r\n\t\t\r\n\t\t// The categorical values need to first be mapped to ordinal values. The mapping in the x and y directions may be different.\r\n\t\tlet mapping = categoricalmapping(d.spatial[0], d.spatial[1], categorical);\r\n\t\t\r\n\t\tlet sp = [\r\n\t\t  spearman( d.spatial[0], categorical.map(c=>mapping[c].x) ),\r\n\t\t  spearman( d.spatial[1], categorical.map(c=>mapping[c].y) )\r\n\t\t]\r\n\t\t\r\n\t\tsp.name = categorical.name;\r\n\t\t\r\n\t\t// Provide the mapping also if it needs to be used outside.\r\n\t\tsp.mapping = mapping;\r\n\t\treturn sp\r\n\t}) // forEach\r\n\t\r\n\treturn scores\r\n  } // get categoricalscores\r\n  \r\n} // SpatialCorrelations\r\n\r\n\r\n\r\nfunction clipstring(s){\r\n  let n_max = 15;\r\n  return s.substr(0, n_max) + (s.length > n_max ? \"...\" : \"\");\r\n} // clipstring\r\n\r\n\r\n\r\n\r\nfunction categoricalmapping(x, y, v){\r\n\t// This is the mapping of a single metadata variable to numerical values. All that is needed are the x,y, and metadata values.\r\n\tlet uniquevals = unique(v) // unique\r\n\r\n\t// Just assign all unique value their median point no? Or just return hte appropriate dictionary?\r\n\treturn uniquevals.reduce(function(acc, uniqueval){\r\n\t\t\r\n\t\t\r\n\t\tlet xpos = x.filter(function(_x,i){return v[i] == uniqueval})\r\n\t\tlet ypos = y.filter(function(_y,i){return v[i] == uniqueval})\r\n\t\t\r\n\t\t\r\n\t\tacc[uniqueval] = {\r\n\t\t\tx: median(xpos),\r\n\t\t\ty: median(ypos)\r\n\t\t}\r\n\t\treturn acc\r\n\t\t\r\n\t}, {}) // reduce\r\n} // categoricalmapping\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n// ACTUAL STATISTICS FUNCTIONS\r\n\r\nfunction spearman(x,y){\r\n  // The inputs are two variable arrays, which are expected to also have a 'mu' and 'sigma' property.\r\n  // Get Spearman's rank correlation scores for the order in the x direction.\r\n  // (https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient)\r\n  // The coefficient is\r\n  // covariance (x_rank, y_rank ) / ( sigma(rank_x) sigma(rank_y) )\r\n  \r\n  // First precalculate some statistics:\r\n  x = calcStatistics(x);\r\n  y = calcStatistics(y);\r\n  return covariance(x,y) / ( x.sigma*y.sigma )\r\n} // spearman\r\n\r\nfunction calcStatistics(A){\r\n  // Give array A the mean, standard deviation, and name properties.\r\n  A.mu = mean(A);\r\n  A.sigma = variance(A)**0.5;\r\n  A.sigma = A.sigma == 0 ? Infinity : A.sigma;\r\n  return A\r\n} // variable\r\n\r\n\r\nfunction covariance(x,y){\r\n\t// 'd' is an array of observations. Calculate the covariance between x and the metadata variable.\r\n\tlet N = x.length\r\n\tlet s = 0;\r\n\tfor(var i=0; i< N; i++) {\r\n\t\ts += ( x[i] - x.mu )*( y[i] - y.mu );\r\n\t}\r\n\treturn 1/(N - 1)*s\r\n} // covariance\r\n\r\nfunction variance(x){\r\n\t// variance is a special case of covariance.\r\n\treturn covariance(x,x)\r\n} // variance\r\n\r\nfunction median(numbers) {\r\n\t// https://stackoverflow.com/questions/45309447/calculating-median-javascript\r\n    let sorted = numbers.slice().sort((a, b) => a - b);\r\n    let middle = Math.floor(sorted.length / 2);\r\n\r\n    if (sorted.length % 2 === 0) {\r\n        return (sorted[middle - 1] + sorted[middle]) / 2;\r\n    }\r\n\r\n    return sorted[middle];\r\n} // median\r\n\r\nfunction mean(d){\r\n\treturn sum(d)/d.length;\r\n} // mean\r\n\r\nfunction sum(objarray, accessor){\r\n\tlet _accessor = accessor ? accessor : function(d){return d};\r\n\treturn objarray.reduce((acc,obj)=>{\r\n\t\treturn acc += _accessor(obj)\r\n\t},0)\r\n} // sum\r\n\r\n\r\n\r\nfunction range(A){\r\n\t// Math.min wants separate inputs.\r\n\treturn A.reduce((acc, v)=>{\r\n\t\tacc[0] = v < acc[0] ? v : acc[0]\r\n\t\tacc[1] = v > acc[1] ? v : acc[1]\r\n\t\treturn acc\r\n\t}, [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY])\r\n} // min\r\n","import { svg2element, scaleLinear, isWithinBoundingClientRect } from \"../../helpers.js\";\r\nimport MiniMapIcon from \"./MiniMapIcon.js\";\r\nimport MiniMapViewRect from \"./MiniMapViewRect.js\";\r\nimport SpatialCorrelations from \"../arrangement/SpatialCorrelations.js\";\r\n/*\r\nThe initial arrangement is not the problem of this module. This module just visualises the current arrangement, and allows global navigation.\r\n\r\nThe panning/zooming should be made available on hte background also.\r\n*/\r\nconst template = `<svg style=\"border: 2px solid gainsboro; display: block;\">\r\n  <g class=\"icons\"></g>\r\n</svg>`; // template\r\n\r\n\r\n// All the data should be on the minimap at all times, including any rearranged items. That means that the scale domain may have to be redone every time there is a rearrangement event.\r\n\r\n\r\nexport default class MiniMap{\r\n\t\r\n\twidth = 300;\r\n\theight = 200;\r\n\t_icons = [];\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.node = svg2element(template);\r\n\t\tobj.node.setAttribute(\"width\", obj.width);\r\n\t\tobj.node.setAttribute(\"height\", obj.height);\r\n\t\t\r\n\t\t\r\n\t\t// The rectangle should have the proportions of the screen.\r\n\t\t\r\n\t\t\r\n\t\t// Abstract the viewrect out??\r\n\t\tobj.viewrect = new MiniMapViewRect();\r\n\t\tobj.node.appendChild(obj.viewrect.node)\r\n\t\t\r\n\t\t// Scrolling is added to the the rect externally!\r\n\t\t\r\n\t\t// Create the scales to map the necessary range to the size of the svg.\r\n\t\tobj.xscale = new scaleLinear();\r\n\t\tobj.xscale.range = [0, obj.width];\r\n\t\t\r\n\t\tobj.yscale = new scaleLinear();\r\n\t\tobj.yscale.range = [0, obj.height];\r\n\t\t\r\n\t\t\r\n\t\t// Maybe it's just simpler to keep re-rendering the MiniMap? So the update doesn't have to be called everywhere?\r\n\t\t// Maybe not, because a lot of the time it's just the re-centering of hte data that is needed?\r\n\t\t\r\n\t\t\r\n\t\t// Let the minimap host the correlations.\r\n\t\t\r\n\t\t// CORRELATIONS\r\n\t\t// The metadata is passed in with the items themselves - or should it be created here instead? Maybe that's a good approach, then inside the module need not think about ordinals and categoricals.\r\n\t\t\r\n\t\t/* Requirements:\r\n\t\t   - when the items are moving the axes variables should be `Unknown'\r\n\t\t   - correlations only updated when the hud elements are clicked\r\n\t\t   - Maybe it can all be merged to the minimap? Reduces some clutter!\r\n\t\t*/\r\n\t\tobj.correlations = new SpatialCorrelations();\r\n\t\tobj.node.appendChild(obj.correlations.node);\r\n\t\tobj.correlations.position([5, obj.height - 5]);\r\n\t\tobj.correlations.xoffset = obj.width - 15;\r\n\t\tobj.correlations.yoffset = obj.height - 15;\r\n\t\tobj.correlations.update();\r\n\t\t// The correlations text is incorrect at first, because it relies on boundingClientRect to get the width of the text...\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\thighlight(taskids){\r\n\t\t// Go through the icons and light up the ones with th eappropriate item.\r\n\t\tlet obj = this;\r\n\t\tobj.icons.forEach(icon=>{\r\n\t\t\t// Some icons represent groups, which have multiple taskIds.\r\n\t\t\tif(icon.item.members){\r\n\t\t\t\t// This is a group - highlight it if any/all elements are part of it?\r\n\t\t\t\tlet memberids = icon.item.members.map(memberitem=>memberitem.task.taskId);\r\n\t\t\t\tif(memberids.some(id=>taskids.includes(id))){\r\n\t\t\t\t\ticon.highlight();\r\n\t\t\t\t} // if\r\n\t\t\t} else {\r\n\t\t\t\tif(taskids.includes(icon.item.task.taskId)){\r\n\t\t\t\t\ticon.highlight();\r\n\t\t\t\t} // if\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t}) // forEach\r\n\t} // highlight\r\n\t\r\n\tunhighlight(){\r\n\t\t// Turn them all off.\r\n\t\tlet obj = this;\r\n\t\tobj.icons.forEach(icon=>{\r\n\t\t\ticon.unhighlight();\r\n\t\t}) // forEach\r\n\t} // unhighlight\r\n\t\r\n\t\r\n\t// icons getter/setter - to dynamically filter out any group sthat are removed.\r\n\tset icons(ic){\r\n\t\tthis._icons = ic;\r\n\t} // set icons\r\n\t\r\n\tget icons(){\r\n\t\treturn this._icons.filter(icon=>{\r\n\t\t\treturn icon.item.node.isConnected ? true : icon.node.remove();\r\n\t\t})\r\n\t} // get icons\r\n\t\r\n\t\r\n\tgetoffset(){\r\n\t    let obj = this;\r\n\t    return [ obj.xscale.range2dom( obj.viewrect.node.getAttribute(\"x\") ),\r\n\t             obj.yscale.range2dom( obj.viewrect.node.getAttribute(\"y\") ) ];\r\n\t} // getoffset\r\n\t\r\n\t\r\n\t// The groups dynamically added to the workspace must also appear on the minimap.\r\n\tadd(item){\r\n\t\tlet obj = this;\r\n\t\tlet icon = new MiniMapIcon(item);\r\n\t\tobj.node.querySelector(\"g.icons\").appendChild(icon.node); \r\n\t\tobj._icons.push(icon);\r\n\t} // add\r\n\t\r\n\t\r\n\tremove(item){\r\n\t\tlet obj = this;\r\n\t\t// Remove the icon, and the underlying obj.\r\n\t\tlet i = obj.icons.map(icon=>icon.item).indexOf(item);\r\n\t\tobj.icons[i].node.remove()\r\n\t\tobj.icons.splice(i, 1);\r\n\t} // remove\r\n\t\r\n\t\r\n\t// Update the circle representations.\r\n\tupdate(items){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// If items have been given, then change the circles.\r\n\t\tif(items){\r\n\t\t\titems.forEach(item=>{\r\n\t\t\t\tobj.add(item);\r\n\t\t\t}); // forEach\r\n\t\t} // items\r\n\t\t\r\n\t\t\r\n\t\t// New items arrived, the square is resized, and the icons should be positioned. Make the items all fit within the square? Or just map the screen directly onto the minimap? Or just scale the square to what can be seen on the main screen?\r\n\t\t\r\n\t\t\r\n\t\t// Redraw minimap\r\n\t\tobj.centerdata();\r\n\t\tobj.viewrect.init(obj.xscale, obj.yscale);\r\n\t\tobj.render();\r\n\t\t \r\n\t} // update\r\n\t\r\n\t\r\n\tcenterdata(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The minimap should show all the items at all times, thus the minimap domain needs to span all the positions of the items in both the x and y dimensions, while preserving AR=1. The data AR won't be the same as the minimap AR, and therefore the data domain is recalculated to fit into the minimap square.\r\n\t\t\r\n\t\tlet domains = calculateInitialMinimapDomain(obj.icons.map(icon=>icon.item));\r\n\t\t\r\n\t\t// The maximum domain AR must be selected to accomodate all the data. Then the domains can be centered on hte minimap.\r\n\t\tlet xdiff = domains.x[1] - domains.x[0];\r\n\t\tlet ydiff = domains.y[1] - domains.y[0];\r\n\t\tlet u = 1.1*Math.max( xdiff / obj.width, ydiff / obj.height )\r\n\t\t\r\n\t\t// Reset the scale domains to center the data.\r\n\t\tobj.xscale.domain = [domains.x[0] + xdiff/2 - u*obj.width/2, domains.x[0] + xdiff/2 + u*obj.width/2];\r\n\t\tobj.yscale.domain = [domains.y[0] + ydiff/2 - u*obj.height/2, domains.y[0] + ydiff/2 + u*obj.height/2];\r\n\t\t\r\n\t} // centerdata\r\n\t\r\n\t\r\n\trender(){\r\n\t\t// Redraw the minimap. Called after the user rearranges the items.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Resize the viewrect to the right aspect ratio and size.\r\n\t\tobj.viewrect.update(obj.xscale, obj.yscale);\r\n\t\tlet r = obj.viewrect.node.getBoundingClientRect();\r\n\t\t\r\n\t\t// Redo the icons if they are active.\r\n\t\tobj.icons.forEach(icon=>{\r\n\t\t\ticon.update(obj.xscale, obj.yscale);\r\n\t\t}) // forEach\r\n\t} // render\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n} // Minimap\r\n\r\n\r\n\r\nfunction calculateInitialMinimapDomain(items){\r\n\t// The workspace and the minimap have no domain limitations, but the minimap should initially be scaled such that all the points are in view. When zooming the rectangle will then change size when scrolled.\r\n\t\r\n\tlet bodyClientRect = document.body.getBoundingClientRect();\r\n\t\r\n\treturn items.reduce((acc,item)=>{\r\n\t\tlet itemClientRect = item.node.getBoundingClientRect();\r\n\t\t\r\n\t\t// Calculate the positions of hte icons based on the center of the item.\r\n\t\tlet minx = itemClientRect.left - bodyClientRect.left;\r\n\t\tlet maxx = itemClientRect.left - bodyClientRect.left + itemClientRect.width;\r\n\t\t \r\n\t\tlet miny = itemClientRect.top - bodyClientRect.top;\r\n\t\tlet maxy = itemClientRect.top - bodyClientRect.top + itemClientRect.height;\r\n\t\t\r\n\t\tacc.x[0] = minx < acc.x[0] ? minx : acc.x[0];\r\n\t\tacc.x[1] = maxx > acc.x[1] ? maxx : acc.x[1];\r\n\t\t\r\n\t\tacc.y[0] = miny < acc.y[0] ? miny : acc.y[0];\r\n\t\tacc.y[1] = maxy > acc.y[1] ? maxy : acc.y[1];\r\n\t\treturn acc\r\n\t}, {\r\n\t\tx: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY], \r\n\t\ty: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY]\r\n\t}) // reduce\r\n} // calculateInitialMinimapDomain","import {svg2element} from \"../../helpers.js\";\r\n\r\n\r\nlet template = `\r\n<polygon class=\"lasso\" points=\"\" style=\"fill: cornflowerblue; stroke: dodgerblue; stroke-width: 2; opacity: 0.4;\"></polygon>\r\n`; // template\r\n\r\n\r\nexport default class Lasso{\r\n\t/* \r\n\t\t`lasso' implements a generic lasso that can be added to svg elements.\r\n\t\r\n\tThe lasso logs the selected points and updates the graphic. If the underlying svg spans across the entire client viewport, then no readjustment of the coordinates is needed.\r\n\t*/\r\n\t\r\n\tconstructor(svg){\r\n\t\t\r\n\t\t// Make reactive??\r\n\t\r\n\t\tlet obj = this;\r\n\t\r\n\t\tobj.svg = svg;\r\n\t\tobj.polygon = svg.appendChild( svg2element(template) );\r\n\t\t\r\n\t\t// An internal boundary is used for all the drawing, and an external boundary is presented to other interested modules. Only the exposed boundary is observable. The exposed boundary is used to determine the lasso selection.\r\n\t\tobj._boundary = [];\r\n\t\tobj.boundary = [];\r\n\r\n\t\t// Should the boundary be stored at all??\r\n\t\tobj.svg.addEventListener(\"mousedown\", function(event){\r\n\t\t\tobj.clearBoundary();\r\n\t\t}) // mousedown\r\n\r\n\t\tobj.svg.addEventListener(\"mousemove\", function(event){\r\n\t\t\tif(obj.active){\r\n\t\t\t\tobj.addBoundaryPoint(event);\r\n\t\t\t\tobj.draw();\r\n\t\t\t} // if\r\n\t\t}) // mousedown\r\n\t\t\r\n\t\tobj.svg.addEventListener(\"mouseup\", function(event){\r\n\t\t\tobj.hide();\r\n\t\t\t\r\n\t\t\t// The bounadry.replace was mobx functionality.\r\n\t\t\tobj.boundary = obj._boundary;\r\n\t\t\tobj.active = false;\r\n\t\t\tobj.svg.style.zIndex = \"\";\r\n\t\t\t\r\n\t\t\t// Dummy function that allows responses.\r\n\t\t\tobj.onend();\r\n\t\t}) // mousedown\r\n\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\n\tclearBoundary(){\r\n\t\tlet obj = this;\r\n\t\tobj._boundary = [];\r\n\t} // clearBoundary\r\n\r\n\taddBoundaryPoint(event){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The svgbox changes if the user scrolls around in the window.\r\n\t\tlet svgbox = obj.svg.getBoundingClientRect();\r\n\t\t\r\n\t\tobj._boundary.push({\r\n\t\t\tx: event.clientX - svgbox.x,\r\n\t\t\ty: event.clientY - svgbox.y\r\n\t\t})\r\n\t\t\r\n\t} // addBoundaryPoint\r\n\t\r\n\tisPointInside(point){\r\n\t\t// Check wheteher the 'point' [pixel coordinates] is within the polygon defined by the points array 'boundary'.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Default answer is no.\r\n\t\tlet isInside = false\r\n\t\t\r\n\t\tlet n = obj.boundary.length\r\n\t\tif(n>2){\r\n\t\t\tfor(let i=1; i<n; i++){\r\n\t\t\t\t// Check whether this edge is being passed when moving from the point to the right. If it passes an even number of edges it's outside, otherwise it's inside.\r\n\t\t\t\tlet p = passesEdge(obj.boundary[i-1], obj.boundary[i], point)\r\n\t\t\t\tisInside = p ? !isInside : isInside\r\n\t\t\t} // for\r\n\t\t\t\r\n\t\t\t// Need to check the same number of edge segments as vertex points. The last edge should be the last and the first point.\r\n\t\t\tlet p = passesEdge(obj.boundary[n-1], obj.boundary[0], point)\r\n\t\t\tisInside = p ? !isInside : isInside\r\n\t\t} // if\r\n\t\t\r\n\t\treturn isInside\r\n\t} // isPointInside\r\n\t\t\r\n\tdraw(){\r\n\t\tlet obj = this;\r\n\t\tobj.polygon.setAttribute(\"points\", obj._boundary.map(p=>`${p.x},${p.y}`).join(\" \"))\r\n\t} // draw\r\n\t\r\n\thide(){\r\n\t\t// Remove the selection drawing.\r\n\t\tlet obj = this\r\n\t\tobj.polygon.setAttribute(\"points\", \"\")\r\n\t} // remove\r\n\t\r\n\t// Dummy function.\r\n\tonend(){} // onend\r\n\t\r\n} // lasso\r\n\r\n\r\n\r\n// A ray casting method to check whether a point is within a polygon or not.\r\nfunction passesEdge(p0, p1, point){\r\n\t// One point needs to be above, while the other needs to be below -> the above conditions must be different.\r\n\t\r\n\tif( (p0.y > point.y) !== (p1.y > point.y) ){\r\n\t\t// One is above, and the other below. Now find if the x are positioned so that the ray passes through. Essentially interpolate the x at the y of the point, and see if it is larger.\r\n\t\tlet x = (p1.x - p0.x)/(p1.y - p0.y)*(point.y - p0.y) + p0.x\r\n\t\treturn x > point.x\r\n\t\t\r\n\t} else {\r\n\t\treturn false\r\n\t} // if\r\n} // checkIntersect\r\n\t","import { html2element } from \"../../helpers.js\";\r\n\r\nlet template = `<div class=\"hudright-menu\">\r\n        <div style=\"float: right;\">\r\n          <div>\r\n\t\t    <input class=\"value\" type=\"text\" placeholder=\"#tag-value\"></input>\r\n\t\t    <button class=\"btn-small v\">📝</button>\r\n\t\t    <button class=\"btn-small x-pos\">📌-x</button>\r\n\t\t    <button class=\"btn-small y-pos\">📌-y</button>\r\n          </div>\r\n        \r\n          <div>\r\n            <input class=\"name\" type=\"text\" placeholder=\"#tag-name\"></input>\r\n\t\t    <button class=\"btn-small submit\">Submit</button>\r\n\t      </div>\r\n        </div>\r\n      </div>`;\r\n\t  \r\n\t  \r\n/* \r\nThe batch form needs to only be able to submit when all on-screen items have the same tag-name in their forms.\r\n\r\nThe tag-name must not be the same as any available tags given to the annotations previously.\r\n*/\r\n\r\nexport default class TagValueBatchForm{\r\n\t\r\n  items = [];\r\n\t\r\n  constructor(){\r\n    let obj = this;\r\n\tobj.node = html2element(template);\r\n\t\r\n\t// name input needs to update the button anytime a char is added or removed. It should alert the user if the name is already assigned to any item.\r\n\tobj.nameInput = obj.node.querySelector(\"input.name\");\r\n\tobj.nameInput.oninput = function(){\r\n\t\t// Name validty is the only condition for the submit to become active. This allows the batch mode to submit simple tags also.\r\n\t\tobj.toggleSubmitButton(obj.namevalid(obj.nameInput.value));\r\n\t} // oninput\r\n\t\r\n\t// This one can capture anything.\r\n\tobj.valueInput = obj.node.querySelector(\"input.value\");\r\n\t\r\n\t\r\n\t// The submit button hould only work when all the items in view have a valid name and value. When will the submit button be updated? It'll have to be updated during the navigation etc. Maybe instead of updating it it can always be on, and it can alert the user with the appropriate message?\r\n\tobj.submitButton = obj.node.querySelector(\"button.submit\");\r\n\tobj.toggleSubmitButton(false);\r\n\tobj.submitButton.onclick = function(e){\r\n\t\tconsole.log(\"Check if anything can be submitted\")\r\n\t\tobj.onscreenitems.forEach(item=>{\r\n\t\t\titem.commenting.tagform.nameinput.value = obj.nameInput.value;\r\n\t\t\titem.commenting.tagform.submitButton.onmousedown(e);\r\n\t\t}) // forEach\r\n\t\tobj.clear();\r\n\t}; // onclick\r\n\t\r\n\t\r\n\t// The buttons need to paste the values to the appropriate\r\n\tobj.valueButton = obj.node.querySelector(\"button.v\");\r\n\tobj.valueButton.onclick = function(){\r\n\t\tlet value = obj.valueInput.value;\r\n\t\tobj.onscreenitems.forEach(item=>{\r\n\t\t\titem.commenting.tagform.valueinput.value = value;\r\n\t\t}); // forEach\r\n\t}; // onclick\r\n\t\r\n\tobj.xPositionButton = obj.node.querySelector(\"button.x-pos\");\r\n\tobj.xPositionButton.onclick = function(){\r\n\t\tobj.onscreenitems.forEach(item=>{\r\n\t\t\tlet itemrect = item.node.getBoundingClientRect();\r\n\t\t\titem.commenting.tagform.valueinput.value = itemrect.x/window.innerWidth;\r\n\t\t}); // forEach\r\n\t}; // onclick\r\n\t\r\n\tobj.yPositionButton = obj.node.querySelector(\"button.y-pos\");\r\n\tobj.yPositionButton.onclick = function(){\r\n\t\tobj.onscreenitems.forEach(item=>{\r\n\t\t\tlet itemrect = item.node.getBoundingClientRect();\r\n\t\t\titem.commenting.tagform.valueinput.value = 1-itemrect.y/window.innerHeight;\r\n\t\t}); // forEach\r\n\t}; // onclick\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  get onscreenitems(){\r\n\tlet obj = this;\r\n\t// Automatically clear the tag forms of off-screen items.\r\n\treturn obj.items.filter(item=>{\r\n\t  if(!item.isonscreen()){\r\n\t\t item.commenting.tagform.clear();\r\n\t  } // if\r\n\t  return item.isonscreen()\r\n\t});\r\n  } // onscreenitems\r\n  \r\n  \r\n\r\n  \r\n  \r\n  clear(){\r\n\tlet obj = this;\r\n\tobj.nameInput.value = \"\";\r\n\tobj.valueInput.value = \"\";\r\n\tobj.toggleSubmitButton(false);\r\n  } // clear\r\n  \r\n  toggleSubmitButton(on){\r\n\t// if on == true then turn the button on, otherwise turn it off.\r\n\tlet obj = this;\r\n    obj.submitButton.style.background = on ? \"black\" : \"gainsboro\";\r\n\tobj.submitButton.style.color = on ? \"white\" : \"black\";\r\n\tobj.submitButton.disabled = !on;\r\n  } // toggleSubmitButton\r\n  \r\n  namevalid(name){\r\n\tlet obj = this;\r\n\treturn !obj.onscreenitems.some(item=>!item.commenting.tagoverview.namevalid(name));\r\n  } // namevalid\r\n} // TagValueBatchForm\r\n\r\n\r\n\r\n\r\n","import { html2element } from \"../helpers.js\";\r\nimport Item from \"./Item.js\";\r\n\r\n\r\nimport TagForm from \"../knowledge/tagging/TagForm.js\";\r\n\r\n/*\r\nGROUPING: \r\nThis item should be support use as a single object, as well as a group. The introduction of a new group, and what happens to the constituent Items is handled outside, so the Item only needs to identify whther it should present itself as a group, or as an individual item. That depends on the number of tasks that come in.\r\n\r\nHow will the data be managed for items in a group? If it follows the Item flow then it will try to load a rendering module, and push data to it, etc.\r\n\r\nIs it still better, in the end, to have a separate group class that takes Items? Ah, but then it will have to either keep making them visible, or pass in the DOM to draw into anyway.\r\n\r\nHave a library that holds all the files, and then distribute them out? The library is an added complication, and if it is the authority on the files it'll have to keep checking all the Items to see which ones still want to keep a copy. Furthermore, the library will have to be passed to the Items so that they can query it.\r\n\r\nJust creating a new Item will require that the sam efiles be reloaded.\r\n\r\nMaybe create a group item, but let it accept Items as the input?\r\n\r\nYes, make a Group class. That will have a viewnode. Then when the usermouses over an element just go to that elements geometry and set it as the group geometry. Then the rendering can be done into the new viewport.\r\n\r\n\r\n\r\n\r\nGroups are always destroyed when something happens to them no? If they are entered they are destroyed, and they can only be exited through the tree? They can be disbanded otherwise.\r\n\r\nBut if you can only navigate out using the tree, then I have to first implement it.\r\nBut the temporary groups should be stored as well - just as the actual groups?\r\n\r\n\r\nMaybe just create all the group items when the data arrives from the server, and store them?? Or create temporary annotations?\r\n\r\nWhen should temporary groups be kept? When it's navigated out of? No, on all navigation tasks the group should be kept, but not otherwise!!\r\n\r\n\r\nENTER/DISSOLVE\r\nButtons should be added to allow the group to be entered or dissolved. maybe no button is needed to enter - a node should appear on the tree. So only dissolve.\r\n\r\n\r\nRELATIVE POSITIONS:\r\nIt's advantageous to store the relative positions of the individual members. Instead of storing them explicitly the group can just store it's original position, and the individual members can just be hidden. When they are revealed again they can jut have their positions adjusted by the delta of the groups current position to the original position. The small multiples are therefore just unpiled in the new location.\r\n\r\n\r\n\r\nSAVING:\r\nThere should be a local and global set of groups. That means that the user must explicitly save his group for it to be submitted to the server. This can be achieved with a tag input.\r\n\r\n\r\nTODO - GROUP INTERACTIONS:\r\nAn initial lasso creates the group.\r\nAdding items (add together, enter tags into form, and dump actual annotations):\r\n  Dragging item over group\r\n  Dragging group over group\r\n  Lassoing group and items\r\n  Lassoing groups\r\n\r\nRemoving items (remove, dump annotations alltogether):\r\n  Long press on preview element?\r\nDon't allow items to be removed when inside a group?\r\n\r\n*/\r\n\r\n\r\nlet icontemplate = `<div class=\"previewicon\"></div>`;\r\n\r\n/* TODO: \r\n\r\n\r\n- entering - only through the navigation tree??\r\n\r\n- dragging other items over it to add them\r\n- lassoing items into existing group??\r\n- in the commenting there should be a tag input with a save button\r\n- the save button should also allow an annotation to be deleted by the author\r\n\r\n\r\n*/\r\n\r\n\r\nexport default class Group extends Item {\r\n\t\r\n  // Main viewport dimensions;\r\n  width = 300;\r\n  height = 200;\r\n  \r\n  icons = [];\r\n  members = [];\r\n  _current = undefined\r\n  \r\n  temporary = true;\r\n\t\r\n  constructor(items, temporary){\r\n\t// `items' is an array of `Items' which should be grouped together. `temporary' is a flag that differentiates the groups created based on server served annotations or the users lasso operation.\r\n\tsuper();\r\n    let obj = this;\r\n\r\n\t// The label should depcit the group name - where does that come from? Maybe it should just be passed in? Maybe as an array of all names for this group.\r\n\tlet head = obj.node.querySelector(\"div.head\")\r\n\thead.querySelector(\"span.label\").innerHTML = \"Group\";\r\n\t\r\n\tlet dissolvebutton = head.querySelector(\"span.dissolve\");\r\n\tdissolvebutton.style.display = \"\";\r\n\tdissolvebutton.onmousedown = function(){\r\n\t\t// The main item checks if the event is a drag, and stops propagation if so. This happens `onmousedown', which is fired before it can become an `onclick' (which presumably includes the `onmouseup' also?)\r\n\t\tobj.dissolve();\r\n\t}; // onclick\r\n\t\r\n\t\r\n\tlet enterbutton = head.querySelector(\"span.enter\");\r\n\tenterbutton.style.display = \"\";\r\n\tenterbutton.onmousedown = function(){\r\n\t\tobj.enter();\r\n\t}; // onclick\r\n\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Maybe just do it the other way around - set a temporary viewnode to the renderer, and allow it to use that?\r\n\t\r\n\t// Store the members. Has to be done after the renderer is established, as one of them will supersede its geometry.\r\n\tobj.current = items[0];\r\n\t\r\n\t\r\n\titems.forEach(item=>{\r\n\t\tobj.addmember(item);\r\n\t}) // map\r\n\t\r\n\tobj.temporary = temporary;\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Add in a Commenting system also.\r\n\tlet commentingnode = obj.node.querySelector(\"div.commenting\");\r\n\tcommentingnode.style.clear = \"both\";\r\n\tcommentingnode.style.paddingTop = \"5px\";\r\n\t\r\n\t// The group should also have a chapter form so that tags for several items can be submitted at once. But no chapters!!!\r\n\tobj.tagform = new TagForm();\t\r\n\tcommentingnode.appendChild(obj.tagform.node);\r\n\t\r\n\t// Hide the time buttons.\r\n\tobj.tagform.node.querySelector(\"button.starttime\").style.display = \"none\";\r\n\tobj.tagform.node.querySelector(\"i\").style.display = \"none\";\r\n\tobj.tagform.node.querySelector(\"button.endtime\").style.display = \"none\";\r\n\t\r\n\t\r\n\t// And now, when the button is clicked loop through the members and call their submit methods.\r\n\tobj.tagform.submit = function(tag){\r\n\t\tobj.members.forEach(member=>{\r\n\t\t\tmember.commenting.TagForm.submit(tag);\r\n\t\t})\r\n\t} // submit\r\n\t\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  set current(item){\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\t// The first time there is no current node to return the renderer node.\r\n\tif(obj._current){\r\n\t\tobj._current.viewnode.appendChild(obj._current.renderer.node);\r\n\t} // if\r\n\t\r\n\t\r\n\t// Should I just try appending the whole renderer node?? But how to return it to its owner afterwards? Maybe here, before the current is swapped out?\r\n\t// Store the current item\r\n\tobj._current = item;\r\n\tobj.renderer = item.renderer;\r\n\tobj.viewnode.appendChild(item.renderer.node);\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Size the view node to the appropriate size.\r\n\t// obj.viewnode.style.height = obj.renderer.view.style.height;\r\n\t// obj.viewnode.style.width = obj.renderer.view.style.width;\r\n\t\r\n\t// Itshould also have immitation controls no? These will have to be added here directly I think.\r\n  } // set current\r\n  \r\n  \r\n  get current(){\r\n\treturn this._current;\r\n  } // get current\r\n  \r\n  \r\n  \r\n  addmember(item){\r\n\tlet obj = this;\r\n\t\r\n\tobj.members.push(item);\r\n\t\r\n\tfunction uncolorAllIcons(){\r\n\t\t// Control the preview appearance.\r\n\t\tobj.previewnode.querySelectorAll(\"div.previewicon\").forEach(icon=>{\r\n\t\t\ticon.style.background = \"gainsboro\";\r\n\t\t}) // forEach\r\n\t} // coordinateIconColors\r\n\t\r\n\t  \r\n\tlet iconobj = {\r\n\t  item: item,\r\n\t  node: html2element(icontemplate)\r\n\t}; // return\r\n\t\t\r\n\t// Give the correct initial color, and append it.\r\n\titem.hide();\r\n\tobj.previewnode.appendChild( iconobj.node );\r\n\t\t\r\n\t\t\r\n\ticonobj.node.onmouseenter = function(){\r\n\t  // Set current object - important for canvas rendering.\r\n\t  obj.current = iconobj.item;\r\n\t\t\t\r\n\t  // coordinate the colors.\r\n\t  uncolorAllIcons();\r\n\t  iconobj.node.style.background = \"gray\";\r\n\t} // onmouseenter\r\n\t\t\r\n\t\t\r\n\t// Long press release.\r\n\tvar pressTimer;\r\n\tfunction releaseMember(){\r\n\t  obj.release(iconobj)\r\n\t} // releaseMember\r\n\t\t\r\n\ticonobj.node.onmouseup = function(){\r\n\t  clearTimeout(pressTimer);\r\n\t  // Clear timeout\r\n\t  return false;\r\n\t}; // onmouseup\r\n\t\t\r\n\ticonobj.node.onmousedown = function(){\r\n\t  // Set timeout\r\n\t  pressTimer = window.setTimeout(releaseMember, 1000);\r\n\t  return false; \r\n\t}; // onmousedown\r\n\t\r\n\tobj.icons.push(iconobj);\r\n\t\r\n\t\r\n\tobj.temporary = true;\r\n\t  \r\n  } // addmember\r\n  \r\n  \r\n  release(iconobj){\r\n\t  // On release the item is placed back where it was collected! Maybe this is a good interaction??\r\n\t  let obj = this;\r\n\t  \r\n\t  \r\n\t  obj.icons.splice(obj.icons.indexOf(iconobj), 1);\r\n\t  obj.members.splice(obj.members.indexOf(iconobj.item), 1);\r\n\t\t\t\r\n\t  iconobj.node.remove();\r\n\t  iconobj.item.node.style.display = \"\";\r\n\t  \r\n\t  obj.current = obj.icons[0].item;\r\n\t  obj.icons[0].node.style.background = \"gray\";\r\n\t  \r\n\t  // The onmove method is already set to update the minimap - just reuse it.\r\n\t  obj.onmove();\r\n\t  \r\n\t  // Always when an item is released the group becomes temporary.\r\n\t  obj.temporary = true;\r\n  } // release\r\n  \r\n  \r\n  // Dummy method\r\n  enter(){} // enter\r\n  \r\n  \r\n  dissolve(){\r\n\t  let obj = this;\r\n\t  // How should this tell the NavigationManager that it should stop tracking it?\r\n\t  // Maybe just allow NavigationManager to filter out any empty groups whenever it tries to access them?\r\n\t  \r\n\t  // Just remove the node! Then where there is an update needed check if the node still exists? Also reinstate the previous items.\r\n\t  obj.node.remove();\r\n\t  \r\n\t  \r\n\t  // When the group is created the items remain at their locations, and are simply hidden. When the group is dissolved an offset is applied to account for th egroup moving. For items that are included individually by dragging and dropping.\r\n\t  obj._current.viewnode.appendChild(obj._current.renderer.node);\r\n\t  \r\n\t  let offset = [\r\n\t    obj.position[0] - obj.origin[0],\r\n\t\tobj.position[1] - obj.origin[1],\r\n\t  ]; // offset\r\n\t  \r\n\t  obj.members.forEach(item=>{\r\n\t\t  item.position = [\r\n\t\t    item.position[0] + offset[0],\r\n\t\t    item.position[1] + offset[1]\r\n\t\t  ]; // position\r\n\t\t  item.node.style.display = \"\";\r\n\t  }) // forEach\r\n\t  \r\n\t  obj.members = [];\r\n\t  \r\n\t  obj.ondissolve();\r\n  } // dissolve\r\n  \r\n  \r\n  // Dmmy method\r\n  ondissolve(){} // ondissolve\r\n  \r\n  \r\n  \r\n  // Custom hide & show methods.\r\n  show(){\r\n\tlet obj = this;\r\n\tobj.members.forEach(item=>item.hide());\r\n\tobj.current = obj._current;\r\n\tobj.node.style.display = \"\";\r\n  } // show\r\n  \r\n  \r\n  hide(){\r\n\tlet obj = this;\r\n\tobj._current.viewnode.appendChild(obj._current.renderer.node);\r\n\tobj.node.style.display = \"none\";\r\n  } // hide\r\n  \r\n} // Group","import TreeKnowledge from \"./tree/TreeKnowledge.js\";\r\nimport MiniMap from \"./minimap/MiniMap.js\";\r\nimport Lasso from \"./lasso/Lasso.js\";\r\nimport TagValueBatchForm from \"../knowledge/tagging/TagValueBatchForm.js\";\r\nimport Group from \"../grouping/Group.js\";\r\nimport { scaleLinear } from \"../helpers.js\";\r\n/*\r\nA drop in class that provides zooming, panning, minimap, and the tree hierarchy navigaton.\r\n*/\r\nexport default class NavigationManager{\r\n\t\r\n  items = []\r\n  _groups = []\r\n  \r\n\t\r\n  scale = 1;\r\n  dx = 0;\r\n  dy = 0;\r\n\t\r\n  constructor(){\r\n    let obj = this;\r\n\t\r\n\t\r\n\tobj.tabletop = document.getElementById(\"tabletop\");\r\n    obj.container = obj.tabletop.querySelector(\"div.scalingwrapper\");\r\n\tobj.sketchpad = document.getElementById(\"sketchpad\");\r\n\t// obj.hudsvg = document.getElementById(\"hudsvg\");\r\n\t\r\n\t// Use transform: scale() to achieve the zoom in and out functionality, and transform: translate(xpx,ypx) for panning. First a default trnasform should be assigned.\r\n\tobj.container.style.transform = `scale(1) translate(0px,0px)`;\r\n\t\r\n\r\n\t// ZOOMING\r\n\tfunction zoom(event) {\r\n\t  event.preventDefault();\r\n\r\n\t  obj.scale += event.deltaY * -0.001;\r\n\r\n\t  // Restrict scale\r\n\t  obj.scale = Math.min(Math.max(.125, obj.scale), 4);\r\n\r\n\t  // Apply scale transform\r\n\t  obj.adjustview();\r\n\t}; // zoom\r\n\t\r\n\t\r\n\t\r\n\t// MINIMAP\r\n\tobj.minimap = new MiniMap();\r\n\tdocument.getElementById(\"minimap\").appendChild(obj.minimap.node);\r\n\t\r\n\tobj.minimap.viewrect.node.onwheel = zoom;\r\n\tobj.minimap.viewrect.reposition = function(){\r\n\t\tlet offset = obj.minimap.getoffset();\r\n\t\tobj.dx = - offset[0] / obj.scale;\r\n\t\tobj.dy = - offset[1] / obj.scale;\r\n\t\t// No minimap update here!!\r\n\t\tobj.container.style.transform = obj.currenttransform();\r\n\t}; // reposition\r\n\t\r\n\t// CORRELATIONS!\r\n\tlet c = obj.minimap.correlations;\r\n\tc.update();\r\n\tdocument.getElementById(\"menucontainer\").appendChild(c.xmenu.node)\r\n\tc.th.onclick = function(){\r\n\t\tlet sp = c.calculate( obj.collectSpatialCorrelationData() );\r\n\t\tlet p = c.th.getBoundingClientRect();\r\n\t\tc.xmenu.toggle(sp, [p.x, window.innerHeight - p.y]);\r\n\t} // onclick\r\n\t\r\n\tdocument.getElementById(\"menucontainer\").appendChild(c.ymenu.node)\r\n\tc.tv.onclick = function(){\r\n\t\tlet sp = c.calculate( obj.collectSpatialCorrelationData() );\r\n\t\tlet p = c.tv.getBoundingClientRect();\r\n\t\tc.ymenu.toggle(sp, [p.x+20, p.y]);\r\n\t} // onclick\r\n\t\r\n\t\r\n\t// Click on an option should arrange by that variable.\r\n\tc.xmenu.onvariableselect = function(correlation){\r\n\t\tc.xvariable = correlation.name;\r\n\t\tc.update();\r\n\t\tobj.arrangeItemsByMetadata(\"x\", correlation);\r\n\t} // onvariableselect\r\n\t\r\n\tc.ymenu.onvariableselect = function(correlation){\r\n\t\tc.yvariable = correlation.name;\r\n\t\tc.update();\r\n\t\tobj.arrangeItemsByMetadata(\"y\", correlation);\r\n\t} // onvariableselect\r\n\t\r\n\t\r\n\t\r\n\t// Click outside of the menu shoul dclose it.\r\n\tobj.sketchpad.addEventListener(\"mousedown\", function(){\r\n\t\tc.xmenu.hide();\r\n\t\tc.ymenu.hide();\r\n\t}) // addEventListener\r\n\t\r\n\tobj.minimap.node.addEventListener(\"mousedown\", function(){\r\n\t\tc.xmenu.hide();\r\n\t\tc.ymenu.hide();\r\n\t}) // addEventListener\r\n\t\r\n\t\r\n\t\r\n\t// BATCH MODE\r\n\tobj.batchform = new TagValueBatchForm();\r\n\tdocument.getElementById(\"batchform\").appendChild(obj.batchform.node);\r\n\tobj.batchform.items = obj.items;\r\n\t\r\n\t\r\n\t// LASSO \r\n\t// Originally the lasso produced a tooltip, with the options: group, tag, close. Some of the tagging is now done through the commenting system. The lasso can still highlight the selection, and the interface based option for spatial value tags can be used for the tagging. Should that just be a menu on the right?\r\n\tobj.lasso = new Lasso(obj.sketchpad);\r\n\t\r\n\tfunction findItemsInLasso(items){\r\n\t\t\r\n\t\tlet selected = items.reduce((acc, item)=>{\r\n\t\t\tlet itemrect = item.node.getBoundingClientRect();\r\n\t\t\tlet miditem = {\r\n\t\t\t\tx: itemrect.x + itemrect.width/2, \r\n\t\t\t\ty: itemrect.y + itemrect.height/2\r\n\t\t\t};\r\n\t\t\tif(item.node.style.display != \"none\" && obj.lasso.isPointInside(miditem)){\r\n\t\t\t\tacc.push(item);\r\n\t\t\t}; // if\r\n\t\t\treturn acc;\r\n\t\t}, [])\r\n\t\t\r\n\t\treturn selected; \r\n\t} // findItemsInLasso\r\n\t\r\n\t\r\n\tobj.lasso.onend = function(){\r\n\t\t// Only visible items should be selectable!!\r\n\t\t\r\n\t\tlet selectedIndividuals = findItemsInLasso( obj.items );\r\n\t\tif(selectedIndividuals.length > 1){\r\n\t\t\tobj.makegroup(selectedIndividuals, true);\r\n\t\t} // if\r\n\t} // lasso.onend\r\n\t\r\n\t\r\n\t// TABLETOP NAVIGATION\r\n\t// The navigation based on hte tabletop. Here the dragging doesn't move the item, but rather a different element. Furthermore, the type of button click should launch a different event.\r\n\tobj.tabletop.onwheel = zoom;\r\n\t\r\n\tlet active, origin, e0;\r\n\tobj.tabletop.onmousedown = function(e){\r\n\t  // Maybe the target event could be logged on the svg?? And then passed up as necessary?\r\n\t  if(e.target == obj.tabletop || e.target == obj.sketchpad){\r\n\t\tswitch(e.which){\r\n\t\t\tcase 1:\r\n\t\t\t  // Left mouse click - panning.\r\n\t\t\t  // e.preventDefault();\r\n\t\t\t  active = true;\r\n\t\t\t  origin = {x: obj.dx, y: obj.dy};\r\n\t\t\t  e0 = e;\r\n\t\t\t  break;\r\n\t\t\tcase 2:\r\n\t\t\t  // Middle mouse click - lasso.\r\n\t\t\t  // Still elevate the svg to allow drawing over the DOM.\r\n\t\t\t  obj.sketchpad.style.zIndex = 1000;\r\n\t\t\t  obj.lasso.clearBoundary();\r\n\t\t\t  obj.lasso.active = true;\r\n\t\t\t  break;\r\n\t\t} // switch\r\n\t\t\r\n\t  } // if\r\n\t} // onmousedown\r\n\t\r\n\tobj.tabletop.onmousemove = function(e){\r\n\t  if(active){\r\n\t\te.preventDefault();\r\n\t\t\r\n\t\t// The elements should move in hte dragged direction.\r\n\t\tobj.dx = origin.x + ( e.clientX - e0.clientX )/obj.scale;\r\n\t\tobj.dy = origin.y + ( e.clientY - e0.clientY )/obj.scale;\r\n\t\t\r\n\t\t// Move the items.\r\n\t\tobj.adjustview();\r\n\t  } // if\r\n\t} // mousemove\r\n\tobj.tabletop.onmouseup = function(){ active = false; } // onmouseup\r\n\tobj.tabletop.onmouseenter = function(){ active = false; } // onmouseenter\r\n\tobj.tabletop.onmouseleave = function(){ active = false; } // onmouseleave\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// KNOWLEDGE TREE\r\n\t// The knowledge tree is added here because it is nominally a navigation element. However the data for it comes from the KnowledgeManager, which will have to interact with the NavigationManager.\r\n\t// So now the hudsvg will just keep on passing the events to the tabletop? Can I just rename the hudsvg to sketchpad? And add other interactible elements to it, e.g. the lasso, and correlations??\r\n\tobj.tree = new TreeKnowledge();\r\n\tobj.sketchpad.querySelector(\"g.tree\").appendChild(obj.tree.node);\r\n\tobj.tree.moveto = function(connections){\r\n\t\t/* Requirements: \r\n\t\t  - temporary groups need to be made visible to be able to dissolve them - should appear whenever possible?\r\n\t\t  - the scope of the items needs to be reduced.\r\n\t\t  - moving to a node is moving to a view with the group visible. So keep the context of the parent. which one? Combined parents?\r\n\t\t  - the currently selected group should be highlighted on the navigation tree.\r\n\t\t  - prevent groups with same members from appearing simultaneously\r\n\t\t\r\n\t\t  - how to deal with the user navigating to the same group twice? Check if a similar group already exists? What to do if a superset group already exists on screen? Just highlight the superset group?\r\n\t\t*/\r\n\t\t\r\n\t\t// When a new item is added to a tree group it should be re-logged as a new temporary group? The groups will also need to keep track of the annotations to make sure only new ones are sent to the server?\r\n\t\t\r\n\t\t\r\n\t\t// The groups that can remain visible are those that are within the set of active tasks.\r\n\t\t\r\n\t\t\r\n\t\tif(connections.group.root){\r\n\t\t\t// All items should become accessible.\r\n\t\t\tobj.groups.forEach(g=>g.hide());\r\n\t\t\tobj.items.forEach(item=>item.show());\r\n\t\t\tobj.tree.currenttasks = [];\r\n\t\t\tobj.hudrefresh();\r\n\t\t} else {\r\n\t\t\t\r\n\t\t\t// Restrict the view to the members of the parent nodes. If one of the parents is the root then all the items should be active tasks.\r\n\t\t\tlet activetasks = connections.parents.reduce(function(acc,parentg){\r\n\t\t\t\treturn parentg.root ? obj.items.map(item=>item.task.taskId) : acc.concat(parentg.members);\r\n\t\t\t}, []); // reduce\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Update the current active tasks in hte tree also. If the root is one of the parents, then don't highlight anything. Maybe don't highlight activetasks, but the selected tasks?\r\n\t\t\tobj.tree.currenttasks = connections.group.members;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tobj.items.forEach(item=>{\r\n\t\t\t\tactivetasks.includes(item.task.taskId) ? item.show() : item.hide();\r\n\t\t\t}) // forEach\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// The items corresponding to the taskIds of the clicked tree node should form a new group.\r\n\t\t\tlet clickedgroupitems = obj.items.filter(item=>{\r\n\t\t\t\treturn connections.group.members.includes(item.task.taskId);\r\n\t\t\t}) // filter\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Hide any groups that contain elements outside the currently active tasks. Maybe just keep all the groups in one array, but tick them to be temporary.\r\n\t\t\tlet clickedgroup\r\n\t\t\tobj.groups.forEach(g=>{\r\n\t\t\t\tif( g.members.map(item=>item.task.taskId).some(taskId=>!activetasks.includes(taskId)) ){\r\n\t\t\t\t\t// A group outside of the current active tasks scope.\r\n\t\t\t\t\tg.hide();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Potentially a group competing with the desired group.\r\n\t\t\t\t\t// A competing group is one that is not hidden, and contains some desired items. The user should not be able to have competing groups on the screen at the same time. Force the current selection, and therefore hide the other groups. They will still be accessible through the tree.\r\n\t\t\t\t\t// But if the group contains all of the clicked items, then it's not competing, then it's a superset group. Still just hide it.\r\n\t\t\t\t\t// However if a group with exactly th edesired membership exists, then just use that.\r\n\t\t\t\t\t// So what happens to tree groups that have a member added? They are turned into a temporary group, and are therefore hidden if navigated to again.\r\n\t\t\t\t\tif( clickedgroupitems.some(item=>g.members.includes(item)) ){\r\n\t\t\t\t\t\tg.hide();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tg.show();\r\n\t\t\t\t\t} // if\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t// A.all is written as !A.some(v=>!B.includes(v))\r\n\t\t\t\t\tif( arrayequal(g.members, clickedgroupitems) ){\r\n\t\t\t\t\t\tclickedgroup = g;\r\n\t\t\t\t\t} // if\r\n\t\t\t\t}; // if\r\n\t\t\t}); // forEach\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif(clickedgroup){\r\n\t\t\t\tclickedgroup.show();\r\n\t\t\t\tobj.hudrefresh();\r\n\t\t\t} else {\r\n\t\t\t\tobj.makegroup(clickedgroupitems, false);\r\n\t\t\t} // if\r\n\t\t} // if\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t} // obj.tree.moveto\r\n\t\r\n\t\r\n\tobj.tree.crossreferencein = function(taskids){\r\n\t\t// Feed it to the minimap\r\n\t\tobj.minimap.highlight(taskids);\r\n\t} // obj.tree.crossreference\r\n\t\r\n\tobj.tree.crossreferenceout = function(){\r\n\t\t// Feed it to the minimap\r\n\t\tobj.minimap.unhighlight();\r\n\t} // obj.tree.crossreference\r\n\t\r\n  } // constructor\r\n \r\n   \r\n  track(item){\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\t// On Drag END chck if item should be placed into group.\r\n\titem.onend = function(p){\r\n\t\t// Check if it should be added to a group.\r\n\t\t// BUT THIS SHOULD ONLY HAPPEN ON MOUSEUP!!\r\n\t\tobj.groups.forEach(g=>{\r\n\t\t\t// Check if the item midpoint is within the group, but only if it's attached. If it's not then the boundingclient rect should come back with all 0s.\r\n\t\t\tlet irect = item.node.getBoundingClientRect();\r\n\t\t\tlet grect = g.node.getBoundingClientRect();\r\n\t\t\tif( \r\n\t\t\t( ((irect.x+irect.width/2) > grect.x) && ((irect.x+irect.width/2) < grect.x+grect.width) ) && \r\n\t\t\t( ((irect.y+irect.height/2) > grect.y) && ((irect.y+irect.height/2) < grect.y + grect.height) ) ){\r\n\t\t\t\tg.addmember(item);\r\n\t\t\t\t\r\n\t\t\t\t// The item itself should be positioned back to the beginning of the drag. When the group is dissolved it allows the item to be positioned based on it's relative position ot the group.\r\n\t\t\t\t// When the group first moved, and the item is added later the results will still be inconsistent...\r\n\t\t\t\titem.position = p;\r\n\t\t\t} // if\r\n\t\t}); // forEach\r\n\t\t\r\n\t\t// Update the minimap and the tree accordingly.\r\n\t\tobj.hudrefresh();\r\n\t\t\r\n\t\t\r\n\t}; // onend\r\n\t\r\n\titem.onmove = function(){\r\n\t\tobj.minimap.update();\r\n\t}; // onmove\r\n\t\r\n\tobj.items.push(item);\r\n\t\r\n\tobj.tree.hierarchy.alltasks.push(item.task);\r\n\t\r\n\t// Make the tree aware of this taskId also. Otherwise it'll hide it when navigating to root.\r\n  } // additem\r\n  \r\n  \r\n  // TABLETOP NAVIGATION\r\n  adjustview(){\r\n\tlet obj = this;\r\n\t// When the view is adjusted the items should also be told to check their sizes, and react is needed.\r\n\tobj.container.style.transform = obj.currenttransform();\r\n\t\r\n\t// Update the minimap\r\n\tobj.minimap.update();\r\n\t\r\n\t// Instruct all the items to check their size.\r\n\tobj.items.forEach(item=>{\r\n\t\titem.checksize();\r\n\t}) // forEach\r\n  } // adjustview\r\n  \r\n  currenttransform(){\r\n\tlet obj = this;\r\n\treturn `scale(${obj.scale}) translate(${obj.dx}px,${obj.dy}px)`;\r\n  }; // gettransform\r\n  \r\n  \r\n  \r\n  /* SPATIAL CORRELATION DATA COLLECTION\r\n  \r\n  \r\n  \r\n  Why not just gather all the metadata at once? And then run through all of it?\r\n  \r\n  For statistics it's favourable to keep all the values of individual variables in single arrays so that calculations of mean and standard deviation etc are simpler.\r\n  \r\n  Still, this can just be made here, and the spatial and metadata values can be prepared together. First collect in the row orientation, and then convert? Maybe that is simplest. And in the reorientation the categoricals can be converted.\r\n  \r\n  TODO\r\n  DONE: 1.) Limit the calculation to on-screen items.\r\n  DONE: 2.) Make sure items aren't accounted for twice\r\n  DONE: 3.) Add tag annotation data.\r\n  \r\n  \r\n  */\r\n  collectSpatialCorrelationData(){\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\tlet onscreenitems = obj.items.filter(item=>item.isonscreen());\r\n\tlet onscreengroups = obj.groups.filter(group=>group.isonscreen());\r\n\t\r\n\t\r\n\t// To see the annotation data that can be used for correlations first all common tags need to be identified. To do that all the relevant items need to be iterated over.\r\n\t// Tags under consideration ar erequired to have a value. But timesteps can have two values. Distinguish between start and end times?\r\n\tlet allrelevantitems = onscreenitems.concat(onscreengroups.reduce((acc,grp)=>{return acc.concat(grp.members)},[]));\r\n\tlet tagCorrelationData = collectAvailableTagCorrelationData(allrelevantitems);\r\n\t\r\n\t\r\n\t\r\n\t// Two kinds of items need to be dealt with - individuals and groups. Grouped items should use the position of the group for the spatial correlations.\r\n\tlet groupedItemData = onscreengroups.reduce((acc,g)=>{\r\n\t\tlet d = g.members.map(item=>{\r\n\t\t\treturn {spatial: {x: g.position[0], y: g.position[1]}, metadata: item.task}\r\n\t\t}); // map\r\n\t\treturn acc.concat(d);\r\n\t}, []) // reduce\r\n\t\r\n\t\r\n\t// Individual items are accounted for in the groups already no? So maybe try to filter them out? Add the third attribute of tag data.\r\n\tlet individualItemData = onscreenitems.map(item=>{\r\n\t\treturn {spatial: {x: item.position[0], y: item.position[1]}, metadata: item.task}\r\n\t})\r\n\t\r\n\t\r\n\tlet d = groupedItemData.concat(individualItemData);\r\n\t\r\n\t\r\n\t// Reorient here, and introduce ordinalvariables and categoricalvariables properties? But it doesn't matter in the end, as long as the categoricals are mapped correctly it's all good?\r\n\tlet spatial = [\r\n\t\tmakeNamedArray(d.map(d_=>d_.spatial.x), \"x\"),\r\n\t\tmakeNamedArray(d.map(d_=>d_.spatial.y), \"y\")\r\n\t]; // spatial\r\n\t\r\n\t\r\n\t\r\n\t// The METADATA COULD BE FILTERED INITIALLY TO REMOVE ANY NONINFORMATIVE VALUES?\r\n\t// Or just prevent non-informative values to be used for correlations - probably better.\r\n\t\r\n\t\r\n\treturn {\r\n\t\tspatial: spatial,\r\n\t\tordinals: obj.ordinals.map(variable=>{\r\n\t\t\t\treturn makeNamedArray(d.map( d_=>d_.metadata[variable]), variable);\r\n\t\t\t}).concat(tagCorrelationData.ordinals),\r\n\t\tcategoricals : obj.categoricals.map(variable=>{\r\n\t\t\t\treturn makeNamedArray(d.map( d_=>d_.metadata[variable]), variable);\r\n\t\t\t}).concat(tagCorrelationData.categoricals)\r\n\t};\r\n  } // collectSpatialCorrelationData\r\n  \r\n  \r\n  arrangeItemsByMetadata(axis, correlation){\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\tlet i_axis = axis == \"x\" ? 0 : 1;\r\n\t\r\n\t// Ok, I should reposition all the items, and all hte groups. The repositioning should be done in the range of positions available, and in a square - so the max range determines the positioning.\r\n\tlet d = obj.items.reduce((acc,item)=>{\r\n\t\t// Go for total range so things spread out a bit if needed. Enforce a minimum range?\r\n\t\tacc.range[0] = Math.min(acc.range[0], parseInt(item.node.style.top), parseInt(item.node.style.left));\r\n\t\tacc.range[1] = Math.max(acc.range[1], parseInt(item.node.style.top), parseInt(item.node.style.left));\r\n\t\t\r\n\t\tlet v_ = item.task[correlation.name];\r\n\t\tlet v = correlation.mapping ? correlation.mapping[v_][axis] : v_;\r\n\t\tacc.domain[0] = Math.min(acc.domain[0], v);\r\n\t\tacc.domain[1] = Math.max(acc.domain[1], v);\r\n\t\treturn acc;\r\n\t}, {\r\n\t\trange: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY], \r\n\t\tdomain: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY]\r\n\t}); // reduce\r\n\t\r\n\t// What do if the variable is categorical? Now the correlation also has the mapping attribute.\r\n\tlet scale = new scaleLinear();\r\n\tscale.domain = d.domain;\r\n\tscale.range = d.range;\r\n\t\r\n\t\r\n\t// Actually loop through the items and arrange them.\r\n\tobj.items.forEach(item=>{\r\n\t\tlet v_ = item.task[correlation.name];\r\n\t\tlet v = correlation.mapping ? correlation.mapping[v_][axis] : v_;\r\n\t\t\r\n\t\tlet p = item.position;\r\n\t\tp[i_axis] = scale.dom2range(v);\r\n\t\titem.position = p;\r\n\t}) // forEach\r\n\t\r\n\t// Now go through the groups and select what to do with them.\r\n\tobj.minimap.update()\r\n\t// console.log(`Arrange ${axis}-axis by: `, correlation, scale)\r\n\t\r\n\t\r\n  } // arrangeItemsByMetadata\r\n  \r\n  /* GROUPING\r\n  How to handle the grouping?\r\n  \r\n  The server pushes an array of `knowledge'. Each row of the array will be a separate annotation? And then the different attributes it will have will make it a different type? The server could be asked to send specific types of annotations over, and the local version would just keep them.\r\n  \r\n  For comments the server sent everything originally, and then individual ones separately. The same could be applied here also. So maybe everything with a valid `tags' could be sent over first, and then the comments etc. would be sent when the corresponding commenting section is open? In any case the knowledge manager will have to keep tabs on all the individual annotations, to be able to replace them with updated versions as they arrive. How would the SQL database be updated with a newer version of the same row? With the UPDATE statement!\r\n  \r\n  \r\n  How should the annotations be stored, just in an array, or in the actual items. Maybe both?\r\n  \r\n  \r\n  Everything with `tags' can be fed to the tree. The groups should be tracked as unsubmitted annoations also. What kind of tags should they be given? Unsaved1 etc?\r\n  \r\n  \r\n  \r\n  The temporary groups can just be kept as groups, and the knowldge manager will just update when groups are expanded? Then the groups made through the tree should not be entered into the obj.groups array. No removal of annotations!!\r\n  \r\n  How should the groups be saved! Should there just be an annotation form at the bottom, that will allow the user to submit a tag? How should the groups with several tags display these? Just above the annotation form? Yes, there they also form a basis for the conversation topics! To supplement the tags they could have a draw icon next to them that allows\r\n  \r\n  \r\n  How to get rid of unnecessary groups once the user dissolves them?? Need to distinguish these groups from the ones that are just navigated away from. And when a tree node is clicked it will have to keep track of the temporary groups also! Well, dissolved groups will have no members!!\r\n  \r\n  The tree needs to correctly position the temporary group also. How should it do this?\r\n  \r\n  */\r\n  \r\n  \r\n  get groups(){\r\n\t  let obj = this;\r\n\t  \r\n\t  // Filter out any empty groups\r\n\t  obj._groups = obj._groups.filter(g=>{\r\n\t\t  return g.members.length > 0;\r\n\t  })\r\n\t  return obj._groups;\r\n  } // set\r\n  \r\n  makegroup(items, temporary){\r\n\tlet obj = this;\r\n\t// The user wishes to create a group using lasso selection. Make this group and store it separately from groups that are a direct result of the tree navigation.\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tlet p = [0, 0];\r\n\titems.forEach(item=>{\r\n\t\tp[0] += parseFloat(item.node.style.left) / items.length;\r\n\t\tp[1] += parseFloat(item.node.style.top) / items.length;\r\n\t}) // forEach\r\n\t\r\n\tlet g = new Group(items, temporary);\r\n\t\r\n\tg.position = p;\r\n\tg.origin = p;\r\n\tg.enter = function(){  \r\n\t\t// Hide all items that are not in the current set.\r\n\t\tobj.items.forEach(item=>{\r\n\t\t\tg.members.includes(item) ? item.show() : item.hide();\r\n\t\t}) // forEach\r\n\t\t\r\n\t\t\r\n\t\t// Return the viewnode to the current!\r\n\t\tg._current.viewnode.appendChild(g._current.renderer.node);\r\n\t\t\r\n\t\t// Just hide all groups.\r\n\t\tobj.groups.forEach(g_=>g_.hide()) // forEach;\r\n\t\t\r\n\t\t\r\n\t\t// Update the tree current status.\r\n\t\tobj.tree.currenttasks = g.members.map(m=>m.task.taskId);\r\n\t\tobj.hudrefresh();\r\n\t\t\r\n\t} // enter\r\n\r\n\t// Add the group to the session.\r\n\tobj.groups.push(g);\r\n\tobj.container.appendChild(g.node);\r\n\t\r\n\t\r\n\t// Update the minimap and the tree data.\r\n\tobj.minimap.add(g);\r\n\t\r\n\r\n\tg.onmove = function(){ obj.minimap.update(); } // onmove\r\n\tg.ondissolve = function(){ obj.hudrefresh(); } // ondissolve\r\n\r\n\r\n\t// All temporary groups should be added as annotations to the tree.\r\n\tobj.hudrefresh();\r\n\t\r\n\t\r\n\tobj.updateRenderingItems(obj.items.concat(obj.groups));\r\n\t\r\n  } // makegroup\r\n  \r\n  \r\n  // DUMMY METHOD.\r\n  updateRenderingItems(items){} // updateRenderingItems \r\n\r\n\r\n  hudrefresh(){\r\n\tlet obj = this;\r\n\tobj.minimap.update();\r\n\tobj.tree.temporary = obj.groups.filter(g=>g.temporary);\r\n\tobj.tree.update();\r\n\t\r\n\t// Update the correlations also in case any correlation is above 0.95, in which case the highest one in that direction should appear on the minimap axes.\r\n\tobj.minimap.correlations.xvariable = \"Unknown\";\r\n\tobj.minimap.correlations.yvariable = \"Unknown\";\r\n\tobj.minimap.correlations.update();\r\n  } // hudrefresh\r\n\r\n  \r\n  \r\n  \r\n} // NavigationManager\r\n\r\n\r\n\r\n\r\nfunction arrayequal(A,B){\r\n\tlet AequalsB = !A.some(v=>!B.includes(v));\r\n\tlet BequalsA = !B.some(v=>!A.includes(v));\r\n\treturn AequalsB && BequalsA\r\n} // arrayequal\r\n\r\nfunction makeNamedArray(A, name){\r\n\tA.name = name;\r\n\treturn A\r\n} // namedArray\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction collectAvailableTagCorrelationData(items){\r\n\t// Maybe it's eaiest to first collect all possibilities, and then remove any array that hose some invalid values? And base it off of a seed anyway, because all otehrs will be filtered out later anyway?\r\n\t// Loop over all the items. Keep only the tags that appear in all of them. Values can be categorical/ordinal - check to see which. Two values are created for sequence annotations, but only if the relevant values are present. Nothing for geometry for now.\r\n\t// Ok, there are several possibilities - tag value, tag starttime, tag endtime.\r\n\t\r\n\t\r\n\t\r\n\t// First filter out any variables that are not present in all items.\r\n\tlet commonTagNames = items.reduce((acc,item)=>{\r\n\t\treturn acc.filter(n=>item.commenting.tagoverview.tags.map(t=>t.name).includes(n))\r\n\t}, items[0].commenting.tagoverview.tags.map(t=>t.name))\r\n\t\r\n\t\r\n\t\r\n\t// Get the relevant item tag.\r\n\tfunction getItemTagByName(item, tagname){\r\n\t\treturn item.commenting.tagoverview.tags.find(t=>t.name==tagname)\r\n\t}; // getItemTagByName\r\n\t\r\n\t\r\n\t\r\n\tfunction getTagDataNamedArray(tagname, optionname, accessor){\r\n\t\tlet values = items.map(item=>{\r\n\t\t\treturn accessor( getItemTagByName(item, tagname) );\r\n\t\t}) // map\r\n\t\treturn makeNamedArray(values, `${tagname}-${optionname}`);\r\n\t} // getTagDataNamedArray\r\n\t\r\n\t\r\n\t// Have to use reduce because for each tag three variables are generated.\r\n\tlet annotationCorrelationData = commonTagNames.reduce((acc,tagname)=>{\r\n\t\tacc.push( getTagDataNamedArray(tagname, \"value\", function(t){return t.value}) );\r\n\t\tacc.push( getTagDataNamedArray(tagname, \"start\", function(t){return t.timestamps ? t.timestamps[0] : undefined}) );\r\n\t\tacc.push( getTagDataNamedArray(tagname, \"end\", function(t){return t.timestamps ? t.timestamps[1] : undefined}) );\r\n\t\treturn acc\r\n\t}, [])\r\n\t\r\n\t\r\n\t// Filter out the ones that have any invalid entries. The null values should be dropped here.\r\n\tlet validAnnotationCorrelationData = annotationCorrelationData.filter(A=>!A.some(v=>!v))\r\n\t\r\n\t\r\n\t// All the values are strings up to this point. Convert them here if they are ordinals.\r\n\treturn validAnnotationCorrelationData.reduce((acc, A)=>{\r\n\t\tif(A.some(v => !Number(v) )){\r\n\t\t\tacc.categoricals.push(A);\r\n\t\t} else {\r\n\t\t\tacc.ordinals.push(makeNamedArray( A.map(v=>Number(v)), A.name));\r\n\t\t} // if\r\n\t\treturn acc\r\n\t}, {ordinals: [], categoricals: []}); // reduce\r\n\t\r\n\t\r\n\t\r\n} // collectAvailableTagCorrelationData\r\n\r\n\r\n\r\n\r\n\r\n","\r\n\r\n/*\r\nThis class should connect with the server to get and save the knowledge captured.\r\n\r\nWhere should the tree be drawn also? Top left, as before?\r\n\r\n\r\nWhere in the code hierarchy should KnowledgeManager sit? Below or above NavigationManager. Maybe above is fine?\r\n\r\nWhat kind of knowledge is there, and what does it need to interact with, and how:\r\n\r\n- Structured tags: name/value pairs equivalent to ordinal/categorical metadata variables\r\n\tordinal name-spatial value pairs: global menu\r\n\tcategorical name-spatial value pairs: global menu\r\n- Unstructured tags: keywords saved as a list for each metadata row\r\n    name: existing chapter form\r\n- Annotations: timestamp/line/area data with a keyword attached\r\n    name-timestep: existing chapter form\r\n\tname-line: drawing interaction\r\n\tname-area: drawing interaction\r\n- Comments:\r\n\ttext: exiting comment form\r\n\r\n\r\nAll properties\t\r\nid, taskId, author, datetime, name, value, timestamps, geometry, comment, upvotes, downvotes\r\n\r\n\r\nCompulsory properties:\r\nid, taskId, author, datetime, name\r\n\r\n\r\nThe id should be an annotation specific id!!! What should this be??? Just sequential numbers? Assigned at the server?\r\n\r\nThe tree should only track the knowledge, and not all the taskIds.\r\n*/\r\n\r\n\r\n\r\n\r\n/*\r\n      Database doesn't exist yet - create Knowledge table. Single table could hold all possible annotations.\r\n      \r\n      id - annotation id, created on the fly by SQL table\r\n      type - annotation type (tag, chapter, name-value pair,...)\r\n      taskId - the taskId it corresponds to\r\n      author - who contributed the knowledge\r\n      datetime - when was it contributed, created server side\r\n      name - tag name\r\n      value - tag value\r\n      timestamps - chapter start and end times saved as stringified array\r\n      geometry - stringified array of [x,y] arrays\r\n      comment - text comment\r\n      upvotes - string of authors that upvoted, with special server-side update method\r\n      downvotes - string of authros who downvoted, with special server-side update method\r\n*/\r\n\r\n\r\n/*\r\n\r\n\r\n\r\n// Task 11 is in two groups!!\r\nconst testannotations = [\r\n{id: \"0\", name: \"green\", taskId: \"task 2\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"1\", name: \"green\", taskId: \"task 7\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"2\", name: \"green\", taskId: \"task 11\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"3\", name: \"blue\", taskId: \"task 5\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"4\", name: \"blue\", taskId: \"task 6\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"5\", name: \"blue\", taskId: \"task 11\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"6\", name: \"brown\", taskId: \"task 1\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"7\", name: \"brown\", taskId: \"task 3\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"8\", name: \"brown\", taskId: \"task 4\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"9\", name: \"brown\", taskId: \"task 8\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"10\", name: \"brown\", taskId: \"task 13\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"11\", name: \"brown\", taskId: \"task 15\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"}\r\n]; // testannotations\r\n\r\n\r\n\r\nconst testannotations2 = [\r\n{id: \"0\", name: \"B\", taskId: \"task 1\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"1\", name: \"B\", taskId: \"task 2\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"2\", name: \"B\", taskId: \"task 3\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"3\", name: \"B\", taskId: \"task 4\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n\r\n{id: \"4\", name: \"C\", taskId: \"task 3\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"5\", name: \"C\", taskId: \"task 4\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"6\", name: \"C\", taskId: \"task 5\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"7\", name: \"C\", taskId: \"task 6\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n\r\n{id: \"8\", name: \"D\", taskId: \"task 3\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"9\", name: \"D\", taskId: \"task 4\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"10\", name: \"D\", taskId: \"task 5\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"11\", name: \"D\", taskId: \"task 6\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n\r\n{id: \"12\", name: \"E\", taskId: \"task 7\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"13\", name: \"E\", taskId: \"task 8\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"14\", name: \"E\", taskId: \"task 9\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n\r\n{id: \"15\", name: \"F\", taskId: \"task 3\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"16\", name: \"F\", taskId: \"task 4\", author: \"Aljaz\", datetime: \"Tue Feb 08 2022\"},\r\n\r\n{id: \"17\", name: \"G\", taskId: \"task 8\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n{id: \"18\", name: \"G\", taskId: \"task 9\", author: \"Magda\", datetime: \"Tue Feb 08 2022\"},\r\n]; // atestannotation2\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n\r\n\r\nexport default class KnowledgeManager{\r\n  constructor(nm){\r\n\tlet obj = this;\r\n\t\r\n\t// `nm' is a NavigationManager object.\r\n\t// Keep a reference to the navigation manager, because the tree navigation must have it's data updated with the knowledge, and the items can be accessed through it.\r\n\tobj.nm = nm;\r\n\t\r\n\t\r\n\t\r\n\t// Commenting needs to be updated if the username changes.\r\n\tdocument.getElementById(\"username\").oninput = function(){\r\n\t\tlet currentuser = document.getElementById(\"username\").value;\r\n\t\tconsole.log(currentuser)\r\n\t\tobj.nm.items.forEach(item=>{\r\n\t\t\titem.annotations.commenting.user = currentuser;\r\n\t\t}) // forEach\r\n\t} // oninput\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\r\n\t/* WEBSOCKET INITIALISATION\r\n\tSo - send over a list of taskIds, and then get back the initial set of comments.\r\n\tEverytime the connection is remade the comments will reload.\r\n\t*/\r\n\r\n\t\r\n\tconst serverAddress = \"wss://continuous-brief-nylon.glitch.me\"; \r\n\tsetupWebSocket();\r\n\r\n\tfunction setupWebSocket(){\r\n\t\t/*\r\n\t\tThe websocket connection can be closed if there is a connection problem between\r\n\t\tthe client and server, or if the connection is inactive for too long. In case\r\n\t\tthere is an error when opening the connection the client tries to reconnect after\r\n\t\t1s. It also tries to reconnect if the connection is closed for some reason. To\r\n\t\tminimise the reconnections due to inactivity the client pings the server every t<300s\r\n\t\tto maintain the connection. The server pongs it back to keep the connection on its side.\r\n\t\t*/\r\n\t\tobj.ws = new WebSocket(serverAddress, \"json\");\r\n\t\t\r\n\t\tobj.ws.onerror = function(){\r\n\t\t\tsetTimeout(setupWebSocket, 1000);\r\n\t\t}; // onerror\r\n\t\t\r\n\t  \r\n\t\tobj.ws.onopen = function(){\r\n\t\t\t// When the connection is initialised the server should send all pertinent comments.\r\n\t\t\tobj.ws.send( JSON.stringify({type: \"query\"}) )\r\n\t\t  \r\n\t\t\tfunction ping(){\r\n\t\t\t   // This should recursively call itself.\r\n\t\t\t   // console.log(\"ping\")\r\n\t\t\t   obj.ws.send(JSON.stringify({type: \"ping\"}));\r\n\t\t\t   setTimeout(ping, 100*1000); // 299*1000   \r\n\t\t\t} // ping\r\n\t\t\t\r\n\t\t\tping();\r\n\t\t}; // onopen\r\n\t\t\r\n\t\t// This will have to be reworked to differentiate between message and upvotes. Ultimately also annotations.\r\n\t\tobj.ws.onmessage = function(msg){\r\n\t\t  // Should differentiate between receiving a 'pong', receiving a single item, and receiving an array.\r\n\t\t  // A single item is just added, while an array requires a purge of existing comments first.\r\n\t\t  let action = JSON.parse( msg.data );\r\n\t\t  // console.log(action)\r\n\t\t  switch(action.type){\r\n\t\t\tcase \"pong\":\r\n\t\t\t  break;\r\n\t\t\tcase \"query\":\r\n\t\t\t  // Purge the existing comments\r\n\t\t\t  obj.purge();\r\n\t\t\tcase \"relay\":\r\n\t\t\t  // But relays can be new comments, or they can be upvotes/downvotes/...\r\n\t\t\t  obj.process(action.data);\r\n\t\t\t  break;\r\n\t\t\tcase \"vote\":\r\n\t\t\t  obj.processvote(action);\r\n\t\t\t  break;\r\n\t\t  }; // switch\r\n\t\t  \r\n\t\t}; // onmessage\r\n\t  \r\n\t\tobj.ws.onclose = function(){\r\n\t\t\tsetTimeout(setupWebSocket, 1000);\r\n\t\t}; // onclose\r\n\t} // setupWebSocket\r\n\r\n\r\n\r\n\r\n\r\n\t/* IMPLEMENT THE POSTING DIRECTLY FROM THE FORMS\r\n\tThe forms have dummy `submit' methods added to them, which receive the collected information as an input. The rest of the information should be fed into this object here.\r\n\t\r\n\t*/\r\n\r\n\r\n\t\r\n\t/* Configure the items to send things to the server\r\n\tWebSockets support sending and receiving: strings, typed arrays (ArrayBuffer) \r\n\tand Blobs. Javascript objects must be serialized to one of the above types \r\n\tbefore sending.\r\n\t\r\n\ttype: comment allows the server to handle different packages differently.\r\n\t*/\r\n\tnm.items.forEach(item=>{\r\n\t\t// `tagform' holds the button to submit tag, tag-value, tag-geometry, and tag-sequence annotations.\r\n\t\titem.annotations.tagform.submit = function(tag){\r\n\t\t\t// Tag comes with at least the tag name from tagform.\r\n\t\t\t\r\n\t\t\t/* The author and taskId are obligatory\r\n\t\t\tAuthor is required to fom groups for the treenavigation, and the taskId allows the annotations to be piped to the corresponding data.\r\n\t\t\t*/ \r\n\t\t\tif(obj.username){\r\n\t\t\t\ttag.taskId = item.task.taskId;\r\n\t\t\t\ttag.author = obj.username;\r\n\t\t\t\t\r\n\t\t\t\t// When stringifying an array all other properties are lost. Instead of explicitly stating that the geometry is closed just make the first and last points the same.\r\n\t\t\t\ttag.geometry = JSON.stringify(item.renderer.geometryannotation.submit());\r\n\r\n\r\n\t\t\t\t// Type tag is assigned so that tags are distinguished from queries and heartbeat pings. Tag type combinations are allowed by always extracting whatever is possible from hte tags. Possible values are controlled for on the server side.\r\n\t\t\t\ttag.type = \"tag\";\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tobj.ws.send( JSON.stringify( tag ) );\r\n\t\t\t} else {\r\n\t\t\t\talert(\"You need to log in\")\r\n\t\t\t} // if\t\t\t\r\n\t\t} // submit\r\n\t\t\r\n\t\t\r\n\t\t// Ah, with the commenting I want to have general comments and replies. And for the replies it's still the commentform that is used. So maybe that can be configured here actually. Ah, but it can't, because it depends on the dynamically generated comment DOM elements.\r\n\t\titem.annotations.commenting.form.submit = function(comment){\r\n\t\t\tif(obj.username){\r\n\t\t\t\tcomment.taskId = item.task.taskId;\r\n\t\t\t\tcomment.author = obj.username;\r\n\t\t\t\tcomment.type = \"tag\";\r\n\t\t\t\t\r\n\t\t\t\tobj.ws.send( JSON.stringify( comment ) );\r\n\t\t\t} else {\r\n\t\t\t\talert(\"You need to log in\")\r\n\t\t\t} // if\r\n\t\t} // submit\r\n\t\t\r\n\t\t\r\n\t\t// The submit for voting needs to be added dynamically. So the function should be gvien to the specific commenting manager, and that needs to assign it onwards.\r\n\t\titem.annotations.commenting.submitvote = function(vote){\r\n\t\t\tif(obj.username){\r\n\t\t\t\tvote.author = obj.username;\r\n\t\t\t\tobj.ws.send( JSON.stringify( vote ) )\r\n\t\t\t} else {\r\n\t\t\t\talert(\"You need to log in\")\r\n\t\t\t} // if\r\n\t\t} // submitvote\r\n\t}) // forEach\r\n\r\n\r\n\r\n\r\n\t// Loop to keep updating the comments every 10 seconds - this is just so that the time labels are getting updated.\r\n\t/*\r\n\tfunction update(){\r\n\t  comments.forEach(c=>{\r\n\t\tc.update()\r\n\t  }) // forEach\r\n\t  setTimeout(update, 10*1000)\r\n\t} // update\r\n\tupdate();\r\n\t*/\r\n  } // constructor\r\n  \r\n  \r\n  get username(){\r\n\treturn document.getElementById(\"username\").value\r\n  } // get username\r\n  \r\n  \r\n  \r\n  purge(){\r\n\tlet obj = this;\r\n\tconsole.log(\"Purging\")\r\n\t// What needs to be purged? The knowledge manager doesn't keep track of the individual annotations anyway? Maybe cause the underlying modules to drop their knowledge?\r\n\t\r\n\t// Purge the navigation tree of obsolete knowledge.\r\n\tobj.nm.tree.purge();\r\n\t\r\n\t\r\n\t// This is called before a query also. needs to purge comment sections, tag overviews, potentially chapters.\r\n\tobj.nm.items.forEach(item=>{\r\n\t\t// The annotation system will purge all its components.\r\n\t\titem.annotations.purge();\r\n\t}) // forEach\r\n  } // purge\r\n\t\r\n\t\r\n\t\r\n  // Processing of knowledge entries cannot rely on types, because these are no longer captured. Instead just define what the individual components require.\r\n  process(d){\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\t// First a nice KLUDGE to get us going - it should only display knowledge relevant to this demo, and so filter out anything with an inappropriate taskId.\r\n\tlet currenttasks = obj.nm.items.map(item=>item.task.taskId);\r\n\td = d.filter(a=>currenttasks.includes(a.taskId));\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// the tree can handle anything with a tag name.\r\n\tlet tags = d.filter(a=>a.name);\r\n\ttags.forEach(tag=>{\r\n\t\tobj.nm.tree.addtagannotation(tag);\r\n\t}) // forEach\r\n\t// console.log(\"Tags\", d, tags)\r\n\tobj.nm.tree.update();\r\n\t\r\n\t\r\n\t// tags need to be distributed to the individual items also - there the available tags will be displayed to the user. The individual items also need them to see if the name of the new annotation is unique or not.\r\n\tlet tagdistribution = distribution(tags);\r\n\tobj.nm.items.forEach(item=>{\r\n\t\tif(tagdistribution[item.task.taskId]){\r\n\t\t\titem.annotations.tagoverview.add(tagdistribution[item.task.taskId]);\r\n\t\t} // if\r\n\t}); // forEach\r\n\t\r\n\t\r\n\t// CLICKING ON CHPTER LABELS COULD ALLOW CHAPTE MODIFICATIONS!!\r\n\t// The chapters need to be distributed to hte appropriate items.\r\n\tlet chapters = d.filter(a=>{\r\n\t\tif(a.timestamps){\r\n\t\t\t// Chpters should have their timestamps parsed back into JSON arrays.\r\n\t\t\ta.timestamps = JSON.parse(a.timestamps);\r\n\t\t\treturn true\r\n\t\t} // if\r\n\t\treturn false\r\n\t}); // filter\r\n\t\r\n\tlet chapterdistribution = distribution(chapters);\r\n\tobj.nm.items.forEach(item=>{\r\n\t\tif(chapterdistribution[item.task.taskId]){\r\n\t\t\t// The chapters are routed to the playbar.\r\n\t\t\titem.renderer.ui.bar.addchapters(chapterdistribution[item.task.taskId]);\r\n\t\t} // if\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t\r\n\t// COMMENTING ON GROUPS IS IMPOSSIBLE, ONLY ACTUAL INDIVIDUALS CAN BE DISCUSSED\r\n\t// Could be relaxed by just toring all the user ids for comments submitted through groups? Would have to implement a group specific way to return a stringified array of taskIds.\r\n\tlet comments = d.filter(c=>c.comment); // filter\r\n\t\r\n\t// Parse the upvotes and downvotes - they shoul dbe arrays.\r\n\tcomments.forEach(c=>{\r\n\t\tc.upvotes = c.upvotes ? JSON.parse(c.upvotes) : null;\r\n\t\tc.downvotes = c.downvotes ? JSON.parse(c.downvotes) : null;\r\n\t}) // forEach\r\n\t\r\n\t// console.log(\"Comments\", comments)\r\n\t\r\n\tlet commentsdistribution = distribution(comments);\r\n\tobj.nm.items.forEach(item=>{\r\n\t\tif(commentsdistribution[item.task.taskId]){\r\n\t\t\t// The comments are routed to the commenting manager.\r\n\t\t\titem.annotations.commenting.add(commentsdistribution[item.task.taskId]);\r\n\t\t} // if\r\n\t}) // forEach\r\n\t\r\n\t\r\n\t// Geometry tags need not be handled separately - TagOverview does what is appropriate.\r\n\t// let geometryannotations = d.filter(a=>a.geometry);\r\n\t// console.log(geometryannotations)\r\n  } // process\r\n  \r\n  \r\n  \r\n  processvote(d){\r\n\t// A vote is received as a single item: vote = {id, type: vote, upvotes, downvotes};\r\n\t// Find the item with the appropriate comment id, and update that comment.\r\n\tlet obj = this;\r\n\t\r\n\t\r\n\t// SHOULD BE MOVED TO COMMENTING MANAGER\r\n\tfunction updatevote(c,v){\r\n\t\t// Update comment `c' with a new voting object `v', if they have the same id.\r\n\t\tif(c.config.id==v.id){\r\n\t\t\tc.config.upvotes = v.upvotes;\r\n\t\t\tc.config.downvotes = v.downvotes;\r\n\t\t\tc.update();\r\n\t\t}; // if\r\n\t} // updatevote\r\n\t\r\n\t\r\n\t// Just updating the comment items doesn't work. Unless we update the comments, then purge the comment objects, and then create new ones?\r\n\t// Alternately loop through them.\r\n\tobj.nm.items.forEach(item=>{\r\n\t\titem.annotations.commenting.generalcommentobjs.forEach(gc=>{\r\n\t\t\tupdatevote(gc,d);\r\n\t\t\tgc.replies.forEach(rc=>{\r\n\t\t\t\tupdatevote(rc,d);\r\n\t\t\t}) // forEach\r\n\t\t})\r\n\t}); // forEach\r\n\t\r\n\t\r\n  } // processvote\r\n  \r\n  \r\n} // KnowledgeManager\r\n\r\n\r\n\r\n\r\nfunction distribution(A){\r\n\t// Create a distribution map for items in array A, by their taskId.\r\n\tlet d = A.reduce((acc,a)=>{\r\n\t\t\r\n\t\tif(acc[a.taskId]){\r\n\t\t\tacc[a.taskId].push(a);\r\n\t\t} else {\r\n\t\t\tacc[a.taskId] = [a];\r\n\t\t} // if\r\n\t\treturn acc\r\n\t},{})\r\n\treturn d\r\n} // distribution\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","/*\r\nThis should connect to the server, receive some data, and create the spatial arrangement environment.\r\n*/\r\n\r\nimport ChessGame from \"./grouping/ChessGame.js\";\r\nimport NavigationManager from \"./navigation/NavigationManager.js\";\r\nimport KnowledgeManager from \"./knowledge/KnowledgeManager.js\";\r\n\r\n\r\n// They need task id.\r\n\r\n\r\n// categorical: [\"Event\", \"Site\", \"White\",\t\"Black\", \"Result\", \"ECO\", \"Opening\", \"TimeControl\",\t\"Termination\", \"Game\"],\r\n// ordinal: [\"UTCDate\", \"UTCTime\", \"WhiteElo\", \"BlackElo\",\t\"WhiteRatingDiff\", \"BlackRatingDiff\"]\r\nfetch(`./data/lichess_db_subset.json`).then(res=>res.json()).then(data=>{\r\n\t\t\r\n\tlet games = data.matches.filter((m,i)=>i<50);\r\n\tgames.forEach(game=>{\r\n\t\tgame.taskId =  `${ game.White } vs. ${ game.Black }, ${ game.UTCDate } at ${ game.UTCTime }`;\r\n\t}) // forEach\r\n\t\t\r\n\r\n\t// The NavigationManager needs to know the variable types because it needs to collect the spatial correlation data to send to the SpatialCorrelations housed by the MiniMap.\r\n\tvar workspace = new NavigationManager();\r\n\tworkspace.ordinals = data.ordinal;\r\n\tworkspace.categoricals = data.categorical;\r\n\t\r\n\t\r\n\r\n\tvar items = [] \r\n\tfor(let i=0; i<games.length; i++){\r\n\t\tlet item = new ChessGame(games[i])\r\n\t\titems.push(item);\r\n\t\t\r\n\t\t// Temporarilyturn the position: absolute off so we get an initial arrangement.\r\n\t\titem.node.style.position = \"\";\r\n\t\t\r\n\t\t// Make navigation manager keep track of the item.\r\n\t\tworkspace.container.appendChild(item.node);\r\n\t\tworkspace.track(item);\r\n\t\t\r\n\t\t\r\n\t} // for\r\n\r\n\r\n\t// Update the minimap with all the items. This could be implemented in a nicer way it feels.\r\n\tworkspace.minimap.update(items);\r\n\r\n\r\n\t// The initial positioning is done based on \"position: relative;\"\r\n\tlet headeroffset = 80;\r\n\tlet positions = items.reduce((acc,item)=>{\r\n\t\tacc.push([item.node.offsetLeft, item.node.offsetTop + headeroffset])\r\n\t\treturn acc\r\n\t},[])\r\n\r\n\t// Now positionthem absolutely, and add the dragging.\r\n\titems.forEach((item,i)=>{\r\n\t\titem.node.style.position = \"absolute\";\r\n\t\titem.position = positions[i];\r\n\t}) // forEach\r\n\r\n\r\n\r\n\t// The knowledge manager object.\r\n\tvar knowledge = new KnowledgeManager(workspace);\r\n\r\n\r\n\r\n\t// Start with the rendering. Rendering only considers drawing the items it knows about, and it knows nothing of the dynamically created groups by the NavigationManager. As a kludge solution the NavigationManager will superst the items to be considered by the renderer.\r\n\r\n\r\n\r\n\r\n\t// How to do the memory handling. And how to make it appear in the navigation bar!\r\n\tconsole.log(workspace, knowledge)\r\n\r\n})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["html2element","html","template","document","createElement","innerHTML","trim","content","firstChild","svg2element","svg","g","createElementNS","isWithinBoundingClientRect","A","B","x","width","y","height","scaleCategorical","domain","range","v","obj","i","indexOf","length","push","scaleLinear","_domain","_range","d","r","mapSpaceAValueToSpaceB","unique","onlyUnique","value","index","self","filter","arrayEqual","arrayIncludesAll","f","b","includes","Item","node","style","position","viewnode","querySelector","previewnode","active","itemStartPosition","itemRelativePosition","onmousedown","e","contains","target","isConnected","rect","getBoundingClientRect","clientX","clientY","parentNode","insertBefore","onmousemove","preventDefault","p","parentElement","k","Number","transform","split","replace","parentRect","pageX","pageY","onmove","onmouseup","onend","onmouseenter","onmouseleave","display","parseFloat","left","top","point","outside","window","innerWidth","innerHeight","colors","files","ranks","invRanks","reverse","allKeys","Array","prototype","concat","map","c","pos2key","pos","key2pos","charCodeAt","allPos","memo","ret","undefined","clear","timer","startAt","start","performance","now","cancel","stop","time","opposite","distanceSq","pos1","pos2","dx","dy","samePiece","p1","p2","role","color","posToTranslateBase","asWhite","xFactor","yFactor","posToTranslateAbs","bounds","posToTranslateRel","translateAbs","el","translateRel","percents","setVisible","visibility","eventPosition","_a","targetTouches","isRightButton","buttons","button","createEl","tagName","className","computeSquareCenter","key","diff","a","Math","abs","pawn","x1","y1","x2","y2","knight","xd","yd","bishop","rook","queen","king","rookFiles","canCastle","rookFilesOf","pieces","backrank","piece","premove","get","mobility","callUserFunction","args","setTimeout","toggleOrientation","state","orientation","animation","current","draggable","selected","setPieces","set","setCheck","check","turnColor","setPremove","orig","dest","meta","unsetPredrop","premovable","events","unsetPremove","unset","setPredrop","predroppable","pd","tryAutoCastle","autoCastle","origPos","destPos","has","baseMove","origPiece","destPiece","captured","unselect","move","lastMove","change","baseNewPiece","force","dropNewPiece","movable","dests","baseUserMove","result","userMove","canMove","holdTime","hold","metadata","ctrlKey","stats","after","canPremove","canDrop","afterNewPiece","predrop","canPredrop","selectSquare","select","enabled","selectable","dragged","isMovable","isPremovable","setSelected","castle","_b","free","isDraggable","playPremove","success","playPredrop","validate","drop","cancelMove","getKeyAtDomPos","file","floor","rank","getSnappedKeyAtDomPos","validSnapPos","validSnapCenters","validSnapDistances","reduce","closestSnapIndex","whitePov","s","initial","roles","n","q","letters","read","fen","Map","row","col","promoted","nb","toLowerCase","write","letter","toUpperCase","join","toString","configure","config","merge","drawable","shapes","hasOwnProperty","duration","rookCastle","kingStartPos","base","extend","isObject","o","_typeof","anim","mutation","animate","render$1","dom","redraw","makePiece","closer","sort","computePlan","prevPieces","anims","animedOrigs","fadings","missings","news","prePieces","curP","preP","vector","newP","step","cur","destroyed","redrawNow","rest","frequency","ease","easing","plan","values","cfg","requestAnimationFrame","size","alreadyRunning","t","brushes","start$2","touches","stopPropagation","brush","eventBrush","snapToValidMove","defaultSnapToValidMove","processDraw","keyAtDomPos","mouseSq","move$1","end$1","addShape","cancel$1","onChange","modA","shiftKey","modB","altKey","metaKey","getModifierState","call","sameShape","similar","find","start$1","isTrusted","previouslySelected","eraseOnClick","cancelable","pieceCloseTo","hadPremove","hadPredrop","stillSelected","element","pieceElementByKey","started","autoDistance","originTarget","cgDragging","classList","add","ghost","elements","processDrag","radiusSq","pow","center","dragNewPiece","newPiece","distance","found","end","type","eventPos","deleteOnDropOff","removeDragElements","board","cgKey","nextSibling","explosion","keys","exploding","stage","setStage","redrawAll","toggleOrientation$1","getFen","cancelPremove","cancelPredrop","explode","setAutoShapes","autoShapes","setShapes","event","destroy","unbind","defaults","coordinates","viewOnly","disableContextMenu","resizable","addPieceZIndex","pieceKey","highlight","showDests","showGhost","dropmode","visible","green","opacity","lineWidth","red","blue","yellow","paleBlue","paleGreen","paleRed","paleGrey","baseUrl","prevSvgHash","renderSvg","customSvg","curD","arrowDests","shape","hash","shapeHash","fullHash","sc","defsEl","shapesEl","customSvgsEl","syncDefs","syncShapes","modifiers","makeCustomBrush","keysInDom","Set","getAttribute","entries","appendChild","renderMarker","root","hashesInDom","toRemove","elHash","removeChild","renderShape","pieceHash","modifiersHash","customSvgHash","scale","m","h","orient","renderCustomSvg","renderPiece","renderArrow","renderCircle","setAttribute","w","setAttributes","viewBox","pos2px","widths","circleWidth","radius","stroke","fill","cx","cy","shorten","arrowMargin","angle","atan2","xo","cos","yo","sin","name","href","marker","id","markerWidth","markerHeight","refX","refY","attrs","round","renderWrap","relative","toggle","helper","container","orientClass","renderCoords","elems","elem","textContent","bindBoard","boundsUpdated","boardEl","observer","observe","onStart","startDragOrDraw","addEventListener","passive","bindDocument","unbinds","unbindable","body","dragOrDraw","ev","onScroll","capture","forEach","eventName","callback","options","removeEventListener","withDrag","withDraw","render","posToTranslate","translate","curAnim","curDrag","squares","computeSquareClasses","samePieces","sameSquares","movedPieces","movedSquares","pieceAtKey","elPieceName","fading","pMvdset","pMvd","sMvdset","sMvd","isPieceNode","cgPiece","remove","cgFading","cgAnimating","pieceNameOf","zIndex","posZIndex","appendValue","isSquareNode","cn","sk","pop","translation","squareNode","pieceName","pieceNode","nodes","removeNodes","updateBounds","z","addSquare","pDests","klass","classes","arr","Chessground","maybeState","prevUnbind","skipSvg","debounceRedraw","insert","redrawing","Chess","BLACK","WHITE","EMPTY","PAWN","KNIGHT","BISHOP","ROOK","QUEEN","KING","SYMBOLS","DEFAULT_POSITION","POSSIBLE_RESULTS","PAWN_OFFSETS","PIECE_OFFSETS","ATTACKS","RAYS","SHIFTS","FLAGS","NORMAL","CAPTURE","BIG_PAWN","EP_CAPTURE","PROMOTION","KSIDE_CASTLE","QSIDE_CASTLE","BITS","RANK_1","RANK_2","RANK_7","RANK_8","SQUARES","a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1","ROOKS","square","flag","kings","turn","castling","ep_square","half_moves","move_number","history","header","comments","load","keep_headers","update_setup","generate_fen","prune_comments","reversed_history","current_comments","copy_comment","undo_move","make_move","reset","tokens","validate_fen","valid","charAt","is_digit","parseInt","put","algebraic","errors","error_number","error","isNaN","test","rows","sum_fields","previous_was_number","empty","cflags","epflags","set_header","sq","build_move","from","to","flags","promotion","generate_moves","add_move","moves","len","us","them","swap_color","second_rank","first_sq","last_sq","single_square","legal","piece_type","j","offset","castling_from","castling_to","attacked","legal_moves","king_attacked","move_to_san","output","disambiguator","get_disambiguator","in_check","in_checkmate","stripped_san","difference","blocked","in_stalemate","insufficient_material","bishops","num_pieces","sq_color","sum","in_threefold_repetition","positions","repetition","slice","old","ambiguities","same_rank","same_file","ambig_from","ambig_to","ambig_piece","infer_piece_type","san","matches","match","ascii","symbol","move_from_san","sloppy","clean_move","legalMoves","illegalMoves","substring","make_pretty","ugly_move","clone","dupe","property","str","perft","depth","child_nodes","ugly_moves","verbose","in_draw","game_over","pgn","newline","newline_char","max_width","header_exists","append_comment","move_string","comment","delimiter","Result","strip","wrap_comment","token","current_width","load_pgn","mask","has_keys","object","parse_pgn_header","header_obj","headers","RegExp","header_regex","header_string","exec","to_hex","string","encodeURIComponent","from_hex","decodeURIComponent","encode_comment","decode_comment","startsWith","endsWith","ms","bracket","semicolon","rav_regex","half_move","arguments","move_obj","pretty_move","undo","square_color","sq_0x88","move_history","get_comment","set_comment","delete_comment","get_comments","Object","delete_comments","play","sqrt","r_max","dH","Mx","My","p0","pause","PlayButton","playing","defaultRectAttributes","PlayBarAnnotation","tscale","dh","background","buffering","foreground","label","unhighlight","t_play","t_buffered","dom2range","starttime","timeFraction","x0","endtime","tf","highlightRectangle","unhighlightRectangle","baseVal","PlayBar","annotations","t_min","t_max","_tscale","exiting","querySelectorAll","makeChapterObj","timestamps","chapters","acc","previous","chapter","update","tags","rebuild","PlayControls","textHeight","textBottomMargin","highlightHeightDelta","bar","barrect","skipped","_playing","ChessGameRenderer","gamepgn","fps","dt","timelastdraw","chess","plies","splice","plies_fen","ply","plyind","plyind_prev","enforceAvailableMoves","geometryannotation","submit","show","previewconfig","drawGeometryAnnotations","plying_prev","ui","interval","setInterval","clearInterval","calculateAvailableMoves","isOnScreen","isOffScreen","bottom","right","shapesconfigs","an","currentplayer","playermoves","availableMoves","css","timebutton","submitbutton","TagForm","nameinput","valueinput","oninput","submitButton","tag","t0","min","t1","max","it0","it1","innerText","toFixed","backgroundColor","some","JSON","stringify","TagButton","on","TagOverview","newtags","newbuttons","onmouseover","preview","onmouseout","previewend","communicatetags","tagnames","textarea","AddCommentForm","_user","commentinput","scrollHeight","replybutton","votenumberi","timestampspan","Comment","user","availabletags","datetime","Date","toISOString","upvotes","downvotes","author","footer","submitvote","updateTimestamp","updateVoteCounter","updateContent","timestamp","formatTimeStamp","buttonClassName","icon","counter","vote","stamp","dayInMiliseconds","todayInMiliseconds","getHours","getMinutes","getSeconds","getMilliseconds","seconds","minutes","hours","days","toLocaleTimeString","toDateString","ReplyComment","marginLeft","GeneralComment","replies","replynode","repliesExpanded","replyconfig","existing","replacement","updateReplies","CommentingManager","generalcommentobjs","form","hsdiv","cdiv","hidden","counterNode","commentsToRemove","children","ownerid","general","reply","ownercomment","gc","addreply","updateCommentCounter","rc","AnnotationSystem","taskid","tagform","tagoverview","commenting","console","log","purge","ChessGame","task","taskId","renderer","Game","ga","cm","activeannotations","geometry","taggeometry","parse","activegeometries","updateAvailableTags","tagname","DrawLink","parentnode","childnode","pi","ci","bendi","node_label_width","bundle_width","line_width","r1","level","r2","calculateOutgoingLineY","calculateIncomingLineY","xHorizontal","origin","originCoord","targetCoord","arc1start","arc1end","arc2start","arc2end","TreeBundle","seednode","links","_bendi","parents","connections","group","nodeChildren","nodeParents","link","paths","path","isNodeAllowed","isNodeUnknown","updateNodeMinBlockPositions","bundles","lowestParentBlock","block","child","TreeLevel","nlevel","getBundleLinesGoingThroughNode","bundle","arrangeIncomingOutgoingTracks","outgoingbundles","incomingbundles","lines","line","nBundlesIn","nBundlesOut","arrangeBundlesOfLevel","maxBundleInd","getbundles","bundleseeds","addchild","addparent","makelinks","getlevels","levels","maxlevel","dimensioning","childMinimumY","lnk","positioned","yBasedOnIncomingHorizontalLine","markerSize","pitch","TreeNode","treegroup","highlightText","highlightMarker","texts","updateBackgroundRectSize","textbox","getBBox","outline","markerPaddingIn","markerPaddingOut","members","array2tree","array","alltasks","groups","findAllTagBasedGroups","makeRootGroup","mergedgroups","mergeIdenticalGroups","hierarchicalnodes","findParentalRelationships","taskgroup","ancestors","descendants","dict","groupid","temporary","addtask","addtag","identicalg","g_","isSubset","candidate","parent","calculateLevelNumbers","unassignednodes","TreeHierarchy","collapsednodes","temporaryAnnotations","item","hiddennodes","collapsed","TreeKnowledge","hierarchy","gnodes","gbundles","currenttasks","visiblenodes","updatenodes","updatelines","updatelegend","interact","nodeobj","iscurrent","highlightselect","tooltipTimer","onclick","moveto","clearTimeout","hidetooltip","crossreferencein","showtooltip","crossreferenceout","bundleobj","entrywidth","entryheight","legendwidth","unsaved","aliases","textnodes","alias","tooltip","taskids","MiniMapIcon","xscale","yscale","itemClientRect","MiniMapViewRect","clickedItemOffset","svgClientRect","reposition","menu","ul","CorrelationsMenu","axis","correlations","lastChild","sign","li","hide","onvariableselect","variable","PI","arrowheadwidth","arrowheadlength","relativeHorizontalArrow","relativeVerticalArrow","SpatialCorrelations","xoffset","yoffset","th","tv","yvariable","xvariable","xmenu","ymenu","textmargin","clipstring","os","ordinalscores","cs","categoricalscores","scores","ordinals","ordinal","sp","spearman","spatial","categoricals","categorical","mapping","categoricalmapping","n_max","substr","uniquevals","uniqueval","xpos","_x","ypos","_y","median","calcStatistics","covariance","sigma","mu","mean","variance","Infinity","N","numbers","sorted","middle","objarray","accessor","_accessor","MiniMap","_icons","viewrect","icons","memberids","memberitem","ic","range2dom","items","centerdata","init","domains","calculateInitialMinimapDomain","xdiff","ydiff","u","bodyClientRect","minx","maxx","miny","maxy","POSITIVE_INFINITY","NEGATIVE_INFINITY","Lasso","polygon","_boundary","boundary","clearBoundary","addBoundaryPoint","draw","svgbox","isInside","passesEdge","TagValueBatchForm","nameInput","toggleSubmitButton","namevalid","valueInput","onscreenitems","valueButton","xPositionButton","itemrect","yPositionButton","isonscreen","disabled","icontemplate","Group","_current","head","dissolvebutton","dissolve","enterbutton","enter","addmember","commentingnode","paddingTop","member","uncolorAllIcons","iconobj","pressTimer","releaseMember","release","ondissolve","NavigationManager","_groups","tabletop","getElementById","sketchpad","zoom","deltaY","adjustview","minimap","onwheel","getoffset","currenttransform","calculate","collectSpatialCorrelationData","correlation","arrangeItemsByMetadata","batchform","lasso","findItemsInLasso","miditem","isPointInside","selectedIndividuals","makegroup","e0","which","tree","hudrefresh","activetasks","parentg","clickedgroupitems","clickedgroup","arrayequal","irect","grect","checksize","onscreengroups","allrelevantitems","grp","tagCorrelationData","collectAvailableTagCorrelationData","groupedItemData","individualItemData","makeNamedArray","d_","i_axis","v_","updateRenderingItems","AequalsB","BequalsA","commonTagNames","getItemTagByName","getTagDataNamedArray","optionname","annotationCorrelationData","validAnnotationCorrelationData","KnowledgeManager","nm","currentuser","serverAddress","setupWebSocket","ws","WebSocket","onerror","onopen","send","ping","onmessage","msg","action","data","process","processvote","onclose","username","alert","addtagannotation","tagdistribution","distribution","chapterdistribution","addchapters","commentsdistribution","updatevote","fetch","then","res","json","games","game","White","Black","UTCDate","UTCTime","workspace","track","headeroffset","offsetLeft","offsetTop","knowledge"],"mappings":"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MAAM,CAACjD,CAAD;EAAnB,KAAAT,GAAyB;EAC3By3B,MAAAA,GAAG,CAACqW,YAAJrW,CAAiB32B,IAAjB22B,CAAsBz3B,CAAtBy3B;EADD,WAEO;EACNA,MAAAA,GAAG,CAACgW,QAAJhW,CAAa32B,IAAb22B,CAAkBye,cAAc,CAAEl2C,CAAC,CAACwF,GAAFxF,CAAM,UAAAS,CAAA;iBAAGiD,MAAM,CAACjD,CAAD;EAAf,OAAAT,CAAF,EAAuBA,CAAC,CAACse,IAAzB,CAAhCmZ;EAJqD,KAAA;;;aAM/CA;EAND,GAAAqf,EAOJ;EAACrJ,IAAAA,QAAQ,EAAE,EAAX;EAAeK,IAAAA,YAAY,EAAE;EAA7B,GAPIgJ,EA3C0C;;;EClnBlD;EACA;AACA;EACA;AACA;AACA;EACA;AACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;AACA;EACA;EACA;AACA;AACA;EACA;EACA;AACA;AACA;EACA;AACA;EACA;EACA;;EAKA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAGA;AACA;AACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;AACA;AACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;AACA;EACA;EACA;AACA;EACA;EACA;EACA;AACA;AACA;EACA;;MAMqBC;8BACPC,IAAG;;;UACZt2C,GAAG,GAAG,KADM;;;EAKhBA,IAAAA,GAAG,CAACs2C,EAAJt2C,GAASs2C,EAATt2C,CALgB;;EAUhBrB,IAAAA,QAAQ,CAACs0C,cAATt0C,CAAwB,UAAxBA,EAAoCy7B,OAApCz7B,GAA8C,YAAU;YACnD43C,WAAW,GAAG53C,QAAQ,CAACs0C,cAATt0C,CAAwB,UAAxBA,EAAoCkC;EACtD0/B,MAAAA,OAAO,CAACC,GAARD,CAAYgW,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"}
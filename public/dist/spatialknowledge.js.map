{"version":3,"file":"spatialknowledge.js","sources":["../../src/helpers.js","../../src/grouping/Item.js","../../src/grouping/Individual.js","../../src/navigation/MiniMapIcon.js","../../src/navigation/MiniMapViewRect.js","../../src/navigation/MiniMap.js","../../src/navigation/Lasso.js","../../src/grouping/Group.js","../../src/navigation/NavigationManager.js","../../src/main.js"],"sourcesContent":["export function html2element(html){\r\n  let template = document.createElement('template'); \r\n  template.innerHTML = html.trim(); // Never return a text node of whitespace as the result\r\n  return template.content.firstChild;\r\n} // html2element\r\n\r\nexport function svg2element(svg){\r\n  let g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n  g.innerHTML = svg.trim();\r\n  return g.firstChild;\r\n} // svg2element\r\n\r\n\r\n\r\n\r\n// How to make the addition of dragging more general?? There are some things that have to happen. Pass them in as additional functions?\r\nexport function addDraggingToItem(item, onstart, ondrag, onend){\r\n\t// Add an object to facilitate the dragging.\r\n\t\r\n\tlet active = false;\r\n\tlet itemRelativePosition = [0, 0];\r\n\t\r\n\titem.node.onmouseenter = function(){\r\n\t\tactive = false;\r\n\t} // onmouseenter\r\n\titem.node.onmouseleave = function(){\r\n\t\tactive = false;\r\n\t} // onmouseleave\r\n\titem.node.onmousedown = function(e){\r\n\t\tif(e.target == item.node || e.target == item.wrappednode){\r\n\t\t\tlet rect = item.node.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\tactive = true;\r\n\t\t\titemRelativePosition = [\r\n\t\t\t\te.clientX - rect.x,\r\n\t\t\t\te.clientY - rect.y\r\n\t\t\t];\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Also move the viewFrame div up so that dragging over otehr higher divs is uninterrupted.\r\n\t\t\titem.node.parentNode.insertBefore(item.node, null);\r\n\t\t\t\r\n\t\t\tif(onstart){onstart()} // if\r\n\t\t} // if\r\n\t} // onmousedown\r\n\titem.node.onmousemove = function(e){\r\n\t\tif(active){\r\n\t\t\tlet x = e.pageX - itemRelativePosition[0];\r\n\t\t\tlet y = e.pageY - itemRelativePosition[1];\r\n\t\t\t\r\n\t\t\titem.node.style.left = x + \"px\"\r\n\t\t\titem.node.style.top  = y + \"px\"\r\n\t\t\t\r\n\t\t\tif(ondrag){ondrag()};\r\n\t\t} // if\r\n\t} // mousemove\r\n\titem.node.onmouseup   = function(){\r\n\t\tactive = false;\r\n\t\tif(onend){onend()};\r\n\t} // onmouseup\r\n} // addDraggingToItem\r\n\r\n\r\n\r\n\r\n// Will I need this dragging elsewhere??\r\nexport function addDraggingToSvgItem(svg, item){\r\n\t// SVG movement should be done in SVG coordinates. As the SVG is small, and never moves off screen, the relative position can be calculated on hte go.\r\n\t// The item can never move off the svg, as when it's dragged to the border and the mouse moves over the edge it stops being dragged. The rectangle is well behaved when the mouse re-enters the svg, and only skips when the rectangle is re-entered. Still, it may be good to stop the dragging if th emouse leaves the svg.\r\n\t\r\n\tlet active = false;\r\n\tlet clickedItemOffset = [0,0];\r\n\t\r\n\t\r\n\titem.onmousedown = function(e){\r\n\t\tactive = true;\r\n\t\t\r\n\t\t// Correcting for clicked position within item.\r\n\t\tlet itemClientRect = item.getBoundingClientRect();\r\n\t\tclickedItemOffset = {\r\n\t\t\tx: itemClientRect.x - e.clientX,\r\n\t\t\ty: itemClientRect.y - e.clientY\r\n\t\t} // clickedItemOffset\r\n\t} // onmousedown\r\n\titem.onmousemove = function(e){\r\n\t\tif(active){\r\n\t\t\t// Convert the mouse position into the position within the parent SVG:\r\n\t\t\tlet svgClientRect = svg.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\t// Check if the mouse left the svg.\r\n\t\t\tif(isEventWithinRectangle(e, svgClientRect)){\r\n\t\t\t\tlet x = e.clientX - svgClientRect.x + clickedItemOffset.x;\r\n\t\t\t\tlet y = e.clientY - svgClientRect.y + clickedItemOffset.y;\r\n\t\t\t\t\r\n\t\t\t\titem.setAttribute(\"x\", x)\r\n\t\t\t\titem.setAttribute(\"y\", y)\r\n\t\t\t} else {\r\n\t\t\t\tactive = false;\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t} // if\r\n\t} // mousemove\r\n\titem.onmouseup   = function(){\r\n\t\tactive = false;\r\n\t} // onmouseup\r\n} // addDraggingToItem\r\n\r\n\r\n\r\n\r\nexport function isWithinBoundingClientRect(A, B){\r\n\t// A and B are expected to be the results of \"getBoundingClientRect\"\r\n\treturn ( A.x > B.x && A.x < B.x + B.width ) &&\r\n\t       ( A.y > B.y && A.y < B.y + B.height );\r\n} // isEventWithinRectangle\r\n\r\n\r\n\r\nexport class scaleLinear {\r\n  \r\n  _domain = [0, 1]\r\n  _range = [0, 1]\r\n\r\n  set domain(d){ this._domain = d } // domain\r\n  get domain(){ return this._domain } // domain\r\n\r\n  set range(r){ this._range = r } // range\r\n  get range(){ return this._range } // range\r\n\r\n  dom2range(v){\r\n\treturn mapSpaceAValueToSpaceB(v, this.domain, this.range)\r\n  } // dom2range\r\n  \r\n  range2dom(v){\r\n\treturn mapSpaceAValueToSpaceB(v, this.range, this.domain)  \r\n  } // range2dom\r\n} // scaleLinear\r\n\r\nfunction mapSpaceAValueToSpaceB(v, A, B){\r\n\treturn (v-A[0])/(A[1]-A[0]) * (B[1]-B[0]) + B[0]\r\n} // mapSpaceAValueToSpaceB","import { html2element } from \"../helpers.js\";\r\n\r\nlet template = `\r\n<div class=\"item\">\r\n  <div class=\"head unselectable\">\r\n    <span class=\"label\"></span>\r\n\t<span class=\"button\" style=\"display: none;\">x</span>\r\n  </div>\r\n  <div class=\"view\"></div>\r\n  <div class=\"preview\"></div>\r\n  <div class=\"controls\"></div>\r\n  <div class=\"commenting\"></div>\r\n</div>\r\n`;\r\n\r\n/*\r\n`Item' is a basis for individual small multiples as well as groups. It implements the node creation and appends dragging.\r\n\r\nScaling: the container is transformed to include zooming/panning. When the zoom happens the items are prompted to check whether they are still large enough to draw the data.\r\n*/\r\nexport default class Item{\r\n\t\r\n  // Main viewport dimensions;\r\n  width = 300;\r\n  height = 200;\r\n\t\r\n  constructor(){\r\n\tlet obj = this;\r\n\t  \r\n\t\r\n\tobj.node = html2element(template);\r\n\tobj.node.style.position = \"absolute\";\r\n\t  \r\n\tobj.viewnode = obj.node.querySelector(\"div.view\");\r\n\tobj.viewnode.style.height = obj.height + \"px\";\r\n\tobj.viewnode.style.width = obj.width + \"px\";\r\n\t  \r\n\tobj.previewnode = obj.node.querySelector(\"div.preview\");\r\n\tobj.previewnode.style.maxWidth = obj.width + \"px\";\r\n\t\r\n\t// Add the dragging in here. The dragging is supposed to be in a scaled, and potentially tranlated div, so the offset to the div needs to be removed.\r\n\tlet active = false;\r\n\tlet itemRelativePosition = [0, 0];\r\n\t\t\r\n\t\t\r\n\t// The `e.target == obj.node' prevents any events on the children elements to bubble up. This require the title width to be 0, and it prevented from a button being positioned to the right. \r\n\t// `obj.node.contains(e.target)' allows any children to launch the dragging, but this will interfere with the panning and zooming in the viewport div.\r\n\t// Maybe any child that is contained by obj.node. but not the viewport node?\r\n\tobj.node.onmousedown = function(e){\r\n\t  if(obj.node.contains(e.target) && e.target != obj.viewnode && obj.node.isConnected){\r\n\t\te.preventDefault();\r\n\t\tlet rect = obj.node.getBoundingClientRect();\r\n\t\t\r\n\t\tactive = true;\r\n\t\titemRelativePosition = [\r\n\t\t  e.clientX - rect.x,\r\n\t\t  e.clientY - rect.y\r\n\t\t];\r\n\t\t\r\n\t\t// Also move the viewFrame div up so that dragging over otehr higher divs is uninterrupted.\r\n\t\tobj.node.parentNode.insertBefore(obj.node, null);\r\n\t  } // if\r\n\t} // onmousedown\r\n\tobj.node.onmousemove = function(e){\r\n\t  if(active){\r\n\t\te.preventDefault();\r\n\t\t\r\n\t\t// The parent may be rescaled, retrieve and collect the k from it.\r\n\t\tlet p = obj.node.parentElement;\r\n\t\tlet k = Number( p.style.transform.split(\" \")[0].replace(/^\\D+|\\D+$/g, \"\") );\r\n\t\tlet parentRect = p.getBoundingClientRect();\r\n\t\t\r\n\t\tlet x = e.pageX - parentRect.x - itemRelativePosition[0];\r\n\t\tlet y = e.pageY - parentRect.y - itemRelativePosition[1];\r\n\t\t\r\n\t\tobj.position = [x/k, y/k];\r\n\t\t\r\n\t\tobj.onmove();\r\n\t  } // if\r\n\t} // mousemove\r\n\tobj.node.onmouseup = function(){ active = false; } // onmouseup\r\n\tobj.node.onmouseenter = function(){ active = false; } // onmouseenter\r\n\tobj.node.onmouseleave = function(){ active = false; } // onmouseleave\r\n  } // constructor\r\n  \r\n  \r\n  // Generic hide, show, and position methods.\r\n  show(){\r\n\tlet obj = this;\r\n\tobj.node.style.display = \"\";\r\n  } // show\r\n  \r\n  hide(){\r\n\tlet obj = this;\r\n\tobj.node.style.display = \"none\";\r\n  } // hide\r\n  \r\n  set position(point){\r\n\tlet obj = this;\r\n\tobj.node.style.left = point[0] + \"px\";\r\n\tobj.node.style.top  = point[1] + \"px\";\r\n  } // set position\r\n  \r\n  get position(){\r\n\t  let obj = this;\r\n\t  return [\r\n\t    parseFloat(obj.node.style.left),\r\n\t\tparseFloat(obj.node.style.top)\r\n\t  ]\r\n  } // get position\r\n  \r\n  // superclass method defined in the subclasses.\r\n  checksize(){} // checksize\r\n  \r\n  \r\n  // Dummy method. Superset in NavigationManager to trigger the minimap update.\r\n  onmove(){} // onmove\r\n  \r\n} // Item","import Item from \"./Item.js\";\r\n\r\n\r\n// How will the individual draw? The group will have to follow the same idea. Or? maybe the drawing would just access a specific module, like geometry or smth, and that isn't implemented yet. And then the same thing can be added to the group?\r\nexport default class Individual extends Item {\r\n  constructor(task){\r\n    super();\r\n    let obj = this;\r\n\t\r\n\t// The task is important, because \r\n\tobj.task = task;\r\n\tobj.node.querySelector(\"span.label\").innerHTML = task.taskId;\r\n\t\r\n  } // constructor\r\n  \r\n  checksize(){\r\n\tlet obj = this;\r\n\t// Check size to decide what to do. In cases where many items are drawn the cumulative memory required to draw the image may be too high, and it's sensible to draw a static image instead.\r\n\t\r\n\tlet rect = obj.node.getBoundingClientRect();\r\n\tif(rect.width < 200){\r\n\t\t// Paint the inside red.\r\n\t\tobj.viewnode.style.background = obj.task.color;\r\n\t\tobj.viewnode.style.opacity = 1;\r\n\t} else {\r\n\t\t// Turn it back to default values.\r\n\t\tobj.viewnode.style.background = \"\";\r\n\t\tobj.viewnode.style.opacity = 0.001;\r\n\t} // if\r\n  } // checksize\r\n  \r\n} // Individual","import { svg2element } from \"../helpers.js\";\r\n\r\nlet template = `<circle r=\"5\" fill=\"cornflowerblue\"></circle>`; // template\r\n\r\nexport default class MiniMapIcon{\r\n    constructor(item){\r\n\t\tlet obj = this;\r\n\t\tobj.item = item;\r\n\t\tobj.node = svg2element(template);\r\n\t} // constructor\r\n\t\r\n\r\n\tupdate(xscale, yscale, highlight){\r\n\t\t// The scales must be given from the parent, and the icon uses them to position itself.\r\n\t\t// The scales should incorporate both the panning and zooming adjustements needed.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Update the position of the circle with the center point of the DOM card.\r\n\t\tlet itemClientRect = obj.item.node.getBoundingClientRect();\r\n\t\t\t\r\n\t\tlet x = itemClientRect.left + itemClientRect.width/2;\r\n\t\tlet y = itemClientRect.top + itemClientRect.height/2;\r\n\t\t\r\n\t\tobj.node.setAttribute(\"cx\", xscale.dom2range( x ));\r\n\t\tobj.node.setAttribute(\"cy\", yscale.dom2range( y ));\r\n\t\t\r\n\t\t\r\n\t\tobj.node.setAttribute(\"fill\", highlight ? \"orange\" : \"cornflowerblue\");\r\n\t\tobj.node.setAttribute(\"display\", obj.item.node.style.display );\r\n\t\t\r\n\t\t\r\n\t\t// Support for groups.\r\n\t\tif(obj.item.members){\r\n\t\t\t// The area of the group of n items should be n times larger?\r\n\t\t\tobj.node.setAttribute(\"r\", Math.sqrt( obj.item.members.length )*5)\r\n\t\t}; // if\r\n\t} // update\r\n\t\r\n} // MiniMapIcon","import { svg2element, isWithinBoundingClientRect } from \"../helpers.js\";\r\n\r\nlet template = `<rect class=\"current\" x=\"50\" y=\"10\" width=\"150\" height=\"50\" fill=\"black\" opacity=\"0.5\"></rect>`\r\n\r\nexport default class MiniMapViewRect{\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.node = svg2element(template);\r\n\t\t\r\n\t\t\r\n\t\t// Make it draggable.\r\n\t\tlet active, clickedItemOffset;\r\n\t\r\n\t\r\n\t\tobj.node.onmousedown = function(e){\r\n\t\t\tactive = true;\r\n\t\t\t\r\n\t\t\t// Correcting for clicked position within item.\r\n\t\t\tlet itemClientRect = obj.node.getBoundingClientRect();\r\n\t\t\tclickedItemOffset = {\r\n\t\t\t\tx: itemClientRect.x - e.clientX,\r\n\t\t\t\ty: itemClientRect.y - e.clientY\r\n\t\t\t} // clickedItemOffset\r\n\t\t} // onmousedown\r\n\t\tobj.node.onmousemove = function(e){\r\n\t\t\tif(active){\r\n\t\t\t\t// Convert the mouse position into the position within the parent SVG. ASSUME that the parent element is the SVG.\r\n\t\t\t\tlet svgClientRect = obj.node.parentElement.getBoundingClientRect();\r\n\t\t\t\t\r\n\t\t\t\t// Check if the mouse left the svg.\r\n\t\t\t\t\r\n\t\t\t\tif(isWithinBoundingClientRect({x: e.clientX, y: e.clientY}, svgClientRect)){\r\n\t\t\t\t\tlet x = e.clientX - svgClientRect.x + clickedItemOffset.x;\r\n\t\t\t\t\tlet y = e.clientY - svgClientRect.y + clickedItemOffset.y;\r\n\t\t\t\t\t\r\n\t\t\t\t\tobj.node.setAttribute(\"x\", x);\r\n\t\t\t\t\tobj.node.setAttribute(\"y\", y);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Now all the DOM items should be moved.\r\n\t\t\t\t\tobj.reposition();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactive = false;\r\n\t\t\t\t} // if\r\n\t\t\t\t\r\n\t\t\t} // if\r\n\t\t} // mousemove\r\n\t\tobj.node.onmouseup   = function(){\r\n\t\t\tactive = false;\r\n\t\t} // onmouseup\r\n\t\t\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\tinit(xscale, yscale){\r\n\t\tlet obj = this;\r\n\t\t// Reposition the viewrect back to the origin.\r\n\t\tobj.node.setAttribute(\"x\",  xscale.dom2range(0) );\r\n\t\tobj.node.setAttribute(\"y\",  yscale.dom2range(0) );\r\n\t} // init\r\n\t\r\n\t\r\n\t// The data to position the icons comes from boundingClientRect, which is the positions on hte screen. In that case\r\n\tupdate(xscale, yscale){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The viewrect represents the window.\r\n\t\tlet width = xscale.dom2range(window.innerWidth) - xscale.dom2range(0);\r\n\t\tlet height = yscale.dom2range(window.innerHeight) - yscale.dom2range(0);\r\n\t\t\r\n\t\tobj.node.setAttribute(\"width\",  width )\r\n\t\tobj.node.setAttribute(\"height\", height )\r\n\t} // update\r\n\t\r\n\t// Dummy function that gets changed by the minimap;\r\n\treposition(){} // reposition\r\n\t\r\n} // MiniMapViewRect","import { svg2element, scaleLinear, isWithinBoundingClientRect } from \"../helpers.js\";\r\nimport MiniMapIcon from \"./MiniMapIcon.js\";\r\nimport MiniMapViewRect from \"./MiniMapViewRect.js\";\r\n/*\r\nThe initial arrangement is not the problem of this module. This module just visualises the current arrangement, and allows global navigation.\r\n\r\nThe panning/zooming should be made available on hte background also.\r\n*/\r\nconst template = `<svg style=\"border: 2px solid gainsboro; display: block;\">\r\n  <g class=\"icons\"></g>\r\n</svg>`; // template\r\n\r\n\r\n// All the data should be on the minimap at all times, including any rearranged items. That means that the scale domain may have to be redone every time there is a rearrangement event.\r\n\r\n\r\nexport default class MiniMap{\r\n\t\r\n\twidth = 300;\r\n\theight = 200;\r\n\t_icons = [];\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.node = svg2element(template);\r\n\t\tobj.node.setAttribute(\"width\", obj.width);\r\n\t\tobj.node.setAttribute(\"height\", obj.height);\r\n\t\t\r\n\t\t\r\n\t\t// The rectangle should have the proportions of the screen.\r\n\t\t\r\n\t\t\r\n\t\t// Abstract the viewrect out??\r\n\t\tobj.viewrect = new MiniMapViewRect();\r\n\t\tobj.node.appendChild(obj.viewrect.node)\r\n\t\t\r\n\t\t// Scrolling is added to the the rect externally!\r\n\t\t\r\n\t\t// Create the scales to map the necessary range to the size of the svg.\r\n\t\tobj.xscale = new scaleLinear();\r\n\t\tobj.xscale.range = [0, obj.width];\r\n\t\t\r\n\t\tobj.yscale = new scaleLinear();\r\n\t\tobj.yscale.range = [0, obj.height];\r\n\t\t\r\n\t\t\r\n\t\t// Maybe it's just simpler to keep re-rendering the MiniMap? So the update doesn't have to be called everywhere?\r\n\t\t// Maybe not, because a lot of the time it's just the re-centering of hte data that is needed?\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\t\r\n\t// icons getter/setter - to dynamically filter out any group sthat are removed.\r\n\tset icons(ic){\r\n\t\tthis._icons = ic;\r\n\t} // set icons\r\n\t\r\n\tget icons(){\r\n\t\treturn this._icons.filter(icon=>{\r\n\t\t\treturn icon.item.node.isConnected ? true : icon.node.remove();\r\n\t\t})\r\n\t} // get icons\r\n\t\r\n\t\r\n\tgetoffset(){\r\n\t    let obj = this;\r\n\t    return [ obj.xscale.range2dom( obj.viewrect.node.getAttribute(\"x\") ),\r\n\t             obj.yscale.range2dom( obj.viewrect.node.getAttribute(\"y\") ) ];\r\n\t} // getoffset\r\n\t\r\n\t\r\n\t// The groups dynamically added to the workspace must also appear on the minimap.\r\n\tadd(item){\r\n\t\tlet obj = this;\r\n\t\tlet icon = new MiniMapIcon(item);\r\n\t\tobj.node.querySelector(\"g.icons\").appendChild(icon.node); \r\n\t\tobj._icons.push(icon);\r\n\t} // add\r\n\t\r\n\t\r\n\tremove(item){\r\n\t\tlet obj = this;\r\n\t\t// Remove the icon, and the underlying obj.\r\n\t\tlet i = obj.icons.map(icon=>icon.item).indexOf(item);\r\n\t\tobj.icons[i].node.remove()\r\n\t\tobj.icons.splice(i, 1);\r\n\t} // remove\r\n\t\r\n\t\r\n\t// Update the circle representations.\r\n\tupdate(items){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// If items have been given, then change the circles.\r\n\t\tif(items){\r\n\t\t\titems.forEach(item=>{\r\n\t\t\t\tobj.add(item);\r\n\t\t\t}); // forEach\r\n\t\t} // items\r\n\t\t\r\n\t\t\r\n\t\t// New items arrived, the square is resized, and the icons should be positioned. Make the items all fit within the square? Or just map the screen directly onto the minimap? Or just scale the square to what can be seen on the main screen?\r\n\t\t\r\n\t\t\r\n\t\t// Redraw minimap\r\n\t\tobj.centerdata();\r\n\t\tobj.viewrect.init(obj.xscale, obj.yscale);\r\n\t\tobj.render();\r\n\t\t \r\n\t} // update\r\n\t\r\n\t\r\n\tcenterdata(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The minimap should show all the items at all times, thus the minimap domain needs to span all the positions of the items in both the x and y dimensions, while preserving AR=1. The data AR won't be the same as the minimap AR, and therefore the data domain is recalculated to fit into the minimap square.\r\n\t\t\r\n\t\tlet domains = calculateInitialMinimapDomain(obj.icons.map(icon=>icon.item));\r\n\t\t\r\n\t\t// The maximum domain AR must be selected to accomodate all the data. Then the domains can be centered on hte minimap.\r\n\t\tlet xdiff = domains.x[1] - domains.x[0];\r\n\t\tlet ydiff = domains.y[1] - domains.y[0];\r\n\t\tlet u = 1.1*Math.max( xdiff / obj.width, ydiff / obj.height )\r\n\t\t\r\n\t\t// Reset the scale domains to center the data.\r\n\t\tobj.xscale.domain = [domains.x[0] + xdiff/2 - u*obj.width/2, domains.x[0] + xdiff/2 + u*obj.width/2];\r\n\t\tobj.yscale.domain = [domains.y[0] + ydiff/2 - u*obj.height/2, domains.y[0] + ydiff/2 + u*obj.height/2];\r\n\t\t\r\n\t} // centerdata\r\n\t\r\n\t\r\n\trender(){\r\n\t\t// Redraw the minimap. Called after the user rearranges the items.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Resize the viewrect to the right aspect ratio and size.\r\n\t\tobj.viewrect.update(obj.xscale, obj.yscale);\r\n\t\tlet r = obj.viewrect.node.getBoundingClientRect();\r\n\t\t\r\n\t\t// Redo the icons if they are active.\r\n\t\tobj.icons.forEach(icon=>{\r\n\t\t\ticon.update(obj.xscale, obj.yscale);\r\n\t\t}) // forEach\r\n\t} // render\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n} // Minimap\r\n\r\n\r\n\r\nfunction calculateInitialMinimapDomain(items){\r\n\t// The workspace and the minimap have no domain limitations, but the minimap should initially be scaled such that all the points are in view. When zooming the rectangle will then change size when scrolled.\r\n\t\r\n\tlet bodyClientRect = document.body.getBoundingClientRect();\r\n\t\r\n\treturn items.reduce((acc,item)=>{\r\n\t\tlet itemClientRect = item.node.getBoundingClientRect();\r\n\t\t\r\n\t\t// Calculate the positions of hte icons based on the center of the item.\r\n\t\tlet minx = itemClientRect.left - bodyClientRect.left;\r\n\t\tlet maxx = itemClientRect.left - bodyClientRect.left + itemClientRect.width;\r\n\t\t \r\n\t\tlet miny = itemClientRect.top - bodyClientRect.top;\r\n\t\tlet maxy = itemClientRect.top - bodyClientRect.top + itemClientRect.height;\r\n\t\t\r\n\t\tacc.x[0] = minx < acc.x[0] ? minx : acc.x[0];\r\n\t\tacc.x[1] = maxx > acc.x[1] ? maxx : acc.x[1];\r\n\t\t\r\n\t\tacc.y[0] = miny < acc.y[0] ? miny : acc.y[0];\r\n\t\tacc.y[1] = maxy > acc.y[1] ? maxy : acc.y[1];\r\n\t\treturn acc\r\n\t}, {\r\n\t\tx: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY], \r\n\t\ty: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY]\r\n\t}) // reduce\r\n} // calculateInitialMinimapDomain","import {svg2element} from \"../helpers.js\";\r\n\r\n\r\nlet template = `\r\n<polygon class=\"lasso\" points=\"\" style=\"fill: cornflowerblue; stroke: dodgerblue; stroke-width: 2; opacity: 0.4;\"></polygon>\r\n`; // template\r\n\r\n\r\nexport default class Lasso{\r\n\t/* \r\n\t\t`lasso' implements a generic lasso that can be added to svg elements.\r\n\t\r\n\tThe lasso logs the selected points and updates the graphic. If the underlying svg spans across the entire client viewport, then no readjustment of the coordinates is needed.\r\n\t*/\r\n\t\r\n\tconstructor(svg){\r\n\t\t\r\n\t\t// Make reactive??\r\n\t\r\n\t\tlet obj = this;\r\n\t\r\n\t\tobj.svg = svg;\r\n\t\tobj.polygon = svg.appendChild( svg2element(template) );\r\n\t\t\r\n\t\t// An internal boundary is used for all the drawing, and an external boundary is presented to other interested modules. Only the exposed boundary is observable. The exposed boundary is used to determine the lasso selection.\r\n\t\tobj._boundary = [];\r\n\t\tobj.boundary = [];\r\n\r\n\t\t// Should the boundary be stored at all??\r\n\t\tobj.svg.addEventListener(\"mousedown\", function(event){\r\n\t\t\tobj.clearBoundary();\r\n\t\t\tobj.active = true;\r\n\t\t}) // mousedown\r\n\r\n\t\tobj.svg.addEventListener(\"mousemove\", function(event){\r\n\t\t\tif(obj.active){\r\n\t\t\t\tobj.addBoundaryPoint(event);\r\n\t\t\t\tobj.draw();\r\n\t\t\t} // if\r\n\t\t}) // mousedown\r\n\t\t\r\n\t\tobj.svg.addEventListener(\"mouseup\", function(event){\r\n\t\t\tobj.hide();\r\n\t\t\t\r\n\t\t\t// The bounadry.replace was mobx functionality.\r\n\t\t\tobj.boundary = obj._boundary;\r\n\t\t\tobj.active = false;\r\n\t\t\tobj.svg.style.zIndex = \"\";\r\n\t\t\t\r\n\t\t\t// Dummy function that allows responses.\r\n\t\t\tobj.onend();\r\n\t\t}) // mousedown\r\n\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\n\tclearBoundary(){\r\n\t\tlet obj = this;\r\n\t\tobj._boundary = [];\r\n\t} // clearBoundary\r\n\r\n\taddBoundaryPoint(event){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The svgbox changes if the user scrolls around in the window.\r\n\t\tlet svgbox = obj.svg.getBoundingClientRect();\r\n\t\t\r\n\t\tobj._boundary.push({\r\n\t\t\tx: event.clientX - svgbox.x,\r\n\t\t\ty: event.clientY - svgbox.y\r\n\t\t})\r\n\t\t\r\n\t} // addBoundaryPoint\r\n\t\r\n\tisPointInside(point){\r\n\t\t// Check wheteher the 'point' [pixel coordinates] is within the polygon defined by the points array 'boundary'.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Default answer is no.\r\n\t\tlet isInside = false\r\n\t\t\r\n\t\tlet n = obj.boundary.length\r\n\t\tif(n>2){\r\n\t\t\tfor(let i=1; i<n; i++){\r\n\t\t\t\t// Check whether this edge is being passed when moving from the point to the right. If it passes an even number of edges it's outside, otherwise it's inside.\r\n\t\t\t\tlet p = passesEdge(obj.boundary[i-1], obj.boundary[i], point)\r\n\t\t\t\tisInside = p ? !isInside : isInside\r\n\t\t\t} // for\r\n\t\t\t\r\n\t\t\t// Need to check the same number of edge segments as vertex points. The last edge should be the last and the first point.\r\n\t\t\tlet p = passesEdge(obj.boundary[n-1], obj.boundary[0], point)\r\n\t\t\tisInside = p ? !isInside : isInside\r\n\t\t} // if\r\n\t\t\r\n\t\treturn isInside\r\n\t} // isPointInside\r\n\t\t\r\n\tdraw(){\r\n\t\tlet obj = this;\r\n\t\tobj.polygon.setAttribute(\"points\", obj._boundary.map(p=>`${p.x},${p.y}`).join(\" \"))\r\n\t} // draw\r\n\t\r\n\thide(){\r\n\t\t// Remove the selection drawing.\r\n\t\tlet obj = this\r\n\t\tobj.polygon.setAttribute(\"points\", \"\")\r\n\t} // remove\r\n\t\r\n\t// Dummy function.\r\n\tonend(){} // onend\r\n\t\r\n} // lasso\r\n\r\n\r\n\r\n// A ray casting method to check whether a point is within a polygon or not.\r\nfunction passesEdge(p0, p1, point){\r\n\t// One point needs to be above, while the other needs to be below -> the above conditions must be different.\r\n\t\r\n\tif( (p0.y > point.y) !== (p1.y > point.y) ){\r\n\t\t// One is above, and the other below. Now find if the x are positioned so that the ray passes through. Essentially interpolate the x at the y of the point, and see if it is larger.\r\n\t\tlet x = (p1.x - p0.x)/(p1.y - p0.y)*(point.y - p0.y) + p0.x\r\n\t\treturn x > point.x\r\n\t\t\r\n\t} else {\r\n\t\treturn false\r\n\t} // if\r\n} // checkIntersect\r\n\t","import { html2element } from \"../helpers.js\";\r\nimport Item from \"./Item.js\";\r\n\r\n\r\n\r\n\r\n/*\r\nGROUPING: \r\nThis item should be support use as a single object, as well as a group. The introduction of a new group, and what happens to the constituent Items is handled outside, so the Item only needs to identify whther it should present itself as a group, or as an individual item. That depends on the number of tasks that come in.\r\n\r\nHow will the data be managed for items in a group? If it follows the Item flow then it will try to load a rendering module, and push data to it, etc.\r\n\r\nIs it still better, in the end, to have a separate group class that takes Items? Ah, but then it will have to either keep making them visible, or pass in the DOM to draw into anyway.\r\n\r\nHave a library that holds all the files, and then distribute them out? The library is an added complication, and if it is the authority on the files it'll have to keep checking all the Items to see which ones still want to keep a copy. Furthermore, the library will have to be passed to the Items so that they can query it.\r\n\r\nJust creating a new Item will require that the sam efiles be reloaded.\r\n\r\nMaybe create a group item, but let it accept Items as the input?\r\n\r\nYes, make a Group class. That will have a viewnode. Then when the usermouses over an element just go to that elements geometry and set it as the group geometry. Then the rendering can be done into the new viewport.\r\n\r\n\r\n\r\n\r\nGroups are always destroyed when something happens to them no? If they are entered they are destroyed, and they can only be exited through the tree? They can be disbanded otherwise.\r\n\r\nBut if you can only navigate out using the tree, then I have to first implement it.\r\nBut the temporary groups should be stored as well - just as the actual groups?\r\n\r\n\r\nMaybe just create all the group items when the data arrives from the server, and store them?? Or create temporary annotations?\r\n\r\nWhen should temporary groups be kept? When it's navigated out of? No, on all navigation tasks the group should be kept, but not otherwise!!\r\n\r\n\r\nENTER/DISSOLVE\r\nButtons should be added to allow the group to be entered or dissolved. maybe no button is needed to enter - a node should appear on the tree. So only dissolve.\r\n\r\n\r\nRELATIVE POSITIONS:\r\nIt's advantageous to store the relative positions of the individual members. Instead of storing them explicitly the group can just store it's original position, and the individual members can just be hidden. When they are revealed again they can jut have their positions adjusted by the delta of the groups current position to the original position. The small multiples are therefore just unpiled in the new location.\r\n\r\n\r\n\r\nSAVING:\r\nThere should be a local and global set of groups. That means that the user must explicitly save his group for it to be submitted to the server. This can be achieved with a tag input.\r\n\r\n\r\nTODO - GROUP INTERACTIONS:\r\nAn initial lasso creates the group.\r\nAdding items (add together, enter tags into form, and dump actual annotations):\r\n  Dragging item over group\r\n  Dragging group over group\r\n  Lassoing group and items\r\n  Lassoing groups\r\n\r\nRemoving items (remove, dump annotations alltogether):\r\n  Long press on preview element?\r\nDon't allow items to be removed when inside a group?\r\n\r\n*/\r\n\r\n\r\nlet icontemplate = `<div class=\"previewicon\"></div>`;\r\n\r\n/* TODO: \r\n\r\n\r\n- entering - only through the navigation tree??\r\n\r\n- dragging other items over it to add them\r\n- lassoing items into existing group??\r\n- in the commenting there should be a tag input with a save button\r\n- the save button should also allow an annotation to be deleted by the author\r\n\r\n\r\n*/\r\n\r\n\r\nexport default class Group extends Item {\r\n\t\r\n  // Main viewport dimensions;\r\n  width = 300;\r\n  height = 200;\r\n  \r\n\t\r\n  constructor(items, annotations){\r\n\t// `items' is an array of `Items' which should be grouped together. `annotations' are an optional input for groups that are created based on server saved annotations.\r\n\tsuper();\r\n    let obj = this;\r\n\r\n\t// The label should depcit the group name - where does that come from? Maybe it should just be passed in? Maybe as an array of all names for this group.\r\n\tlet head = obj.node.querySelector(\"div.head\")\r\n\thead.querySelector(\"span.label\").innerHTML = \"Group\";\r\n\t\r\n\tlet dissolvebutton = head.querySelector(\"span.button\");\r\n\tdissolvebutton.style.display = \"\";\r\n\tdissolvebutton.onmousedown = function(){\r\n\t\t// The main item checks if the event is a drag, and stops propagation if so. This happens `onmousedown', which is fired before it can become an `onclick' (which presumably includes the `onmouseup' also?)\r\n\t\tobj.dissolve();\r\n\t}; // onclick\r\n\t\r\n\t// Store the members.\r\n\tobj.members = items;\r\n\tobj.current = items[0];\r\n\t\r\n\t// When deleting an item the current item WILL be deleted (because it was moused onto first). Therefore another item will have to be selected\r\n\t\r\n\t\r\n\tfunction uncolorAllIcons(){\r\n\t\t// Control the preview appearance.\r\n\t\tobj.previewnode.querySelectorAll(\"div.previewicon\").forEach(icon=>{\r\n\t\t\ticon.style.background = \"gainsboro\";\r\n\t\t}) // forEach\r\n\t} // coordinateIconColors\r\n\t\r\n\t\r\n\tobj.icons = obj.members.map(item=>{\r\n\t\t\r\n\t\tlet iconobj = {\r\n\t\t\titem: item,\r\n\t\t\tnode: html2element(icontemplate)\r\n\t\t}; // return\r\n\t\t\r\n\t\t// Give the correct initial color, and append it.\r\n\t\t\r\n\t\tobj.previewnode.appendChild( iconobj.node );\r\n\t\t\r\n\t\t\r\n\t\ticonobj.node.onmouseenter = function(){\r\n\t\t\t// Set current object - important for canvas rendering.\r\n\t\t\tobj.current = iconobj.item;\r\n\t\t\t\r\n\t\t\t// coordinate the colors.\r\n\t\t\tuncolorAllIcons();\r\n\t\t\ticonobj.node.style.background = \"gray\";\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Dummy rendering\r\n\t\t\tobj.viewnode.style.background = obj.current.task.color;\r\n\t\t\tobj.viewnode.style.opacity = 1;\r\n\t\t} // onmouseenter\r\n\t\t\r\n\t\t\r\n\t\t// Long press release.\r\n\t\tvar pressTimer;\r\n\t\tfunction releaseMember(){\r\n\t\t\tobj.release(iconobj)\r\n\t\t} // releaseMember\r\n\t\t\r\n\t\ticonobj.node.onmouseup = function(){\r\n\t\t  clearTimeout(pressTimer);\r\n\t\t  // Clear timeout\r\n\t\t  return false;\r\n\t\t}; // onmouseup\r\n\t\t\r\n\t\ticonobj.node.onmousedown = function(){\r\n\t\t  // Set timeout\r\n\t\t  pressTimer = window.setTimeout(releaseMember, 1000);\r\n\t\t  return false; \r\n\t\t}; // onmousedown\r\n\t\t\r\n\t\treturn iconobj;\r\n\t}) // map\r\n\t\r\n\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  release(iconobj){\r\n\t  // On release the item is placed back where it was collected! Maybe this is a good interaction??\r\n\t  let obj = this;\r\n\t  \r\n\t  \r\n\t  obj.icons.splice(obj.icons.indexOf(iconobj), 1);\r\n\t  obj.members.splice(obj.members.indexOf(iconobj.item), 1);\r\n\t\t\t\r\n\t  iconobj.node.remove();\r\n\t  iconobj.item.node.style.display = \"\";\r\n\t  \r\n\t  obj.current = obj.icons[0].item;\r\n\t  obj.icons[0].node.style.background = \"gray\";\r\n\t  \r\n\t  // The onmove method is already set to update the minimap - just reuse it.\r\n\t  obj.onmove();\r\n  } // release\r\n  \r\n  \r\n  dissolve(){\r\n\t  let obj = this;\r\n\t  // How should this tell the NavigationManager that it should stop tracking it?\r\n\t  // Maybe just allow NavigationManager to filter out any empty groups whenever it tries to access them?\r\n\t  \r\n\t  // Just remove the node! Then where there is an update needed check if the node still exists? Also reinstate the previous items.\r\n\t  obj.node.remove();\r\n\t  \r\n\t  \r\n\t  // Calculate and apply the offset.\r\n\t  \r\n\t  let offset = [\r\n\t    obj.position[0] - obj.origin[0],\r\n\t\tobj.position[1] - obj.origin[1],\r\n\t  ]; // offset\r\n\t  \r\n\t  obj.members.forEach(item=>{\r\n\t\t  item.position = [\r\n\t\t    item.position[0] + offset[0],\r\n\t\t    item.position[1] + offset[1]\r\n\t\t  ]; // position\r\n\t\t  item.node.style.display = \"\";\r\n\t  }) // forEach\r\n\t  \r\n\t  obj.onmove();\r\n  } // dissolve\r\n  \r\n} // Group","import MiniMap from \"./MiniMap.js\";\r\nimport Lasso from \"./Lasso.js\";\r\nimport Group from \"../grouping/Group.js\";\r\n/*\r\nA drop in class that provides zooming, panning, minimap, and the tree hierarchy navigaton.\r\n*/\r\nexport default class NavigationManager{\r\n\t\r\n  items = []\r\n  groups = []\r\n\t\r\n  scale = 1;\r\n  dx = 0;\r\n  dy = 0;\r\n\t\r\n  constructor(){\r\n    let obj = this;\r\n\t\r\n\t\r\n\tobj.tabletop = document.getElementById(\"tabletop\");\r\n    obj.container = obj.tabletop.querySelector(\"div.scalingwrapper\");\r\n\tobj.sketchpad = document.getElementById(\"sketchpad\");\r\n\t\r\n\t// Use transform: scale() to achieve the zoom in and out functionality, and transform: translate(xpx,ypx) for panning. First a default trnasform should be assigned.\r\n\tobj.container.style.transform = `scale(1) translate(0px,0px)`;\r\n\t\r\n\r\n\t// ZOOMING\r\n\tfunction zoom(event) {\r\n\t  event.preventDefault();\r\n\r\n\t  obj.scale += event.deltaY * -0.001;\r\n\r\n\t  // Restrict scale\r\n\t  obj.scale = Math.min(Math.max(.125, obj.scale), 4);\r\n\r\n\t  // Apply scale transform\r\n\t  obj.adjustview();\r\n\t}; // zoom\r\n\t\r\n\t\r\n\t\r\n\t// MINIMAP\r\n\tobj.minimap = new MiniMap();\r\n\tdocument.getElementById(\"minimap\").appendChild(obj.minimap.node);\r\n\t\r\n\tobj.minimap.viewrect.node.onwheel = zoom;\r\n\tobj.minimap.viewrect.reposition = function(){\r\n\t\tlet offset = obj.minimap.getoffset();\r\n\t\tobj.dx = - offset[0] / obj.scale;\r\n\t\tobj.dy = - offset[1] / obj.scale;\r\n\t\t// No minimap update here!!\r\n\t\tobj.container.style.transform = obj.currenttransform();\r\n\t}; // reposition\r\n\t\r\n\t\r\n\t// LASSO \r\n\t// Originally the lasso produced a tooltip, with the options: group, tag, close. Some of the tagging is now done through the commenting system. The lasso can still highlight the selection, and the interface based option for spatial value tags can be used for the tagging. Should that just be a menu on the right?\r\n\tobj.lasso = new Lasso(obj.sketchpad);\r\n\t\r\n\tfunction findItemsInLasso(items){\r\n\t\t\r\n\t\tlet selected = items.reduce((acc, item)=>{\r\n\t\t\tlet itemrect = item.node.getBoundingClientRect();\r\n\t\t\tlet miditem = {\r\n\t\t\t\tx: itemrect.x + itemrect.width/2, \r\n\t\t\t\ty: itemrect.y + itemrect.height/2\r\n\t\t\t};\r\n\t\t\tif(item.node.style.display != \"none\" && obj.lasso.isPointInside(miditem)){\r\n\t\t\t\tacc.push(item);\r\n\t\t\t}; // if\r\n\t\t\treturn acc;\r\n\t\t}, [])\r\n\t\t\r\n\t\treturn selected; \r\n\t} // findItemsInLasso\r\n\t\r\n\t\r\n\tobj.lasso.onend = function(){\r\n\t\t// Only visible items should be selectable!!\r\n\t\t\r\n\t\tlet selectedIndividuals = findItemsInLasso( obj.items );\r\n\t\t// let selectedGroups = findItemsInLasso( obj.groups );\r\n\t\t\r\n\t\tif(selectedIndividuals.length > 1){\r\n\t\t\t// Groups are only kept on navigation events. Here all the groups are destroyed, and the members are recombined into a new group.\r\n\t\t\t\r\n\t\t\t// Or should a supergroup be created whenever multiple groups are selected? Maybe that makes more sense? How to store local groups?\r\n\t\t\tobj.makegroup(selectedIndividuals);\r\n\t\t\tobj.minimap.update();\r\n\t\t} // if\r\n\t} // lasso.onend\r\n\t\r\n\t\r\n\t// The navigation based on hte tabletop. Here the dragging doesn't move the item, but rather a different element. Furthermore, the type of button click should launch a different event.\r\n\tobj.tabletop.onwheel = zoom;\r\n\t\r\n\tlet active, origin, e0;\r\n\tobj.tabletop.onmousedown = function(e){\r\n\t  if(e.target == obj.tabletop){\r\n\t\tswitch(e.which){\r\n\t\t\tcase 1:\r\n\t\t\t  // Left mouse click - panning.\r\n\t\t\t  e.preventDefault();\r\n\t\t\t  active = true;\r\n\t\t\t  origin = {x: obj.dx, y: obj.dy};\r\n\t\t\t  e0 = e;\r\n\t\t\t  break;\r\n\t\t\tcase 2:\r\n\t\t\t  // Middle mouse click - lasso.\r\n\t\t\t  obj.sketchpad.style.zIndex = 1000;\r\n\t\t\t  obj.lasso.clearBoundary();\r\n\t\t\t  obj.lasso.active = true;\r\n\t\t\t  break;\r\n\t\t} // switch\r\n\t\t\r\n\t  } // if\r\n\t} // onmousedown\r\n\t\r\n\tobj.tabletop.onmousemove = function(e){\r\n\t  if(active){\r\n\t\te.preventDefault();\r\n\t\t\r\n\t\t// The elements should move in hte dragged direction.\r\n\t\tobj.dx = origin.x + ( e.clientX - e0.clientX )/obj.scale;\r\n\t\tobj.dy = origin.y + ( e.clientY - e0.clientY )/obj.scale;\r\n\t\t\r\n\t\t// Move the items.\r\n\t\tobj.adjustview();\r\n\t  } // if\r\n\t} // mousemove\r\n\tobj.tabletop.onmouseup = function(){ active = false; } // onmouseup\r\n\tobj.tabletop.onmouseenter = function(){ active = false; } // onmouseenter\r\n\tobj.tabletop.onmouseleave = function(){ active = false; } // onmouseleave\r\n\t\r\n\t\r\n\t\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  \r\n  // Getter and setter for groups to allow inactive groups to be filtered out.\r\n  \r\n  \r\n  \r\n  track(item){\r\n\tlet obj = this;\r\n\t\r\n\tobj.container.appendChild(item.node);\r\n\t\r\n\titem.onmove = function(){\r\n\t\t// Check if it should be added to a group.\r\n\t\t\r\n\t\t\r\n\t\t// Update the minimap accordingly?\r\n\t\tobj.minimap.update();\r\n\t} // onmove\r\n\t\r\n\tobj.items.push(item);\r\n  } // additem\r\n  \r\n  \r\n  adjustview(){\r\n\tlet obj = this;\r\n\t// When the view is adjusted the items should also be told to check their sizes, and react is needed.\r\n\tobj.container.style.transform = obj.currenttransform();\r\n\t\r\n\t// Update the minimap\r\n\tobj.minimap.update();\r\n\t\r\n\t// Instruct all the items to check their size.\r\n\tobj.items.forEach(item=>{\r\n\t\titem.checksize();\r\n\t}) // forEach\r\n  } // adjustview\r\n  \r\n  currenttransform(){\r\n\tlet obj = this;\r\n\treturn `scale(${obj.scale}) translate(${obj.dx}px,${obj.dy}px)`;\r\n  }; // gettransform\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  /* GROUPING\r\n  How to handle the grouping?\r\n  \r\n  The server pushes an array of `knowledge'. Each row of the array will be a separate annotation? And then the different attributes it will have will make it a different type? The server could be asked to send specific types of annotations over, and the local version would just keep them.\r\n  \r\n  For comments the server sent everything originally, and then individual ones separately. The same could be applied here also. So maybe everything with a valid `tags' could be sent over first, and then the comments etc. would be sent when the corresponding commenting section is open? In any case the knowledge manager will have to keep tabs on all the individual annotations, to be able to replace them with updated versions as they arrive. How would the SQL database be updated with a newer version of the same row? With the UPDATE statement!\r\n  \r\n  \r\n  How should the annotations be stored, just in an array, or in the actual items. Maybe both?\r\n  \r\n  \r\n  Everything with `tags' can be fed to the tree. The groups should be tracked as unsubmitted annoations also. What kind of tags should they be given? Unsaved1 etc?\r\n  \r\n  \r\n  \r\n  The temporary groups can just be kept as groups, and the knowldge manager will just update when groups are expanded? Then the groups made through the tree should not be entered into the obj.groups array. No removal of annotations!!\r\n  \r\n  How should the groups be saved! Should there just be an annotation form at the bottom, that will allow the user to submit a tag? How should the groups with several tags display these? Just above the annotation form? Yes, there they also form a basis for the conversation topics! To supplement the tags they could have a draw icon next to them that allows\r\n  \r\n  \r\n  How to get rid of unnecessary groups once the user dissolves them?? Need to distinguish these groups from the ones that are just navigated away from. And when a tree node is clicked it will have to keep track of the temporary groups also!\r\n  \r\n  The tree needs to correctly position the temporary group also. How should it do this?\r\n  \r\n  */\r\n  \r\n  /*\r\n  get groups(){\r\n\t  // Filter out any groups\r\n\t  let obj = this;\r\n\t  obj._groups = obj._groups.filter(g=>{\r\n\t\t  return g.\r\n\t  })\r\n  } // set\r\n  */\r\n\r\n  makegroup(items){\r\n    let obj = this;\r\n\t\r\n\t// Collect the midpoint of the selected items to position the group.\r\n\tlet p = [0, 0];\r\n\titems.forEach(item=>{\r\n\t\tp[0] += parseFloat(item.node.style.left) / items.length;\r\n\t\tp[1] += parseFloat(item.node.style.top) / items.length;\r\n\t\titem.hide();\r\n\t}) // forEach\r\n\t\r\n\tlet g = new Group(items);\r\n\tobj.groups.push(g);\r\n\t\r\n\tg.position = p;\r\n\tg.origin = p;\r\n\t\r\n\t\r\n\tobj.container.appendChild(g.node);\r\n\tobj.minimap.add(g);\r\n\tg.onmove = function(){\r\n\t\tobj.minimap.update();\r\n\t} // onmove\r\n\t\r\n\t\r\n  } // makegroup\r\n\r\n  \r\n  \r\n  \r\n} // NavigationManager\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","/*\r\nThis should connect to the server, receive some data, and create the spatial arrangement environment.\r\n*/\r\n\r\nimport Individual from \"./grouping/Individual.js\";\r\nimport NavigationManager from \"./navigation/NavigationManager.js\";\r\n\r\n\r\n\r\n// Do we want categorical variables in here as well?? Knowledge may be injected through ML generated tags or something? But then maybe they could be injected just as tags?\r\n\r\n// author, datetime, tag, taskId, line, area, t\r\n// Maybe separate annotations for starttime and endtime? And then let the system figure out a closed chapter.\r\n\r\nconst annotations = [\r\n{tag: \"green\", taskId: \"task 2\"},\r\n{tag: \"green\", taskId: \"task 7\"},\r\n{tag: \"green\", taskId: \"task 11\"},\r\n{tag: \"blue\", taskId: \"task 5\"},\r\n{tag: \"blue\", taskId: \"task 6\"},\r\n{tag: \"blue\", taskId: \"task 11\"},\r\n{tag: \"brown\", taskId: \"task 1\"},\r\n{tag: \"brown\", taskId: \"task 3\"},\r\n{tag: \"brown\", taskId: \"task 4\"},\r\n{tag: \"brown\", taskId: \"task 8\"},\r\n{tag: \"brown\", taskId: \"task 13\"},\r\n{tag: \"brown\", taskId: \"task 15\"}\r\n]; // annotations\r\n\r\n\r\nconst data = [\r\n{taskId: \"task 0\", sepal_length: 5.1, sepal_width: 3.5, color: \"salmon\"},\r\n{taskId: \"task 1\", sepal_length: 4.9, sepal_width: 3, color: \"sandybrown\"},\r\n{taskId: \"task 2\", sepal_length: 4.7, sepal_width: 3.2, color: \"seagreen\"},\r\n{taskId: \"task 3\", sepal_length: 4.6, sepal_width: 3.1, color: \"seashell\"},\r\n{taskId: \"task 4\", sepal_length: 5, sepal_width: 3.6, color: \"sienna\"},\r\n{taskId: \"task 5\", sepal_length: 5.4, sepal_width: 3.9, color: \"skyblue\"},\r\n{taskId: \"task 6\", sepal_length: 4.6, sepal_width: 3.4, color: \"slateblue\"},\r\n{taskId: \"task 7\", sepal_length: 5, sepal_width: 3.4, color: \"springgreen\"},\r\n{taskId: \"task 8\", sepal_length: 4.4, sepal_width: 2.9, color: \"tan\"},\r\n{taskId: \"task 9\", sepal_length: 4.9, sepal_width: 3.1, color: \"thistle\"},\r\n{taskId: \"task 10\", sepal_length: 5.4, sepal_width: 3.7, color: \"tomato\"},\r\n{taskId: \"task 11\", sepal_length: 4.8, sepal_width: 3.4, color: \"turquoise\"},\r\n{taskId: \"task 12\", sepal_length: 4.8, sepal_width: 3, color: \"violet\"},\r\n{taskId: \"task 13\", sepal_length: 4.3, sepal_width: 3, color: \"wheat\"},\r\n{taskId: \"task 14\", sepal_length: 5.8, sepal_width: 4, color: \"lightpink\"},\r\n{taskId: \"task 15\", sepal_length: 5.7, sepal_width: 4.4, color: \"antiquewhite\"}\r\n]; // data\r\n\r\n// Items\r\nvar workspace = new NavigationManager();\r\n\r\nvar items = [] \r\n\r\nfor(let i=0; i<data.length; i++){\r\n\tlet item = new Individual(data[i])\r\n\titems.push(item);\r\n\t\r\n\t// Temporarilyturn the position: absolute off so we get an initial arrangement.\r\n\titem.node.style.position = \"\";\r\n\t\r\n\t// Make navigation manager keep track of the item.\r\n\tworkspace.track(item);\r\n} // for\r\n\r\n\r\n// Update the minimap with all the items. This could be implemented in a nicer way it feels.\r\nworkspace.minimap.update(items);\r\n\r\n// The initial positioning is done based on \"position: relative;\"\r\nlet headeroffset = 80;\r\nlet positions = items.reduce((acc,item)=>{\r\n\tacc.push([item.node.offsetLeft, item.node.offsetTop + headeroffset])\r\n\treturn acc\r\n},[])\r\n\r\n// Now positionthem absolutely, and add the dragging.\r\nitems.forEach((item,i)=>{\r\n\titem.node.style.position = \"absolute\";\r\n\titem.position = positions[i];\r\n}) // forEach\r\n\r\n\r\n\r\n\r\n\r\n// Add the main rendering loop\r\nconsole.log(workspace)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["html2element","html","template","document","createElement","innerHTML","trim","content","firstChild","svg2element","svg","g","createElementNS","isWithinBoundingClientRect","A","B","x","width","y","height","scaleLinear","_domain","_range","d","r","v","mapSpaceAValueToSpaceB","domain","range","Item","obj","node","style","position","viewnode","querySelector","previewnode","maxWidth","active","itemRelativePosition","onmousedown","e","contains","target","isConnected","preventDefault","rect","getBoundingClientRect","clientX","clientY","parentNode","insertBefore","onmousemove","p","parentElement","k","Number","transform","split","replace","parentRect","pageX","pageY","onmove","onmouseup","onmouseenter","onmouseleave","display","parseFloat","left","top","point","Individual","task","taskId","background","color","opacity","MiniMapIcon","item","xscale","yscale","highlight","itemClientRect","setAttribute","dom2range","members","Math","sqrt","length","MiniMapViewRect","clickedItemOffset","svgClientRect","reposition","window","innerWidth","innerHeight","MiniMap","_icons","viewrect","appendChild","filter","icon","remove","ic","range2dom","getAttribute","push","i","icons","map","indexOf","splice","items","forEach","add","centerdata","init","render","domains","calculateInitialMinimapDomain","xdiff","ydiff","u","max","update","bodyClientRect","body","reduce","acc","minx","maxx","miny","maxy","POSITIVE_INFINITY","NEGATIVE_INFINITY","Lasso","polygon","_boundary","boundary","addEventListener","event","clearBoundary","addBoundaryPoint","draw","hide","zIndex","onend","svgbox","isInside","n","passesEdge","join","p0","p1","icontemplate","Group","annotations","head","dissolvebutton","dissolve","current","uncolorAllIcons","querySelectorAll","iconobj","pressTimer","releaseMember","release","clearTimeout","setTimeout","offset","origin","NavigationManager","groups","scale","dx","dy","tabletop","getElementById","container","sketchpad","zoom","deltaY","min","adjustview","minimap","onwheel","getoffset","currenttransform","lasso","findItemsInLasso","selected","itemrect","miditem","isPointInside","selectedIndividuals","makegroup","e0","which","checksize","data","sepal_length","sepal_width","workspace","track","headeroffset","positions","offsetLeft","offsetTop","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,SAASA,YAAT,CAAsBC,IAAtB,EAA2B;QAC5BC,QAAQ,GAAGC,QAAQ,CAACC,aAATD,CAAuB,UAAvBA;EACfD,EAAAA,QAAQ,CAACG,SAATH,GAAqBD,IAAI,CAACK,IAALL,EAArBC,CAFgC;;WAGzBA,QAAQ,CAACK,OAATL,CAAiBM;;;EAGnB,SAASC,WAAT,CAAqBC,GAArB,EAAyB;QAC1BC,CAAC,GAAGR,QAAQ,CAACS,eAATT,CAAyB,4BAAzBA,EAAuD,GAAvDA;EACRQ,EAAAA,CAAC,CAACN,SAAFM,GAAcD,GAAG,CAACJ,IAAJI,EAAdC;WACOA,CAAC,CAACH;;;EAqGJ,SAASK,0BAAT,CAAoCC,CAApC,EAAuCC,CAAvC,EAAyC;;WAEtCD,CAAC,CAACE,CAAFF,GAAMC,CAAC,CAACC,CAARF,IAAaA,CAAC,CAACE,CAAFF,GAAMC,CAAC,CAACC,CAAFD,GAAMA,CAAC,CAACE,KAA3BH,IACAA,CAAC,CAACI,CAAFJ,GAAMC,CAAC,CAACG,CADRJ,IACaA,CAAC,CAACI,CAAFJ,GAAMC,CAAC,CAACG,CAAFH,GAAMA,CAAC,CAACI;;;MAKxBC,WAAb;;;;WAEEC,UAAU,CAAC,CAAD,EAAI,CAAJ;WACVC,SAAS,CAAC,CAAD,EAAI,CAAJ;;;;;;qBAGG;eAAS,KAAKD;EAN5B;;WAKE,YAAA,CAAWE,CAAX,EAAa;aAAOF,UAAUE;;;;;qBAInB;eAAS,KAAKD;EAT3B;;WAQE,YAAA,CAAUE,CAAV,EAAY;aAAOF,SAASE;;;;aAG5B,kBAAA,CAAUC,CAAV,EAAY;eACNC,sBAAsB,CAACD,CAAD,EAAI,KAAKE,MAAT,EAAiB,KAAKC,KAAtB;EAZ9B;;;;aAeE,kBAAA,CAAUH,CAAV,EAAY;eACNC,sBAAsB,CAACD,CAAD,EAAI,KAAKG,KAAT,EAAgB,KAAKD,MAArB;EAhB9B;;;;;;;EAoBA,SAASD,sBAAT,CAAgCD,CAAhC,EAAmCX,CAAnC,EAAsCC,CAAtC,EAAwC;WAChC,CAACU,CAAC,GAACX,CAAC,CAAC,CAAD,CAAJ,KAAUA,CAAC,CAAC,CAAD,CAADA,GAAKA,CAAC,CAAC,CAAD,CAAhB,KAAwBC,CAAC,CAAC,CAAD,CAADA,GAAKA,CAAC,CAAC,CAAD,CAA9B,IAAqCA,CAAC,CAAC,CAAD;;;ECzI9C,IAAIb,UAAQ,wTAAZ;EAaA;EACA;AACA;EACA;EACA;;MACqB2B;;oBAMN;;;WAHbZ,QAAQ;WACRE,SAAS;UAGNW,GAAG,GAAG;EAGVA,IAAAA,GAAG,CAACC,IAAJD,GAAW9B,YAAY,CAACE,UAAD,CAAvB4B;EACAA,IAAAA,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAeG,QAAfH,GAA0B,UAA1BA;EAEAA,IAAAA,GAAG,CAACI,QAAJJ,GAAeA,GAAG,CAACC,IAAJD,CAASK,aAATL,CAAuB,UAAvBA,CAAfA;EACAA,IAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmBX,MAAnBW,GAA4BA,GAAG,CAACX,MAAJW,GAAa,IAAzCA;EACAA,IAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmBb,KAAnBa,GAA2BA,GAAG,CAACb,KAAJa,GAAY,IAAvCA;EAEAA,IAAAA,GAAG,CAACM,WAAJN,GAAkBA,GAAG,CAACC,IAAJD,CAASK,aAATL,CAAuB,aAAvBA,CAAlBA;EACAA,IAAAA,GAAG,CAACM,WAAJN,CAAgBE,KAAhBF,CAAsBO,QAAtBP,GAAiCA,GAAG,CAACb,KAAJa,GAAY,IAA7CA,CAZc;;UAeVQ,MAAM,GAAG;UACTC,oBAAoB,GAAG,CAAC,CAAD,EAAI,CAAJ,EAhBb;;;;EAsBdT,IAAAA,GAAG,CAACC,IAAJD,CAASU,WAATV,GAAuB,UAASW,CAAT,EAAW;YAC7BX,GAAG,CAACC,IAAJD,CAASY,QAATZ,CAAkBW,CAAC,CAACE,MAApBb,KAA+BW,CAAC,CAACE,MAAFF,IAAYX,GAAG,CAACI,QAA/CJ,IAA2DA,GAAG,CAACC,IAAJD,CAASc,aAAY;EACpFH,QAAAA,CAAC,CAACI,cAAFJ;cACIK,IAAI,GAAGhB,GAAG,CAACC,IAAJD,CAASiB,qBAATjB;EAEXQ,QAAAA,MAAM,GAAG,IAATA;EACAC,QAAAA,oBAAoB,GAAG,CACrBE,CAAC,CAACO,OAAFP,GAAYK,IAAI,CAAC9B,CADI,EAErByB,CAAC,CAACQ,OAAFR,GAAYK,IAAI,CAAC5B,CAFI,CAAvBqB,CALoF;;EAWpFT,QAAAA,GAAG,CAACC,IAAJD,CAASoB,UAATpB,CAAoBqB,YAApBrB,CAAiCA,GAAG,CAACC,IAArCD,EAA2C,IAA3CA;EAZiC,OAAA;;EAAlC,KAAAA,CAtBc;;;EAqCdA,IAAAA,GAAG,CAACC,IAAJD,CAASsB,WAATtB,GAAuB,UAASW,CAAT,EAAW;YAC7BH,QAAO;EACXG,QAAAA,CAAC,CAACI,cAAFJ,GADW;;cAIPY,CAAC,GAAGvB,GAAG,CAACC,IAAJD,CAASwB;cACbC,CAAC,GAAGC,MAAM,CAAEH,CAAC,CAACrB,KAAFqB,CAAQI,SAARJ,CAAkBK,KAAlBL,CAAwB,GAAxBA,EAA6B,CAA7BA,EAAgCM,OAAhCN,CAAwC,YAAxCA,EAAsD,EAAtDA,CAAF;cACVO,UAAU,GAAGP,CAAC,CAACN,qBAAFM;cAEbrC,CAAC,GAAGyB,CAAC,CAACoB,KAAFpB,GAAUmB,UAAU,CAAC5C,CAArByB,GAAyBF,oBAAoB,CAAC,CAAD;cACjDrB,CAAC,GAAGuB,CAAC,CAACqB,KAAFrB,GAAUmB,UAAU,CAAC1C,CAArBuB,GAAyBF,oBAAoB,CAAC,CAAD;EAErDT,QAAAA,GAAG,CAACG,QAAJH,GAAe,CAACd,CAAC,GAACuC,CAAH,EAAMrC,CAAC,GAACqC,CAAR,CAAfzB;EAEAA,QAAAA,GAAG,CAACiC,MAAJjC;EAdiC,OAAA;;EAAlC,KAAAA,CArCc;;;EAsDdA,IAAAA,GAAG,CAACC,IAAJD,CAASkC,SAATlC,GAAqB,YAAU;EAAEQ,MAAAA,MAAM,GAAG,KAATA;EAAjC,KAAAR,CAtDc;;;EAuDdA,IAAAA,GAAG,CAACC,IAAJD,CAASmC,YAATnC,GAAwB,YAAU;EAAEQ,MAAAA,MAAM,GAAG,KAATA;EAApC,KAAAR,CAvDc;;;EAwDdA,IAAAA,GAAG,CAACC,IAAJD,CAASoC,YAATpC,GAAwB,YAAU;EAAEQ,MAAAA,MAAM,GAAG,KAATA;EAApC,KAAAR,CAxDc;;;;;;;;aA6Db,aAAA,GAAM;YACHA,GAAG,GAAG;EACVA,MAAAA,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAeqC,OAAfrC,GAAyB,EAAzBA;;;;;aAGC,aAAA,GAAM;YACHA,GAAG,GAAG;EACVA,MAAAA,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAeqC,OAAfrC,GAAyB,MAAzBA;;;;;;qBASe;YACTA,GAAG,GAAG;eACH,CACLsC,UAAU,CAACtC,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAeuC,IAAhB,CADL,EAERD,UAAU,CAACtC,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAewC,GAAhB,CAFF;;;;WARR,YAAA,CAAaC,KAAb,EAAmB;YAChBzC,GAAG,GAAG;EACVA,MAAAA,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAeuC,IAAfvC,GAAsByC,KAAK,CAAC,CAAD,CAALA,GAAW,IAAjCzC;EACAA,MAAAA,GAAG,CAACC,IAAJD,CAASE,KAATF,CAAewC,GAAfxC,GAAsByC,KAAK,CAAC,CAAD,CAALA,GAAW,IAAjCzC;;;;aAYC,kBAAA,GAAW;;;;;aAIX,eAAA,GAAQ;;;;;;;MChHW0C;;;;;wBACPC,MAAK;;;;;;;UAEX3C,GAAG,iCAFQ;;;EAKlBA,IAAAA,GAAG,CAAC2C,IAAJ3C,GAAW2C,IAAX3C;EACAA,IAAAA,GAAG,CAACC,IAAJD,CAASK,aAATL,CAAuB,YAAvBA,EAAqCzB,SAArCyB,GAAiD2C,IAAI,CAACC,MAAtD5C;;;;;;;aAIC,kBAAA,GAAW;YACRA,GAAG,GAAG,KADE;;YAIRgB,IAAI,GAAGhB,GAAG,CAACC,IAAJD,CAASiB,qBAATjB;;YACRgB,IAAI,CAAC7B,KAAL6B,GAAa,KAAI;;EAEnBhB,QAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmB6C,UAAnB7C,GAAgCA,GAAG,CAAC2C,IAAJ3C,CAAS8C,KAAzC9C;EACAA,QAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmB+C,OAAnB/C,GAA6B,CAA7BA;EAHD,aAIO;;EAENA,QAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmB6C,UAAnB7C,GAAgC,EAAhCA;EACAA,QAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmB+C,OAAnB/C,GAA6B,KAA7BA;EAZW,OAAA;;;;;;;IAX2BD;;ECFxC,IAAI3B,UAAQ,sDAAZ;;MAEqB4E;yBACLC,MAAK;;;UACfjD,GAAG,GAAG;EACVA,IAAAA,GAAG,CAACiD,IAAJjD,GAAWiD,IAAXjD;EACAA,IAAAA,GAAG,CAACC,IAAJD,GAAWrB,WAAW,CAACP,UAAD,CAAtB4B;;;;;;aAID,eAAA,CAAOkD,MAAP,EAAeC,MAAf,EAAuBC,SAAvB,EAAiC;;;YAG5BpD,GAAG,GAAG,KAHsB;;YAM5BqD,cAAc,GAAGrD,GAAG,CAACiD,IAAJjD,CAASC,IAATD,CAAciB,qBAAdjB;YAEjBd,CAAC,GAAGmE,cAAc,CAACd,IAAfc,GAAsBA,cAAc,CAAClE,KAAfkE,GAAqB;YAC/CjE,CAAC,GAAGiE,cAAc,CAACb,GAAfa,GAAqBA,cAAc,CAAChE,MAAfgE,GAAsB;EAEnDrD,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,IAAtBA,EAA4BkD,MAAM,CAACK,SAAPL,CAAkBhE,CAAlBgE,CAA5BlD;EACAA,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,IAAtBA,EAA4BmD,MAAM,CAACI,SAAPJ,CAAkB/D,CAAlB+D,CAA5BnD;EAGAA,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,MAAtBA,EAA8BoD,SAAS,GAAG,QAAH,GAAc,gBAArDpD;EACAA,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,SAAtBA,EAAiCA,GAAG,CAACiD,IAAJjD,CAASC,IAATD,CAAcE,KAAdF,CAAoBqC,OAArDrC,EAhBgC;;YAoB7BA,GAAG,CAACiD,IAAJjD,CAASwD,SAAQ;;EAEnBxD,QAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,GAAtBA,EAA2ByD,IAAI,CAACC,IAALD,CAAWzD,GAAG,CAACiD,IAAJjD,CAASwD,OAATxD,CAAiB2D,MAA5BF,IAAqC,CAAhEzD;;;;;;;;;EChCH,IAAI5B,UAAQ,iHAAZ;;MAEqBwF;+BAEP;;;UACR5D,GAAG,GAAG;EAEVA,IAAAA,GAAG,CAACC,IAAJD,GAAWrB,WAAW,CAACP,UAAD,CAAtB4B,CAHY;;UAORQ,QAAQqD;;EAGZ7D,IAAAA,GAAG,CAACC,IAAJD,CAASU,WAATV,GAAuB,UAASW,CAAT,EAAW;EACjCH,MAAAA,MAAM,GAAG,IAATA,CADiC;;YAI7B6C,cAAc,GAAGrD,GAAG,CAACC,IAAJD,CAASiB,qBAATjB;EACrB6D,MAAAA,iBAAiB,GAAG;EACnB3E,QAAAA,CAAC,EAAEmE,cAAc,CAACnE,CAAfmE,GAAmB1C,CAAC,CAACO,OADL;EAEnB9B,QAAAA,CAAC,EAAEiE,cAAc,CAACjE,CAAfiE,GAAmB1C,CAAC,CAACQ;EAFL,OAApB0C,CALiC;EAAlC,KAAA7D,CAVY;;;EAoBZA,IAAAA,GAAG,CAACC,IAAJD,CAASsB,WAATtB,GAAuB,UAASW,CAAT,EAAW;YAC9BH,QAAO;;cAELsD,aAAa,GAAG9D,GAAG,CAACC,IAAJD,CAASwB,aAATxB,CAAuBiB,qBAAvBjB,GAFX;;cAMNjB,0BAA0B,CAAC;EAACG,UAAAA,CAAC,EAAEyB,CAAC,CAACO,OAAN;EAAe9B,UAAAA,CAAC,EAAEuB,CAAC,CAACQ;EAApB,SAAD,EAA+B2C,aAA/B,GAA8C;gBACtE5E,CAAC,GAAGyB,CAAC,CAACO,OAAFP,GAAYmD,aAAa,CAAC5E,CAA1ByB,GAA8BkD,iBAAiB,CAAC3E;gBACpDE,CAAC,GAAGuB,CAAC,CAACQ,OAAFR,GAAYmD,aAAa,CAAC1E,CAA1BuB,GAA8BkD,iBAAiB,CAACzE;EAExDY,UAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,GAAtBA,EAA2Bd,CAA3Bc;EACAA,UAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,GAAtBA,EAA2BZ,CAA3BY,EAL0E;;EAQ1EA,UAAAA,GAAG,CAAC+D,UAAJ/D;EARD,eASO;EACNQ,UAAAA,MAAM,GAAG,KAATA;EAhBQ,SAAA;;EADuB,OAAA;;EAAlC,KAAAR,CApBY;;;EA0CZA,IAAAA,GAAG,CAACC,IAAJD,CAASkC,SAATlC,GAAuB,YAAU;EAChCQ,MAAAA,MAAM,GAAG,KAATA;EADD,KAAAR,CA1CY;;;;;;;aAkDb,aAAA,CAAKkD,MAAL,EAAaC,MAAb,EAAoB;YACfnD,GAAG,GAAG,KADS;;EAGnBA,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,GAAtBA,EAA4BkD,MAAM,CAACK,SAAPL,CAAiB,CAAjBA,CAA5BlD;EACAA,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,GAAtBA,EAA4BmD,MAAM,CAACI,SAAPJ,CAAiB,CAAjBA,CAA5BnD;;;;;;aAKD,eAAA,CAAOkD,MAAP,EAAeC,MAAf,EAAsB;YACjBnD,GAAG,GAAG,KADW;;YAIjBb,KAAK,GAAG+D,MAAM,CAACK,SAAPL,CAAiBc,MAAM,CAACC,UAAxBf,IAAsCA,MAAM,CAACK,SAAPL,CAAiB,CAAjBA;YAC9C7D,MAAM,GAAG8D,MAAM,CAACI,SAAPJ,CAAiBa,MAAM,CAACE,WAAxBf,IAAuCA,MAAM,CAACI,SAAPJ,CAAiB,CAAjBA;EAEpDnD,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,OAAtBA,EAAgCb,KAAhCa;EACAA,MAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,QAAtBA,EAAgCX,MAAhCW;;;;;;aAID,mBAAA,GAAY;;;;;;;EC1Eb;EACA;AACA;EACA;EACA;;EACA,IAAM5B,UAAQ,oGAAd;EAKA;;MAGqB+F;uBAMP;;;WAJbhF,QAAQ;WACRE,SAAS;WACT+E,SAAS;UAGJpE,GAAG,GAAG;EAEVA,IAAAA,GAAG,CAACC,IAAJD,GAAWrB,WAAW,CAACP,UAAD,CAAtB4B;EACAA,IAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,OAAtBA,EAA+BA,GAAG,CAACb,KAAnCa;EACAA,IAAAA,GAAG,CAACC,IAAJD,CAASsD,YAATtD,CAAsB,QAAtBA,EAAgCA,GAAG,CAACX,MAApCW,EALY;;;EAYZA,IAAAA,GAAG,CAACqE,QAAJrE,GAAe,IAAI4D,eAAJ,EAAf5D;EACAA,IAAAA,GAAG,CAACC,IAAJD,CAASsE,WAATtE,CAAqBA,GAAG,CAACqE,QAAJrE,CAAaC,IAAlCD,EAbY;;;EAkBZA,IAAAA,GAAG,CAACkD,MAAJlD,GAAa,IAAIV,WAAJ,EAAbU;EACAA,IAAAA,GAAG,CAACkD,MAAJlD,CAAWF,KAAXE,GAAmB,CAAC,CAAD,EAAIA,GAAG,CAACb,KAAR,CAAnBa;EAEAA,IAAAA,GAAG,CAACmD,MAAJnD,GAAa,IAAIV,WAAJ,EAAbU;EACAA,IAAAA,GAAG,CAACmD,MAAJnD,CAAWF,KAAXE,GAAmB,CAAC,CAAD,EAAIA,GAAG,CAACX,MAAR,CAAnBW,CAtBY;;;;;;;;;qBAqCF;eACH,KAAKoE,MAAL,CAAYG,MAAZ,CAAmB,UAAAC,IAAA,EAAM;iBACxBA,IAAI,CAACvB,IAALuB,CAAUvE,IAAVuE,CAAe1D,WAAf0D,GAA6B,IAA7BA,GAAoCA,IAAI,CAACvE,IAALuE,CAAUC,MAAVD;EADrC,OAAA;;;WALR,YAAA,CAAUE,EAAV,EAAa;aACPN,SAASM;;;;aAUf,kBAAA,GAAW;YACH1E,GAAG,GAAG;eACH,CAAEA,GAAG,CAACkD,MAAJlD,CAAW2E,SAAX3E,CAAsBA,GAAG,CAACqE,QAAJrE,CAAaC,IAAbD,CAAkB4E,YAAlB5E,CAA+B,GAA/BA,CAAtBA,CAAF,EACEA,GAAG,CAACmD,MAAJnD,CAAW2E,SAAX3E,CAAsBA,GAAG,CAACqE,QAAJrE,CAAaC,IAAbD,CAAkB4E,YAAlB5E,CAA+B,GAA/BA,CAAtBA,CADF;;;;;;aAMX,YAAA,CAAIiD,IAAJ,EAAS;YACJjD,GAAG,GAAG;YACNwE,IAAI,GAAG,IAAIxB,WAAJ,CAAgBC,IAAhB;EACXjD,MAAAA,GAAG,CAACC,IAAJD,CAASK,aAATL,CAAuB,SAAvBA,EAAkCsE,WAAlCtE,CAA8CwE,IAAI,CAACvE,IAAnDD;;EACAA,MAAAA,GAAG,CAACoE,MAAJpE,CAAW6E,IAAX7E,CAAgBwE,IAAhBxE;;;;;aAID,eAAA,CAAOiD,IAAP,EAAY;YACPjD,GAAG,GAAG,KADC;;YAGP8E,CAAC,GAAG9E,GAAG,CAAC+E,KAAJ/E,CAAUgF,GAAVhF,CAAc,UAAAwE,IAAA;iBAAMA,IAAI,CAACvB;EAAzB,OAAAjD,EAA+BiF,OAA/BjF,CAAuCiD,IAAvCjD;EACRA,MAAAA,GAAG,CAAC+E,KAAJ/E,CAAU8E,CAAV9E,EAAaC,IAAbD,CAAkByE,MAAlBzE;EACAA,MAAAA,GAAG,CAAC+E,KAAJ/E,CAAUkF,MAAVlF,CAAiB8E,CAAjB9E,EAAoB,CAApBA;;;;;;aAKD,eAAA,CAAOmF,KAAP,EAAa;YACRnF,GAAG,GAAG,KADE;;YAITmF,OAAM;EACRA,QAAAA,KAAK,CAACC,OAAND,CAAc,UAAAlC,IAAA,EAAM;EACnBjD,UAAAA,GAAG,CAACqF,GAAJrF,CAAQiD,IAARjD;EADD,SAAAmF,EADQ;EAJG,OAAA;;;;;EAeZnF,MAAAA,GAAG,CAACsF,UAAJtF;EACAA,MAAAA,GAAG,CAACqE,QAAJrE,CAAauF,IAAbvF,CAAkBA,GAAG,CAACkD,MAAtBlD,EAA8BA,GAAG,CAACmD,MAAlCnD;EACAA,MAAAA,GAAG,CAACwF,MAAJxF;;;;;aAKD,mBAAA,GAAY;YACPA,GAAG,GAAG,KADC;;YAKPyF,OAAO,GAAGC,6BAA6B,CAAC1F,GAAG,CAAC+E,KAAJ/E,CAAUgF,GAAVhF,CAAc,UAAAwE,IAAA;iBAAMA,IAAI,CAACvB;EAAzB,OAAAjD,CAAD,EALhC;;YAQP2F,KAAK,GAAGF,OAAO,CAACvG,CAARuG,CAAU,CAAVA,IAAeA,OAAO,CAACvG,CAARuG,CAAU,CAAVA;YACvBG,KAAK,GAAGH,OAAO,CAACrG,CAARqG,CAAU,CAAVA,IAAeA,OAAO,CAACrG,CAARqG,CAAU,CAAVA;YACvBI,CAAC,GAAG,MAAIpC,IAAI,CAACqC,GAALrC,CAAUkC,KAAK,GAAG3F,GAAG,CAACb,KAAtBsE,EAA6BmC,KAAK,GAAG5F,GAAG,CAACX,MAAzCoE,EAVD;;EAaXzD,MAAAA,GAAG,CAACkD,MAAJlD,CAAWH,MAAXG,GAAoB,CAACyF,OAAO,CAACvG,CAARuG,CAAU,CAAVA,IAAeE,KAAK,GAAC,CAArBF,GAAyBI,CAAC,GAAC7F,GAAG,CAACb,KAAN0G,GAAY,CAAtC,EAAyCJ,OAAO,CAACvG,CAARuG,CAAU,CAAVA,IAAeE,KAAK,GAAC,CAArBF,GAAyBI,CAAC,GAAC7F,GAAG,CAACb,KAAN0G,GAAY,CAA9E,CAApB7F;EACAA,MAAAA,GAAG,CAACmD,MAAJnD,CAAWH,MAAXG,GAAoB,CAACyF,OAAO,CAACrG,CAARqG,CAAU,CAAVA,IAAeG,KAAK,GAAC,CAArBH,GAAyBI,CAAC,GAAC7F,GAAG,CAACX,MAANwG,GAAa,CAAvC,EAA0CJ,OAAO,CAACrG,CAARqG,CAAU,CAAVA,IAAeG,KAAK,GAAC,CAArBH,GAAyBI,CAAC,GAAC7F,GAAG,CAACX,MAANwG,GAAa,CAAhF,CAApB7F;;;;;aAKD,eAAA,GAAQ;;YAEHA,GAAG,GAAG,KAFH;;EAKPA,MAAAA,GAAG,CAACqE,QAAJrE,CAAa+F,MAAb/F,CAAoBA,GAAG,CAACkD,MAAxBlD,EAAgCA,GAAG,CAACmD,MAApCnD;QACQA,GAAG,CAACqE,QAAJrE,CAAaC,IAAbD,CAAkBiB,qBAAlBjB,GAND;;EASPA,MAAAA,GAAG,CAAC+E,KAAJ/E,CAAUoF,OAAVpF,CAAkB,UAAAwE,IAAA,EAAM;EACvBA,QAAAA,IAAI,CAACuB,MAALvB,CAAYxE,GAAG,CAACkD,MAAhBsB,EAAwBxE,GAAG,CAACmD,MAA5BqB;EADD,OAAAxE,EATO;;;;;;;;EAuBT,SAAS0F,6BAAT,CAAuCP,KAAvC,EAA6C;;QAGxCa,cAAc,GAAG3H,QAAQ,CAAC4H,IAAT5H,CAAc4C,qBAAd5C;WAEd8G,KAAK,CAACe,MAANf,CAAa,UAACgB,GAAD,EAAKlD,IAAL,EAAY;UAC3BI,cAAc,GAAGJ,IAAI,CAAChD,IAALgD,CAAUhC,qBAAVgC,GADU;;UAI3BmD,IAAI,GAAG/C,cAAc,CAACd,IAAfc,GAAsB2C,cAAc,CAACzD;UAC5C8D,IAAI,GAAGhD,cAAc,CAACd,IAAfc,GAAsB2C,cAAc,CAACzD,IAArCc,GAA4CA,cAAc,CAAClE;UAElEmH,IAAI,GAAGjD,cAAc,CAACb,GAAfa,GAAqB2C,cAAc,CAACxD;UAC3C+D,IAAI,GAAGlD,cAAc,CAACb,GAAfa,GAAqB2C,cAAc,CAACxD,GAApCa,GAA0CA,cAAc,CAAChE;EAEpE8G,IAAAA,GAAG,CAACjH,CAAJiH,CAAM,CAANA,IAAWC,IAAI,GAAGD,GAAG,CAACjH,CAAJiH,CAAM,CAANA,CAAPC,GAAkBA,IAAlBA,GAAyBD,GAAG,CAACjH,CAAJiH,CAAM,CAANA,CAApCA;EACAA,IAAAA,GAAG,CAACjH,CAAJiH,CAAM,CAANA,IAAWE,IAAI,GAAGF,GAAG,CAACjH,CAAJiH,CAAM,CAANA,CAAPE,GAAkBA,IAAlBA,GAAyBF,GAAG,CAACjH,CAAJiH,CAAM,CAANA,CAApCA;EAEAA,IAAAA,GAAG,CAAC/G,CAAJ+G,CAAM,CAANA,IAAWG,IAAI,GAAGH,GAAG,CAAC/G,CAAJ+G,CAAM,CAANA,CAAPG,GAAkBA,IAAlBA,GAAyBH,GAAG,CAAC/G,CAAJ+G,CAAM,CAANA,CAApCA;EACAA,IAAAA,GAAG,CAAC/G,CAAJ+G,CAAM,CAANA,IAAWI,IAAI,GAAGJ,GAAG,CAAC/G,CAAJ+G,CAAM,CAANA,CAAPI,GAAkBA,IAAlBA,GAAyBJ,GAAG,CAAC/G,CAAJ+G,CAAM,CAANA,CAApCA;aACOA;EAfD,GAAAhB,EAgBJ;EACFjG,IAAAA,CAAC,EAAE,CAACwC,MAAM,CAAC8E,iBAAR,EAA2B9E,MAAM,CAAC+E,iBAAlC,CADD;EAEFrH,IAAAA,CAAC,EAAE,CAACsC,MAAM,CAAC8E,iBAAR,EAA2B9E,MAAM,CAAC+E,iBAAlC;EAFD,GAhBItB,EALqC;;;ECzJ7C,IAAI/G,QAAQ,2IAAZ;;MAKqBsI;;EAErB;EACA;EACA;EACA;mBAEa9H,KAAI;mCAAA;;;UAIXoB,GAAG,GAAG;EAEVA,IAAAA,GAAG,CAACpB,GAAJoB,GAAUpB,GAAVoB;EACAA,IAAAA,GAAG,CAAC2G,OAAJ3G,GAAcpB,GAAG,CAAC0F,WAAJ1F,CAAiBD,WAAW,CAACP,QAAD,CAA5BQ,CAAdoB,CAPe;;EAUfA,IAAAA,GAAG,CAAC4G,SAAJ5G,GAAgB,EAAhBA;EACAA,IAAAA,GAAG,CAAC6G,QAAJ7G,GAAe,EAAfA,CAXe;;EAcfA,IAAAA,GAAG,CAACpB,GAAJoB,CAAQ8G,gBAAR9G,CAAyB,WAAzBA,EAAsC,UAAS+G,KAAT,EAAe;EACpD/G,MAAAA,GAAG,CAACgH,aAAJhH;EACAA,MAAAA,GAAG,CAACQ,MAAJR,GAAa,IAAbA;EAFD,KAAAA,EAde;;EAmBfA,IAAAA,GAAG,CAACpB,GAAJoB,CAAQ8G,gBAAR9G,CAAyB,WAAzBA,EAAsC,UAAS+G,KAAT,EAAe;YACjD/G,GAAG,CAACQ,QAAO;EACbR,QAAAA,GAAG,CAACiH,gBAAJjH,CAAqB+G,KAArB/G;EACAA,QAAAA,GAAG,CAACkH,IAAJlH;EAHmD,OAAA;;EAArD,KAAAA,EAnBe;;EA0BfA,IAAAA,GAAG,CAACpB,GAAJoB,CAAQ8G,gBAAR9G,CAAyB,SAAzBA,EAAoC,UAAS+G,KAAT,EAAe;EAClD/G,MAAAA,GAAG,CAACmH,IAAJnH,GADkD;;EAIlDA,MAAAA,GAAG,CAAC6G,QAAJ7G,GAAeA,GAAG,CAAC4G,SAAnB5G;EACAA,MAAAA,GAAG,CAACQ,MAAJR,GAAa,KAAbA;EACAA,MAAAA,GAAG,CAACpB,GAAJoB,CAAQE,KAARF,CAAcoH,MAAdpH,GAAuB,EAAvBA,CANkD;;EASlDA,MAAAA,GAAG,CAACqH,KAAJrH;EATD,KAAAA,EA1Be;;;;;;aA6ChB,sBAAA,GAAe;YACVA,GAAG,GAAG;EACVA,MAAAA,GAAG,CAAC4G,SAAJ5G,GAAgB,EAAhBA;;;;;aAGD,yBAAA,CAAiB+G,KAAjB,EAAuB;YAClB/G,GAAG,GAAG,KADY;;YAIlBsH,MAAM,GAAGtH,GAAG,CAACpB,GAAJoB,CAAQiB,qBAARjB;;EAEbA,MAAAA,GAAG,CAAC4G,SAAJ5G,CAAc6E,IAAd7E,CAAmB;EAClBd,QAAAA,CAAC,EAAE6H,KAAK,CAAC7F,OAAN6F,GAAgBO,MAAM,CAACpI,CADR;EAElBE,QAAAA,CAAC,EAAE2H,KAAK,CAAC5F,OAAN4F,GAAgBO,MAAM,CAAClI;EAFR,OAAnBY;;;;;aAOD,sBAAA,CAAcyC,KAAd,EAAoB;;YAEfzC,GAAG,GAAG,KAFS;;YAKfuH,QAAQ,GAAG;YAEXC,CAAC,GAAGxH,GAAG,CAAC6G,QAAJ7G,CAAa2D;;YAClB6D,CAAC,GAAC,GAAE;eACF,IAAI1C,CAAC,GAAC,GAAGA,CAAC,GAAC0C,GAAG1C,CAAC,IAAG;;gBAEjBvD,EAAC,GAAGkG,UAAU,CAACzH,GAAG,CAAC6G,QAAJ7G,CAAa8E,CAAC,GAAC,CAAf9E,CAAD,EAAoBA,GAAG,CAAC6G,QAAJ7G,CAAa8E,CAAb9E,CAApB,EAAqCyC,KAArC;;EAClB8E,UAAAA,QAAQ,GAAGhG,EAAC,GAAG,CAACgG,QAAJ,GAAeA,QAA3BA;EAJK,SAAA;;;;cAQFhG,CAAC,GAAGkG,UAAU,CAACzH,GAAG,CAAC6G,QAAJ7G,CAAawH,CAAC,GAAC,CAAfxH,CAAD,EAAoBA,GAAG,CAAC6G,QAAJ7G,CAAa,CAAbA,CAApB,EAAqCyC,KAArC;EAClB8E,QAAAA,QAAQ,GAAGhG,CAAC,GAAG,CAACgG,QAAJ,GAAeA,QAA3BA;EAjBkB,OAAA;;;eAoBZA;;;;;aAGR,aAAA,GAAM;YACDvH,GAAG,GAAG;EACVA,MAAAA,GAAG,CAAC2G,OAAJ3G,CAAYsD,YAAZtD,CAAyB,QAAzBA,EAAmCA,GAAG,CAAC4G,SAAJ5G,CAAcgF,GAAdhF,CAAkB,UAAAuB,CAAA;2BAAMA,CAAC,CAACrC,eAAKqC,CAAC,CAACnC;EAAjC,OAAAY,EAAsC0H,IAAtC1H,CAA2C,GAA3CA,CAAnCA;;;;;aAGD,aAAA,GAAM;;YAEDA,GAAG,GAAG;EACVA,MAAAA,GAAG,CAAC2G,OAAJ3G,CAAYsD,YAAZtD,CAAyB,QAAzBA,EAAmC,EAAnCA;;;;;;aAID,cAAA,GAAO;;;;;;;EAOR,SAASyH,UAAT,CAAoBE,EAApB,EAAwBC,EAAxB,EAA4BnF,KAA5B,EAAkC;;QAG5BkF,EAAE,CAACvI,CAAHuI,GAAOlF,KAAK,CAACrD,CAAbuI,KAAqBC,EAAE,CAACxI,CAAHwI,GAAOnF,KAAK,CAACrD,GAAI;;UAEtCF,CAAC,GAAG,CAAC0I,EAAE,CAAC1I,CAAH0I,GAAOD,EAAE,CAACzI,CAAX,KAAe0I,EAAE,CAACxI,CAAHwI,GAAOD,EAAE,CAACvI,CAAzB,KAA6BqD,KAAK,CAACrD,CAANqD,GAAUkF,EAAE,CAACvI,CAA1C,IAA+CuI,EAAE,CAACzI;aACnDA,CAAC,GAAGuD,KAAK,CAACvD;EAHlB,SAKO;aACC;EATyB,GAAA;;;;EClHlC;EACA;EACA;AACA;EACA;AACA;EACA;AACA;EACA;AACA;EACA;AACA;EACA;AACA;EACA;AACA;AACA;AACA;AACA;EACA;AACA;EACA;EACA;AACA;AACA;EACA;AACA;EACA;AACA;AACA;EACA;EACA;AACA;AACA;EACA;EACA;AACA;AACA;AACA;EACA;EACA;AACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;AACA;EACA;;EAGA,IAAI2I,YAAY,sCAAhB;EAEA;AACA;AACA;EACA;AACA;EACA;EACA;EACA;EACA;AACA;AACA;EACA;;MAGqBC;;;;;;mBAOP3C,OAAO4C,aAAY;;;mCAAA;;;;YAJ/B5I,QAAQ;YACRE,SAAS;;UAMHW,GAAG,iCAHsB;;;UAM5BgI,IAAI,GAAGhI,GAAG,CAACC,IAAJD,CAASK,aAATL,CAAuB,UAAvBA;EACXgI,IAAAA,IAAI,CAAC3H,aAAL2H,CAAmB,YAAnBA,EAAiCzJ,SAAjCyJ,GAA6C,OAA7CA;UAEIC,cAAc,GAAGD,IAAI,CAAC3H,aAAL2H,CAAmB,aAAnBA;EACrBC,IAAAA,cAAc,CAAC/H,KAAf+H,CAAqB5F,OAArB4F,GAA+B,EAA/BA;;EACAA,IAAAA,cAAc,CAACvH,WAAfuH,GAA6B,YAAU;;EAEtCjI,MAAAA,GAAG,CAACkI,QAAJlI;EAFD,KAAAiI,CAXgC;;;;EAiBhCjI,IAAAA,GAAG,CAACwD,OAAJxD,GAAcmF,KAAdnF;EACAA,IAAAA,GAAG,CAACmI,OAAJnI,GAAcmF,KAAK,CAAC,CAAD,CAAnBnF,CAlBgC;;eAuBvBoI,kBAAiB;;EAEzBpI,MAAAA,GAAG,CAACM,WAAJN,CAAgBqI,gBAAhBrI,CAAiC,iBAAjCA,EAAoDoF,OAApDpF,CAA4D,UAAAwE,IAAA,EAAM;EACjEA,QAAAA,IAAI,CAACtE,KAALsE,CAAW3B,UAAX2B,GAAwB,WAAxBA;EADD,OAAAxE,EAFyB;EAvBM,KAAA;;;EA+BhCA,IAAAA,GAAG,CAAC+E,KAAJ/E,GAAYA,GAAG,CAACwD,OAAJxD,CAAYgF,GAAZhF,CAAgB,UAAAiD,IAAA,EAAM;YAE7BqF,OAAO,GAAG;EACbrF,QAAAA,IAAI,EAAEA,IADO;EAEbhD,QAAAA,IAAI,EAAE/B,YAAY,CAAC2J,YAAD;EAFL,QAFmB;;;EASjC7H,MAAAA,GAAG,CAACM,WAAJN,CAAgBsE,WAAhBtE,CAA6BsI,OAAO,CAACrI,IAArCD;;EAGAsI,MAAAA,OAAO,CAACrI,IAARqI,CAAanG,YAAbmG,GAA4B,YAAU;;EAErCtI,QAAAA,GAAG,CAACmI,OAAJnI,GAAcsI,OAAO,CAACrF,IAAtBjD,CAFqC;;EAKrCoI,QAAAA,eAAe;EACfE,QAAAA,OAAO,CAACrI,IAARqI,CAAapI,KAAboI,CAAmBzF,UAAnByF,GAAgC,MAAhCA,CANqC;;EAUrCtI,QAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmB6C,UAAnB7C,GAAgCA,GAAG,CAACmI,OAAJnI,CAAY2C,IAAZ3C,CAAiB8C,KAAjD9C;EACAA,QAAAA,GAAG,CAACI,QAAJJ,CAAaE,KAAbF,CAAmB+C,OAAnB/C,GAA6B,CAA7BA;EAXD,OAAAsI,CAZiC;;;;YA4B7BC;;iBACKC,gBAAe;EACvBxI,QAAAA,GAAG,CAACyI,OAAJzI,CAAYsI,OAAZtI;EA9BgC,OAAA;;;EAiCjCsI,MAAAA,OAAO,CAACrI,IAARqI,CAAapG,SAAboG,GAAyB,YAAU;EACjCI,QAAAA,YAAY,CAACH,UAAD,CAAZG,CADiC;;iBAG1B;EAHT,OAAAJ,CAjCiC;;;EAuCjCA,MAAAA,OAAO,CAACrI,IAARqI,CAAa5H,WAAb4H,GAA2B,YAAU;;EAEnCC,QAAAA,UAAU,GAAGvE,MAAM,CAAC2E,UAAP3E,CAAkBwE,aAAlBxE,EAAiC,IAAjCA,CAAbuE;iBACO;EAHT,OAAAD,CAvCiC;;;eA6C1BA;EA7CI,KAAAtI,CAAZA,CA/BgC;;;;;;;;aAoF/B,gBAAA,CAAQsI,OAAR,EAAgB;;YAEXtI,GAAG,GAAG;EAGVA,MAAAA,GAAG,CAAC+E,KAAJ/E,CAAUkF,MAAVlF,CAAiBA,GAAG,CAAC+E,KAAJ/E,CAAUiF,OAAVjF,CAAkBsI,OAAlBtI,CAAjBA,EAA6C,CAA7CA;EACAA,MAAAA,GAAG,CAACwD,OAAJxD,CAAYkF,MAAZlF,CAAmBA,GAAG,CAACwD,OAAJxD,CAAYiF,OAAZjF,CAAoBsI,OAAO,CAACrF,IAA5BjD,CAAnBA,EAAsD,CAAtDA;EAEAsI,MAAAA,OAAO,CAACrI,IAARqI,CAAa7D,MAAb6D;EACAA,MAAAA,OAAO,CAACrF,IAARqF,CAAarI,IAAbqI,CAAkBpI,KAAlBoI,CAAwBjG,OAAxBiG,GAAkC,EAAlCA;EAEAtI,MAAAA,GAAG,CAACmI,OAAJnI,GAAcA,GAAG,CAAC+E,KAAJ/E,CAAU,CAAVA,EAAaiD,IAA3BjD;EACAA,MAAAA,GAAG,CAAC+E,KAAJ/E,CAAU,CAAVA,EAAaC,IAAbD,CAAkBE,KAAlBF,CAAwB6C,UAAxB7C,GAAqC,MAArCA,CAZe;;EAefA,MAAAA,GAAG,CAACiC,MAAJjC;;;;;aAID,iBAAA,GAAU;YACLA,GAAG,GAAG,KADD;;;;EAMTA,MAAAA,GAAG,CAACC,IAAJD,CAASyE,MAATzE,GANS;;YAWL4I,MAAM,GAAG,CACX5I,GAAG,CAACG,QAAJH,CAAa,CAAbA,IAAkBA,GAAG,CAAC6I,MAAJ7I,CAAW,CAAXA,CADP,EAEdA,GAAG,CAACG,QAAJH,CAAa,CAAbA,IAAkBA,GAAG,CAAC6I,MAAJ7I,CAAW,CAAXA,CAFJ,EAXJ;;EAgBTA,MAAAA,GAAG,CAACwD,OAAJxD,CAAYoF,OAAZpF,CAAoB,UAAAiD,IAAA,EAAM;EACzBA,QAAAA,IAAI,CAAC9C,QAAL8C,GAAgB,CACdA,IAAI,CAAC9C,QAAL8C,CAAc,CAAdA,IAAmB2F,MAAM,CAAC,CAAD,CADX,EAEd3F,IAAI,CAAC9C,QAAL8C,CAAc,CAAdA,IAAmB2F,MAAM,CAAC,CAAD,CAFX,CAAhB3F,CADyB;;EAKzBA,QAAAA,IAAI,CAAChD,IAALgD,CAAU/C,KAAV+C,CAAgBZ,OAAhBY,GAA0B,EAA1BA;EALD,OAAAjD,EAhBS;;EAwBTA,MAAAA,GAAG,CAACiC,MAAJjC;;;;;;IAtIgCD;;EC7EnC;EACA;EACA;;MACqB+I;iCASN;;;WAPb3D,QAAQ;WACR4D,SAAS;WAETC,QAAQ;WACRC,KAAK;WACLC,KAAK;UAGClJ,GAAG,GAAG;EAGbA,IAAAA,GAAG,CAACmJ,QAAJnJ,GAAe3B,QAAQ,CAAC+K,cAAT/K,CAAwB,UAAxBA,CAAf2B;EACGA,IAAAA,GAAG,CAACqJ,SAAJrJ,GAAgBA,GAAG,CAACmJ,QAAJnJ,CAAaK,aAAbL,CAA2B,oBAA3BA,CAAhBA;EACHA,IAAAA,GAAG,CAACsJ,SAAJtJ,GAAgB3B,QAAQ,CAAC+K,cAAT/K,CAAwB,WAAxBA,CAAhB2B,CANc;;EASdA,IAAAA,GAAG,CAACqJ,SAAJrJ,CAAcE,KAAdF,CAAoB2B,SAApB3B,gCAAAA,CATc;;eAaLuJ,KAAKxC,OAAO;EACnBA,MAAAA,KAAK,CAAChG,cAANgG;EAEA/G,MAAAA,GAAG,CAACgJ,KAAJhJ,IAAa+G,KAAK,CAACyC,MAANzC,GAAe,CAAC,KAA7B/G,CAHmB;;EAMnBA,MAAAA,GAAG,CAACgJ,KAAJhJ,GAAYyD,IAAI,CAACgG,GAALhG,CAASA,IAAI,CAACqC,GAALrC,CAAS,IAATA,EAAezD,GAAG,CAACgJ,KAAnBvF,CAATA,EAAoC,CAApCA,CAAZzD,CANmB;;EASnBA,MAAAA,GAAG,CAAC0J,UAAJ1J;;;;EAMFA,IAAAA,GAAG,CAAC2J,OAAJ3J,GAAc,IAAImE,OAAJ,EAAdnE;EACA3B,IAAAA,QAAQ,CAAC+K,cAAT/K,CAAwB,SAAxBA,EAAmCiG,WAAnCjG,CAA+C2B,GAAG,CAAC2J,OAAJ3J,CAAYC,IAA3D5B;EAEA2B,IAAAA,GAAG,CAAC2J,OAAJ3J,CAAYqE,QAAZrE,CAAqBC,IAArBD,CAA0B4J,OAA1B5J,GAAoCuJ,IAApCvJ;;EACAA,IAAAA,GAAG,CAAC2J,OAAJ3J,CAAYqE,QAAZrE,CAAqB+D,UAArB/D,GAAkC,YAAU;YACvC4I,MAAM,GAAG5I,GAAG,CAAC2J,OAAJ3J,CAAY6J,SAAZ7J;EACbA,MAAAA,GAAG,CAACiJ,EAAJjJ,GAAS,CAAE4I,MAAM,CAAC,CAAD,CAAR,GAAc5I,GAAG,CAACgJ,KAA3BhJ;EACAA,MAAAA,GAAG,CAACkJ,EAAJlJ,GAAS,CAAE4I,MAAM,CAAC,CAAD,CAAR,GAAc5I,GAAG,CAACgJ,KAA3BhJ,CAH2C;;EAK3CA,MAAAA,GAAG,CAACqJ,SAAJrJ,CAAcE,KAAdF,CAAoB2B,SAApB3B,GAAgCA,GAAG,CAAC8J,gBAAJ9J,EAAhCA;EALD,KAAAA,CAhCc;;;;;EA2CdA,IAAAA,GAAG,CAAC+J,KAAJ/J,GAAY,IAAI0G,KAAJ,CAAU1G,GAAG,CAACsJ,SAAd,CAAZtJ;;eAESgK,iBAAiB7E,OAAM;YAE3B8E,QAAQ,GAAG9E,KAAK,CAACe,MAANf,CAAa,UAACgB,GAAD,EAAMlD,IAAN,EAAa;cACpCiH,QAAQ,GAAGjH,IAAI,CAAChD,IAALgD,CAAUhC,qBAAVgC;cACXkH,OAAO,GAAG;EACbjL,UAAAA,CAAC,EAAEgL,QAAQ,CAAChL,CAATgL,GAAaA,QAAQ,CAAC/K,KAAT+K,GAAe,CADlB;EAEb9K,UAAAA,CAAC,EAAE8K,QAAQ,CAAC9K,CAAT8K,GAAaA,QAAQ,CAAC7K,MAAT6K,GAAgB;EAFnB;;cAIXjH,IAAI,CAAChD,IAALgD,CAAU/C,KAAV+C,CAAgBZ,OAAhBY,IAA2B,MAA3BA,IAAqCjD,GAAG,CAAC+J,KAAJ/J,CAAUoK,aAAVpK,CAAwBmK,OAAxBnK,GAAiC;EACxEmG,UAAAA,GAAG,CAACtB,IAAJsB,CAASlD,IAATkD;;;iBAEMA;EATO,OAAAhB,EAUZ,EAVYA;eAYR8E;EA3DM,KAAA;;;EA+DdjK,IAAAA,GAAG,CAAC+J,KAAJ/J,CAAUqH,KAAVrH,GAAkB,YAAU;;YAGvBqK,mBAAmB,GAAGL,gBAAgB,CAAEhK,GAAG,CAACmF,KAAN,EAHf;;YAMxBkF,mBAAmB,CAAC1G,MAApB0G,GAA6B,GAAE;;;EAIjCrK,QAAAA,GAAG,CAACsK,SAAJtK,CAAcqK,mBAAdrK;EACAA,QAAAA,GAAG,CAAC2J,OAAJ3J,CAAY+F,MAAZ/F;EAX0B,OAAA;;EAA5B,KAAAA,CA/Dc;;;;EAgFdA,IAAAA,GAAG,CAACmJ,QAAJnJ,CAAa4J,OAAb5J,GAAuBuJ,IAAvBvJ;UAEIQ,QAAQqI,QAAQ0B;;EACpBvK,IAAAA,GAAG,CAACmJ,QAAJnJ,CAAaU,WAAbV,GAA2B,UAASW,CAAT,EAAW;YACjCA,CAAC,CAACE,MAAFF,IAAYX,GAAG,CAACmJ,UAAS;kBACtBxI,CAAC,CAAC6J;iBACH;;EAEH7J,YAAAA,CAAC,CAACI,cAAFJ;EACAH,YAAAA,MAAM,GAAG,IAATA;EACAqI,YAAAA,MAAM,GAAG;EAAC3J,cAAAA,CAAC,EAAEc,GAAG,CAACiJ,EAAR;EAAY7J,cAAAA,CAAC,EAAEY,GAAG,CAACkJ;EAAnB,aAATL;EACA0B,YAAAA,EAAE,GAAG5J,CAAL4J;;;iBAEG;;EAEHvK,YAAAA,GAAG,CAACsJ,SAAJtJ,CAAcE,KAAdF,CAAoBoH,MAApBpH,GAA6B,IAA7BA;EACAA,YAAAA,GAAG,CAAC+J,KAAJ/J,CAAUgH,aAAVhH;EACAA,YAAAA,GAAG,CAAC+J,KAAJ/J,CAAUQ,MAAVR,GAAmB,IAAnBA;;WAb0B;;EADQ,OAAA;;EAAtC,KAAAA,CAnFc;;;EAwGdA,IAAAA,GAAG,CAACmJ,QAAJnJ,CAAasB,WAAbtB,GAA2B,UAASW,CAAT,EAAW;YACjCH,QAAO;EACXG,QAAAA,CAAC,CAACI,cAAFJ,GADW;;EAIXX,QAAAA,GAAG,CAACiJ,EAAJjJ,GAAS6I,MAAM,CAAC3J,CAAP2J,GAAW,CAAElI,CAAC,CAACO,OAAFP,GAAY4J,EAAE,CAACrJ,OAAjB,IAA2BlB,GAAG,CAACgJ,KAAnDhJ;EACAA,QAAAA,GAAG,CAACkJ,EAAJlJ,GAAS6I,MAAM,CAACzJ,CAAPyJ,GAAW,CAAElI,CAAC,CAACQ,OAAFR,GAAY4J,EAAE,CAACpJ,OAAjB,IAA2BnB,GAAG,CAACgJ,KAAnDhJ,CALW;;EAQXA,QAAAA,GAAG,CAAC0J,UAAJ1J;EATqC,OAAA;;EAAtC,KAAAA,CAxGc;;;EAoHdA,IAAAA,GAAG,CAACmJ,QAAJnJ,CAAakC,SAAblC,GAAyB,YAAU;EAAEQ,MAAAA,MAAM,GAAG,KAATA;EAArC,KAAAR,CApHc;;;EAqHdA,IAAAA,GAAG,CAACmJ,QAAJnJ,CAAamC,YAAbnC,GAA4B,YAAU;EAAEQ,MAAAA,MAAM,GAAG,KAATA;EAAxC,KAAAR,CArHc;;;EAsHdA,IAAAA,GAAG,CAACmJ,QAAJnJ,CAAaoC,YAAbpC,GAA4B,YAAU;EAAEQ,MAAAA,MAAM,GAAG,KAATA;EAAxC,KAAAR,CAtHc;;;;;;;;aAmIb,cAAA,CAAMiD,IAAN,EAAW;YACRjD,GAAG,GAAG;EAEVA,MAAAA,GAAG,CAACqJ,SAAJrJ,CAAcsE,WAAdtE,CAA0BiD,IAAI,CAAChD,IAA/BD;;EAEAiD,MAAAA,IAAI,CAAChB,MAALgB,GAAc,YAAU;;;EAKvBjD,QAAAA,GAAG,CAAC2J,OAAJ3J,CAAY+F,MAAZ/F;EALD,OAAAiD,CALY;;;EAaZjD,MAAAA,GAAG,CAACmF,KAAJnF,CAAU6E,IAAV7E,CAAeiD,IAAfjD;;;;;aAIC,mBAAA,GAAY;YACTA,GAAG,GAAG,KADG;;EAGbA,MAAAA,GAAG,CAACqJ,SAAJrJ,CAAcE,KAAdF,CAAoB2B,SAApB3B,GAAgCA,GAAG,CAAC8J,gBAAJ9J,EAAhCA,CAHa;;EAMbA,MAAAA,GAAG,CAAC2J,OAAJ3J,CAAY+F,MAAZ/F,GANa;;EASbA,MAAAA,GAAG,CAACmF,KAAJnF,CAAUoF,OAAVpF,CAAkB,UAAAiD,IAAA,EAAM;EACvBA,QAAAA,IAAI,CAACwH,SAALxH;EADD,OAAAjD,EATa;;;;;aAcZ,yBAAA,GAAkB;YACfA,GAAG,GAAG;+BACMA,GAAG,CAACgJ,8BAAoBhJ,GAAG,CAACiJ,kBAAQjJ,GAAG,CAACkJ;;;;;;;EASzD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;;EAGA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;yBAEY/D,OAAM;YACVnF,GAAG,GAAG,KADI;;YAIbuB,CAAC,GAAG,CAAC,CAAD,EAAI,CAAJ;EACR4D,MAAAA,KAAK,CAACC,OAAND,CAAc,UAAAlC,IAAA,EAAM;EACnB1B,QAAAA,CAAC,CAAC,CAAD,CAADA,IAAQe,UAAU,CAACW,IAAI,CAAChD,IAALgD,CAAU/C,KAAV+C,CAAgBV,IAAjB,CAAVD,GAAmC6C,KAAK,CAACxB,MAAjDpC;EACAA,QAAAA,CAAC,CAAC,CAAD,CAADA,IAAQe,UAAU,CAACW,IAAI,CAAChD,IAALgD,CAAU/C,KAAV+C,CAAgBT,GAAjB,CAAVF,GAAkC6C,KAAK,CAACxB,MAAhDpC;EACA0B,QAAAA,IAAI,CAACkE,IAALlE;EAHD,OAAAkC,EALiB;;YAWbtG,CAAC,GAAG,IAAIiJ,KAAJ,CAAU3C,KAAV;EACRnF,MAAAA,GAAG,CAAC+I,MAAJ/I,CAAW6E,IAAX7E,CAAgBnB,CAAhBmB;EAEAnB,MAAAA,CAAC,CAACsB,QAAFtB,GAAa0C,CAAb1C;EACAA,MAAAA,CAAC,CAACgK,MAAFhK,GAAW0C,CAAX1C;EAGAmB,MAAAA,GAAG,CAACqJ,SAAJrJ,CAAcsE,WAAdtE,CAA0BnB,CAAC,CAACoB,IAA5BD;EACAA,MAAAA,GAAG,CAAC2J,OAAJ3J,CAAYqF,GAAZrF,CAAgBnB,CAAhBmB;;EACAnB,MAAAA,CAAC,CAACoD,MAAFpD,GAAW,YAAU;EACpBmB,QAAAA,GAAG,CAAC2J,OAAJ3J,CAAY+F,MAAZ/F;EADD,OAAAnB,CApBiB;;;;;;;;;ECjMlB,IAAM6L,IAAI,GAAG,CACb;EAAC9H,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CADa,EAEb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,CAAnD;EAAsD9H,EAAAA,KAAK,EAAE;EAA7D,CAFa,EAGb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CAHa,EAIb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CAJa,EAKb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,CAAjC;EAAoCC,EAAAA,WAAW,EAAE,GAAjD;EAAsD9H,EAAAA,KAAK,EAAE;EAA7D,CALa,EAMb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CANa,EAOb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CAPa,EAQb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,CAAjC;EAAoCC,EAAAA,WAAW,EAAE,GAAjD;EAAsD9H,EAAAA,KAAK,EAAE;EAA7D,CARa,EASb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CATa,EAUb;EAACF,EAAAA,MAAM,EAAE,QAAT;EAAmB+H,EAAAA,YAAY,EAAE,GAAjC;EAAsCC,EAAAA,WAAW,EAAE,GAAnD;EAAwD9H,EAAAA,KAAK,EAAE;EAA/D,CAVa,EAWb;EAACF,EAAAA,MAAM,EAAE,SAAT;EAAoB+H,EAAAA,YAAY,EAAE,GAAlC;EAAuCC,EAAAA,WAAW,EAAE,GAApD;EAAyD9H,EAAAA,KAAK,EAAE;EAAhE,CAXa,EAYb;EAACF,EAAAA,MAAM,EAAE,SAAT;EAAoB+H,EAAAA,YAAY,EAAE,GAAlC;EAAuCC,EAAAA,WAAW,EAAE,GAApD;EAAyD9H,EAAAA,KAAK,EAAE;EAAhE,CAZa,EAab;EAACF,EAAAA,MAAM,EAAE,SAAT;EAAoB+H,EAAAA,YAAY,EAAE,GAAlC;EAAuCC,EAAAA,WAAW,EAAE,CAApD;EAAuD9H,EAAAA,KAAK,EAAE;EAA9D,CAba,EAcb;EAACF,EAAAA,MAAM,EAAE,SAAT;EAAoB+H,EAAAA,YAAY,EAAE,GAAlC;EAAuCC,EAAAA,WAAW,EAAE,CAApD;EAAuD9H,EAAAA,KAAK,EAAE;EAA9D,CAda,EAeb;EAACF,EAAAA,MAAM,EAAE,SAAT;EAAoB+H,EAAAA,YAAY,EAAE,GAAlC;EAAuCC,EAAAA,WAAW,EAAE,CAApD;EAAuD9H,EAAAA,KAAK,EAAE;EAA9D,CAfa,EAgBb;EAACF,EAAAA,MAAM,EAAE,SAAT;EAAoB+H,EAAAA,YAAY,EAAE,GAAlC;EAAuCC,EAAAA,WAAW,EAAE,GAApD;EAAyD9H,EAAAA,KAAK,EAAE;EAAhE,CAhBa,CAAb;EAmBA;;EACA,IAAI+H,SAAS,GAAG,IAAI/B,iBAAJ,EAAhB;EAEA,IAAI3D,KAAK,GAAG,EAAZ;;EAEA,KAAI,IAAIL,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC4F,IAAI,CAAC/G,MAApB,EAA4BmB,CAAC,EAA7B,EAAgC;QAC3B7B,IAAI,GAAG,IAAIP,UAAJ,CAAegI,IAAI,CAAC5F,CAAD,CAAnB;EACXK,EAAAA,KAAK,CAACN,IAANM,CAAWlC,IAAXkC,EAF+B;;EAK/BlC,EAAAA,IAAI,CAAChD,IAALgD,CAAU/C,KAAV+C,CAAgB9C,QAAhB8C,GAA2B,EAA3BA,CAL+B;;EAQ/B4H,EAAAA,SAAS,CAACC,KAAVD,CAAgB5H,IAAhB4H;;EAID;;;EACAA,SAAS,CAAClB,OAAVkB,CAAkB9E,MAAlB8E,CAAyB1F,KAAzB0F;;EAGA,IAAIE,YAAY,GAAG,EAAnB;EACA,IAAIC,SAAS,GAAG7F,KAAK,CAACe,MAANf,CAAa,UAACgB,GAAD,EAAKlD,IAAL,EAAY;EACxCkD,EAAAA,GAAG,CAACtB,IAAJsB,CAAS,CAAClD,IAAI,CAAChD,IAALgD,CAAUgI,UAAX,EAAuBhI,IAAI,CAAChD,IAALgD,CAAUiI,SAAVjI,GAAsB8H,YAA7C,CAAT5E;WACOA;EAFQ,CAAAhB,EAGd,EAHcA,CAAhB;;EAMAA,KAAK,CAACC,OAAND,CAAc,UAAClC,IAAD,EAAM6B,CAAN,EAAU;EACvB7B,EAAAA,IAAI,CAAChD,IAALgD,CAAU/C,KAAV+C,CAAgB9C,QAAhB8C,GAA2B,UAA3BA;EACAA,EAAAA,IAAI,CAAC9C,QAAL8C,GAAgB+H,SAAS,CAAClG,CAAD,CAAzB7B;EAFD,CAAAkC;EASA;;EACAgG,OAAO,CAACC,GAARD,CAAYN,SAAZM;;;;;;"}
{"version":3,"file":"spatialknowledge.js","sources":["../../src/helpers.js","../../src/grouping/Item.js","../../src/navigation/MiniMapIcon.js","../../src/navigation/MiniMapViewRect.js","../../src/navigation/MiniMap.js","../../src/navigation/NavigationManager.js","../../src/main.js"],"sourcesContent":["export function html2element(html){\r\n  let template = document.createElement('template'); \r\n  template.innerHTML = html.trim(); // Never return a text node of whitespace as the result\r\n  return template.content.firstChild;\r\n} // html2element\r\n\r\nexport function svg2element(svg){\r\n  let g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n  g.innerHTML = svg.trim();\r\n  return g.firstChild;\r\n} // svg2element\r\n\r\n\r\n\r\n\r\n// How to make the addition of dragging more general?? There are some things that have to happen. Pass them in as additional functions?\r\nexport function addDraggingToItem(item, onstart, ondrag, onend){\r\n\t// Add an object to facilitate the dragging.\r\n\t\r\n\tlet active = false;\r\n\tlet itemRelativePosition = [0, 0];\r\n\t\r\n\titem.node.onmouseenter = function(){\r\n\t\tactive = false;\r\n\t} // onmouseenter\r\n\titem.node.onmouseleave = function(){\r\n\t\tactive = false;\r\n\t} // onmouseleave\r\n\titem.node.onmousedown = function(e){\r\n\t\tif(e.target == item.node || e.target == item.wrappednode){\r\n\t\t\tlet rect = item.node.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\tactive = true;\r\n\t\t\titemRelativePosition = [\r\n\t\t\t\te.clientX - rect.x,\r\n\t\t\t\te.clientY - rect.y\r\n\t\t\t];\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Also move the viewFrame div up so that dragging over otehr higher divs is uninterrupted.\r\n\t\t\titem.node.parentNode.insertBefore(item.node, null);\r\n\t\t\t\r\n\t\t\tif(onstart){onstart()} // if\r\n\t\t} // if\r\n\t} // onmousedown\r\n\titem.node.onmousemove = function(e){\r\n\t\tif(active){\r\n\t\t\tlet x = e.pageX - itemRelativePosition[0];\r\n\t\t\tlet y = e.pageY - itemRelativePosition[1];\r\n\t\t\t\r\n\t\t\titem.node.style.left = x + \"px\"\r\n\t\t\titem.node.style.top  = y + \"px\"\r\n\t\t\t\r\n\t\t\tif(ondrag){ondrag()};\r\n\t\t} // if\r\n\t} // mousemove\r\n\titem.node.onmouseup   = function(){\r\n\t\tactive = false;\r\n\t\tif(onend){onend()};\r\n\t} // onmouseup\r\n} // addDraggingToItem\r\n\r\n\r\n\r\n\r\n// Will I need this dragging elsewhere??\r\nexport function addDraggingToSvgItem(svg, item){\r\n\t// SVG movement should be done in SVG coordinates. As the SVG is small, and never moves off screen, the relative position can be calculated on hte go.\r\n\t// The item can never move off the svg, as when it's dragged to the border and the mouse moves over the edge it stops being dragged. The rectangle is well behaved when the mouse re-enters the svg, and only skips when the rectangle is re-entered. Still, it may be good to stop the dragging if th emouse leaves the svg.\r\n\t\r\n\tlet active = false;\r\n\tlet clickedItemOffset = [0,0];\r\n\t\r\n\t\r\n\titem.onmousedown = function(e){\r\n\t\tactive = true;\r\n\t\t\r\n\t\t// Correcting for clicked position within item.\r\n\t\tlet itemClientRect = item.getBoundingClientRect();\r\n\t\tclickedItemOffset = {\r\n\t\t\tx: itemClientRect.x - e.clientX,\r\n\t\t\ty: itemClientRect.y - e.clientY\r\n\t\t} // clickedItemOffset\r\n\t} // onmousedown\r\n\titem.onmousemove = function(e){\r\n\t\tif(active){\r\n\t\t\t// Convert the mouse position into the position within the parent SVG:\r\n\t\t\tlet svgClientRect = svg.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\t// Check if the mouse left the svg.\r\n\t\t\tif(isEventWithinRectangle(e, svgClientRect)){\r\n\t\t\t\tlet x = e.clientX - svgClientRect.x + clickedItemOffset.x;\r\n\t\t\t\tlet y = e.clientY - svgClientRect.y + clickedItemOffset.y;\r\n\t\t\t\t\r\n\t\t\t\titem.setAttribute(\"x\", x)\r\n\t\t\t\titem.setAttribute(\"y\", y)\r\n\t\t\t} else {\r\n\t\t\t\tactive = false;\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t} // if\r\n\t} // mousemove\r\n\titem.onmouseup   = function(){\r\n\t\tactive = false;\r\n\t} // onmouseup\r\n} // addDraggingToItem\r\n\r\n\r\nexport function isEventWithinBoundingClientRect(e, rect){\r\n\treturn ( e.clientX > rect.x && e.clientX < rect.x + rect.width ) &&\r\n\t       ( e.clientY > rect.y && e.clientY < rect.y + rect.height );\r\n} // isEventWithinRectangle\r\n\r\n\r\n\r\nexport class scaleLinear {\r\n  \r\n  _domain = [0, 1]\r\n  _range = [0, 1]\r\n\r\n  set domain(d){ this._domain = d } // domain\r\n  get domain(){ return this._domain } // domain\r\n\r\n  set range(r){ this._range = r } // range\r\n  get range(){ return this._range } // range\r\n\r\n  dom2range(v){\r\n\treturn mapSpaceAValueToSpaceB(v, this.domain, this.range)\r\n  } // dom2range\r\n  \r\n  range2dom(v){\r\n\treturn mapSpaceAValueToSpaceB(v, this.range, this.domain)  \r\n  } // range2dom\r\n} // scaleLinear\r\n\r\nfunction mapSpaceAValueToSpaceB(v, A, B){\r\n\treturn (v-A[0])/(A[1]-A[0]) * (B[1]-B[0]) + B[0]\r\n} // mapSpaceAValueToSpaceB","import { html2element } from \"../helpers.js\";\r\n\r\n// What happens if we add a wrapper, so that the wrapper is positioned, but the div is scaled?\r\nlet template = `\r\n<div class=\"item\">\r\n  <div class=\"label unselectable\">Label</div>\r\n  <div class=\"view\">\r\n  </div>\r\n</div>\r\n`;\r\n\r\n// This item should be support use as a single object, as well as a group. Just depends on the tasks coming in.\r\n\r\n// The Item will have to be scalable!!\r\nexport default class Item{\r\n\t\r\n  // Main viewport dimensions;\r\n  width = 300;\r\n  height = 200;\r\n\t\r\n  constructor(task){\r\n\tlet obj = this;\r\n\t  \r\n\tobj.task = task;\r\n\tobj.node = html2element(template);\r\n\t  \r\n\tobj.viewnode = obj.node.querySelector(\"div.view\");\r\n\tobj.viewnode.style.height = obj.height + \"px\";\r\n\tobj.viewnode.style.width = obj.width + \"px\";\r\n\t  \r\n\t  \r\n\tobj.node.querySelector(\"div.label\").innerHTML = task.taskId;\r\n\t  \r\n\t\r\n\t// Add the dragging in here. The dragging is supposed to be in a scaled, and potentially tranlated div, so the offset to the div needs to be removed.\r\n\tlet active = false;\r\n\tlet itemRelativePosition = [0, 0];\r\n\t\t\r\n\tobj.node.onmousedown = function(e){\r\n\t  if(e.target == obj.node){\r\n\t\te.preventDefault();\r\n\t\tlet rect = obj.node.getBoundingClientRect();\r\n\t\t\r\n\t\tactive = true;\r\n\t\titemRelativePosition = [\r\n\t\t  e.clientX - rect.x,\r\n\t\t  e.clientY - rect.y\r\n\t\t];\r\n\t\t\r\n\t\t// Also move the viewFrame div up so that dragging over otehr higher divs is uninterrupted.\r\n\t\tobj.node.parentNode.insertBefore(obj.node, null);\r\n\t  } // if\r\n\t} // onmousedown\r\n\tobj.node.onmousemove = function(e){\r\n\t  if(active){\r\n\t\te.preventDefault();\r\n\t\t\r\n\t\t// The parent may be rescaled, retrieve and collect the k from it.\r\n\t\tlet p = obj.node.parentElement;\r\n\t\tlet k = Number( p.style.transform.split(\" \")[0].replace(/^\\D+|\\D+$/g, \"\") );\r\n\t\tlet parentRect = p.getBoundingClientRect();\r\n\t\t\r\n\t\tlet x = e.pageX - parentRect.x - itemRelativePosition[0];\r\n\t\tlet y = e.pageY - parentRect.y - itemRelativePosition[1];\r\n\t\t\t\t\r\n\t\tobj.node.style.left = x/k + \"px\";\r\n\t\tobj.node.style.top  = y/k + \"px\";\r\n\t\t\r\n\t\tobj.onmove();\r\n\t  } // if\r\n\t} // mousemove\r\n\tobj.node.onmouseup = function(){ active = false; } // onmouseup\r\n\tobj.node.onmouseenter = function(){ active = false; } // onmouseenter\r\n\tobj.node.onmouseleave = function(){ active = false; } // onmouseleave\r\n  } // constructor\r\n  \r\n  // Dummy method that evaluates when the item is being repositioned.\r\n  onmove(){} // onmove\r\n  \r\n} // Item","import { svg2element } from \"../helpers.js\";\r\n\r\nlet template = `<circle r=\"5\" fill=\"orange\"></circle>`; // template\r\n\r\nexport default class MiniMapIcon{\r\n    constructor(item){\r\n\t\tlet obj = this;\r\n\t\tobj.item = item;\r\n\t\tobj.node = svg2element(template);\r\n\t} // constructor\r\n\t\r\n\r\n\tupdate(xscale, yscale){\r\n\t\t// The scales must be given from the parent, and the icon uses them to position itself.\r\n\t\t// The scales should incorporate both the panning and zooming adjustements needed.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Update the position of the circle with the center point of the DOM card.\r\n\t\tlet itemClientRect = obj.item.node.getBoundingClientRect();\r\n\t\t\t\r\n\t\tlet x = itemClientRect.left + itemClientRect.width/2;\r\n\t\tlet y = itemClientRect.top + itemClientRect.height/2;\r\n\t\t\r\n\t\tobj.node.setAttribute(\"cx\", xscale.dom2range( x ));\r\n\t\tobj.node.setAttribute(\"cy\", yscale.dom2range( y ));\r\n\t\t\r\n\t} // update\r\n} // MiniMapIcon","import { svg2element, isEventWithinBoundingClientRect } from \"../helpers.js\";\r\n\r\nlet template = `<rect class=\"current\" x=\"50\" y=\"10\" width=\"150\" height=\"50\" fill=\"black\" opacity=\"0.5\"></rect>`\r\n\r\nexport default class MiniMapViewRect{\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.node = svg2element(template);\r\n\t\t\r\n\t\t\r\n\t\t// Make it draggable.\r\n\t\tlet active, clickedItemOffset;\r\n\t\r\n\t\r\n\t\tobj.node.onmousedown = function(e){\r\n\t\t\tactive = true;\r\n\t\t\t\r\n\t\t\t// Correcting for clicked position within item.\r\n\t\t\tlet itemClientRect = obj.node.getBoundingClientRect();\r\n\t\t\tclickedItemOffset = {\r\n\t\t\t\tx: itemClientRect.x - e.clientX,\r\n\t\t\t\ty: itemClientRect.y - e.clientY\r\n\t\t\t} // clickedItemOffset\r\n\t\t} // onmousedown\r\n\t\tobj.node.onmousemove = function(e){\r\n\t\t\tif(active){\r\n\t\t\t\t// Convert the mouse position into the position within the parent SVG. ASSUME that the parent element is the SVG.\r\n\t\t\t\tlet svgClientRect = obj.node.parentElement.getBoundingClientRect();\r\n\t\t\t\t\r\n\t\t\t\t// Check if the mouse left the svg.\r\n\t\t\t\tif(isEventWithinBoundingClientRect(e, svgClientRect)){\r\n\t\t\t\t\tlet x = e.clientX - svgClientRect.x + clickedItemOffset.x;\r\n\t\t\t\t\tlet y = e.clientY - svgClientRect.y + clickedItemOffset.y;\r\n\t\t\t\t\t\r\n\t\t\t\t\tobj.node.setAttribute(\"x\", x);\r\n\t\t\t\t\tobj.node.setAttribute(\"y\", y);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Now all the DOM items should be moved.\r\n\t\t\t\t\tobj.reposition();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactive = false;\r\n\t\t\t\t} // if\r\n\t\t\t\t\r\n\t\t\t} // if\r\n\t\t} // mousemove\r\n\t\tobj.node.onmouseup   = function(){\r\n\t\t\tactive = false;\r\n\t\t} // onmouseup\r\n\t\t\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\t\r\n\tinit(xscale, yscale){\r\n\t\tlet obj = this;\r\n\t\t// Reposition the viewrect back to the origin.\r\n\t\tobj.node.setAttribute(\"x\",  xscale.dom2range(0) );\r\n\t\tobj.node.setAttribute(\"y\",  yscale.dom2range(0) );\r\n\t} // init\r\n\t\r\n\t\r\n\t// The data to position the icons comes from boundingClientRect, which is the positions on hte screen. In that case\r\n\tupdate(xscale, yscale){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The viewrect represents the window.\r\n\t\tlet width = xscale.dom2range(window.innerWidth) - xscale.dom2range(0);\r\n\t\tlet height = yscale.dom2range(window.innerHeight) - yscale.dom2range(0);\r\n\t\t\r\n\t\tobj.node.setAttribute(\"width\",  width )\r\n\t\tobj.node.setAttribute(\"height\", height )\r\n\t} // update\r\n\t\r\n\t// Dummy function that gets changed by the minimap;\r\n\treposition(){} // reposition\r\n\t\r\n} // MiniMapViewRect","import { svg2element, scaleLinear } from \"../helpers.js\";\r\nimport MiniMapIcon from \"./MiniMapIcon.js\";\r\nimport MiniMapViewRect from \"./MiniMapViewRect.js\";\r\n/*\r\nThe initial arrangement is not the problem of this module. This module just visualises the current arrangement, and allows global navigation.\r\n\r\nThe panning/zooming should be made available on hte background also.\r\n*/\r\nconst template = `<svg style=\"border: 2px solid black; display: block;\">\r\n  <g class=\"icons\"></g>\r\n</svg>`; // template\r\n\r\n\r\n// All the data should be on the minimap at all times, including any rearranged items. That means that the scale domain may have to be redone every time there is a rearrangement event.\r\n\r\n\r\nexport default class MiniMap{\r\n\t\r\n\twidth = 300;\r\n\theight = 200;\r\n\ticons = [];\r\n\t\r\n\tconstructor(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\tobj.node = svg2element(template);\r\n\t\tobj.node.setAttribute(\"width\", obj.width);\r\n\t\tobj.node.setAttribute(\"height\", obj.height);\r\n\t\t\r\n\t\t\r\n\t\t// The rectangle should have the proportions of the screen.\r\n\t\t\r\n\t\t\r\n\t\t// Abstract the viewrect out??\r\n\t\tobj.viewrect = new MiniMapViewRect();\r\n\t\tobj.node.appendChild(obj.viewrect.node)\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// When the square moves the main view should be updated. How to do the update?\r\n\t\t// Should tehre be an offset applied? This doesn't seem neat\r\n\t\t// Should the items keep track of their coordinates and sizes in initial coordinates, which would then be converted to the browser coordinates depending on the view.\r\n\t\t// scrollLeft and scrollTop are bounded by 0 on each side, so the items can either be repositioned initially, or I keep track of the coordnates internally.\r\n\t\t\r\n\t\t// Then the position components need to be tracked independently, as they are changed through different interactions. So keep track of the initial position and size, and the user dragging offset separately.\r\n\t\t\r\n\t\t// The dragging just applies the offset from the original position to the current cursor position. Maybe instead of storing the components I can just transform back, and apply the new transform?\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// Add scrolling to the rect!\r\n\t\t\r\n\t\t// Create the scales to map the necessary range to the size of the svg.\r\n\t\tobj.xscale = new scaleLinear();\r\n\t\tobj.xscale.range = [0, obj.width];\r\n\t\t\r\n\t\tobj.yscale = new scaleLinear();\r\n\t\tobj.yscale.range = [0, obj.height];\r\n\t\t\r\n\t} // constructor\r\n\t\r\n\tgetoffset(){\r\n\t    let obj = this;\r\n\t    return [obj.xscale.range2dom( obj.viewrect.node.getAttribute(\"x\") ),\r\n\t            obj.yscale.range2dom( obj.viewrect.node.getAttribute(\"y\") ) ];\r\n\t} // getoffset\r\n\t\r\n\t// Update the circle representations.\r\n\tupdate(items){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// If items have been given, then change the circles.\r\n\t\tif(items){\r\n\t\t\tlet container = obj.node.querySelector(\"g.icons\");\r\n\t\t\tobj.icons = items.map(item=>{\r\n\t\t\t\tlet icon = new MiniMapIcon(item);\r\n\t\t\t\tcontainer.appendChild(icon.node);\r\n\t\t\t\treturn icon;\r\n\t\t\t}) // map\r\n\t\t} // items\r\n\t\t\r\n\t\t\r\n\t\t// New items arrived, the square is resized, and the icons should be positioned. Make the items all fit within the square? Or just map the screen directly onto the minimap? Or just scale the square to what can be seen on the main screen?\r\n\t\t\r\n\t\t\r\n\t\t// Redraw minimap\r\n\t\tobj.centerdata();\r\n\t\tobj.viewrect.init(obj.xscale, obj.yscale);\r\n\t\tobj.render()\r\n\t\t \r\n\t} // update\r\n\t\r\n\t\r\n\tcenterdata(){\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// The minimap should show all the items at all times, thus the minimap domain needs to span all the positions of the items in both the x and y dimensions, while preserving AR=1. The data AR won't be the same as the minimap AR, and therefore the data domain is recalculated to fit into the minimap square.\r\n\t\t\r\n\t\tlet domains = calculateInitialMinimapDomain(obj.icons.map(icon=>icon.item));\r\n\t\t\r\n\t\t// The maximum domain AR must be selected to accomodate all the data. Then the domains can be centered on hte minimap.\r\n\t\tlet xdiff = domains.x[1] - domains.x[0];\r\n\t\tlet ydiff = domains.y[1] - domains.y[0];\r\n\t\tlet u = 1.1*Math.max( xdiff / obj.width, ydiff / obj.height )\r\n\t\t\r\n\t\t// Reset the scale domains to center the data.\r\n\t\tobj.xscale.domain = [domains.x[0] + xdiff/2 - u*obj.width/2, domains.x[0] + xdiff/2 + u*obj.width/2];\r\n\t\tobj.yscale.domain = [domains.y[0] + ydiff/2 - u*obj.height/2, domains.y[0] + ydiff/2 + u*obj.height/2];\r\n\t\t\r\n\t} // centerdata\r\n\t\r\n\t\r\n\trender(){\r\n\t\t// Redraw the minimap. Called after the user rearranges the items.\r\n\t\tlet obj = this;\r\n\t\t\r\n\t\t// Resize the viewrect to the right aspect ratio and size.\r\n\t\tobj.viewrect.update(obj.xscale, obj.yscale);\r\n\t\t\r\n\t\t// Redo the icons.\r\n\t\tobj.icons.forEach(icon=>{\r\n\t\t\ticon.update(obj.xscale, obj.yscale);\r\n\t\t}) // forEach\r\n\t} // render\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n} // Minimap\r\n\r\n\r\n\r\nfunction calculateInitialMinimapDomain(items){\r\n\t// The workspace and the minimap have no domain limitations, but the minimap should initially be scaled such that all the points are in view. When zooming the rectangle will then change size when scrolled.\r\n\t\r\n\tlet bodyClientRect = document.body.getBoundingClientRect();\r\n\t\r\n\treturn items.reduce((acc,item)=>{\r\n\t\tlet itemClientRect = item.node.getBoundingClientRect();\r\n\t\t\r\n\t\t// Calculate the positions of hte icons based on the center of the item.\r\n\t\tlet minx = itemClientRect.left - bodyClientRect.left;\r\n\t\tlet maxx = itemClientRect.left - bodyClientRect.left + itemClientRect.width;\r\n\t\t \r\n\t\tlet miny = itemClientRect.top - bodyClientRect.top;\r\n\t\tlet maxy = itemClientRect.top - bodyClientRect.top + itemClientRect.height;\r\n\t\t\r\n\t\tacc.x[0] = minx < acc.x[0] ? minx : acc.x[0];\r\n\t\tacc.x[1] = maxx > acc.x[1] ? maxx : acc.x[1];\r\n\t\t\r\n\t\tacc.y[0] = miny < acc.y[0] ? miny : acc.y[0];\r\n\t\tacc.y[1] = maxy > acc.y[1] ? maxy : acc.y[1];\r\n\t\treturn acc\r\n\t}, {\r\n\t\tx: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY], \r\n\t\ty: [Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY]\r\n\t}) // reduce\r\n} // calculateInitialMinimapDomain","import MiniMap from \"./MiniMap.js\";\r\n\r\n/*\r\nA drop in class that provides zooming, panning, minimap, and the tree hierarchy navigaton.\r\n*/\r\nexport default class NavigationManager{\r\n\t\r\n  items = []\r\n\t\r\n  scale = 1;\r\n  dx = 0;\r\n  dy = 0;\r\n\t\r\n  constructor(){\r\n    let obj = this;\r\n\t\r\n\t\r\n\tobj.tabletop = document.getElementById(\"tabletop\");\r\n    obj.container = obj.tabletop.querySelector(\"div.scalingwrapper\");\r\n\t\r\n\t// // Use transform: scale() to achieve the zoom in and out functionality, and transform: translate(xpx,ypx) for panning. First a default trnasform should be assigned.\r\n\tobj.container.style.transform = `scale(1) translate(0px,0px)`;\r\n\t\r\n\r\n\t\r\n\t\r\n\t// make a minimap and include the items on it.\r\n\tobj.minimap = new MiniMap();\r\n\tdocument.getElementById(\"minimap\").appendChild(obj.minimap.node);\r\n\t\r\n\r\n\t\r\n\r\n\t// ZOOMING\r\n\tfunction zoom(event) {\r\n\t  event.preventDefault();\r\n\r\n\t  obj.scale += event.deltaY * -0.001;\r\n\r\n\t  // Restrict scale\r\n\t  obj.scale = Math.min(Math.max(.125, obj.scale), 4);\r\n\r\n\t  // Apply scale transform\r\n\t  obj.adjustview();\r\n\t}; // zoom\r\n\t\r\n\tobj.tabletop.onwheel = zoom;\r\n\tobj.minimap.viewrect.node.onwheel = zoom;\r\n\tobj.minimap.viewrect.reposition = function(){\r\n\t\tlet offset = obj.minimap.getoffset();\r\n\t\tobj.dx = - offset[0] / obj.scale;\r\n\t\tobj.dy = - offset[1] / obj.scale;\r\n\t\t// No minimap update here!!\r\n\t\tobj.container.style.transform = obj.currenttransform();\r\n\t}; // reposition\r\n\t\r\n\t// Here the dragging doesn't move the item, but rather a different element.\r\n\tlet active, origin, e0\r\n\t\t\r\n\tobj.tabletop.onmousedown = function(e){\r\n\t  console.log(\"onmousedown tabletop\")\r\n\t  if(e.target == obj.tabletop){\r\n\t\te.preventDefault();\r\n\t\tactive = true;\r\n\t\torigin = {x: obj.dx, y: obj.dy};\r\n\t\te0 = e;\r\n\t  } // if\r\n\t} // onmousedown\r\n\t\r\n\tobj.tabletop.onmousemove = function(e){\r\n\t  if(active){\r\n\t\te.preventDefault();\r\n\t\t\r\n\t\t// The elements should move in hte dragged direction.\r\n\t\tobj.dx = origin.x + e.clientX - e0.clientX;\r\n\t\tobj.dy = origin.y + e.clientY - e0.clientY;\r\n\t\t\r\n\t\t// Move the items.\r\n\t\tobj.adjustview();\r\n\t\t\r\n\t\t\r\n\t  } // if\r\n\t} // mousemove\r\n\tobj.tabletop.onmouseup = function(){ active = false; } // onmouseup\r\n\tobj.tabletop.onmouseenter = function(){ active = false; } // onmouseenter\r\n\tobj.tabletop.onmouseleave = function(){ active = false; } // onmouseleave\r\n\t\r\n\t\r\n\t\r\n\t\r\n  } // constructor\r\n  \r\n  \r\n  adjustview(){\r\n\tlet obj = this;\r\n\t// When the view is adjusted the items should also be told to check their sizes, and react is needed.\r\n\tobj.container.style.transform = obj.currenttransform();\r\n\t\r\n\t// Update the minimap\r\n\tobj.minimap.update();\r\n  } // adjustview\r\n  \r\n  currenttransform(){\r\n\tlet obj = this;\r\n\treturn `scale(${obj.scale}) translate(${obj.dx}px,${obj.dy}px)`;\r\n  }; // gettransform\r\n  \r\n  \r\n  \r\n} // NavigationManager\r\n\r\n\r\n","/*\r\nThis should connect to the server, receive some data, and create the spatial arrangement environment.\r\n*/\r\n\r\nimport Item from \"./grouping/Item.js\";\r\nimport NavigationManager from \"./navigation/NavigationManager.js\";\r\n\r\n\r\n\r\n\r\n\r\nconst data = [\r\n{taskId: \"task 0\", sepal_length: 5.1, sepal_width: 3.5},\r\n{taskId: \"task 1\", sepal_length: 4.9, sepal_width: 3},\r\n{taskId: \"task 2\", sepal_length: 4.7, sepal_width: 3.2},\r\n{taskId: \"task 3\", sepal_length: 4.6, sepal_width: 3.1},\r\n{taskId: \"task 4\", sepal_length: 5, sepal_width: 3.6},\r\n{taskId: \"task 5\", sepal_length: 5.4, sepal_width: 3.9},\r\n{taskId: \"task 6\", sepal_length: 4.6, sepal_width: 3.4},\r\n{taskId: \"task 7\", sepal_length: 5, sepal_width: 3.4},\r\n{taskId: \"task 8\", sepal_length: 4.4, sepal_width: 2.9},\r\n{taskId: \"task 9\", sepal_length: 4.9, sepal_width: 3.1},\r\n{taskId: \"task 10\", sepal_length: 5.4, sepal_width: 3.7},\r\n{taskId: \"task 11\", sepal_length: 4.8, sepal_width: 3.4},\r\n{taskId: \"task 12\", sepal_length: 4.8, sepal_width: 3},\r\n{taskId: \"task 13\", sepal_length: 4.3, sepal_width: 3},\r\n{taskId: \"task 14\", sepal_length: 5.8, sepal_width: 4},\r\n{taskId: \"task 15\", sepal_length: 5.7, sepal_width: 4.4}\r\n]; // data\r\n\r\n// Items\r\nvar workspace = new NavigationManager();\r\n\r\nvar items = [] \r\n\r\nfor(let i=0; i<data.length; i++){\r\n\tlet item = new Item(data[i])\r\n\titems.push(item);\r\n\t\r\n\t// Make navigation manager keep track of the item.\r\n\tworkspace.container.appendChild(item.node);\r\n\titem.onmove = function(){\r\n\t\tworkspace.minimap.update();\r\n\t} // onmove\r\n} // for\r\n\r\n\r\n// Update the minimap with all the items. This could be implemented in a nicer way it feels.\r\nworkspace.minimap.update(items);\r\n\r\n// The initial positioning is done based on \"position: relative;\"\r\nlet headeroffset = 80;\r\nlet positions = items.reduce((acc,item)=>{\r\n\tacc.push([item.node.offsetLeft, item.node.offsetTop + headeroffset])\r\n\treturn acc\r\n},[])\r\n\r\n// Now positionthem absolutely, and add the dragging.\r\nitems.forEach((item,i)=>{\r\n\titem.node.style.position = \"absolute\";\r\n\titem.node.style.left = positions[i][0] + \"px\"\r\n\titem.node.style.top = positions[i][1] + \"px\"\r\n}) // forEach\r\n\r\n\r\n\r\n\r\n// ALL NAVIGATION BELOW\r\n\r\n// If all of the navigation is in onle class, then that class could keep a reference for the scale, and then on every update communicate it to the member modules.\r\n\r\n// The tabletop should support zooming and panning\r\n// The minimap should support zooming and panning\r\n// So maybe no panning on hte tabletop??\r\n\r\n// If there is panning on the tabletop, then how will hte lasso svg become active?\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["html2element","html","template","document","createElement","innerHTML","trim","content","firstChild","svg2element","svg","g","createElementNS","isEventWithinBoundingClientRect","e","rect","clientX","x","width","clientY","y","height","scaleLinear","_domain","_range","d","r","v","mapSpaceAValueToSpaceB","domain","range","A","B","Item","task","obj","node","viewnode","querySelector","style","taskId","active","itemRelativePosition","onmousedown","target","preventDefault","getBoundingClientRect","parentNode","insertBefore","onmousemove","p","parentElement","k","Number","transform","split","replace","parentRect","pageX","pageY","left","top","onmove","onmouseup","onmouseenter","onmouseleave","MiniMapIcon","item","xscale","yscale","itemClientRect","setAttribute","dom2range","MiniMapViewRect","clickedItemOffset","svgClientRect","reposition","window","innerWidth","innerHeight","MiniMap","icons","viewrect","appendChild","range2dom","getAttribute","items","container","map","icon","centerdata","init","render","domains","calculateInitialMinimapDomain","xdiff","ydiff","u","Math","max","update","forEach","bodyClientRect","body","reduce","acc","minx","maxx","miny","maxy","POSITIVE_INFINITY","NEGATIVE_INFINITY","NavigationManager","scale","dx","dy","tabletop","getElementById","minimap","zoom","event","deltaY","min","adjustview","onwheel","offset","getoffset","currenttransform","origin","e0","console","log","data","sepal_length","sepal_width","workspace","i","length","push","headeroffset","positions","offsetLeft","offsetTop","position"],"mappings":"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"}